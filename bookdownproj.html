<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Cartografia Temática em R para estudantes de Geografia</title>
  <meta name="description" content="Cartografia Temática em R para estudantes de Geografia" />
  <meta name="generator" content="bookdown #bookdown:version# and GitBook 2.6.7" />

  <meta property="og:title" content="Cartografia Temática em R para estudantes de Geografia" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Cartografia Temática em R para estudantes de Geografia" />
  
  
  

<meta name="author" content="Ligia Vizeu Barrozo" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<!--bookdown:link_prev-->
<!--bookdown:link_next-->
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



<!--bookdown:title:start-->
<div id="header">
<h1 class="title">Cartografia Temática em R para estudantes de Geografia</h1>
<p class="author"><em>Ligia Vizeu Barrozo</em></p>
<p class="date"><em>06-18-2023</em></p>
</div>
<!--bookdown:title:end-->

<!--bookdown:toc:start-->
  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">
<!--bookdown:toc2:start-->
<ul>
<li><a href="#apresentação" id="toc-apresentação">Apresentação</a>
<ul>
<li><a href="#referência-citada" id="toc-referência-citada">Referência citada</a></li>
</ul></li>
<li><a href="#sobre-o-livro" id="toc-sobre-o-livro">Sobre o livro</a></li>
<li><a href="#agradecimentos" id="toc-agradecimentos">Agradecimentos</a></li>
<li><a href="#intro" id="toc-intro"><span class="toc-section-number">1</span> Introdução</a>
<ul>
<li><a href="#o-programa-r" id="toc-o-programa-r"><span class="toc-section-number">1.1</span> O programa R</a></li>
<li><a href="#instalação-do-r-e-rstudio" id="toc-instalação-do-r-e-rstudio"><span class="toc-section-number">1.2</span> Instalação do R e RStudio</a>
<ul>
<li><a href="#instalação-do-r-para-windows" id="toc-instalação-do-r-para-windows"><span class="toc-section-number">1.2.1</span> Instalação do R para Windows</a></li>
<li><a href="#instalação-do-r-para-mac" id="toc-instalação-do-r-para-mac"><span class="toc-section-number">1.2.2</span> Instalação do R para Mac</a></li>
<li><a href="#instalação-do-rstudio" id="toc-instalação-do-rstudio"><span class="toc-section-number">1.2.3</span> Instalação do RStudio</a></li>
<li><a href="#instalação-do-rtools" id="toc-instalação-do-rtools"><span class="toc-section-number">1.2.4</span> Instalação do RTools</a></li>
</ul></li>
</ul></li>
<li><a href="#básico-do-básico-do-r-e-rstudio" id="toc-básico-do-básico-do-r-e-rstudio"><span class="toc-section-number">2</span> Básico do básico do R e RStudio</a>
<ul>
<li><a href="#os-paineis" id="toc-os-paineis"><span class="toc-section-number">2.1</span> Os paineis</a></li>
<li><a href="#tipos-de-objetos" id="toc-tipos-de-objetos"><span class="toc-section-number">2.2</span> Tipos de objetos</a></li>
<li><a href="#estrutura-dos-dados" id="toc-estrutura-dos-dados"><span class="toc-section-number">2.3</span> Estrutura dos dados</a></li>
<li><a href="#vetores" id="toc-vetores"><span class="toc-section-number">2.4</span> Vetores</a></li>
<li><a href="#nomeando-os-vetores" id="toc-nomeando-os-vetores"><span class="toc-section-number">2.5</span> Nomeando os vetores</a></li>
<li><a href="#seleção-em-vetores" id="toc-seleção-em-vetores"><span class="toc-section-number">2.6</span> Seleção em vetores</a></li>
<li><a href="#totais-e-médias-em-vetores" id="toc-totais-e-médias-em-vetores"><span class="toc-section-number">2.7</span> Totais e médias em vetores</a></li>
<li><a href="#matrizes" id="toc-matrizes"><span class="toc-section-number">2.8</span> Matrizes</a></li>
<li><a href="#cálculos-em-matrizes" id="toc-cálculos-em-matrizes"><span class="toc-section-number">2.9</span> Cálculos em Matrizes</a></li>
<li><a href="#seleção-em-matrizes" id="toc-seleção-em-matrizes"><span class="toc-section-number">2.10</span> Seleção em Matrizes</a></li>
<li><a href="#fatores" id="toc-fatores"><span class="toc-section-number">2.11</span> Fatores</a></li>
<li><a href="#referências-citadas" id="toc-referências-citadas"><span class="toc-section-number">2.12</span> Referências citadas</a></li>
</ul></li>
<li><a href="#dataframes" id="toc-dataframes"><span class="toc-section-number">3</span> Dataframes</a>
<ul>
<li><a href="#criação-de-dataframe" id="toc-criação-de-dataframe"><span class="toc-section-number">3.1</span> Criação de dataframe</a></li>
<li><a href="#importação-de-um-dataframe" id="toc-importação-de-um-dataframe"><span class="toc-section-number">3.2</span> Importação de um dataframe</a></li>
</ul></li>
<li><a href="#tidyverse" id="toc-tidyverse"><span class="toc-section-number">4</span> Básico do Tidyverse</a>
<ul>
<li><a href="#o-operador-pipe-no-tidyverse" id="toc-o-operador-pipe-no-tidyverse"><span class="toc-section-number">4.1</span> O operador Pipe no tidyverse</a></li>
<li><a href="#selecionando-colunas" id="toc-selecionando-colunas"><span class="toc-section-number">4.2</span> Selecionando colunas</a></li>
<li><a href="#combinando-dataframes" id="toc-combinando-dataframes"><span class="toc-section-number">4.3</span> Combinando dataframes</a></li>
<li><a href="#filtrando-observações" id="toc-filtrando-observações"><span class="toc-section-number">4.4</span> Filtrando observações</a></li>
<li><a href="#organizando-uma-tabela-com-a-função-arrange" id="toc-organizando-uma-tabela-com-a-função-arrange"><span class="toc-section-number">4.5</span> Organizando uma tabela com a função <code>arrange()</code></a></li>
<li><a href="#o-verbo-mutate" id="toc-o-verbo-mutate"><span class="toc-section-number">4.6</span> O verbo “mutate”</a></li>
<li><a href="#agrupando-dados-com-a-função-group_by" id="toc-agrupando-dados-com-a-função-group_by"><span class="toc-section-number">4.7</span> Agrupando dados com a função <code>group_by</code></a></li>
<li><a href="#rumo-aos-mapas" id="toc-rumo-aos-mapas"><span class="toc-section-number">4.8</span> Rumo aos mapas</a></li>
</ul></li>
<li><a href="#tipos" id="toc-tipos"><span class="toc-section-number">5</span> Tipos de dados, conceitos e representação cartográfica</a>
<ul>
<li><a href="#definição-do-tipo-de-representação-cartográfica" id="toc-definição-do-tipo-de-representação-cartográfica"><span class="toc-section-number">5.1</span> Definição do tipo de representação cartográfica</a></li>
<li><a href="#variáveis-visuais" id="toc-variáveis-visuais"><span class="toc-section-number">5.2</span> Variáveis visuais</a></li>
<li><a href="#o-conceito-diversidade" id="toc-o-conceito-diversidade"><span class="toc-section-number">5.3</span> O conceito <em>diversidade</em></a></li>
<li><a href="#o-conceito-ordem" id="toc-o-conceito-ordem"><span class="toc-section-number">5.4</span> O conceito <em>ordem</em></a></li>
<li><a href="#o-conceito-de-proporcionalidade" id="toc-o-conceito-de-proporcionalidade"><span class="toc-section-number">5.5</span> O conceito de <em>proporcionalidade</em></a></li>
<li><a href="#referências-sugeridas" id="toc-referências-sugeridas"><span class="toc-section-number">5.6</span> Referências sugeridas</a></li>
</ul></li>
<li><a href="#quali1" id="toc-quali1"><span class="toc-section-number">6</span> Dados qualitativos: mapa corocromático nominal</a>
<ul>
<li><a href="#instalando-e-carregando-pacotes-do-r" id="toc-instalando-e-carregando-pacotes-do-r"><span class="toc-section-number">6.1</span> Instalando e carregando pacotes do R</a></li>
<li><a href="#o-pacote-geobr" id="toc-o-pacote-geobr"><span class="toc-section-number">6.2</span> O pacote geobr</a></li>
<li><a href="#projeção-cartográfica" id="toc-projeção-cartográfica"><span class="toc-section-number">6.3</span> Projeção cartográfica</a></li>
<li><a href="#iniciando-com-o-ggplot2" id="toc-iniciando-com-o-ggplot2"><span class="toc-section-number">6.4</span> Iniciando com o ggplot2</a></li>
<li><a href="#biomas-do-brasil" id="toc-biomas-do-brasil"><span class="toc-section-number">6.5</span> Biomas do Brasil</a></li>
<li><a href="#referências-citadas-1" id="toc-referências-citadas-1">Referências citadas</a></li>
</ul></li>
<li><a href="#quali2" id="toc-quali2"><span class="toc-section-number">7</span> Dados qualitativos: mapa corocromático ordinal</a>
<ul>
<li><a href="#banco-de-dados" id="toc-banco-de-dados"><span class="toc-section-number">7.1</span> Banco de dados</a></li>
<li><a href="#potencial-de-agressividade-climática-na-amazônia-legal-do-brasil" id="toc-potencial-de-agressividade-climática-na-amazônia-legal-do-brasil"><span class="toc-section-number">7.2</span> Potencial de agressividade climática na Amazônia Legal do Brasil</a></li>
</ul></li>
<li><a href="#quanti1" id="toc-quanti1"><span class="toc-section-number">8</span> Dados quantitativos absolutos: mapa das figuras geométricas proporcionais</a>
<ul>
<li><a href="#bases-de-dados" id="toc-bases-de-dados"><span class="toc-section-number">8.1</span> Bases de dados</a></li>
<li><a href="#centroides-dos-municípios" id="toc-centroides-dos-municípios"><span class="toc-section-number">8.2</span> Centroides dos municípios</a></li>
<li><a href="#mapa-da-população-do-estado-de-são-paulo" id="toc-mapa-da-população-do-estado-de-são-paulo"><span class="toc-section-number">8.3</span> Mapa da população do estado de São Paulo</a></li>
<li><a href="#referências-sugeridas-1" id="toc-referências-sugeridas-1"><span class="toc-section-number">8.4</span> Referências sugeridas</a></li>
</ul></li>
<li><a href="#quanti2" id="toc-quanti2"><span class="toc-section-number">9</span> Dados quantitativos absolutos: mapa dos pontos de contagem (ou densidade de pontos)</a>
<ul>
<li><a href="#bases-de-dados-1" id="toc-bases-de-dados-1"><span class="toc-section-number">9.1</span> Bases de dados</a></li>
<li><a href="#definição-dos-pontos-aleatórios" id="toc-definição-dos-pontos-aleatórios"><span class="toc-section-number">9.2</span> Definição dos pontos aleatórios</a></li>
<li><a href="#mapa-de-raça-ou-cor-dos-residentes-do-município-de-são-paulo" id="toc-mapa-de-raça-ou-cor-dos-residentes-do-município-de-são-paulo"><span class="toc-section-number">9.3</span> Mapa de raça ou cor dos residentes do município de São Paulo</a></li>
<li><a href="#referências-sugeridas-2" id="toc-referências-sugeridas-2"><span class="toc-section-number">9.4</span> Referências sugeridas</a></li>
</ul></li>
<li><a href="#quanti3" id="toc-quanti3"><span class="toc-section-number">10</span> Dados quantitativos relativos: mapa coroplético</a>
<ul>
<li><a href="#bancos-de-dados" id="toc-bancos-de-dados"><span class="toc-section-number">10.1</span> Bancos de dados</a></li>
<li><a href="#mapas-coropléticos" id="toc-mapas-coropléticos"><span class="toc-section-number">10.2</span> Mapas coropléticos</a>
<ul>
<li><a href="#o-número-de-classes" id="toc-o-número-de-classes"><span class="toc-section-number">10.2.1</span> O número de classes</a></li>
<li><a href="#os-intervalos-de-classes" id="toc-os-intervalos-de-classes"><span class="toc-section-number">10.2.2</span> Os intervalos de classes</a></li>
<li><a href="#escalacores" id="toc-escalacores"><span class="toc-section-number">10.2.3</span> A escala de cores</a></li>
</ul></li>
<li><a href="#layout-do-mapa-coroplético-de-idhm-da-rmsp" id="toc-layout-do-mapa-coroplético-de-idhm-da-rmsp"><span class="toc-section-number">10.3</span> Layout do mapa coroplético de IDHM da RMSP</a></li>
</ul></li>
<li><a href="#quanti4" id="toc-quanti4"><span class="toc-section-number">11</span> Mapa coroplético interativo</a>
<ul>
<li><a href="#indo-além-proposta-de-exercício" id="toc-indo-além-proposta-de-exercício"><span class="toc-section-number">11.1</span> Indo além: Proposta de exercício</a></li>
<li><a href="#referências-sugeridas-3" id="toc-referências-sugeridas-3"><span class="toc-section-number">11.2</span> Referências sugeridas</a></li>
</ul></li>
<li><a href="#quanti4" id="toc-quanti4"><span class="toc-section-number">12</span> Dados quantitativos a partir de amostras: mapa isarítmico</a>
<ul>
<li><a href="#referências-sugeridas-4" id="toc-referências-sugeridas-4"><span class="toc-section-number">12.1</span> Referências sugeridas</a></li>
</ul></li>
<li><a href="#quanti5" id="toc-quanti5"><span class="toc-section-number">13</span> Mapa de fluxos: movimentos no espaço</a></li>
<li><a href="#osm" id="toc-osm"><span class="toc-section-number">14</span> Usando dados do Open Street Map</a></li>
<li><a href="#anamorf" id="toc-anamorf"><span class="toc-section-number">15</span> Anamorfose</a></li>
<li><a href="#sintese" id="toc-sintese"><span class="toc-section-number">16</span> Mapas de síntese</a></li>
</ul>
<!--bookdown:toc2:end-->
      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Cartografia Temática em R para estudantes de Geografia</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<!--bookdown:toc:end-->
<!--bookdown:body:start-->
<div id="apresentação" class="section level1 unnumbered hasAnchor">
<h1 class="unnumbered hasAnchor">Apresentação<a href="#apresentação" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p><img src="capa_livro.png" width="629" /></p>
<p>A Geografia é muito mais do que mapas, análises quantitativas, modelos de regressão. Sem dúvida! No entanto, tem se beneficiado muito com a elaboração de mapas, com análises quantitativas e modelos de regressão. É inquestionável. Análises quantitativas e qualitativas se complementam e ampliam a capacidade crítica de compreensão de um mundo em constante transformação.</p>
<p>Há 17 anos ensinando Cartografia Temática para o curso de Bacharelado em Geografia na Universidade de São Paulo, tenho acompanhado a evolução das geotecnologias. Hoje temos a disponibilidade de grande volume de dados. Nossa forma de análise tradicional, utilizando planilhas eletrônicas que podem abrir arquivos de até 1 milhão de linhas, já não atende as necessidades de nossas pesquisas. Estamos em uma nova encruzilhada promovida pelo avanço tecnológico. Por acreditar no potencial crítico e sintético do(a) geógrafo(a), encaro o desafio de contribuir para a aprendizagem e incorporação da programação na elaboração de mapas de forma mais acessível aos geógrafos(as) e outros profissionais que usam dados espaciais para a compreensão do mundo.</p>
<p>Penso que este livro pode cobrir uma lacuna que se situa na necessidade de o(a) geógrafo(a) aprender os primeiros passos do <strong>R</strong> para elaborar mapas temáticos. Neste caso, não estou preocupada em ensinar a fazer códigos limpos, bonitos e complexos, mas a ensinar como o aluno pode dar início à utilização do <strong>R</strong>, ao mesmo tempo em que aplica aspectos teóricos da Cartografia Temática na elaboração de seus mapas. Este livro surge junto com o meu próprio aprendizado ao tentar compilar inúmeros livros sobre <strong>R</strong> disponíveis, mas que não cumprem a função que preciso.</p>
<p>Fazer mapas não é sobre saber fazer código em <strong>R</strong>. O(A) geógrafo(a) pensa espacialmente. Precisa que os dados estejam representados cartograficamente para que sejam analisados, seja para a elaboração de hipóteses, seja para a comunicação de fenômenos espaciais, seja para testar hipóteses elaboradas previamente. Ao usar <strong>R</strong> para elaborar mapas, abre-se a possibilidade de explorar grandes bancos de dados e de permitir a reprodução exata dos procedimentos utilizados, garantindo transparência e avaliação criteriosa dos resultados obtidos. Em um mundo onde a Ciência é cada vez mais questionada, garantir a robustez e a transparência das análises contribui para que os resultados possam ser interpretados de forma correta e responsável. Além disso, segundo Comber &amp; Brunsdom (2021), em uma <em>ciência de dados crítica</em> “não há desculpa para trituradores de números que não são críticos em sua análise de dados”.</p>
<div id="referência-citada" class="section level2 unnumbered hasAnchor">
<h2 class="unnumbered hasAnchor">Referência citada<a href="#referência-citada" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Comber, L., Brunsdom, C. (2021) <strong>Geographical Data Science &amp; Spatial Data Analysis</strong>: an introduction in R. Los Angeles: SAGE, 431p. <a href="https://study.sagepub.com/comber" class="uri">https://study.sagepub.com/comber</a></p>
</div>
</div>
<div id="sobre-o-livro" class="section level1 unnumbered hasAnchor">
<h1 class="unnumbered hasAnchor">Sobre o livro<a href="#sobre-o-livro" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Por que mais um livro sobre a linguagem <strong>R</strong>?</p>
<p>Este livro é para iniciantes na linguagem <strong>R</strong>. Não requer conhecimento anterior, ao mesmo tempo em que oferece conteúdo interessante para aqueles que já não são mais iniciantes. Também pode ser útil para quem utiliza mapas no jornalismo, pois orienta para a representação cartográfica mais adequada a cada conjunto de dados.</p>
<p>Este livro pretende compilar, de forma compreensível, o básico da gramática do <strong>ggplot2</strong> e <strong>tmap</strong> além de recursos de diversos outros pacotes do <strong>R</strong> para a elaboração de mapas temáticos. Ao mesmo tempo, pretende associar aspectos técnicos da elaboração de mapas à teoria da representação cartográfica.
Este livro foi organizado de forma a intercalar o conteúdo teórico da Cartografia Temática com a elaboração de mapas a partir de códigos do <strong>R</strong>. Um aspecto importante é a utilização de dados abertos para ilustrar os diversos tipos de representação cartográfica. Desta forma, o leitor se torna independente na obtenção de dados e na elaboração de mapas.</p>
<p>Este livro não está acabado. Ele será modificado à medida em que serão percebidos erros de qualquer tipo (conceituais, gramaticais, de tipografia, códigos etc.). Assim, fique à vontade em me enviar sugestões de correções. Agradeço antecipadamente. Também agradeço se puder divulgá-lo. Democratizar o conhecimento de forma gratuita e aberta faz parte de um projeto de mundo no qual o conhecimento científico de qualidade é valorizado e subsidia ações que promovam bem-estar para todos.</p>
</div>
<div id="agradecimentos" class="section level1 unnumbered hasAnchor">
<h1 class="unnumbered hasAnchor">Agradecimentos<a href="#agradecimentos" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>O aprendizado é um percurso longo. Impossível agradecer a todos que têm contribuído para a minha formação. Várias são as minhas referências na área da Cartografia, das quais destaco meus mestres diretos durante a graduação, professores Marcello Martinelli e Mario De Biasi. Os meus colegas de ofício, todos, têm me ensinado muito. Aos que ensinam Cartografia no Departamento de Geografia da FFLCH/USP, meu grande carinho e amizade. Aos meus alunos de Graduação e Pós, motivo deste livro. À equipe do <em>Big Data Analytics</em> do Hospital Israelita Albert Einstein, em especial ao Dr. Edson Amaro Jr., meu profundo reconhecimento. Participar deste grupo como pesquisadora visitante me fez ver a importância de dominar os instrumentos para a atuação do geógrafo na pesquisa e na gestão de governos. Aos meus colegas de pesquisa, do Grupo de Estudos Espaço Urbano e Saúde - <a href="https://espacourbanoesaude.iea.usp.br/">Geurbs</a>, direção do IEA/USP e apoio técnico, e aos demais das mais diversas áreas que me desafiam a cada pesquisa, minha gratidão sincera. Ao Professor Paulo Saldiva, exemplo de ser humano e de pesquisador, que com sua generosidade agrega pessoas e, sendo médico, acredita na força dos mapas.</p>
<p><strong>Contato</strong>:</p>
<p>Ligia Vizeu Barrozo</p>
<p>Professora Titular, Departamento de Geografia, da
Fac. de Filosofia, Letras e Ciências Humanas</p>
<p>e-mail: <a href="mailto:lija@usp.br" class="email">lija@usp.br</a></p>
<p><strong>Universidade de São Paulo - USP</strong></p>
<p>Pesquisadora Visitante, <em>Big Data Analytics</em></p>
<p><strong>Hospital Israelita Albert Einstein</strong></p>
<p><img src="88x31.png" width="20%" /></p>
<p>Este trabalho tem uma licença da <a href="http://creativecommons.org/licenses/by-nc-nd/4.0/">Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License</a></p>
<!--chapter:end:index.Rmd-->
</div>
<div id="intro" class="section level1 hasAnchor" number="1">
<h1 class="hasAnchor"><span class="header-section-number">1</span> Introdução<a href="#intro" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="o-programa-r" class="section level2 hasAnchor" number="1.1">
<h2 class="hasAnchor"><span class="header-section-number">1.1</span> O programa R<a href="#o-programa-r" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Na página do projeto <strong>R</strong> <a href="https://www.r-project.org/about.html" class="uri">https://www.r-project.org/about.html</a> você encontrará todos os detalhes sobre este programa incrível. O <strong>R</strong> pode ser definido como uma linguagem e ambiente para computação estatística e gráficos. O <strong>R</strong> teve origem na linguagem S desenvolvida nas décadas de 1970 e 1980 e inicialmente desenvolvido por Robert Gentleman e Ross Ihaka — também conhecido como “R &amp; R” - do Departamento de Estatística da Universidade de Auckland, Austrália. A versão atual é resultado de esforço colaborativo com contribuição de pesquisadores de todo o mundo. Desde a metade de 1997 existe um grupo central, o <strong>R Core Team</strong>, com acesso à gravação da fonte <strong>R</strong>.</p>
<p>O <strong>R</strong> disponibiliza grande variedade de técnicas gráficas, de análise estatística (modelagem linear e não linear, clássicos testes estatísticos, análise de séries temporais, classificação, agrupamento etc.) e de análise espacial.</p>
<p>Você deve estar se perguntando por quê um geógrafo precisa aprender <strong>R</strong> para fazer mapas se domina Sistemas de Informações Geográficas (SIGs) como QGIS e ArcGIS, entre outros. Uma das respostas seria a possibilidade de reprodutibilidade por meio de códigos facilmente aplicáveis por outros pesquisadores. Outra resposta seria a crescente necessidade de trabalhar com a paulatina disponibilidade de grandes quantidades de dados. Imagine se você quisesse reproduzir o mesmo mapa de precipitação para dados de cada um dos 30 dias de um mês. Seria muito mais fácil com algumas linhas de comando. Ainda, a possibilidade de fazer a ponte com programas SIGs como GRASS, QGIS, SAGA e gvSIG a partir do terminal do sistema por meio de <em>command-line interface (CLI)</em> (interface por linha de comando, em português). De acordo com o criador do QGIS, Gary Sherman, muitos usuários do QGIS perdem as vantagens da linha de comando por não saberem <strong>R</strong>.</p>
<p>Além disso, deve-se destacar que o <strong>R</strong> é fantástico para análise espacial e permite a elaboração de mapas interativos para visualização na Web usando os pacotes <strong>Leaflet</strong> e <strong>Shiny</strong>.</p>
<p>Se você ficou convencido(a), arregace as mangas e vamos começar.</p>
</div>
<div id="instalação-do-r-e-rstudio" class="section level2 hasAnchor" number="1.2">
<h2 class="hasAnchor"><span class="header-section-number">1.2</span> Instalação do R e RStudio<a href="#instalação-do-r-e-rstudio" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>A interface do <strong>R</strong> é basicamente uma interface de comando de linha.</p>
<p>O <strong>RStudio</strong> é um IDE (<em>Integrated Development Environment</em> - Ambiente de Desenvolvimento Integrado, em português). Em outras palavras, é um programa que roda o programa <strong>R</strong> e fornece uma interface com ferramentas auxiliares para escrever os códigos em <strong>R</strong> de forma mais amigável. Você pode trabalhar diretamente no <strong>R</strong> se preferir, mas o <strong>RStudio</strong> pode facilitar em muito a sua experiência com o <strong>R</strong>.</p>
<p>Se você for usar <strong>R</strong> no sistema Windows, instale também o <strong>RTools</strong>, um conjunto de programas que são necessários para construir pacotes <strong>R</strong> a partir da fonte.</p>
<div id="instalação-do-r-para-windows" class="section level3 hasAnchor" number="1.2.1">
<h3 class="hasAnchor"><span class="header-section-number">1.2.1</span> Instalação do R para Windows<a href="#instalação-do-r-para-windows" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ol style="list-style-type: decimal">
<li><p>Vá até <a href="https://cran.r-project.org/" class="uri">https://cran.r-project.org/</a>, clique em <em>‘Download R for Windows’</em>, então, clique em <em>‘base’</em>, e depois no link de <em>Download</em>.</p></li>
<li><p>Depois que o <em>download</em> estiver completo, rode o instalador. Use as opções padrão, com uma exceção. Não escolha a pasta <em>arquivos de programas</em>. Prefira criar uma pasta <strong>R</strong> como subpasta do seu drive C.</p></li>
</ol>
</div>
<div id="instalação-do-r-para-mac" class="section level3 hasAnchor" number="1.2.2">
<h3 class="hasAnchor"><span class="header-section-number">1.2.2</span> Instalação do R para Mac<a href="#instalação-do-r-para-mac" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ol style="list-style-type: decimal">
<li><p>Vá até <a href="https://cran.r-project.org/" class="uri">https://cran.r-project.org/</a>, clique em <em>‘Download R for (Mac) OS X’</em>, então em <em>‘base’</em>, e depois no link de <em>Download</em>.</p></li>
<li><p>Depois que o <em>download</em> estiver completo, rode o instalador e aceite as opções padrão. Você deverá ver uma tela indicando que a instalação obteve sucesso.</p></li>
</ol>
</div>
<div id="instalação-do-rstudio" class="section level3 hasAnchor" number="1.2.3">
<h3 class="hasAnchor"><span class="header-section-number">1.2.3</span> Instalação do RStudio<a href="#instalação-do-rstudio" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Você deve instalar o <strong>RStudio</strong> apenas depois de já ter instalado o programa <strong>R</strong>.</p>
<ol style="list-style-type: decimal">
<li><p>Você pode fazer <em>download</em> do <strong>RStudio</strong> a partir do seguinte link:
<a href="https://www.rstudio.com/products/rstudio/download/#download" class="uri">https://www.rstudio.com/products/rstudio/download/#download</a>. Selecione a opção para o seu sistema operacional.</p></li>
<li><p>Depois de fazer <em>download</em>, rode o instalador e use todas as opções padrão.</p></li>
</ol>
</div>
<div id="instalação-do-rtools" class="section level3 hasAnchor" number="1.2.4">
<h3 class="hasAnchor"><span class="header-section-number">1.2.4</span> Instalação do RTools<a href="#instalação-do-rtools" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Se você estiver usando o sistema operacional Windows, instale também o <strong>RTools</strong>.</p>
<ol style="list-style-type: decimal">
<li><p>Vá para <a href="https://cran.r-project.org/" class="uri">https://cran.r-project.org/</a>, clique em <em>‘Download R for Windows’</em>, então em <em>‘Rtools’</em>, e selecione a versão mais atual do <strong>RTools</strong> para <em>download</em>.</p></li>
<li><p>Depois que o <em>download</em> tiver sido feito, rode o instalador. Selecione todas as opções padrão.</p></li>
</ol>
<!--chapter:end:02-intro.Rmd-->
</div>
</div>
</div>
<div id="básico-do-básico-do-r-e-rstudio" class="section level1 hasAnchor" number="2">
<h1 class="hasAnchor"><span class="header-section-number">2</span> Básico do básico do R e RStudio<a href="#básico-do-básico-do-r-e-rstudio" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="os-paineis" class="section level2 hasAnchor" number="2.1">
<h2 class="hasAnchor"><span class="header-section-number">2.1</span> Os paineis<a href="#os-paineis" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Ao abrir o <strong>RStudio</strong> você encontrará os seguintes paineis (Figura @ref(fig:console)).</p>
<div class="figure">
<img src="console.jpg" alt="Tela do RStudio" width="80%" />
<p class="caption">
(#fig:console)Tela do RStudio
</p>
</div>
<p>O painel “console” é o <strong>R</strong> propriamente dito; onde você pode digitar os comandos e executá-los diretamente. As outras janelas são opcionais existentes no <strong>RStudio</strong> para facilitar as tarefas. É recomendado utilizar o painel de Editor de Texto (ou script) pois você pode digitar comentários sobre os comandos para que possa se recordar futuramente ou para que outra pessoa possa compreender o raciocínio percorrido. Para abrir um script, use o menu <strong>File/New file/R script</strong>. Desta forma, terá uma tela como a da Figura @ref(fig:script).</p>
<div class="figure">
<img src="script.jpg" alt="Tela do script" width="80%" />
<p class="caption">
(#fig:script)Tela do script
</p>
</div>
<p>O script permite a digitação de um texto sem formatação, como no Bloco de Notas do Windows. No lado direito, encontramos o painel “Environment” (ou Ambiente, em português) onde são listados os objetos e funções da sessão corrente. No lado inferior direito existe o navegador de arquivos entre outras guias que serão vistas no decorrer das atividades. O navegador de arquivos funciona como o “Explorer” do Windows, onde você pode apagar, renomear e gerenciar os arquivos.</p>
<p>O script do RStudio apresenta algumas funcionalidades muito úteis, tais como a conclusão do código. Ao digitar parte de um código, opções de códigos semelhantes surgirão e poderão ser completados ao se utilizar a tecla <strong>Tab</strong>. Além deste, o <strong>RStudio</strong> também armazena a história dos comandos. Assim, usando as teclas com as setas para cima ou para baixo, você pode navegar nos comandos anteriores.</p>
<p>O <strong>R</strong> é um programa de linha de comando, ou seja, após abri-lo, digitamos o código no <em>script</em>. Para executá-lo, você pode selecionar a linha digitada e as teclas <strong>Ctrl+Enter</strong> para enviar a linha para o seu interpretador. Ou pode usar o comando <strong>Run</strong> que fica na barra de cima do script. Todos os códigos do <strong>R</strong> são baseados em inglês e seus nomes, normalmente, dão dicas a respeito do seu uso.</p>
<p>O símbolo <strong>&gt;</strong> no início da última linha exibida no console chama-se <em>prompt</em> e indica que o <strong>R</strong> está pronto para receber comandos.
Todos as funções terminam com (). Quando quiser fechar o <strong>R</strong>, utilize a função <strong>quit()</strong>. O programa lhe perguntará se quer salvar a área de trabalho. Escolha “Yes” se quiser continuar o trabalho da próxima vez que abrir o <strong>R</strong> na mesma pasta. Os objetos criados serão salvos no arquivo <strong>.RData</strong> e o histórico de todos os comandos digitados no arquivo <strong>.Rhistory</strong>. Se quiser sair sem salvar a área de trabalho e o histórico, escolha “No”. O comando <strong>quit()</strong> possui uma versão mais curta <strong>q()</strong>.</p>
<p>A acentuação no <strong>R</strong> pode ficar com caracteres estranhos devido à incompatibilidade com a língua portuguesa. Para resolver este problema, vamos ajustar para português.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="co">#para ajustar a língua para portugues usando a função</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">Sys.setlocale</span>(<span class="at">category =</span> <span class="st">&quot;LC_ALL&quot;</span>, <span class="at">locale =</span> <span class="st">&quot;pt_BR.UTF-8&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;LC_COLLATE=pt_BR.UTF-8;LC_CTYPE=pt_BR.UTF-8;LC_MONETARY=pt_BR.UTF-8;LC_NUMERIC=C;LC_TIME=pt_BR.UTF-8&quot;</code></pre>
<p>Neste livro, os comandos a serem digitados no script do <strong>R</strong> estão coloridos de forma a facilitar a sua interpretação. Os resultados dos comandos impressos no console do <strong>R</strong> são exibidos aqui precedidos do símbolo <strong>##</strong> e de <strong>[1]</strong> (indica o primeiro elemento requerido). Por exemplo, ao digitar no <em>script</em> do <strong>R</strong> a primeira linha, a segunda será exibida no console:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="st">&quot;Olá geógraf@s&quot;</span></span></code></pre></div>
<pre><code>## [1] &quot;Olá geógraf@s&quot;</code></pre>
<p>Observe que ao digitar ou colar comandos longos no console, ocupando mais de uma linha, o <strong>R</strong> adiciona o símbolo <strong>+</strong> à primeira coluna da tela para indicar que a linha é a continuação do comando anterior.</p>
<p>Crie o hábito de adicionar comentários aos fragmentos de códigos que você digita no script. Para isso, utilize o símbolo <strong>#</strong> ao começar o comentário. O <strong>RStudio</strong> ignora tudo o que vier depois deste símbolo. Fazer comentários no código ajuda muito o aprendizado e a recuperar o raciocínio utilizado.</p>
<p>A utilização da função <strong>help</strong> auxilia enormemente a compreensão das funções. Use <strong>? nome_da_função</strong> ou <strong>help(nome_da_função)</strong>. Quando se deparar com algo que não consegue resolver, busque a solução na internet, nos fóruns de discussão sobre o <strong>R</strong>. Existem páginas como <a href="https://stackoverflow.com/" class="uri">https://stackoverflow.com/</a>, onde os usuários se ajudam mutuamente para a solução de problemas. Existe um grupo com discussão em português <a href="https://pt.stackoverflow.com/questions" class="uri">https://pt.stackoverflow.com/questions</a>.</p>
</div>
<div id="tipos-de-objetos" class="section level2 hasAnchor" number="2.2">
<h2 class="hasAnchor"><span class="header-section-number">2.2</span> Tipos de objetos<a href="#tipos-de-objetos" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Uma referência bastante interessante para a estruturação deste capítulo é o DataCamp, a primeira plataforma de aprendizado on-line para Ciência de Dados. Os cursos são ministrados em inglês e fornecem a base necessária para a compreensão dos tipos de objetos e manipulação de dados (DataCamp, 2023).</p>
<p>A forma mais simples de utilização do <strong>R</strong> é como uma calculadora. Vamos fazer um teste: digite na área do script <strong>3 + 4</strong>. Selecione esta linha digitada e rode (pressione a tecla Ctrl ao mesmo tempo em que digita a tecla Enter).</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="dv">3</span> <span class="sc">+</span> <span class="dv">4</span></span></code></pre></div>
<pre><code>## [1] 7</code></pre>
<p>No console, você verá a resposta <strong>[1] 7</strong>, ou seja, o <strong>R</strong> retornou um valor [1] solicitado cuja resposta é 7. Observe o painel do “Ambiente”, do lado direito superior. Ele está vazio, ou seja, não atribui a resposta (7) a nenhum objeto. No entanto, se quisermos gravar esta resposta, podemos atribui-la a um objeto, como <code>x</code> ou qualquer outro nome. Uma variável permite que você salve um valor (e.g., 102) ou um objeto (e.g., descrição de uma função, listas, matrizes) em <strong>R</strong>. Em outro momento, você pode usar o nome da variável armazenada para acessar o valor ou o objeto que foi salvo dentro desta variável. A atribuição a uma variável é feita com os símbolos <strong>&lt;-</strong>. Este símbolo parece uma flecha apontando para o nome que se quer dar à variàvel e pode ser usado para o outro lado <strong>-&gt;</strong>.</p>
<p>Rode novamente, agora digitando <code>x</code> seguido dos sinais de menor e de subtração antes da soma desejada. Use espaços antes e depois dos operadores de atribuição <code>&lt;-</code>, mas não entre &lt; e -. O atalho muito útil para &lt;- é pressionar simultaneamente as teclas alt e a tecla menos (Alt + -).</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">3</span> <span class="sc">+</span> <span class="dv">4</span> <span class="co">#dê o nome de &quot;x&quot; ao valor resultante de 3 + 4</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="dv">3</span> <span class="sc">+</span> <span class="dv">4</span> <span class="ot">-&gt;</span> x <span class="co">#dê ao valor resultante de 3 + 4 o nome de &quot;x&quot;</span></span></code></pre></div>
<p>Observe que agora existe um <strong>objeto</strong> no painel “Ambiente”. O objeto é <strong>x</strong> e seu valor é 7. Deve-se observar que para nomear um objeto, o nome deve iniciar com uma letra (A-Z ou a-z) e pode incluir letras, dígitos (0-9), ponto (.) e sublinhado (_). No entanto, os nomes não podem começar com um número ou por um ponto seguido de um número. As palavras “if” e “for” não são permitidas para um objeto. O <strong>R</strong> discrimina letras maiúsculas de minúsculas nos nomes dos objetos. Assim, <strong>Y</strong> e <strong>y</strong> são dois objetos diferentes.</p>
<p>Digite a função <code>typeof</code>para verificar o tipo de objeto criado.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="fu">typeof</span>(x)</span></code></pre></div>
<pre><code>## [1] &quot;double&quot;</code></pre>
<p>No caso, o objeto obtido foi do tipo “double”. Se você atribuir a <strong>x</strong> um outro valor, digamos 8, o valor anterior é apagado e passa a ter o novo valor. Esta modificação afeta apenas os objetos na memória ativa, não os dados que estão no disco rígido (Paradis, 2005). Para excluir um objeto, usa-se a função <strong>rm</strong>. Por exemplo, <code>rm(x)</code> exclui o objeto <code>x</code>. O comando <code>rm(list=ls())</code> apaga todos os objetos da memória.</p>
<p>Todos os objetos têm dois atributos intrínsecos: modo (mode) e comprimento (length).</p>
<p>No <strong>R</strong>, os tipos de dados que são inseridos nos objetos são divididos em:</p>
<ul>
<li><p><strong>numeric</strong>: armazena números no formato “integer” (inteiro) ou “double” (reais);</p></li>
<li><p><strong>character</strong>: armazena dados categóricos ou qualitativos por meio de caracteres (variáveis de texto);</p></li>
<li><p><strong>logical</strong>: armazena variáveis que assumem os valores “FALSE” (falso) ou “TRUE” (verdadeiro). Variáveis lógicas são conhecidas como “booleanas” porque é um tipo de dado lógico que pode ter apenas um de dois valores possíveis: verdadeiro ou falso;</p></li>
<li><p><strong>complex</strong>: relacionados ao número imaginário “i”.</p></li>
</ul>
<p>Quando um número aparece entre aspas (simples ou dupla), o objeto é atribuído a um tipo “character”. Vejamos alguns exemplos:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="fu">typeof</span>(<span class="st">&#39;20&#39;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;character&quot;</code></pre>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="fu">typeof</span>(<span class="st">&quot;20&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;character&quot;</code></pre>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="fu">typeof</span>(<span class="dv">20</span>)</span></code></pre></div>
<pre><code>## [1] &quot;double&quot;</code></pre>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="fu">typeof</span>(<span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## [1] &quot;logical&quot;</code></pre>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="fu">typeof</span>(<span class="fl">150.4</span>)</span></code></pre></div>
<pre><code>## [1] &quot;double&quot;</code></pre>
<p>Para que um número inteiro seja armazenado como “integer” é preciso que seja seguido da letra <strong>L</strong>. Já vimos que o tipo de objeto <code>x</code> é “double”. Vamos criar um objeto <code>y</code> do tipo “integer”.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a>y <span class="ot">&lt;-</span> 3L <span class="sc">+</span> 4L</span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a><span class="fu">typeof</span>(y)</span></code></pre></div>
<pre><code>## [1] &quot;integer&quot;</code></pre>
<p>Perceba que a <code>class</code>de x é “numeric” e a de y é “integer”. As outras classes são “character” e “logical”.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a><span class="fu">class</span>(x)</span></code></pre></div>
<pre><code>## [1] &quot;numeric&quot;</code></pre>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a><span class="fu">class</span>(y)</span></code></pre></div>
<pre><code>## [1] &quot;integer&quot;</code></pre>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a><span class="fu">class</span>(<span class="st">&#39;20&#39;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;character&quot;</code></pre>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" tabindex="-1"></a><span class="fu">class</span>(<span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## [1] &quot;logical&quot;</code></pre>
<p>A classe é uma propriedade de um objeto que determina o comportamento das funções aplicadas a ele.</p>
<p>A tabela sistematizada por Aquino (2014), apresenta os operadores matemáticos e lógicos que podemos usar no <strong>R</strong> e seus significados.</p>
<table>
<colgroup>
<col width="29%" />
<col width="20%" />
<col width="23%" />
<col width="26%" />
</colgroup>
<thead>
<tr class="header">
<th align="center">Operador matemático</th>
<th align="center">Significado</th>
<th align="center">Operador lógico</th>
<th align="center">Significado</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">+</td>
<td align="center">soma</td>
<td align="center">&gt;</td>
<td align="center">maior que</td>
</tr>
<tr class="even">
<td align="center">-</td>
<td align="center">subtração</td>
<td align="center">&lt;</td>
<td align="center">menor que</td>
</tr>
<tr class="odd">
<td align="center">/</td>
<td align="center">divisão</td>
<td align="center">&gt;=</td>
<td align="center">maior ou igual a</td>
</tr>
<tr class="even">
<td align="center">*</td>
<td align="center">multiplicação</td>
<td align="center">&lt;=</td>
<td align="center">menor ou igual a</td>
</tr>
<tr class="odd">
<td align="center">^</td>
<td align="center">exponenciação</td>
<td align="center">&amp;</td>
<td align="center">e</td>
</tr>
<tr class="even">
<td align="center"></td>
<td align="center"></td>
<td align="center">|</td>
<td align="center">ou</td>
</tr>
<tr class="odd">
<td align="center"></td>
<td align="center"></td>
<td align="center">==</td>
<td align="center">igual a</td>
</tr>
<tr class="even">
<td align="center"></td>
<td align="center"></td>
<td align="center">!</td>
<td align="center">não</td>
</tr>
<tr class="odd">
<td align="center"></td>
<td align="center"></td>
<td align="center">!=</td>
<td align="center">diferente de</td>
</tr>
</tbody>
</table>
<p>Quando temos objetos, podemos fazer operações matemáticas entre eles. Por exemplo, vamos criar o objeto <strong>laranjas</strong> e atribuir o valor de 36. Criamos também o objeto <strong>bananas</strong> e atribuímos o valor de 48. Agora, podemos ter um novo objeto <strong>minhas_frutas</strong>, resultante da soma entre <strong>bananas</strong> e <strong>laranjas</strong>.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" tabindex="-1"></a><span class="co">#para criar o objeto &#39;laranjas&#39;</span></span>
<span id="cb30-2"><a href="#cb30-2" tabindex="-1"></a>laranjas <span class="ot">&lt;-</span> <span class="dv">36</span></span>
<span id="cb30-3"><a href="#cb30-3" tabindex="-1"></a><span class="co">#para criar o objeto &#39;bananas&#39;</span></span>
<span id="cb30-4"><a href="#cb30-4" tabindex="-1"></a>bananas <span class="ot">&lt;-</span> <span class="dv">48</span></span>
<span id="cb30-5"><a href="#cb30-5" tabindex="-1"></a><span class="co">#para criar o objeto &#39;minhas_frutas&#39;</span></span>
<span id="cb30-6"><a href="#cb30-6" tabindex="-1"></a>minhas_frutas <span class="ot">&lt;-</span> laranjas <span class="sc">+</span> bananas</span>
<span id="cb30-7"><a href="#cb30-7" tabindex="-1"></a><span class="co">#para mostrar o objeto &#39;minhas_frutas&#39;</span></span>
<span id="cb30-8"><a href="#cb30-8" tabindex="-1"></a>minhas_frutas</span></code></pre></div>
<pre><code>## [1] 84</code></pre>
</div>
<div id="estrutura-dos-dados" class="section level2 hasAnchor" number="2.3">
<h2 class="hasAnchor"><span class="header-section-number">2.3</span> Estrutura dos dados<a href="#estrutura-dos-dados" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Segundo Wickham (2019), a estrutura dos dados no <strong>R</strong> pode ser organizada segundo sua <strong>dimensionalidade</strong> (1 dimensão, 2 dimensões ou <em>n</em> dimensões) e se ela é <strong>homogênea</strong> (todos os conteúdos são do mesmo tipo) ou <strong>heterogênea</strong> (conteúdos podem ser de tipos diferentes). A tabela organizada por Wickham (2019), a seguir, mostra os cinco tipos de dados mais frequentemente utilizados em análise de dados.</p>
<table>
<thead>
<tr class="header">
<th align="left">Dimensão</th>
<th align="left">Homogênea</th>
<th align="left">Heterogênea</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">1d</td>
<td align="left">Atomic vector</td>
<td align="left">List</td>
</tr>
<tr class="even">
<td align="left">2d</td>
<td align="left">Matrix</td>
<td align="left">Data frame</td>
</tr>
<tr class="odd">
<td align="left"><em>n</em>d</td>
<td align="left">Array</td>
<td align="left"></td>
</tr>
</tbody>
</table>
<p>Para saber a estrutura de um objeto, use <code>str()</code>. A função <code>str</code> mostra o modo e o comprimento (número de elementos do objeto). Dados faltantes são representados por <strong>NA</strong> (<em>not available</em>, ou não disponível, em português). Valores não numéricos são representados por <strong>NaN</strong> (<em>not a number</em>, ou não é um número, em português).</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" tabindex="-1"></a><span class="fu">str</span>(x)</span></code></pre></div>
<pre><code>##  num 7</code></pre>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" tabindex="-1"></a><span class="fu">str</span>(y)</span></code></pre></div>
<pre><code>##  int 7</code></pre>
</div>
<div id="vetores" class="section level2 hasAnchor" number="2.4">
<h2 class="hasAnchor"><span class="header-section-number">2.4</span> Vetores<a href="#vetores" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Os vetores são matrizes de <strong>uma dimensão</strong> que podem conter dados numéricos, dados de caracteres <strong>ou</strong> dados lógicos. Em outras palavras, um vetor é uma ferramenta simples para armazenar dados de um único tipo.</p>
<p>Em <strong>R</strong>, criamos um vetor com a função <code>c()</code>. Para facilitar a memorização, “c” vem de “<em>concatenate</em>” (concatenar, unir). Os elementos são colocados dentro dos parênteses, separados por vírgula. A partir de vetores é possível fazer cálculos.</p>
<p>Por exemplo, podemos criar vetores para armazenar os dados de temperatura do ar e precipitação média mensal de Mirante do Parnaíba, em São Paulo (Fonte: <a href="https://pt.wikipedia.org/wiki/Clima_da_cidade_de_São_Paulo#" class="uri">https://pt.wikipedia.org/wiki/Clima_da_cidade_de_São_Paulo#</a>).</p>
<p>Vamos criar vetores de temperatura média anual do ar, que receberá o nome de <strong>temp</strong>. Os dados de <strong>temp</strong> são: 23.1, 23.5, 22.5, 21.2, 18.4, 17.5, 17.2, 18.1, 19.1, 20.5, 21.2, 22.6 (Dica: para ter o exato conjunto de dados, copie e cole desde o primeiro valor até o último dentro dos parênteses da função).</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" tabindex="-1"></a><span class="co">#para criar o objeto &#39;temp&#39;</span></span>
<span id="cb36-2"><a href="#cb36-2" tabindex="-1"></a>temp <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">23.1</span>, <span class="fl">23.5</span>, <span class="fl">22.5</span>, <span class="fl">21.2</span>, <span class="fl">18.4</span>, <span class="fl">17.5</span>, <span class="fl">17.2</span>, <span class="fl">18.1</span>, <span class="fl">19.1</span>, <span class="fl">20.5</span>, <span class="fl">21.2</span>, <span class="fl">22.6</span>)</span>
<span id="cb36-3"><a href="#cb36-3" tabindex="-1"></a><span class="co">#para visualizar &#39;temp&#39;</span></span>
<span id="cb36-4"><a href="#cb36-4" tabindex="-1"></a>temp</span></code></pre></div>
<pre><code>##  [1] 23.1 23.5 22.5 21.2 18.4 17.5 17.2 18.1 19.1 20.5 21.2 22.6</code></pre>
<p>A precipitação média anual receberá o nome de <strong>prec</strong>. Os dados de precipitação arredondados são: 292, 257, 229, 87, 66, 59, 48, 32, 83, 127, 143, 231</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" tabindex="-1"></a><span class="co">#para criar o objeto &#39;prec&#39;</span></span>
<span id="cb38-2"><a href="#cb38-2" tabindex="-1"></a>prec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">292</span>, <span class="dv">257</span>, <span class="dv">229</span>, <span class="dv">87</span>, <span class="dv">66</span>, <span class="dv">59</span>, <span class="dv">48</span>, <span class="dv">32</span>, <span class="dv">83</span>, <span class="dv">127</span>, <span class="dv">143</span>, <span class="dv">231</span>)</span>
<span id="cb38-3"><a href="#cb38-3" tabindex="-1"></a><span class="co">#para visualizar &#39;prec&#39;</span></span>
<span id="cb38-4"><a href="#cb38-4" tabindex="-1"></a>prec</span></code></pre></div>
<pre><code>##  [1] 292 257 229  87  66  59  48  32  83 127 143 231</code></pre>
</div>
<div id="nomeando-os-vetores" class="section level2 hasAnchor" number="2.5">
<h2 class="hasAnchor"><span class="header-section-number">2.5</span> Nomeando os vetores<a href="#nomeando-os-vetores" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Vimos que podemos criar conjuntos de dados usando a função <code>c()</code> em R.
Como temos dados de precipitação e temperatura, seria interessante que estes valores fossem associados ao mês correspondente. Esta tarefa pode ser executada por meio da função <code>names()</code>.</p>
<p>Podemos dar os nomes dos meses aos dados de temperatura e precipitação criando um vetor de meses. Atribua a uma variável chamada ‘meses’ o conjunto de nomes dos meses do ano. Os nomes dos meses serão abreviados: “jan”, “fev”, “mar”, “abr”, “mai”, “jun”, “jul”, “ago”, “set”, “out”, “nov”, “dez”. Lembre-se que nomes são textos e, portanto, devem entrar entre aspas.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" tabindex="-1"></a><span class="co">#para atribuir os meses do ano ao objeto &#39;meses&#39;</span></span>
<span id="cb40-2"><a href="#cb40-2" tabindex="-1"></a>meses <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;jan&quot;</span>, <span class="st">&quot;fev&quot;</span>, <span class="st">&quot;mar&quot;</span>, <span class="st">&quot;abr&quot;</span>, <span class="st">&quot;mai&quot;</span>, <span class="st">&quot;jun&quot;</span>, <span class="st">&quot;jul&quot;</span>, <span class="st">&quot;ago&quot;</span>, <span class="st">&quot;set&quot;</span>, <span class="st">&quot;out&quot;</span>, <span class="st">&quot;nov&quot;</span>, <span class="st">&quot;dez&quot;</span>)</span></code></pre></div>
<p>Agora, atribua o vetor de “meses” diretamente à variável <strong>temp</strong> usando a função <strong>names()</strong>.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" tabindex="-1"></a><span class="fu">names</span>(temp) <span class="ot">&lt;-</span> <span class="fu">c</span>(meses) <span class="co">#para atribuir os meses a &#39;temp&#39;</span></span>
<span id="cb41-2"><a href="#cb41-2" tabindex="-1"></a>temp <span class="co">#para imprimir &#39;temp&#39;</span></span></code></pre></div>
<pre><code>##  jan  fev  mar  abr  mai  jun  jul  ago  set  out  nov  dez 
## 23.1 23.5 22.5 21.2 18.4 17.5 17.2 18.1 19.1 20.5 21.2 22.6</code></pre>
<p>Faça o mesmo para a variável <strong>prec</strong>.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" tabindex="-1"></a><span class="fu">names</span>(prec) <span class="ot">&lt;-</span> <span class="fu">c</span>(meses) <span class="co">#para atribuir os meses a &#39;prec&#39;</span></span>
<span id="cb43-2"><a href="#cb43-2" tabindex="-1"></a>prec <span class="co">#para imprimir &#39;prec&#39;</span></span></code></pre></div>
<pre><code>## jan fev mar abr mai jun jul ago set out nov dez 
## 292 257 229  87  66  59  48  32  83 127 143 231</code></pre>
</div>
<div id="seleção-em-vetores" class="section level2 hasAnchor" number="2.6">
<h2 class="hasAnchor"><span class="header-section-number">2.6</span> Seleção em vetores<a href="#seleção-em-vetores" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Como geógrafos, gostaríamos de saber quanto chove em cada estação do ano. Para chegarmos nesta resposta, começaremos criando variáveis para cada estação do ano com os valores de precipitação correspondentes. Considere <strong>primavera</strong> contendo os seguintes meses: setembro, outubro e novembro; <strong>verão</strong> contendo dezembro, janeiro e fevereiro; <strong>outono</strong> contendo março, abril e maio e, <strong>inverno</strong> contendo junho, julho e agosto.</p>
<p>Para selecionar elementos de um vetor (e depois em matrizes, dataframes, …), são usados os colchetes <strong>[]</strong>. Dentro dos colchetes são indicados os elementos do conjunto de dados que serão selecionados. Por exemplo, para selecionar a precipitação do mês de janeiro usa-se a seguinte forma de seleção <strong>prec[1]</strong>. A seleção do segundo elemento seria <strong>prec[2]</strong> e assim por diante. Em <strong>R</strong>, o primeiro elemento de um vetor tem a posição 1 (em Python, a primeira posição tem o índice 0).
Para selecionar múltiplos elementos de um vetor, são usados os <strong>[]</strong> contendo o vetor com a posição dos elementos desejados. Como exemplo, se quisermos selecionar as precipitações dos meses de janeiro e dezembro, usamos <code>c(1, 12)</code> entre colchetes, depois de definir o nome da variável que contém os dados.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" tabindex="-1"></a><span class="co">#para selecionar as precipitações de janeiro e dezembro</span></span>
<span id="cb45-2"><a href="#cb45-2" tabindex="-1"></a>prec_selecao <span class="ot">&lt;-</span> prec[<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">12</span>)]</span>
<span id="cb45-3"><a href="#cb45-3" tabindex="-1"></a><span class="co">#para imprimir a seleção</span></span>
<span id="cb45-4"><a href="#cb45-4" tabindex="-1"></a>prec_selecao</span></code></pre></div>
<pre><code>## jan dez 
## 292 231</code></pre>
<p>Observe que para selecionar intervalos de dados, pode-se usar <strong>:</strong>. Por exemplo, para criar uma variável selecionando as precipitações durante os meses do primeiro semestre:</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" tabindex="-1"></a><span class="co">#para selecionar as precipitações do semestre 1</span></span>
<span id="cb47-2"><a href="#cb47-2" tabindex="-1"></a>prec_semestre1 <span class="ot">&lt;-</span> prec[<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>)]</span>
<span id="cb47-3"><a href="#cb47-3" tabindex="-1"></a><span class="co">#para imprimir prec_semestre1</span></span>
<span id="cb47-4"><a href="#cb47-4" tabindex="-1"></a>prec_semestre1</span></code></pre></div>
<pre><code>## jan fev mar abr mai jun 
## 292 257 229  87  66  59</code></pre>
<p>Crie os arquivos de precipitação para cada estação do ano: <strong>primavera_prec</strong>, <strong>verao_prec</strong>, <strong>outono_prec</strong> e <strong>inverno_prec</strong> usando seleção múltipla.</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" tabindex="-1"></a><span class="co">#para criar a &#39;primavera_prec&#39; a partir de seleção</span></span>
<span id="cb49-2"><a href="#cb49-2" tabindex="-1"></a>primavera_prec <span class="ot">&lt;-</span> prec[<span class="fu">c</span>(<span class="dv">9</span>, <span class="dv">10</span>, <span class="dv">11</span>)]</span>
<span id="cb49-3"><a href="#cb49-3" tabindex="-1"></a><span class="co">#para criar a &#39;verao_prec&#39; a partir de seleção</span></span>
<span id="cb49-4"><a href="#cb49-4" tabindex="-1"></a>verao_prec <span class="ot">&lt;-</span> prec[<span class="fu">c</span>(<span class="dv">12</span>, <span class="dv">1</span>, <span class="dv">2</span>)]</span>
<span id="cb49-5"><a href="#cb49-5" tabindex="-1"></a><span class="co">#para criar a &#39;outono_prec&#39; a partir de seleção</span></span>
<span id="cb49-6"><a href="#cb49-6" tabindex="-1"></a>outono_prec <span class="ot">&lt;-</span> prec[<span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>)]</span>
<span id="cb49-7"><a href="#cb49-7" tabindex="-1"></a><span class="co">#para criar a &#39;inverno_prec&#39; a partir de seleção</span></span>
<span id="cb49-8"><a href="#cb49-8" tabindex="-1"></a>inverno_prec <span class="ot">&lt;-</span> prec[<span class="fu">c</span>(<span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>)]</span>
<span id="cb49-9"><a href="#cb49-9" tabindex="-1"></a><span class="co">#para visualizar os resultados</span></span>
<span id="cb49-10"><a href="#cb49-10" tabindex="-1"></a>primavera_prec</span></code></pre></div>
<pre><code>## set out nov 
##  83 127 143</code></pre>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" tabindex="-1"></a>verao_prec</span></code></pre></div>
<pre><code>## dez jan fev 
## 231 292 257</code></pre>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" tabindex="-1"></a>outono_prec</span></code></pre></div>
<pre><code>## mar abr mai 
## 229  87  66</code></pre>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" tabindex="-1"></a>inverno_prec</span></code></pre></div>
<pre><code>## jun jul ago 
##  59  48  32</code></pre>
<p>Vamos fazer a seleção segundo estação do ano para a variável ‘temp’.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" tabindex="-1"></a><span class="co">#para criar a &#39;primavera_temp&#39; a partir de seleção</span></span>
<span id="cb57-2"><a href="#cb57-2" tabindex="-1"></a>primavera_temp <span class="ot">&lt;-</span> temp[<span class="fu">c</span>(<span class="dv">9</span>, <span class="dv">10</span>, <span class="dv">11</span>)]</span>
<span id="cb57-3"><a href="#cb57-3" tabindex="-1"></a><span class="co">#para criar a &#39;verao_temp&#39; a partir de seleção</span></span>
<span id="cb57-4"><a href="#cb57-4" tabindex="-1"></a>verao_temp <span class="ot">&lt;-</span> temp[<span class="fu">c</span>(<span class="dv">12</span>, <span class="dv">1</span>, <span class="dv">2</span>)]</span>
<span id="cb57-5"><a href="#cb57-5" tabindex="-1"></a><span class="co">#para criar a &#39;outono_temp&#39; a partir de seleção</span></span>
<span id="cb57-6"><a href="#cb57-6" tabindex="-1"></a>outono_temp <span class="ot">&lt;-</span> temp[<span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>)]</span>
<span id="cb57-7"><a href="#cb57-7" tabindex="-1"></a><span class="co">#para criar a &#39;inverno_temp&#39; a partir de seleção</span></span>
<span id="cb57-8"><a href="#cb57-8" tabindex="-1"></a>inverno_temp <span class="ot">&lt;-</span> temp[<span class="fu">c</span>(<span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>)]</span>
<span id="cb57-9"><a href="#cb57-9" tabindex="-1"></a><span class="co">#para visualizar os resultados</span></span>
<span id="cb57-10"><a href="#cb57-10" tabindex="-1"></a>primavera_temp</span></code></pre></div>
<pre><code>##  set  out  nov 
## 19.1 20.5 21.2</code></pre>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" tabindex="-1"></a>verao_temp</span></code></pre></div>
<pre><code>##  dez  jan  fev 
## 22.6 23.1 23.5</code></pre>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" tabindex="-1"></a>outono_temp</span></code></pre></div>
<pre><code>##  mar  abr  mai 
## 22.5 21.2 18.4</code></pre>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" tabindex="-1"></a>inverno_temp</span></code></pre></div>
<pre><code>##  jun  jul  ago 
## 17.5 17.2 18.1</code></pre>
<p><strong>R</strong> permite fazer seleções a partir de operadores lógicos:</p>
<ul>
<li><p><code>&lt;</code> para menor do que</p></li>
<li><p><code>&gt;</code> para maior do que</p></li>
<li><p><code>&lt;=</code> para menor ou igual a</p></li>
<li><p><code>&gt;=</code> para maior ou igual a</p></li>
<li><p><code>==</code> para igual a</p></li>
<li><p><code>!=</code> para não igual a</p></li>
</ul>
<p>Suponha que gostaríamos de saber em quais meses do ano temos precipitação acima de 100 mm. Você consegue imaginar como seria a linha de comando? Crie uma variável chamada <strong>prec100</strong>.</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" tabindex="-1"></a><span class="co">#para selecionar os meses com valores acima de 100 mm de precipitação</span></span>
<span id="cb65-2"><a href="#cb65-2" tabindex="-1"></a>prec100 <span class="ot">&lt;-</span> prec <span class="sc">&gt;</span> <span class="dv">100</span></span>
<span id="cb65-3"><a href="#cb65-3" tabindex="-1"></a><span class="co">#para visualizar os meses que atendem à seleção</span></span>
<span id="cb65-4"><a href="#cb65-4" tabindex="-1"></a>prec100</span></code></pre></div>
<pre><code>##   jan   fev   mar   abr   mai   jun   jul   ago   set   out   nov   dez 
##  TRUE  TRUE  TRUE FALSE FALSE FALSE FALSE FALSE FALSE  TRUE  TRUE  TRUE</code></pre>
<p>Como você observou, o código criado gerou um resultado lógico mostrando <strong>TRUE</strong> para meses com valores acima de 100 mm e <strong>FALSE</strong> para meses com valores abaixo ou até 100 mm. No entanto, gostaríamos de saber também não apenas os meses com precipitação acima de 100 mm, mas também quanto choveu nestes meses. Você pode criar uma nova variável <strong>meses_prec100</strong> selecionando diretamente [prec &gt; 100] após <strong>prec</strong>.</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" tabindex="-1"></a>meses_prec100 <span class="ot">&lt;-</span> prec[prec <span class="sc">&gt;</span> <span class="dv">100</span>]</span>
<span id="cb67-2"><a href="#cb67-2" tabindex="-1"></a>meses_prec100</span></code></pre></div>
<pre><code>## jan fev mar out nov dez 
## 292 257 229 127 143 231</code></pre>
</div>
<div id="totais-e-médias-em-vetores" class="section level2 hasAnchor" number="2.7">
<h2 class="hasAnchor"><span class="header-section-number">2.7</span> Totais e médias em vetores<a href="#totais-e-médias-em-vetores" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Como queremos compreender um pouco mais as variáveis meteorológicas de São Paulo, precisamos saber os totais de precipitação durante cada estação do ano.
Como já temos os valores para cada estação, podemos simplesmente criar novas variáveis (primavera_prec_total, verao_prec_total, outono_prec_total e inverno_prec_total) usando a função de soma, <strong>sum(primavera_prec)</strong> e assim por diante.</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" tabindex="-1"></a><span class="co">#para criar o total da precipitação na primavera</span></span>
<span id="cb69-2"><a href="#cb69-2" tabindex="-1"></a>primavera_prec_total <span class="ot">&lt;-</span> <span class="fu">sum</span>(primavera_prec)</span>
<span id="cb69-3"><a href="#cb69-3" tabindex="-1"></a><span class="co">#para criar o total da precipitação no verão</span></span>
<span id="cb69-4"><a href="#cb69-4" tabindex="-1"></a>verao_prec_total <span class="ot">&lt;-</span> <span class="fu">sum</span>(verao_prec)</span>
<span id="cb69-5"><a href="#cb69-5" tabindex="-1"></a><span class="co">#para criar o total da precipitação no outono</span></span>
<span id="cb69-6"><a href="#cb69-6" tabindex="-1"></a>outono_prec_total <span class="ot">&lt;-</span> <span class="fu">sum</span>(outono_prec)</span>
<span id="cb69-7"><a href="#cb69-7" tabindex="-1"></a><span class="co">#para criar o total da precipitação no inverno</span></span>
<span id="cb69-8"><a href="#cb69-8" tabindex="-1"></a>inverno_prec_total <span class="ot">&lt;-</span> <span class="fu">sum</span>(inverno_prec)</span>
<span id="cb69-9"><a href="#cb69-9" tabindex="-1"></a><span class="co">#para visualizar os totais</span></span>
<span id="cb69-10"><a href="#cb69-10" tabindex="-1"></a>primavera_prec_total</span></code></pre></div>
<pre><code>## [1] 353</code></pre>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" tabindex="-1"></a>verao_prec_total</span></code></pre></div>
<pre><code>## [1] 780</code></pre>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" tabindex="-1"></a>outono_prec_total</span></code></pre></div>
<pre><code>## [1] 382</code></pre>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" tabindex="-1"></a>inverno_prec_total</span></code></pre></div>
<pre><code>## [1] 139</code></pre>
<p>Sabendo que a função para o cálculo das médias de temperatura é <strong>mean()</strong>, como você faria para calcular as médias de temperaturas segundo estação do ano?</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" tabindex="-1"></a><span class="co">#para criar a média da temperatura na primavera</span></span>
<span id="cb77-2"><a href="#cb77-2" tabindex="-1"></a>primavera_temp_media <span class="ot">&lt;-</span> <span class="fu">mean</span>(primavera_temp)</span>
<span id="cb77-3"><a href="#cb77-3" tabindex="-1"></a><span class="co">#para criar a média da temperatura no verão</span></span>
<span id="cb77-4"><a href="#cb77-4" tabindex="-1"></a>verao_temp_media <span class="ot">&lt;-</span> <span class="fu">mean</span>(verao_temp)</span>
<span id="cb77-5"><a href="#cb77-5" tabindex="-1"></a><span class="co">#para criar a média da temperatura no outono</span></span>
<span id="cb77-6"><a href="#cb77-6" tabindex="-1"></a>outono_temp_media <span class="ot">&lt;-</span> <span class="fu">mean</span>(outono_temp)</span>
<span id="cb77-7"><a href="#cb77-7" tabindex="-1"></a><span class="co">#para criar a média da temperatura no inverno</span></span>
<span id="cb77-8"><a href="#cb77-8" tabindex="-1"></a>inverno_temp_media <span class="ot">&lt;-</span> <span class="fu">mean</span>(inverno_temp)</span>
<span id="cb77-9"><a href="#cb77-9" tabindex="-1"></a><span class="co">#para visualizar as médias</span></span>
<span id="cb77-10"><a href="#cb77-10" tabindex="-1"></a>primavera_temp_media</span></code></pre></div>
<pre><code>## [1] 20.26667</code></pre>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" tabindex="-1"></a>verao_temp_media</span></code></pre></div>
<pre><code>## [1] 23.06667</code></pre>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" tabindex="-1"></a>outono_temp_media</span></code></pre></div>
<pre><code>## [1] 20.7</code></pre>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" tabindex="-1"></a>inverno_temp_media</span></code></pre></div>
<pre><code>## [1] 17.6</code></pre>
<p>Será que em São Paulo chove mais no verão ou no inverno? Escreva um código para verificar se chove mais no verão ou no inverno em São Paulo.</p>
<p>Verifique se a temperatura média no outono é diferente da do inverno.</p>
<p>Qual seria a precipitação em cada mês do ano se chovesse o dobro? Crie uma variável chamada <strong>prec2x</strong>. Imprima o resultado de prec2x.</p>
<p>Qual a diferença de precipitação entre primavera e verão (nesta ordem)? Chame a nova variável de <strong>dif_prec</strong>. Imprima o resultado.</p>
</div>
<div id="matrizes" class="section level2 hasAnchor" number="2.8">
<h2 class="hasAnchor"><span class="header-section-number">2.8</span> Matrizes<a href="#matrizes" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Em <strong>R</strong>, uma matriz é uma coleção de elementos do mesmo tipo de dados (numeric, character ou logical) arrumados em um número fixo de linhas e colunas. Como está organizada em linhas e colunas, uma matriz é bi-dimensional.</p>
<p>Uma matriz pode ser criada com a função <strong>matrix()</strong>.</p>
<p>Por exemplo se queremos construir uma matriz com 9 elementos e 3 linhas, podemos usar o código a seguir:</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" tabindex="-1"></a><span class="co">#para criar uma matriz com 3 linhas</span></span>
<span id="cb85-2"><a href="#cb85-2" tabindex="-1"></a><span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>, <span class="at">nrow =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>##      [,1] [,2] [,3]
## [1,]    1    2    3
## [2,]    4    5    6
## [3,]    7    8    9</code></pre>
<p>Nesta função, o primeiro argumento <strong>1:9</strong> é a coleção de elementos que <strong>R</strong> vai formar em colunas e linhas em uma matriz. Neste caso será 1:9, ou seja c(1, 2, 3, 4, 5, 6, 7, 8, 9).</p>
<p>O segundo argumento <strong>byrow</strong> indica que a matriz vai ser preenchida pelos números de 1 a 9 seguindo as linhas (<em>by row</em> = por linha). Se queremos preencher segundo as colunas, o argumento deverá ser <strong>byrow = FALSE</strong>.</p>
<p>O terceiro argumento <strong>nrow</strong> indica que a matriz deve ter 3 linhas (nrow significa number of rows).</p>
<p>Vamos construir uma matriz para ver como se distribui a população de São Paulo segundo tipo de assentamento. Dividimos os assentamentos em: assentamentos regulares, aglomerados subnormais (definidos pelo IBGE) e assentamentos precários, em três faixas etárias: de 0 a 19 anos; de 20 a 59 anos e + de 60 anos de idade.</p>
<p>Para construir uma matriz, vamos primeiro criar os vetores das populações por faixa etária de cada tipo de assentamento. Chame o primeiro vetor de ‘ass_reg’ e atribua os seguintes valores: 2540608, 5794529, 1253256.</p>
<p>O segundo vetor terá o nome de ‘ass_prec’ e conterá os seguintes valores: 97712, 161663, 19225.</p>
<p>O terceiro vetor será o ‘agsn’, com: 539918, 777051, 65114</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" tabindex="-1"></a><span class="co">#para criar o vetor &#39;ass_reg&#39;</span></span>
<span id="cb87-2"><a href="#cb87-2" tabindex="-1"></a>ass_reg <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2540608</span>, <span class="dv">5794529</span>, <span class="dv">1253256</span>)</span>
<span id="cb87-3"><a href="#cb87-3" tabindex="-1"></a><span class="co">#para criar o vetor &#39;ass_prec&#39;</span></span>
<span id="cb87-4"><a href="#cb87-4" tabindex="-1"></a>ass_prec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">97712</span>, <span class="dv">161663</span>, <span class="dv">19225</span>)</span>
<span id="cb87-5"><a href="#cb87-5" tabindex="-1"></a><span class="co">#para criar o vetor &#39;agsn&#39;</span></span>
<span id="cb87-6"><a href="#cb87-6" tabindex="-1"></a>agsn <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">539918</span>, <span class="dv">777051</span>, <span class="dv">65114</span>)</span></code></pre></div>
<p>Agora podemos definir a matriz com 3 linhas, seguindo a sequência das linhas. Vamos chamá-la de <strong>pop_sp_matrix</strong>.</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" tabindex="-1"></a><span class="co">#para criar a matriz com os 3 vetores </span></span>
<span id="cb88-2"><a href="#cb88-2" tabindex="-1"></a>pop_sp_matrix <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(ass_reg, ass_prec, agsn), <span class="at">nrow =</span> <span class="dv">3</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb88-3"><a href="#cb88-3" tabindex="-1"></a><span class="co">#para imprimi-la</span></span>
<span id="cb88-4"><a href="#cb88-4" tabindex="-1"></a>pop_sp_matrix</span></code></pre></div>
<pre><code>##         [,1]    [,2]    [,3]
## [1,] 2540608 5794529 1253256
## [2,]   97712  161663   19225
## [3,]  539918  777051   65114</code></pre>
<p>Como você viu, não temos nomes para linhas e colunas. Vamos gerar dois vetores contendo os nomes. Um para as linhas, outro para as colunas. As linhas vão receber o nome de ‘tipos’ e vão conter: ‘ass. regular’, ‘ass. precário’ e ‘agsn’. A ordem de entrada dos elementos precisa ser correta. Lembre-se que por serem texto, precisam estar entre aspas.</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" tabindex="-1"></a><span class="co">#para criar o vetor &#39;tipos&#39;</span></span>
<span id="cb90-2"><a href="#cb90-2" tabindex="-1"></a>tipos <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;ass. regular&quot;</span>, <span class="st">&quot;ass. precário&quot;</span>, <span class="st">&quot;agsn&quot;</span>)</span></code></pre></div>
<p>As colunas serão chamadas de ‘idades’ e deverão conter: 0 a 19, 20 a 59, 60 e mais</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" tabindex="-1"></a><span class="co">#para criar o vetor &#39;idades&#39;</span></span>
<span id="cb91-2"><a href="#cb91-2" tabindex="-1"></a>idades <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;0 a 19&quot;</span>, <span class="st">&quot;20 a 59&quot;</span>, <span class="st">&quot;60 e mais&quot;</span>)</span></code></pre></div>
<p>Para atribuir os nomes das colunas à matriz, vamos usar a função <strong>colnames()</strong>.</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" tabindex="-1"></a><span class="co">#para dar nomes às colunas</span></span>
<span id="cb92-2"><a href="#cb92-2" tabindex="-1"></a><span class="fu">colnames</span>(pop_sp_matrix) <span class="ot">&lt;-</span> idades</span></code></pre></div>
<p>Você consegue atribuir o nome ‘tipos’ para as linhas usando a função <strong>rownames()</strong>? Imprima novamente a matrix.</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" tabindex="-1"></a><span class="co">#para dar nomes às linhas</span></span>
<span id="cb93-2"><a href="#cb93-2" tabindex="-1"></a><span class="fu">rownames</span>(pop_sp_matrix) <span class="ot">&lt;-</span> tipos</span></code></pre></div>
</div>
<div id="cálculos-em-matrizes" class="section level2 hasAnchor" number="2.9">
<h2 class="hasAnchor"><span class="header-section-number">2.9</span> Cálculos em Matrizes<a href="#cálculos-em-matrizes" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Gostaríamos de saber qual a população total em cada tipo de assentamento. Para isso, usamos a função <strong>rowSums()</strong> para criar ‘total’</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" tabindex="-1"></a><span class="co">#para somar as linhas</span></span>
<span id="cb94-2"><a href="#cb94-2" tabindex="-1"></a>tot_rows <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(pop_sp_matrix)</span>
<span id="cb94-3"><a href="#cb94-3" tabindex="-1"></a><span class="co">#Imprima para ver o resultado</span></span>
<span id="cb94-4"><a href="#cb94-4" tabindex="-1"></a>tot_rows</span></code></pre></div>
<pre><code>##  ass. regular ass. precário          agsn 
##       9588393        278600       1382083</code></pre>
<p>Seria interessante criarmos uma nova coluna com os totais encontrados. Para isso vamos adicionar o vetor ‘total’ à matriz ‘pop_sp_matrix’ e chamar de ‘pop_sp_tot_rows’, usando a função <strong>cbind()</strong>. A letra ‘c’ neste caso, indica ‘column’</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" tabindex="-1"></a><span class="co">#para unir a coluna &#39;tot_rows&#39; à matriz</span></span>
<span id="cb96-2"><a href="#cb96-2" tabindex="-1"></a>pop_sp_tot_rows <span class="ot">&lt;-</span> <span class="fu">cbind</span>(pop_sp_matrix, tot_rows)</span>
<span id="cb96-3"><a href="#cb96-3" tabindex="-1"></a><span class="co">#imprima pop_sp_total</span></span>
<span id="cb96-4"><a href="#cb96-4" tabindex="-1"></a>pop_sp_tot_rows</span></code></pre></div>
<pre><code>##                0 a 19 20 a 59 60 e mais tot_rows
## ass. regular  2540608 5794529   1253256  9588393
## ass. precário   97712  161663     19225   278600
## agsn           539918  777051     65114  1382083</code></pre>
<p>Usando o raciocínio percorrido para adicionar uma nova coluna com a função <strong>cbind()</strong>, você seria capaz de acrescentar uma linha com os totais de cada faixa etária na matriz ‘pop_sp_total’ usando as funções <code>colSums()</code> e <code>rbind()</code>?</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" tabindex="-1"></a><span class="co">#para somar as colunas</span></span>
<span id="cb98-2"><a href="#cb98-2" tabindex="-1"></a>tot_cols <span class="ot">&lt;-</span> <span class="fu">colSums</span>(pop_sp_tot_rows)</span>
<span id="cb98-3"><a href="#cb98-3" tabindex="-1"></a><span class="co">#para unir a linha &#39;tot_cols&#39; à matriz</span></span>
<span id="cb98-4"><a href="#cb98-4" tabindex="-1"></a>pop_sp_total <span class="ot">&lt;-</span> <span class="fu">rbind</span>(pop_sp_tot_rows, tot_cols)</span>
<span id="cb98-5"><a href="#cb98-5" tabindex="-1"></a><span class="co">#Imprima para ver o resultado</span></span>
<span id="cb98-6"><a href="#cb98-6" tabindex="-1"></a>pop_sp_total</span></code></pre></div>
<pre><code>##                0 a 19 20 a 59 60 e mais tot_rows
## ass. regular  2540608 5794529   1253256  9588393
## ass. precário   97712  161663     19225   278600
## agsn           539918  777051     65114  1382083
## tot_cols      3178238 6733243   1337595 11249076</code></pre>
<p>Imagine, hipoteticamente, que 90% da população, independente da faixa etária e tipo de assentamento, tenha tomado todas as doses da vacina contra a COVID-19 em São Paulo. Para saber quantas pessoas ainda precisam tomá-la podemos multiplicar toda a matriz por 0.10. Chame o resultado de ‘pop_sp_10’</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" tabindex="-1"></a><span class="co">#para multiplicar a matriz por 10%</span></span>
<span id="cb100-2"><a href="#cb100-2" tabindex="-1"></a>pop_sp_10 <span class="ot">&lt;-</span> pop_sp_total <span class="sc">*</span> <span class="fl">0.10</span></span>
<span id="cb100-3"><a href="#cb100-3" tabindex="-1"></a><span class="co">#para visualizar o resultado</span></span>
<span id="cb100-4"><a href="#cb100-4" tabindex="-1"></a>pop_sp_10</span></code></pre></div>
<pre><code>##                 0 a 19  20 a 59 60 e mais  tot_rows
## ass. regular  254060.8 579452.9  125325.6  958839.3
## ass. precário   9771.2  16166.3    1922.5   27860.0
## agsn           53991.8  77705.1    6511.4  138208.3
## tot_cols      317823.8 673324.3  133759.5 1124907.6</code></pre>
<p>Mas na verdade descobrimos que a cobertura vacinal variou entre as faixas etárias e também entre os tipos de assentamentos. Criamos uma matriz com os valores (hipotéticos) de cobertura vacinal.</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" tabindex="-1"></a><span class="co">#vetor da cobertura vacinal</span></span>
<span id="cb102-2"><a href="#cb102-2" tabindex="-1"></a>cob_vac <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.59</span>, <span class="fl">0.88</span>, <span class="fl">0.93</span>, <span class="fl">0.8</span>, <span class="fl">0.61</span>, <span class="fl">0.79</span>, <span class="fl">0.75</span>, <span class="fl">0.66</span>, <span class="fl">0.56</span>, <span class="fl">0.65</span>, <span class="fl">0.72</span>, <span class="fl">0.64</span>, <span class="fl">0.59</span>, <span class="fl">0.77</span>, <span class="fl">0.8</span>, <span class="fl">0.7</span>)</span>
<span id="cb102-3"><a href="#cb102-3" tabindex="-1"></a><span class="co">#para criar a matriz</span></span>
<span id="cb102-4"><a href="#cb102-4" tabindex="-1"></a>cob_vac_matrix <span class="ot">&lt;-</span> <span class="fu">matrix</span>(cob_vac, <span class="at">nrow =</span> <span class="dv">4</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb102-5"><a href="#cb102-5" tabindex="-1"></a><span class="co">#para imprimir a matriz</span></span>
<span id="cb102-6"><a href="#cb102-6" tabindex="-1"></a>cob_vac_matrix</span></code></pre></div>
<pre><code>##      [,1] [,2] [,3] [,4]
## [1,] 0.59 0.88 0.93 0.80
## [2,] 0.61 0.79 0.75 0.66
## [3,] 0.56 0.65 0.72 0.64
## [4,] 0.59 0.77 0.80 0.70</code></pre>
<p>Agora queremos saber quantas pessoas já foram vacinadas por faixa etária e tipo de assentamento. Para isso, multiplique as duas matrizes.</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" tabindex="-1"></a><span class="co">#para multiplicar as matrizes</span></span>
<span id="cb104-2"><a href="#cb104-2" tabindex="-1"></a>sp_cob_vac <span class="ot">&lt;-</span> pop_sp_total <span class="sc">*</span> cob_vac_matrix</span>
<span id="cb104-3"><a href="#cb104-3" tabindex="-1"></a><span class="co">#para visualizar o resultado</span></span>
<span id="cb104-4"><a href="#cb104-4" tabindex="-1"></a>sp_cob_vac</span></code></pre></div>
<pre><code>##                   0 a 19   20 a 59  60 e mais  tot_rows
## ass. regular  1498958.72 5099185.5 1165528.08 7670714.4
## ass. precário   59604.32  127713.8   14418.75  183876.0
## agsn           302354.08  505083.2   46882.08  884533.1
## tot_cols      1875160.42 5184597.1 1070076.00 7874353.2</code></pre>
<p>Veja que a aritmética entre matrizes só é possível quando elas têm o mesmo número de linhas e colunas.</p>
</div>
<div id="seleção-em-matrizes" class="section level2 hasAnchor" number="2.10">
<h2 class="hasAnchor"><span class="header-section-number">2.10</span> Seleção em Matrizes<a href="#seleção-em-matrizes" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Já vimos que para selecionar um elemento de um vetor podemos usar colchetes <strong>[ ]</strong>. O mesmo acontece com a seleção em matrizes. A diferença é que um vetor é unidimensional enquanto uma matriz é bidimensional. Desta forma, dentro dos colchetes precisamos indicar qual a linha e qual a coluna correspondente ao elemento que desejamos selecionar.</p>
<p>Outro aspecto que precisamos recordar é que quando desejamos selecionar um intervalo de dados podemos usar <strong>:</strong> para indicar que os dados estão em uma sequência. Por exemplo, para selecionar elementos que estão nas linhas 23 a 35, na coluna 12: <strong>[23:35,12]</strong>.</p>
<p>Ao selecionar uma linha inteira definimos apenas o número da linha. Por exemplo, seleção da linha 63: <strong>nomearquivo[63,]</strong>. Se fosse a coluna 31, seria <strong>[,31]</strong>.</p>
<p>Com base na matriz de população por tipo de assentamento e faixa etária, selecione a população de 20 a 59 anos que mora em aglomerados subnormais. Chame a variável de ‘agsn_20a59’. Se achar mais fácil, imprima a matriz ‘pop_sp_total’ para visualizar os dados. Observe que a matriz de dados é 4 x 4 (os nomes das linhas e das colunas não contam).</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" tabindex="-1"></a><span class="co">#para visualizar a matriz</span></span>
<span id="cb106-2"><a href="#cb106-2" tabindex="-1"></a>pop_sp_total</span></code></pre></div>
<pre><code>##                0 a 19 20 a 59 60 e mais tot_rows
## ass. regular  2540608 5794529   1253256  9588393
## ass. precário   97712  161663     19225   278600
## agsn           539918  777051     65114  1382083
## tot_cols      3178238 6733243   1337595 11249076</code></pre>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" tabindex="-1"></a><span class="co">#para selecionar o que se deseja e criar uma nova variável</span></span>
<span id="cb108-2"><a href="#cb108-2" tabindex="-1"></a>agsn_20a59 <span class="ot">&lt;-</span> pop_sp_total[<span class="dv">3</span>,<span class="dv">2</span>]</span>
<span id="cb108-3"><a href="#cb108-3" tabindex="-1"></a><span class="co">#para visualizar o resultado</span></span>
<span id="cb108-4"><a href="#cb108-4" tabindex="-1"></a>agsn_20a59</span></code></pre></div>
<pre><code>## [1] 777051</code></pre>
<p>Selecione a linha inteira dos assentamentos precários e chame a nova variável de ‘pop_ass_prec’.</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" tabindex="-1"></a><span class="co">#para atribuir &#39;pop_ass_prec&#39; à seleção da linha inteira</span></span>
<span id="cb110-2"><a href="#cb110-2" tabindex="-1"></a>pop_ass_prec <span class="ot">&lt;-</span> pop_sp_total[<span class="dv">2</span>,]</span>
<span id="cb110-3"><a href="#cb110-3" tabindex="-1"></a><span class="co">#para visualizar</span></span>
<span id="cb110-4"><a href="#cb110-4" tabindex="-1"></a>pop_ass_prec</span></code></pre></div>
<pre><code>##    0 a 19   20 a 59 60 e mais  tot_rows 
##     97712    161663     19225    278600</code></pre>
</div>
<div id="fatores" class="section level2 hasAnchor" number="2.11">
<h2 class="hasAnchor"><span class="header-section-number">2.11</span> Fatores<a href="#fatores" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Fatores armazenam dados de variáveis categóricas (ou qualitativas). Enquanto as variáveis contínuas correspondem a infinitos valores, as variáveis categóricas só podem pertencer a um número limitado de classes.</p>
<p>Um bom exemplo de variável categórica são as classes de raça ou cor (segundo classificação do IBGE). No Censo Demográfico brasileiro há 5 grupos autorreferidos de raça ou cor: preta, branca, amarela, indígena ou parda. Deixando de lado todas as discussões sobre a definição e nomes destas categorias, podemos criar um vetor atribuindo a cada pessoa entrevistada uma cor ou raça referida por ela.</p>
<p>Vamos criar um vetor chamado ‘vetor_cor’ para uma amostragem de 10 pessoas, cujas respostas ordenadas foram: preta, preta, branca, parda, branca, amarela, indigena, preta, branca, parda. Como as respostas são em texto, é necessário usar ““.</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" tabindex="-1"></a>vetor_cor <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;preta&quot;</span>, <span class="st">&quot;preta&quot;</span>, <span class="st">&quot;branca&quot;</span>, <span class="st">&quot;parda&quot;</span>, <span class="st">&quot;branca&quot;</span>, <span class="st">&quot;amarela&quot;</span>, <span class="st">&quot;indigena&quot;</span>, <span class="st">&quot;preta&quot;</span>, <span class="st">&quot;branca&quot;</span>, <span class="st">&quot;parda&quot;</span>)</span>
<span id="cb112-2"><a href="#cb112-2" tabindex="-1"></a></span>
<span id="cb112-3"><a href="#cb112-3" tabindex="-1"></a><span class="co">#Imprima para ver o vetor</span></span>
<span id="cb112-4"><a href="#cb112-4" tabindex="-1"></a>vetor_cor</span></code></pre></div>
<pre><code>##  [1] &quot;preta&quot;    &quot;preta&quot;    &quot;branca&quot;   &quot;parda&quot;    &quot;branca&quot;   &quot;amarela&quot; 
##  [7] &quot;indigena&quot; &quot;preta&quot;    &quot;branca&quot;   &quot;parda&quot;</code></pre>
<p>Para que o R reconheça este vetor como um fator, usamos a função <strong>factor()</strong>. Crie ‘fator_vetor_cor’ usando a função <strong>factor()</strong>. Imprima para ver o resultado.</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" tabindex="-1"></a><span class="co">#para criar o fator</span></span>
<span id="cb114-2"><a href="#cb114-2" tabindex="-1"></a>fator_vetor_cor <span class="ot">&lt;-</span> <span class="fu">factor</span>(vetor_cor)</span>
<span id="cb114-3"><a href="#cb114-3" tabindex="-1"></a><span class="co">#para visualizar</span></span>
<span id="cb114-4"><a href="#cb114-4" tabindex="-1"></a>fator_vetor_cor</span></code></pre></div>
<pre><code>##  [1] preta    preta    branca   parda    branca   amarela  indigena
##  [8] preta    branca   parda   
## Levels: amarela branca indigena parda preta</code></pre>
<p>Observe que quando imprimimos o objeto do tipo fator, existe a linha “Levels” mostrando todas as categorias encontradas no conjunto de dados.</p>
<p>Os dados categóricos podem ser nominais ou ordinais. Como vimos no fator cor, não existe ordem entre as categorias. Neste caso, eles são listados em ordem alfabética na linha “Levels”.</p>
<p>Uma função muito útil é <strong>summary()</strong>. Com ela você tem uma boa ideia do conteúdo de cada objeto. Tente <strong>summary()</strong> para ver ‘vetor_cor’ e em seguida, para ver ‘fator_vetor_cor’.</p>
<p>Qual a diferença entre os dois?</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" tabindex="-1"></a><span class="co">#para ver o resumo do vetor</span></span>
<span id="cb116-2"><a href="#cb116-2" tabindex="-1"></a><span class="fu">summary</span>(vetor_cor)</span></code></pre></div>
<pre><code>##    Length     Class      Mode 
##        10 character character</code></pre>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" tabindex="-1"></a><span class="co">#para vero resumo do fator</span></span>
<span id="cb118-2"><a href="#cb118-2" tabindex="-1"></a><span class="fu">summary</span>(fator_vetor_cor)</span></code></pre></div>
<pre><code>##  amarela   branca indigena    parda    preta 
##        1        3        1        2        3</code></pre>
<p>Em um fator, o ‘summary’ resume o número de elementos presentes em cada categoria. No vetor, ‘summary’ apresenta o comprimento do vetor e o tipo de dados.</p>
<p>Fatores podem ser nominais ou ordinais. Para criar um fator ordinal, é preciso especificar os níveis entre os elementos. Vamos criar um vetor com a vulnerabilidade a inundações de 10 municípios. Chame este vetor de ‘vuln’.</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" tabindex="-1"></a><span class="co">#para criar o vetor</span></span>
<span id="cb120-2"><a href="#cb120-2" tabindex="-1"></a>vuln <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;alta&quot;</span>, <span class="st">&quot;baixa&quot;</span>, <span class="st">&quot;baixa&quot;</span>, <span class="st">&quot;muito alta&quot;</span>, <span class="st">&quot;nenhuma&quot;</span>, <span class="st">&quot;intermediária&quot;</span>, <span class="st">&quot;intermediária&quot;</span>, <span class="st">&quot;intermediária&quot;</span>, <span class="st">&quot;baixa&quot;</span>, <span class="st">&quot;baixa&quot;</span>)</span>
<span id="cb120-3"><a href="#cb120-3" tabindex="-1"></a><span class="co">#para visualizar</span></span>
<span id="cb120-4"><a href="#cb120-4" tabindex="-1"></a>vuln</span></code></pre></div>
<pre><code>##  [1] &quot;alta&quot;          &quot;baixa&quot;         &quot;baixa&quot;         &quot;muito alta&quot;   
##  [5] &quot;nenhuma&quot;       &quot;intermediária&quot; &quot;intermediária&quot; &quot;intermediária&quot;
##  [9] &quot;baixa&quot;         &quot;baixa&quot;</code></pre>
<p>Vamos converter o vetor ‘vuln’ em um fator ordenado. Para isso precisaremos indicar a ordem dos níveis. Ordem de elementos segundo vulnerabilidade (nenhuma, baixa, intermediária, alta, muito alta).</p>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" tabindex="-1"></a><span class="co">#para criar o fator</span></span>
<span id="cb122-2"><a href="#cb122-2" tabindex="-1"></a>factor_vuln <span class="ot">&lt;-</span> <span class="fu">factor</span>(vuln, <span class="at">ordered =</span> T, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;nenhuma&quot;</span>, <span class="st">&quot;baixa&quot;</span>, <span class="st">&quot;intermediária&quot;</span>, <span class="st">&quot;alta&quot;</span>, <span class="st">&quot;muito alta&quot;</span>))</span>
<span id="cb122-3"><a href="#cb122-3" tabindex="-1"></a><span class="co">#para visualizar o fator criado</span></span>
<span id="cb122-4"><a href="#cb122-4" tabindex="-1"></a>factor_vuln</span></code></pre></div>
<pre><code>##  [1] alta          baixa         baixa         muito alta   
##  [5] nenhuma       intermediária intermediária intermediária
##  [9] baixa         baixa        
## Levels: nenhuma &lt; baixa &lt; intermediária &lt; alta &lt; muito alta</code></pre>
<p>Em um fator ordenado, as classes aparecem em ordem crescente de acordo com os níveis estabelecidos.</p>
<p>Visualize o <strong>summary()</strong> de ‘factor_vuln’.</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" tabindex="-1"></a><span class="fu">summary</span>(factor_vuln)</span></code></pre></div>
<pre><code>##       nenhuma         baixa intermediária          alta    muito alta 
##             1             4             3             1             1</code></pre>
<p>Vamos selecionar e criar novos objetos com os elementos de ‘factor_vuln’. Selecione o elemento 6 e crie um objeto. Selecione o elemento 2 e crie um elemento. Chame de ‘vuln6’ e ‘vuln2’, respectivamente</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" tabindex="-1"></a><span class="co">#para selecionar o elemento 6</span></span>
<span id="cb126-2"><a href="#cb126-2" tabindex="-1"></a>vuln6 <span class="ot">&lt;-</span> factor_vuln[<span class="dv">6</span>]</span>
<span id="cb126-3"><a href="#cb126-3" tabindex="-1"></a><span class="co">#para selecionar o elemento 2</span></span>
<span id="cb126-4"><a href="#cb126-4" tabindex="-1"></a>vuln2 <span class="ot">&lt;-</span> factor_vuln[<span class="dv">2</span>]</span>
<span id="cb126-5"><a href="#cb126-5" tabindex="-1"></a></span>
<span id="cb126-6"><a href="#cb126-6" tabindex="-1"></a><span class="co">#para visualizar</span></span>
<span id="cb126-7"><a href="#cb126-7" tabindex="-1"></a>vuln6</span></code></pre></div>
<pre><code>## [1] intermediária
## Levels: nenhuma &lt; baixa &lt; intermediária &lt; alta &lt; muito alta</code></pre>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" tabindex="-1"></a>vuln2</span></code></pre></div>
<pre><code>## [1] baixa
## Levels: nenhuma &lt; baixa &lt; intermediária &lt; alta &lt; muito alta</code></pre>
<p>Agora poderemos comparar ‘vuln6’ com ‘vuln2’. Verifique se ‘vuln6’ é igual a ‘vuln2’.</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" tabindex="-1"></a><span class="co">#para verificar se vuln6 é igual a vuln2</span></span>
<span id="cb130-2"><a href="#cb130-2" tabindex="-1"></a>vuln6 <span class="sc">==</span> vuln2</span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<p>Verifique se ‘vuln6’ é maior do que ‘vuln2’.</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" tabindex="-1"></a><span class="co">#para verificar se vuln6 é maior do que vuln2</span></span>
<span id="cb132-2"><a href="#cb132-2" tabindex="-1"></a>vuln6 <span class="sc">&gt;</span> vuln2</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
</div>
<div id="referências-citadas" class="section level2 hasAnchor" number="2.12">
<h2 class="hasAnchor"><span class="header-section-number">2.12</span> Referências citadas<a href="#referências-citadas" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>AQUINO, J.A. <strong>R para cientistas sociais</strong>. Ilhéus: Editora da UESC, 2014. 167p.</p>
<p>DATACAMP. 2023. Cornelissen, J. <strong>Introduction to R</strong>. On-line Course.</p>
<p>DATACAMP. 2023. Robinson, D. <strong>Introduction to the Tidyverse</strong>. On-line Course.</p>
<p>DATACAMP. 2023. Chapman, J. <strong>Data manipulation with Dplyr</strong>. On-line Course.</p>
<!--chapter:end:03-basico-do-basico.Rmd-->
</div>
</div>
<div id="dataframes" class="section level1 hasAnchor" number="3">
<h1 class="hasAnchor"><span class="header-section-number">3</span> Dataframes<a href="#dataframes" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Um <strong>dataframe</strong> contém um conjunto de dados organizados em linhas e colunas, assim como uma matriz. No entanto, existe uma diferença importante entre uma matriz e um dataframe. O dataframe aceita que as colunas tenham diferentes tipos de dados, enquanto uma matriz só permite um tipo para todas as colunas.</p>
<p>Para darmos início, vamos limpar a memória e verificar o diretório.</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" tabindex="-1"></a><span class="co">#para limpar a memoria</span></span>
<span id="cb134-2"><a href="#cb134-2" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span> <span class="fu">ls</span>())</span>
<span id="cb134-3"><a href="#cb134-3" tabindex="-1"></a><span class="co">#para verificar o diretório de trabalho</span></span>
<span id="cb134-4"><a href="#cb134-4" tabindex="-1"></a><span class="fu">getwd</span>()</span></code></pre></div>
<p>É sempre bom deixarmos alinhado com a língua que usaremos para evitar problemas com acentuação nos títulos. Também vamos desativar a notação científica para que os códigos do IBGE apareçam por completo.</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" tabindex="-1"></a><span class="co">#para ajustar a língua para português usando a função</span></span>
<span id="cb135-2"><a href="#cb135-2" tabindex="-1"></a><span class="fu">Sys.setlocale</span>(<span class="at">category =</span> <span class="st">&quot;LC_ALL&quot;</span>, <span class="at">locale =</span> <span class="st">&quot;pt_BR.UTF-8&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;LC_COLLATE=pt_BR.UTF-8;LC_CTYPE=pt_BR.UTF-8;LC_MONETARY=pt_BR.UTF-8;LC_NUMERIC=C;LC_TIME=pt_BR.UTF-8&quot;</code></pre>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" tabindex="-1"></a><span class="co">#para desativar a notação científica</span></span>
<span id="cb137-2"><a href="#cb137-2" tabindex="-1"></a><span class="fu">options</span>(<span class="at">scipen =</span> <span class="dv">999</span>)</span></code></pre></div>
<div id="criação-de-dataframe" class="section level2 hasAnchor" number="3.1">
<h2 class="hasAnchor"><span class="header-section-number">3.1</span> Criação de dataframe<a href="#criação-de-dataframe" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Vimos que um dataframe pode conter diferentes tipos de variáveis. Para vermos com mais detalhes como um dataframe funciona, vamos criar um a partir de vetores.</p>
<p>Podemos criar vetores e depois uni-los usando a função <strong>data.frame()</strong>. Também poderemos importar bancos de dados prontos, o que é ainda mais usual.</p>
<p>Vamos começar com a construção de um dataframe a partir dos vetores.</p>
<p>Vamos criar um dataframe com dados das capitais das Unidades da Federação do Brasil. Para isso vamos precisar criar os vetores de cada conjunto de dados separadamente.</p>
<p>Vamos começar com os nomes das capitais, ‘nomes’. Lembre-se que os nomes devem entrar entre aspas: “Aracaju”, “Belém”, “Belo Horizonte”, “Boa Vista”, “Brasília”, “Campo Grande”, “Cuiabá”, “Curitiba”, “Florianópolis”, “Fortaleza”, “Goiânia”, “João Pessoa”, “Macapá”, “Maceió”, “Manaus”, “Natal”, “Palmas”, “Porto Alegre”, “Porto Velho”, “Recife”, “Rio Branco”, “Rio de Janeiro”, “Salvador”, “São Luís”, “São Paulo”, “Teresina”, “Vitória”</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" tabindex="-1"></a>nomes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Aracaju&quot;</span>, <span class="st">&quot;Belém&quot;</span>, <span class="st">&quot;Belo Horizonte&quot;</span>, <span class="st">&quot;Boa Vista&quot;</span>, <span class="st">&quot;Brasília&quot;</span>, <span class="st">&quot;Campo Grande&quot;</span>, <span class="st">&quot;Cuiabá&quot;</span>, <span class="st">&quot;Curitiba&quot;</span>, <span class="st">&quot;Florianópolis&quot;</span>, <span class="st">&quot;Fortaleza&quot;</span>, <span class="st">&quot;Goiânia&quot;</span>, <span class="st">&quot;João Pessoa&quot;</span>, <span class="st">&quot;Macapá&quot;</span>, <span class="st">&quot;Maceió&quot;</span>, <span class="st">&quot;Manaus&quot;</span>, <span class="st">&quot;Natal&quot;</span>, <span class="st">&quot;Palmas&quot;</span>, <span class="st">&quot;Porto Alegre&quot;</span>, <span class="st">&quot;Porto Velho&quot;</span>, <span class="st">&quot;Recife&quot;</span>, <span class="st">&quot;Rio Branco&quot;</span>, <span class="st">&quot;Rio de Janeiro&quot;</span>, <span class="st">&quot;Salvador&quot;</span>, <span class="st">&quot;São Luís&quot;</span>, <span class="st">&quot;São Paulo&quot;</span>, <span class="st">&quot;Teresina&quot;</span>, <span class="st">&quot;Vitória&quot;</span>)</span></code></pre></div>
<p>Vamos criar o objeto ‘regiao’: “Nordeste”, “Norte”, “Sudeste”, “Norte”, “Centro-Oeste”, “Centro-Oeste”, “Centro-Oeste”, “Sul”, “Sul”, “Nordeste”, “Centro-Oeste”, “Nordeste”, “Norte”, “Nordeste”, “Norte”, “Nordeste”, “Norte”, “Sul”, “Norte”, “Nordeste”, “Norte”, “Sudeste”, “Nordeste”, “Nordeste”, “Sudeste”, “Nordeste”, “Sudeste”</p>
<p>O vetor da população de cada capital receberá o nome de ‘pop’ e deverá conter: 664908, 1499641, 2521564, 419652, 3055149, 906092, 618124, 1948626, 508826, 2686612, 1536097, 817511, 512902, 1025360, 2219580, 890480, 306296, 1488252, 539354, 1653461, 413418 , 6747815, 2886698, 1108975, 11253503, 868075, 365855</p>
<p>Vamos criar um vetor para indicar se a capital fica no litoral ou não. O vetor receberá o nome de ‘costa’ e deverá conter: TRUE, TRUE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, TRUE, TRUE, FALSE, TRUE, TRUE, TRUE, FALSE, TRUE, FALSE, FALSE, FALSE, TRUE, FALSE, TRUE, TRUE, TRUE, FALSE, FALSE, TRUE</p>
<p>A partir dos vetores fica fácil criar um data frame usando a função <strong>data.frame()</strong>. Chame o dataframe de ‘capitais’ contendo os vetores nomes, regiao, pop e costa</p>
<p>Agora examine as variáveis de ‘capitais’ usando a função <strong>str()</strong>.</p>
</div>
<div id="importação-de-um-dataframe" class="section level2 hasAnchor" number="3.2">
<h2 class="hasAnchor"><span class="header-section-number">3.2</span> Importação de um dataframe<a href="#importação-de-um-dataframe" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Os dataframes são muito usados nas análises de dados. Os arquivos com dados espaciais, que serão usados para elaborarmos os mapas, contêm uma tabela de dados relacional. Ela é chamada relacional porque está associada a cada feição (ponto, linha ou polígono) do arquivo de geometria. Assim, em um arquivo do tipo <strong>shapefile</strong> o polígono do município de São Paulo tem a sua forma representada em um arquivo do tipo .shp. A tabela de dados do tipo .dbf contém uma linha para cada feição do arquivo da geometria e características (atributos) vinculados a cada feição. Um terceiro arquivo, do tipo .shx, faz a conexão entre o arquivo .shp e o .dbf.</p>
<p>Não é objetivo deste livro esgotar as possibilidades dos pacotes para análise de dados. O conteúdo que será apresentado será o mínimo para que seja possível a preparação dos arquivos que serão usados para a elaboração de mapas. Em geral, precisaremos saber fazer o download de tabelas e arquivos espaciais; fazer cálculos entre colunas da tabela; filtrar colunas e linhas e unir tabelas de dados a dados espaciais (shapefiles, geopackages, etc).</p>
<p>Para que o leitor consiga autonomia, vamos trabalhar com dados reais, disponíveis na Internet. Para baixar os dados diretos da Internet, vamos precisar do pacote <strong>R.utils</strong>. Precisamos instalá-lo agora.</p>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" tabindex="-1"></a><span class="co">#para instalar o pacote R.utils</span></span>
<span id="cb139-2"><a href="#cb139-2" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;R.utils&quot;</span>)</span></code></pre></div>
<p>Também será necessário carregá-lo.</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" tabindex="-1"></a><span class="co">#para carregar o pacote instalado</span></span>
<span id="cb140-2"><a href="#cb140-2" tabindex="-1"></a><span class="fu">library</span>(R.utils)</span></code></pre></div>
<p>O arquivo com extensão csv está disponível no site da Fundação SEADE. Desta forma, faremos o download do arquivo CSV após a identificação da url (<em>Uniform Resource Locator</em>, ou Localizador Uniforme de Recursos - significa endereço web, ou seja, o texto que você digita na barra do navegador para acessar uma determinada página ou serviço). Para isso, usaremos a função <code>download.file</code> do pacote <strong>R.utils</strong>. A documentação completa dos pacotes e funções estão disponíveis em <a href="https://www.rdocumentation.org/">R documentation</a>.</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" tabindex="-1"></a><span class="co">#se quiser identificar a url de um determinado conjunto de dados, faça o download do arquivo desejado manualmente e clique em Ctrl+J. O navegador mostrará o caminho completo, que poderá ser copiado. Para o download do arquivo com os municípios do estado de São Paulo, use o comando a seguir. Use o nome do arquivo como arquivo de destino (destfile) </span></span>
<span id="cb141-2"><a href="#cb141-2" tabindex="-1"></a><span class="fu">download.file</span>(<span class="at">url =</span> <span class="st">&quot;https://repositorio.seade.gov.br/dataset/71bffea4-0650-4f2e-9d82-b0179137cd3e/resource/ef737887-69d9-4afa-a513-00aa78ec2419/download/evolucao_casamentos.csv&quot;</span>, <span class="at">destfile =</span> <span class="st">&quot;evolucao_casamentos.csv&quot;</span>)</span></code></pre></div>
<p>Também precisaremos do arquivo com os nomes dos municípios.</p>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" tabindex="-1"></a><span class="co">#para fazer download do arquivo &#39;codigos_municipios_regioes.csv&#39;</span></span>
<span id="cb142-2"><a href="#cb142-2" tabindex="-1"></a></span>
<span id="cb142-3"><a href="#cb142-3" tabindex="-1"></a><span class="fu">download.file</span>(<span class="at">url =</span> <span class="st">&quot;https://repositorio.seade.gov.br/dataset/1617c335-f5ab-426c-b175-280d4e41ec1c/resource/1871ac05-7b7f-4c13-9b4a-23c7d41fd988/download/codigos_municipios_regioes.csv&quot;</span>, <span class="at">destfile =</span> <span class="st">&quot;codigos_municipios_regioes.csv&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" tabindex="-1"></a><span class="co">#para criar um dataframe com o nome &#39;evol_casam&#39; a partir do arquivo csv. Como o arquivo contém a primeira linha de cabeçalho, é preciso indicar que &#39;header = TRUE&#39;. Como os campos estão separados por ponto e vírgula, deve-se indicar &#39;sep = &quot;;&quot; </span></span>
<span id="cb143-2"><a href="#cb143-2" tabindex="-1"></a>evol_casam <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;C:/Users/l_viz/Documents/RCartoTematica/evolucao_casamentos.csv&quot;</span>, <span class="at">header =</span> <span class="cn">TRUE</span>, <span class="at">sep =</span> <span class="st">&quot;;&quot;</span>)</span></code></pre></div>
<p>Vamos abrir o segundo arquivo csv que contém os códigos do IBGE e os nomes dos municípios do Estado de São Paulo.</p>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" tabindex="-1"></a><span class="co">#Este arquivo está codificado em &#39;latin1&#39;.</span></span>
<span id="cb144-2"><a href="#cb144-2" tabindex="-1"></a><span class="co">#para criar um dataframe com o nome &#39;codigos&#39;, precisamos indicar o encoding como &#39;latin1&#39; para que a acentuação seja lida corretamente</span></span>
<span id="cb144-3"><a href="#cb144-3" tabindex="-1"></a>codigos <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;C:/Users/l_viz/Documents/RCartoTematica/codigos_municipios_regioes.csv&quot;</span>, <span class="at">header =</span> <span class="cn">TRUE</span>, <span class="at">sep =</span> <span class="st">&quot;;&quot;</span>, <span class="at">dec =</span> <span class="st">&quot;.&quot;</span>, <span class="at">stringsAsFactors=</span><span class="cn">FALSE</span>, <span class="at">encoding=</span><span class="st">&quot;latin1&quot;</span>)</span></code></pre></div>
<p>Como o banco de dados é muito grande, podemos olhar para uma amostra bem menor, digamos, de 6 linhas do começo do banco de dados ou das últimas linhas. Para isso usamos a função <strong>head()</strong> (<em>cabeça</em>) ou <strong>tail()</strong> (<em>cauda</em>), respectivamente. Rode as duas funções para ‘evol_casam’ e ‘codigos’.</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" tabindex="-1"></a><span class="co">#para ver as 6 primeiras linhas do início</span></span>
<span id="cb145-2"><a href="#cb145-2" tabindex="-1"></a><span class="fu">head</span>(evol_casam)</span></code></pre></div>
<pre><code>##    ano cod_ibge entre.pessoas.de.sexos.diferentes
## 1 2000  3500105                               139
## 2 2000  3500204                                22
## 3 2000  3500303                               119
## 4 2000  3500402                                69
## 5 2000  3500501                                73
## 6 2000  3500550                                14
##   entre.pessoas.do.mesmo.sexo ignorado total
## 1                          NA       NA   139
## 2                          NA       NA    22
## 3                          NA       NA   119
## 4                          NA       NA    69
## 5                          NA       NA    73
## 6                          NA       NA    14</code></pre>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" tabindex="-1"></a><span class="fu">head</span>(codigos)</span></code></pre></div>
<pre><code>##   cod_ibge          municipios                   cod_ra
## 1  3500000 Estado de São Paulo Estado sem especificação
## 2  3500105          Adamantina                      691
## 3  3500204              Adolfo                      689
## 4  3500303               Aguaí                      686
## 5  3500402      Águas da Prata                      686
## 6  3500501    Águas de Lindóia                      686
##            reg_administrativa       reg_metropolitanas cod_ibge6
## 1    Estado sem especificação Estado sem especificação    350000
## 2   RA de Presidente Prudente        Demais municípios    350010
## 3 RA de São José do Rio Preto RM São José do Rio Preto    350020
## 4              RA de Campinas        Demais municípios    350030
## 5              RA de Campinas        Demais municípios    350040
## 6              RA de Campinas        Demais municípios    350050
##                    pop2020             porte_pop2020
## 1 Estado sem especificação  Estado sem especificação
## 2                    33894 Mais de 20 mil até 50 mil
## 3                     3447                 Até 5 mil
## 4                    35608 Mais de 20 mil até 50 mil
## 5                     7797  Mais de 5 mil até 10 mil
## 6                    18374 Mais de 10 mil até 20 mil
##                    cod_drs                      drs
## 1 Estado sem especificação Estado sem especificação
## 2                        5                  Marília
## 3                       15    São José do Rio Preto
## 4                       14    São João da Boa Vista
## 5                       14    São João da Boa Vista
## 6                        3                 Campinas</code></pre>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" tabindex="-1"></a><span class="co">#para ver as 6 últimas linhas</span></span>
<span id="cb149-2"><a href="#cb149-2" tabindex="-1"></a><span class="fu">tail</span>(evol_casam)</span></code></pre></div>
<pre><code>##        ano cod_ibge entre.pessoas.de.sexos.diferentes
## 14763 2022  3557154                                11
## 14764 2022  3557204                                87
## 14765 2022  3557303                                69
## 14766 2022  3549102                               398
## 14767 2022  3522901                                39
## 14768 2022  3538105                                79
##       entre.pessoas.do.mesmo.sexo ignorado total
## 14763                          NA       NA    11
## 14764                          NA       NA    87
## 14765                          NA       NA    69
## 14766                          NA       NA   398
## 14767                           1       NA    40
## 14768                          NA       NA    79</code></pre>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1" tabindex="-1"></a><span class="fu">tail</span>(codigos)</span></code></pre></div>
<pre><code>##     cod_ibge     municipios cod_ra          reg_administrativa
## 641  3556958 Vitória Brasil    689 RA de São José do Rio Preto
## 642  3557006     Votorantim    685              RA de Sorocaba
## 643  3557105    Votuporanga    689 RA de São José do Rio Preto
## 644  3557154       Zacarias    689 RA de São José do Rio Preto
## 645  3557204      Chavantes    692               RA de Marília
## 646  3557303   Estiva Gerbi    686              RA de Campinas
##           reg_metropolitanas cod_ibge6 pop2020
## 641        Demais municípios    355695    1760
## 642           RM de Sorocaba    355700  119824
## 643        Demais municípios    355710   91760
## 644 RM São José do Rio Preto    355715    2560
## 645        Demais municípios    355720   12223
## 646        Demais municípios    355730   11079
##                   porte_pop2020 cod_drs                   drs
## 641                   Até 5 mil      15 São José do Rio Preto
## 642 Mais de 100 mil até 200 mil       6              Sorocaba
## 643  Mais de 50 mil até 100 mil      15 São José do Rio Preto
## 644                   Até 5 mil      15 São José do Rio Preto
## 645   Mais de 10 mil até 20 mil       5               Marília
## 646   Mais de 10 mil até 20 mil      14 São João da Boa Vista</code></pre>
<p>Vamos usar estes dois dataframes para as operações com o pacote <strong>Tidyverse</strong>, a seguir.</p>
</div>
</div>
<div id="tidyverse" class="section level1 hasAnchor" number="4">
<h1 class="hasAnchor"><span class="header-section-number">4</span> Básico do Tidyverse<a href="#tidyverse" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Quando instalamos o <strong>R</strong> e o <strong>RStudio</strong>, apenas as funções básicas do <strong>R</strong> são instaladas. Outros pacotes são necessários para funções específicas.</p>
<p>Um pacote que permite a organização e manipulação de dados é o <strong>Tidyverse</strong>. Este pacote contém outros, tais como: <em>ggplot2</em>, <em>dplyr</em>, <em>tidyr</em>, <em>readr</em>, <em>purrr</em>, <em>tibble</em>, <em>stringr</em>, <em>forcats</em>.</p>
<p>O primeiro passo será instalar o pacote <strong>tidyverse</strong>, usando a função <strong>install.packages()</strong>. Alternativamente, é possível fazer a instalação usando a ferramenta <strong>Tools/Install Packages</strong> do menu do <strong>RStudio</strong>.</p>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1" tabindex="-1"></a><span class="co">#para instalar o pacote</span></span>
<span id="cb153-2"><a href="#cb153-2" tabindex="-1"></a><span class="fu">install.packages</span>(tidyverse)</span></code></pre></div>
<p>Depois de instalado, o pacote precisa ser carregado a partir da função <strong>library()</strong>.</p>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb154-1"><a href="#cb154-1" tabindex="-1"></a><span class="co">#para carregar o pacote instalado</span></span>
<span id="cb154-2"><a href="#cb154-2" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code></pre></div>
<p>Observe que ao carregar o pacote <strong>tidyverse</strong>, os pacotes <em>ggplot2</em>, <em>dplyr</em>, <em>tidyr</em>, <em>readr</em>, <em>purrr</em>, <em>tibble</em>, <em>stringr</em>, <em>forcats</em> são carregados também.</p>
<div id="o-operador-pipe-no-tidyverse" class="section level2 hasAnchor" number="4.1">
<h2 class="hasAnchor"><span class="header-section-number">4.1</span> O operador Pipe no tidyverse<a href="#o-operador-pipe-no-tidyverse" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>O operador <strong>%&gt;%</strong> é usado para expressar uma sequência de operações múltiplas, por exemplo, a saída de uma função ou expressão é passada a uma outra função como um argumento. No código, pode ser traduzido como <strong>então</strong>.</p>
<p><strong>Pontos importantes no uso do Pipe no R</strong></p>
<ul>
<li><p>quando usar o pacote <strong>tidyverse</strong> o operador %&gt;% fica automaticamente disponível para uso.</p></li>
<li><p>ele considera a saída de uma função e a usa em outra função como um argumento;</p></li>
<li><p>funciona com uma função que leva uma entrada;</p></li>
<li><p>se uma função precisar de duas entradas, então não poderá ser usado.</p></li>
</ul>
<p>Quando você tem um código complexo para escrever na programação <strong>R</strong>, às vezes você aninha as operações que resultam em um código <strong>R</strong> ilegível e é difícil para outras pessoas entenderem. Usando o operador <strong>%&gt;%</strong> é possível encadear uma sequência para evitar a gravação de código complexo.</p>
<p>Além disso, usando o operador Pipe <strong>%&gt;%</strong> ajuda a economizar memória. Por causa disso, tem sido usado em muitos pacotes do <strong>R</strong>. Por exemplo, imagine que você tenha chamado 3 funções e o resultado de cada função é passado como entrada para a função subsequente. Quando você não usa o Pipe, você tem que armazenar o resultado de cada função em uma variável e usar esta variável em outra função. Desta forma você armazena 3 variáveis na memória com os dados. Ao usar o operador Pipe, você pode evitar variáveis intermediárias e encadear as funções.</p>
</div>
<div id="selecionando-colunas" class="section level2 hasAnchor" number="4.2">
<h2 class="hasAnchor"><span class="header-section-number">4.2</span> Selecionando colunas<a href="#selecionando-colunas" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Vimos que ‘codigos’ contém diversas colunas que não serão utilizadas. Interessam-nos apenas as colunas ‘cod_ibge’, ‘municipios’ e ‘reg_administrativa’. Para criar um novo dataframe com apenas estas duas colunas, vamos usar a função <code>select</code>. Atribuiremos à seleção, o nome de ‘nomes_munic’.</p>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb155-1"><a href="#cb155-1" tabindex="-1"></a><span class="co">#para selecionar apenas as colunas &#39;cod_ibge&#39;, &#39;municipios&#39; e &#39;reg_administrativa&#39;</span></span>
<span id="cb155-2"><a href="#cb155-2" tabindex="-1"></a>nomes_munic <span class="ot">&lt;-</span> codigos <span class="sc">%&gt;%</span> </span>
<span id="cb155-3"><a href="#cb155-3" tabindex="-1"></a>  <span class="fu">select</span>(cod_ibge, municipios, reg_administrativa)</span>
<span id="cb155-4"><a href="#cb155-4" tabindex="-1"></a><span class="co">#para visualizar</span></span>
<span id="cb155-5"><a href="#cb155-5" tabindex="-1"></a><span class="fu">head</span>(nomes_munic)</span></code></pre></div>
<pre><code>##   cod_ibge          municipios          reg_administrativa
## 1  3500000 Estado de São Paulo    Estado sem especificação
## 2  3500105          Adamantina   RA de Presidente Prudente
## 3  3500204              Adolfo RA de São José do Rio Preto
## 4  3500303               Aguaí              RA de Campinas
## 5  3500402      Águas da Prata              RA de Campinas
## 6  3500501    Águas de Lindóia              RA de Campinas</code></pre>
</div>
<div id="combinando-dataframes" class="section level2 hasAnchor" number="4.3">
<h2 class="hasAnchor"><span class="header-section-number">4.3</span> Combinando dataframes<a href="#combinando-dataframes" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>O <strong>Tidyverse</strong> oferece diversas possibilidades de unir dois dataframes. Este resumo em pdf apresenta as principais funções do <strong>Tidyverse</strong> (<a href="https://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf" class="uri">https://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf</a>).
Os conjuntos de dados podem ser combinados a partir das seguintes funções: <code>left_join</code>, <code>right_join</code>, <code>inner_join</code>, <code>full_join</code>, <code>semi_join</code> e <code>anti_join</code>.</p>
<p>Como podemos observar, os dois dataframes (‘evol_casam’ e ‘nomes_munic’) têm uma coluna com o mesmo nome (‘cod_ibge’), cujos códigos apresentam 7 dígitos. Desta forma, esta coluna será usada para unirmos os dois dataframes para termos os nomes dos municípios, que não aparecem em ‘evol_casam’.</p>
<p>Com os dois dataframes, podemos uni-los usando a função <code>right_join</code>. Imagine duas tabelas que serão unidas. A tabela de ‘nomes_munic’ contém 646 linhas. A tabela de ‘evol_casam’ contém 14123 linhas porque são 21 anos de dados. Queremos que a tabela ‘evol_casam’ receba os nomes dos municípios da tabela ‘nomes_munic’. Usando a função <code>right_join</code> os nomes dos municípios da tabela à esquerda (nomes_munic) farão correspondência com todas as linhas da tabela à direita (evol_casam).</p>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1" tabindex="-1"></a><span class="co">#para unir os dois dataframes</span></span>
<span id="cb157-2"><a href="#cb157-2" tabindex="-1"></a>casam <span class="ot">&lt;-</span> <span class="fu">right_join</span>(nomes_munic, evol_casam, <span class="at">by=</span><span class="st">&quot;cod_ibge&quot;</span>)</span>
<span id="cb157-3"><a href="#cb157-3" tabindex="-1"></a><span class="co">#para visualizar as 6 primeiras linhas</span></span>
<span id="cb157-4"><a href="#cb157-4" tabindex="-1"></a><span class="fu">head</span>(casam)</span></code></pre></div>
<pre><code>##   cod_ibge municipios        reg_administrativa  ano
## 1  3500105 Adamantina RA de Presidente Prudente 2000
## 2  3500105 Adamantina RA de Presidente Prudente 2001
## 3  3500105 Adamantina RA de Presidente Prudente 2002
## 4  3500105 Adamantina RA de Presidente Prudente 2003
## 5  3500105 Adamantina RA de Presidente Prudente 2004
## 6  3500105 Adamantina RA de Presidente Prudente 2005
##   entre.pessoas.de.sexos.diferentes entre.pessoas.do.mesmo.sexo
## 1                               139                          NA
## 2                               136                          NA
## 3                               112                          NA
## 4                               141                          NA
## 5                               119                          NA
## 6                               125                          NA
##   ignorado total
## 1       NA   139
## 2       NA   136
## 3       NA   112
## 4       NA   141
## 5       NA   119
## 6       NA   125</code></pre>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb159-1"><a href="#cb159-1" tabindex="-1"></a><span class="co">#para visualizar as 6 últimas linhas</span></span>
<span id="cb159-2"><a href="#cb159-2" tabindex="-1"></a><span class="fu">tail</span>(casam)</span></code></pre></div>
<pre><code>##       cod_ibge   municipios reg_administrativa  ano
## 14763  3557303 Estiva Gerbi     RA de Campinas 2017
## 14764  3557303 Estiva Gerbi     RA de Campinas 2018
## 14765  3557303 Estiva Gerbi     RA de Campinas 2019
## 14766  3557303 Estiva Gerbi     RA de Campinas 2020
## 14767  3557303 Estiva Gerbi     RA de Campinas 2021
## 14768  3557303 Estiva Gerbi     RA de Campinas 2022
##       entre.pessoas.de.sexos.diferentes entre.pessoas.do.mesmo.sexo
## 14763                                86                          NA
## 14764                                65                           1
## 14765                                86                          NA
## 14766                                56                           1
## 14767                                74                           1
## 14768                                69                          NA
##       ignorado total
## 14763       NA    86
## 14764       NA    66
## 14765       NA    86
## 14766       NA    57
## 14767       NA    75
## 14768       NA    69</code></pre>
<p>Outra forma de entender melhor os dados é olhando a sua estrutura. Use <strong>str()</strong></p>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb161-1"><a href="#cb161-1" tabindex="-1"></a><span class="co">#para ver a estrutura dos dados</span></span>
<span id="cb161-2"><a href="#cb161-2" tabindex="-1"></a><span class="fu">str</span>(casam)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    14768 obs. of  8 variables:
##  $ cod_ibge                         : int  3500105 3500105 3500105 3500105 3500105 3500105 3500105 3500105 3500105 3500105 ...
##  $ municipios                       : chr  &quot;Adamantina&quot; &quot;Adamantina&quot; &quot;Adamantina&quot; &quot;Adamantina&quot; ...
##  $ reg_administrativa               : chr  &quot;RA de Presidente Prudente&quot; &quot;RA de Presidente Prudente&quot; &quot;RA de Presidente Prudente&quot; &quot;RA de Presidente Prudente&quot; ...
##  $ ano                              : int  2000 2001 2002 2003 2004 2005 2006 2007 2008 2009 ...
##  $ entre.pessoas.de.sexos.diferentes: int  139 136 112 141 119 125 196 185 173 148 ...
##  $ entre.pessoas.do.mesmo.sexo      : int  NA NA NA NA NA NA NA NA NA NA ...
##  $ ignorado                         : int  NA NA NA NA NA NA NA NA NA NA ...
##  $ total                            : int  139 136 112 141 119 125 196 185 173 148 ...</code></pre>
</div>
<div id="filtrando-observações" class="section level2 hasAnchor" number="4.4">
<h2 class="hasAnchor"><span class="header-section-number">4.4</span> Filtrando observações<a href="#filtrando-observações" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>A função <strong>filter()</strong> filtra as observações (linhas) de acordo com uma condição.</p>
<p>A partir do dataframe ‘casam’, vamos filtrar os dados para mantermos apenas dados do ano de 2021, criando o objeto ‘casam_2021’.</p>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb163-1"><a href="#cb163-1" tabindex="-1"></a><span class="co">#para filtrar para o ano 2021</span></span>
<span id="cb163-2"><a href="#cb163-2" tabindex="-1"></a>casam_2021 <span class="ot">&lt;-</span> casam <span class="sc">%&gt;%</span></span>
<span id="cb163-3"><a href="#cb163-3" tabindex="-1"></a>  <span class="fu">filter</span>(ano <span class="sc">==</span> <span class="dv">2021</span>)</span></code></pre></div>
<p>Outras condições podem ser também filtradas. Vamos filtrar para o município “São Paulo”.</p>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb164-1"><a href="#cb164-1" tabindex="-1"></a>casam <span class="sc">%&gt;%</span></span>
<span id="cb164-2"><a href="#cb164-2" tabindex="-1"></a>  <span class="fu">filter</span>(municipios <span class="sc">==</span> <span class="st">&quot;São Paulo&quot;</span>)</span></code></pre></div>
<pre><code>##    cod_ibge municipios reg_administrativa  ano
## 1   3550308  São Paulo   RM  de São Paulo 2000
## 2   3550308  São Paulo   RM  de São Paulo 2001
## 3   3550308  São Paulo   RM  de São Paulo 2002
## 4   3550308  São Paulo   RM  de São Paulo 2003
## 5   3550308  São Paulo   RM  de São Paulo 2004
## 6   3550308  São Paulo   RM  de São Paulo 2005
## 7   3550308  São Paulo   RM  de São Paulo 2006
## 8   3550308  São Paulo   RM  de São Paulo 2007
## 9   3550308  São Paulo   RM  de São Paulo 2008
## 10  3550308  São Paulo   RM  de São Paulo 2009
## 11  3550308  São Paulo   RM  de São Paulo 2010
## 12  3550308  São Paulo   RM  de São Paulo 2011
## 13  3550308  São Paulo   RM  de São Paulo 2012
## 14  3550308  São Paulo   RM  de São Paulo 2013
## 15  3550308  São Paulo   RM  de São Paulo 2014
## 16  3550308  São Paulo   RM  de São Paulo 2015
## 17  3550308  São Paulo   RM  de São Paulo 2016
## 18  3550308  São Paulo   RM  de São Paulo 2017
## 19  3550308  São Paulo   RM  de São Paulo 2018
## 20  3550308  São Paulo   RM  de São Paulo 2019
## 21  3550308  São Paulo   RM  de São Paulo 2020
## 22  3550308  São Paulo   RM  de São Paulo 2021
## 23  3550308  São Paulo   RM  de São Paulo 2022
##    entre.pessoas.de.sexos.diferentes entre.pessoas.do.mesmo.sexo
## 1                              47937                          NA
## 2                              50019                          NA
## 3                              50035                          NA
## 4                              51117                          NA
## 5                              55887                          NA
## 6                              57688                          NA
## 7                              60248                          NA
## 8                              62883                          NA
## 9                              65732                          NA
## 10                             62700                          NA
## 11                             62990                          NA
## 12                             65764                          NA
## 13                             66305                          NA
## 14                             67226                         820
## 15                             70960                         791
## 16                             73716                         770
## 17                             70500                         798
## 18                             70385                         926
## 19                             65732                        1767
## 20                             63658                        1385
## 21                             45375                         969
## 22                             52072                        1109
## 23                             56213                        1638
##    ignorado total
## 1        NA 47937
## 2        NA 50019
## 3        NA 50035
## 4        NA 51117
## 5        NA 55887
## 6        NA 57688
## 7        NA 60248
## 8        NA 62883
## 9        NA 65732
## 10       NA 62700
## 11       NA 62990
## 12       NA 65764
## 13       NA 66305
## 14      248 68294
## 15       NA 71751
## 16       NA 74486
## 17       NA 71298
## 18       NA 71311
## 19       NA 67499
## 20       NA 65043
## 21       NA 46344
## 22       NA 53181
## 23        1 57852</code></pre>
<p>As duas condições podem ser filtradas em um mesmo código.</p>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb166-1"><a href="#cb166-1" tabindex="-1"></a>casam <span class="sc">%&gt;%</span></span>
<span id="cb166-2"><a href="#cb166-2" tabindex="-1"></a>  <span class="fu">filter</span>(ano <span class="sc">==</span> <span class="dv">2021</span>, municipios <span class="sc">==</span> <span class="st">&quot;São Paulo&quot;</span>)</span></code></pre></div>
<pre><code>##   cod_ibge municipios reg_administrativa  ano
## 1  3550308  São Paulo   RM  de São Paulo 2021
##   entre.pessoas.de.sexos.diferentes entre.pessoas.do.mesmo.sexo
## 1                             52072                        1109
##   ignorado total
## 1       NA 53181</code></pre>
<p>Também é possível filtrar a partir de operadores lógicos. Vamos filtrar os municípios com casamentos entre pessoas de sexos diferentes maior do que 5000 em 2021.</p>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb168-1"><a href="#cb168-1" tabindex="-1"></a><span class="co">#para filtrar para o ano de 2021 e municípios com casamentos entre pessoas de sexos diferentes maiores do que 5 mil</span></span>
<span id="cb168-2"><a href="#cb168-2" tabindex="-1"></a>casam <span class="sc">%&gt;%</span> </span>
<span id="cb168-3"><a href="#cb168-3" tabindex="-1"></a>  <span class="fu">filter</span>(ano <span class="sc">==</span> <span class="dv">2021</span>, entre.pessoas.de.sexos.diferentes <span class="sc">&gt;</span> <span class="dv">5000</span>)</span></code></pre></div>
<pre><code>##   cod_ibge municipios reg_administrativa  ano
## 1  3509502   Campinas     RA de Campinas 2021
## 2  3518800  Guarulhos   RM  de São Paulo 2021
## 3  3550308  São Paulo   RM  de São Paulo 2021
##   entre.pessoas.de.sexos.diferentes entre.pessoas.do.mesmo.sexo
## 1                              6017                         107
## 2                              7021                          79
## 3                             52072                        1109
##   ignorado total
## 1       NA  6124
## 2       NA  7100
## 3       NA 53181</code></pre>
</div>
<div id="organizando-uma-tabela-com-a-função-arrange" class="section level2 hasAnchor" number="4.5">
<h2 class="hasAnchor"><span class="header-section-number">4.5</span> Organizando uma tabela com a função <code>arrange()</code><a href="#organizando-uma-tabela-com-a-função-arrange" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>A função <strong>arrange()</strong> organiza uma tabela com base em uma variável (coluna). A condição <em>default</em> é a ordem crescente. Para indicar ordem decrescente, é necessário indicar <em>desc</em>. Vamos a um exemplo. Vamos solicitar a organização da tabela pela coluna entre.pessoas.de.mesmo.sexo.</p>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb170-1"><a href="#cb170-1" tabindex="-1"></a><span class="co">#para filtrar as linhas que correspondem ao ano 2021</span></span>
<span id="cb170-2"><a href="#cb170-2" tabindex="-1"></a>msexo_2021 <span class="ot">&lt;-</span> casam <span class="sc">%&gt;%</span></span>
<span id="cb170-3"><a href="#cb170-3" tabindex="-1"></a>  <span class="fu">filter</span>(ano <span class="sc">==</span> <span class="dv">2021</span>) <span class="sc">%&gt;%</span></span>
<span id="cb170-4"><a href="#cb170-4" tabindex="-1"></a><span class="co">#para organizar em ordem crescente</span></span>
<span id="cb170-5"><a href="#cb170-5" tabindex="-1"></a>  <span class="fu">arrange</span>(entre.pessoas.do.mesmo.sexo)</span>
<span id="cb170-6"><a href="#cb170-6" tabindex="-1"></a><span class="co">#para visualizar</span></span>
<span id="cb170-7"><a href="#cb170-7" tabindex="-1"></a><span class="fu">head</span>(msexo_2021)</span></code></pre></div>
<pre><code>##   cod_ibge             municipios          reg_administrativa  ano
## 1  3500105             Adamantina   RA de Presidente Prudente 2021
## 2  3500204                 Adolfo RA de São José do Rio Preto 2021
## 3  3500550 Águas de Santa Bárbara              RA de Sorocaba 2021
## 4  3500600     Águas de São Pedro              RA de Campinas 2021
## 5  3500808      Alfredo Marcondes   RA de Presidente Prudente 2021
## 6  3501707    Américo Brasiliense                  RA Central 2021
##   entre.pessoas.de.sexos.diferentes entre.pessoas.do.mesmo.sexo
## 1                               122                           1
## 2                                27                           1
## 3                                34                           1
## 4                                16                           1
## 5                                21                           1
## 6                               168                           1
##   ignorado total
## 1       NA   123
## 2       NA    28
## 3       NA    35
## 4       NA    17
## 5       NA    22
## 6       NA   169</code></pre>
<p>Para organizar em ordem decrescente:</p>
<div class="sourceCode" id="cb172"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb172-1"><a href="#cb172-1" tabindex="-1"></a><span class="co">#para filtrar as linhas que correspondem ao ano 2021</span></span>
<span id="cb172-2"><a href="#cb172-2" tabindex="-1"></a>casam_msexo_desc <span class="ot">&lt;-</span> casam <span class="sc">%&gt;%</span></span>
<span id="cb172-3"><a href="#cb172-3" tabindex="-1"></a>  <span class="fu">filter</span>(ano <span class="sc">==</span> <span class="dv">2021</span>) <span class="sc">%&gt;%</span></span>
<span id="cb172-4"><a href="#cb172-4" tabindex="-1"></a><span class="co">#para organizar em ordem decrescente</span></span>
<span id="cb172-5"><a href="#cb172-5" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(entre.pessoas.do.mesmo.sexo))</span>
<span id="cb172-6"><a href="#cb172-6" tabindex="-1"></a><span class="co">#para visualizar</span></span>
<span id="cb172-7"><a href="#cb172-7" tabindex="-1"></a><span class="fu">head</span>(casam_msexo_desc)</span></code></pre></div>
<pre><code>##   cod_ibge     municipios   reg_administrativa  ano
## 1  3550308      São Paulo     RM  de São Paulo 2021
## 2  3509502       Campinas       RA de Campinas 2021
## 3  3518800      Guarulhos     RM  de São Paulo 2021
## 4  3543402 Ribeirão Preto RA de Ribeirão Preto 2021
## 5  3552205       Sorocaba       RA de Sorocaba 2021
## 6  3534401         Osasco     RM  de São Paulo 2021
##   entre.pessoas.de.sexos.diferentes entre.pessoas.do.mesmo.sexo
## 1                             52072                        1109
## 2                              6017                         107
## 3                              7021                          79
## 4                              3636                          79
## 5                              4283                          76
## 6                              4224                          71
##   ignorado total
## 1       NA 53181
## 2       NA  6124
## 3       NA  7100
## 4       NA  3715
## 5       NA  4359
## 6       NA  4295</code></pre>
</div>
<div id="o-verbo-mutate" class="section level2 hasAnchor" number="4.6">
<h2 class="hasAnchor"><span class="header-section-number">4.6</span> O verbo “mutate”<a href="#o-verbo-mutate" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Digamos que quiséssemos ter uma coluna com a porcentagem de casamentos entre pessoas de sexos diferentes. Para isso seria necessário dividir a coluna <strong>entre.pessoas.de.sexos.diferentes</strong> pela coluna <strong>total</strong> e multiplicar por 100. A função <strong>mutate()</strong> permite mudar por meio de cálculos ou adicionar variáveis (colunas).</p>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb174-1"><a href="#cb174-1" tabindex="-1"></a><span class="co">#para acrescentar uma coluna com os resultados da porcentagem de casamentos entre pessoas de sexos diferentes</span></span>
<span id="cb174-2"><a href="#cb174-2" tabindex="-1"></a>casam1 <span class="ot">&lt;-</span> casam <span class="sc">%&gt;%</span></span>
<span id="cb174-3"><a href="#cb174-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">perc_sexodif =</span> entre.pessoas.de.sexos.diferentes <span class="sc">/</span> total <span class="sc">*</span> <span class="dv">100</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb174-4"><a href="#cb174-4" tabindex="-1"></a><span class="co">#para organizar a coluna em ordem decrescente</span></span>
<span id="cb174-5"><a href="#cb174-5" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(perc_sexodif))</span>
<span id="cb174-6"><a href="#cb174-6" tabindex="-1"></a><span class="co">#para visualizar as 6 primeiras linhas</span></span>
<span id="cb174-7"><a href="#cb174-7" tabindex="-1"></a><span class="fu">head</span>(casam1)</span></code></pre></div>
<pre><code>##   cod_ibge municipios        reg_administrativa  ano
## 1  3500105 Adamantina RA de Presidente Prudente 2000
## 2  3500105 Adamantina RA de Presidente Prudente 2001
## 3  3500105 Adamantina RA de Presidente Prudente 2002
## 4  3500105 Adamantina RA de Presidente Prudente 2003
## 5  3500105 Adamantina RA de Presidente Prudente 2004
## 6  3500105 Adamantina RA de Presidente Prudente 2005
##   entre.pessoas.de.sexos.diferentes entre.pessoas.do.mesmo.sexo
## 1                               139                          NA
## 2                               136                          NA
## 3                               112                          NA
## 4                               141                          NA
## 5                               119                          NA
## 6                               125                          NA
##   ignorado total perc_sexodif
## 1       NA   139          100
## 2       NA   136          100
## 3       NA   112          100
## 4       NA   141          100
## 5       NA   119          100
## 6       NA   125          100</code></pre>
<p>Observe que municípios com pequeno número total de casamentos, quando 1 deles é entre pessoas do mesmo sexo, o percentual fica elevado.</p>
</div>
<div id="agrupando-dados-com-a-função-group_by" class="section level2 hasAnchor" number="4.7">
<h2 class="hasAnchor"><span class="header-section-number">4.7</span> Agrupando dados com a função <code>group_by</code><a href="#agrupando-dados-com-a-função-group_by" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>A função <strong>group_by</strong> permite aplicar cálculos de resumo segundo grupos, por exemplo, por ano, por Região Administrativa, etc. Para usar essa função é necessário definir o tipo de agregação que queremos. Em outras palavras, se vamos agrupar os casamentos por Região Administrativa, os resultados serão as somas dos casamentos das regiões? Ou seriam as médias? Dependendo da variável, não faz sentido efetuarmos a soma como no caso de variáveis resultantes de divisões (índices, porcentagens, razões, etc.) deve-se calcular a média, por meio da função <code>summarize</code> (mean). No nosso exemplo, vamos agrupar as regiões administrativas por meio de soma para as variáveis entre.pessoas.de.sexos.diferentes, entre.pessoas.do.mesmo.sexo e total.</p>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb176-1"><a href="#cb176-1" tabindex="-1"></a><span class="co">#para agrupar por região administrativa</span></span>
<span id="cb176-2"><a href="#cb176-2" tabindex="-1"></a>casam <span class="sc">%&gt;%</span> </span>
<span id="cb176-3"><a href="#cb176-3" tabindex="-1"></a>  <span class="fu">group_by</span>(reg_administrativa) <span class="sc">%&gt;%</span></span>
<span id="cb176-4"><a href="#cb176-4" tabindex="-1"></a><span class="co">#para definir a soma como operação de agrupamento. &#39;na.omit&#39; é usado para que a soma desconsidere os valores NA da coluna entre.pessoas.do.mesmo.sexo</span></span>
<span id="cb176-5"><a href="#cb176-5" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">tot_sexodif =</span> <span class="fu">sum</span>(entre.pessoas.de.sexos.diferentes),</span>
<span id="cb176-6"><a href="#cb176-6" tabindex="-1"></a>            <span class="at">tot_msexo =</span> <span class="fu">sum</span>(<span class="fu">na.omit</span>(entre.pessoas.do.mesmo.sexo)),</span>
<span id="cb176-7"><a href="#cb176-7" tabindex="-1"></a>            <span class="at">tot_todos =</span> <span class="fu">sum</span>(total))</span></code></pre></div>
<pre><code>## # A tibble: 16 × 4
##    reg_administrativa          tot_sexodif tot_msexo tot_todos
##    &lt;chr&gt;                             &lt;int&gt;     &lt;int&gt;     &lt;int&gt;
##  1 RA Central                       132776       619    133420
##  2 RA de Araçatuba                  100275       307    100602
##  3 RA de Barretos                    57897       211     58119
##  4 RA de Bauru                      148751       552    149316
##  5 RA de Campinas                   893340      3840    897859
##  6 RA de Franca                      92649       301     92974
##  7 RA de Itapeva                     72322       131     72475
##  8 RA de Marília                    129304       373    129700
##  9 RA de Presidente Prudente        116224       327    116563
## 10 RA de Registro                    36611        67     36692
## 11 RA de Ribeirão Preto             162735       813    163579
## 12 RA de Santos                     211221      1482    212739
## 13 RA de Sorocaba                   346753      1590    348424
## 14 RA de São José do Rio Preto      194609       871    195513
## 15 RA de São José dos Campos        334861      1499    336420
## 16 RM  de São Paulo                2616946     16027   2633463</code></pre>
<p>Observe que passamos a ter 16 linhas, correspondendo às 16 Regiões Administrativas do Estado.
Vamos resumir por ano e região administrativa.</p>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb178-1"><a href="#cb178-1" tabindex="-1"></a><span class="co">#para agrupar por região administrativa</span></span>
<span id="cb178-2"><a href="#cb178-2" tabindex="-1"></a>casam_regadm <span class="ot">&lt;-</span> casam <span class="sc">%&gt;%</span> </span>
<span id="cb178-3"><a href="#cb178-3" tabindex="-1"></a>  <span class="fu">group_by</span>(ano, reg_administrativa) <span class="sc">%&gt;%</span></span>
<span id="cb178-4"><a href="#cb178-4" tabindex="-1"></a><span class="co">#para definir a soma como operação de agrupamento. &#39;na.omit&#39; é usado para que a soma desconsidere os valores NA da coluna entre.pessoas.do.mesmo.sexo</span></span>
<span id="cb178-5"><a href="#cb178-5" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">tot_sexodif =</span> <span class="fu">sum</span>(entre.pessoas.de.sexos.diferentes),</span>
<span id="cb178-6"><a href="#cb178-6" tabindex="-1"></a>            <span class="at">tot_msexo =</span> <span class="fu">sum</span>(<span class="fu">na.omit</span>(entre.pessoas.do.mesmo.sexo)),</span>
<span id="cb178-7"><a href="#cb178-7" tabindex="-1"></a>            <span class="at">tot_todos =</span> <span class="fu">sum</span>(total))</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;ano&#39;. You can override using the
## `.groups` argument.</code></pre>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb180-1"><a href="#cb180-1" tabindex="-1"></a><span class="co">#para visualizar</span></span>
<span id="cb180-2"><a href="#cb180-2" tabindex="-1"></a><span class="fu">head</span>(casam_regadm)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 5
## # Groups:   ano [1]
##     ano reg_administrativa tot_sexodif tot_msexo tot_todos
##   &lt;int&gt; &lt;chr&gt;                    &lt;int&gt;     &lt;int&gt;     &lt;int&gt;
## 1  2000 RA Central                4164         0      4164
## 2  2000 RA de Araçatuba           3438         0      3438
## 3  2000 RA de Barretos            1662         0      1662
## 4  2000 RA de Bauru               5116         0      5116
## 5  2000 RA de Campinas           28634         0     28634
## 6  2000 RA de Franca              3291         0      3291</code></pre>
<p>Agora temos 352 linhas, resultantes de 16 regiões administrativas vezes 22 anos.</p>
</div>
<div id="rumo-aos-mapas" class="section level2 hasAnchor" number="4.8">
<h2 class="hasAnchor"><span class="header-section-number">4.8</span> Rumo aos mapas<a href="#rumo-aos-mapas" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Agora que você teve uma introdução rápida ao <strong>R</strong> e aprendeu a fazer cálculos entre colunas, unir dataframes e agrupar dados, tem a bagagem mínima para entrar em contato com a teoria da Cartografia Temática e a elaborar seus mapas em <strong>R</strong>.
Novas funções serão apresentadas à medida que forem necessárias.</p>
<!--chapter:end:04-dataframes.Rmd-->
</div>
</div>
<div id="tipos" class="section level1 hasAnchor" number="5">
<h1 class="hasAnchor"><span class="header-section-number">5</span> Tipos de dados, conceitos e representação cartográfica<a href="#tipos" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>A <strong>Cartografia Temática</strong> é um campo da <strong>Cartografia</strong> com um referencial teórico consolidado para a orientação das representações gráficas, em especial, para os mapas da Geografia. A literatura na área é densa e vasta. Não tenho como objetivo o aprofundamento teórico de cada tipo de representação cartográfica, pois além de repetitivo faria este livro ser muito extenso, desfocando da aplicação do <strong>R</strong> na elaboração de mapas temáticos. Desta forma, apresentarei a ideia principal em torno de cada tipo de representação e a bibliografia sugerida para aprofundamento.</p>
<div id="definição-do-tipo-de-representação-cartográfica" class="section level2 hasAnchor" number="5.1">
<h2 class="hasAnchor"><span class="header-section-number">5.1</span> Definição do tipo de representação cartográfica<a href="#definição-do-tipo-de-representação-cartográfica" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Como escolher o tipo de representação cartográfica mais adequado? A resposta a esta pergunta, diferente do que muitos pensam, é direcionada pelo tipo de dados que queremos mapear.</p>
<p>Cada tipo de dado conduz a um conceito a ser transcrito. Segundo J. Bertin em seu livro <strong>Semiologie graphique</strong>, de 1973, existem três conceitos associados aos tipos de dados: <strong>diversidade</strong>, <strong>ordem</strong> e <strong>proporcionalidade</strong>. Assim, o primeiro passo é identificar a qual grupo os dados a serem mapeados pertencem: aos dados <strong>qualitativos</strong> ou aos dados <strong>quantitativos</strong>. Se os dados forem qualitativos, deve-se identificar se referem-se a categorias (dados nominais) ou se sugerem ordem (dados ordinais).</p>
<p>No caso dos dados quantitativos, estes devem ser identificados como absolutos (resultantes de contagens) ou relativos (resultantes de divisões por área, por população, etc.). A Figura @ref(fig:tipos-dados) apresenta o fluxograma para a identificação do conceito e da variável visual a ser utilizada.</p>
<div class="figure" style="text-align: center">
<img src="tipos_dados.jpg" alt="Fluxograma para identificação do conceito e variável visual a ser definida segundo a Semiologia Gráfica de J. Bertin (1973)" width="640" />
<p class="caption">
(#fig:tipos-dados)Fluxograma para identificação do conceito e variável visual a ser definida segundo a Semiologia Gráfica de J. Bertin (1973)
</p>
</div>
<div style="page-break-after: always;"></div>
<p>Tomando como partida o conceito a ser transcrito graficamente, Martinelli (2003a) agrupou os métodos para elaboração dos mapas temáticos, em métodos para:</p>
<ul>
<li><p>representações qualitativas,</p></li>
<li><p>representações ordenadas,</p></li>
<li><p>representações quantitativas,</p></li>
<li><p>representações dinâmicas.</p></li>
</ul>
<p>Martinelli (2003a) ainda diferenciou o tipo de raciocínio a ser considerado, se analítico ou sintético. Para entender melhor o racional envolvido nestes dois tipos de mapas, sugiro a leitura do artigo de Queiroz Filho e Martinelli (2007).</p>
</div>
<div id="variáveis-visuais" class="section level2 hasAnchor" number="5.2">
<h2 class="hasAnchor"><span class="header-section-number">5.2</span> Variáveis visuais<a href="#variáveis-visuais" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Bertin (1973) propôs que seis variáveis visuais seriam suficientes para transcrever os três conceitos de diversidade, ordem e proporcionalidade.</p>
<p>A Figura @ref(fig:var-visuais) apresenta as seis variáveis visuais sugeridas por Bertin (1973, 1977).</p>
<div class="figure" style="text-align: center">
<img src="variaveis_visuais.jpg" alt="As variáveis visuais segundo Bertin (1973, 1977) e Martinelli (1999)" width="640" />
<p class="caption">
(#fig:var-visuais)As variáveis visuais segundo Bertin (1973, 1977) e Martinelli (1999)
</p>
</div>
</div>
<div id="o-conceito-diversidade" class="section level2 hasAnchor" number="5.3">
<h2 class="hasAnchor"><span class="header-section-number">5.3</span> O conceito <em>diversidade</em><a href="#o-conceito-diversidade" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>O conceito <strong>diversidade</strong> é sugerido apenas por dados qualitativos nominais (Fig. @ref(fig:tipos-dados)). A ideia é transcrever por meio das variáveis visuais que os elementos são diferentes, sem ordem entre eles. Bertin (1973) sugeriu que as variáveis mais eficientes para tal transcrição seriam a <strong>cor</strong>, a <strong>forma</strong> e a <strong>orientação</strong>. Deve-se contextualizar esta escolha, uma vez que a produção de mapas na década de 1970 era feita na forma impressa, para a qual havia um custo enorme ao se utilizar cores no processo gráfico de impressão. No momento presente, a variável mais eficiente é a cor, pois “tem indiscutível impacto e atua sobre a emotividade humana” (Martinelli, 2003a). O uso da cor em computadores e em publicações digitais é muito viável.</p>
<p>Por ser a variável visual de maior impacto, conhecer alguns aspectos da cor nos capacita a empregá-la de forma adequada.</p>
<p>O que chamamos de cor corresponde a uma faixa bem estreita do espectro eletromagnético. A energia eletromagnética pode ser definida como uma forma de energia que se move na velocidade da luz, na forma de ondas ou de partículas, e que não precisa de um meio material para se propagar. Nossos olhos são sensíveis a apenas determinados comprimentos de radiação eletromagnética. Assim, a cor pode ser considerada como uma resposta sensorial à radiação eletromagnética. O olho humano capta o intervalo entre 380 e 760 nm (nanômetro = bilionésima parte do metro, 10<sup>–9</sup> m). Um objeto pode absorver todos os comprimentos de onda e, portanto, será entendido como preto aos nossos olhos. Ao contrário, pode ser capaz de refletir todos os comprimentos de onda da luz branca e será percebido como branco. A cor de um objeto é na verdade os comprimentos de onda da luz refletida, enquanto todos os outros comprimentos de onda são absorvidos. As cores seguem a ordem definida pelos comprimentos de onda (Fig. @ref(fig:espectro1)).</p>
<div class="figure" style="text-align: center">
<img src="espectro1.jpg" alt="A faixa visível do espectro eletromagnético" width="960" />
<p class="caption">
(#fig:espectro1)A faixa visível do espectro eletromagnético
</p>
</div>
<p>Considerando a faixa da Figura (@ref(fig:espectro1)), se unirmos suas extremidades (violeta e vermelho) teremos o círculo das cores (Fig. @ref(fig:circulocores2)).</p>
<div class="figure" style="text-align: center">
<img src="circulocores2.jpg" alt="Círculo das cores: a) as setas indicam as cores opostas, b) a seta indica as cores em ordem" width="2400" />
<p class="caption">
(#fig:circulocores2)Círculo das cores: a) as setas indicam as cores opostas, b) a seta indica as cores em ordem
</p>
</div>
<p>Desta forma, o conceito de diversidade por meio da variável cor será transcrito se usarmos cores que se encontram distantes no círculo das cores (Fig. @ref(fig:circulocores2)a).</p>
<p>As variáveis visuais podem ser usadas para transcrever fenômenos cujas feições são pontuais, lineares, em área ou tridimensionais. As implantações da cor e seus aspectos (matiz, brilho e saturação) são apresentados na Figura @ref(fig:implantacao3).</p>
<div class="figure" style="text-align: center">
<img src="implantacao3.jpg" alt="Matiz, brilho e saturação e suas implantações segundo tipo de feição, modificado de Slocum et al. (2005)" width="508" />
<p class="caption">
(#fig:implantacao3)Matiz, brilho e saturação e suas implantações segundo tipo de feição, modificado de Slocum et al. (2005)
</p>
</div>
<p>Mais sobre cores e paletas de cores em <strong>R</strong> será visto no item @ref(escalacores).</p>
</div>
<div id="o-conceito-ordem" class="section level2 hasAnchor" number="5.4">
<h2 class="hasAnchor"><span class="header-section-number">5.4</span> O conceito <em>ordem</em><a href="#o-conceito-ordem" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>O conceito <strong>ordem</strong> pode ser sugerido tanto por dados qualitativos quanto por dados quantitativos (Fig. @ref(fig:tipos-dados)). As variáveis visuais <strong>valor</strong>, <strong>cor ordenada</strong> e <strong>granulação</strong> transcrevem este conceito. Enquanto a <strong>cor ordenada</strong> corresponde ao matiz e segue o espectro visível (@ref(fig:espectro1)), a variável <strong>valor</strong> corresponde ao brilho, ou seja, uma única matiz que varia do mais claro ao mais escuro (monocromático). Na impossibilidade da utilização de cor ou valor, a variável <strong>granulação</strong> pode ser utilizada.</p>
</div>
<div id="o-conceito-de-proporcionalidade" class="section level2 hasAnchor" number="5.5">
<h2 class="hasAnchor"><span class="header-section-number">5.5</span> O conceito de <em>proporcionalidade</em><a href="#o-conceito-de-proporcionalidade" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>A comparação entre quantidades só pode ser efetuada de forma inequívoca pela utilização da variável visual <strong>tamanho</strong>. Embora não seja incomum encontrarmos a variável valor para representar o conceito de proporcionalidade, a transcrição com esta variável não é a ideal. A diferença de tonalidade entre uma classe e outra é incapaz de seguir uma escala proporcional em relação às quantidades. No entanto, este efeito é facilmente obtido por meio do <strong>tamanho</strong>.</p>
</div>
<div id="referências-sugeridas" class="section level2 hasAnchor" number="5.6">
<h2 class="hasAnchor"><span class="header-section-number">5.6</span> Referências sugeridas<a href="#referências-sugeridas" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>BÉGUIN, M.; PUMAIN, D. <strong>La représentation des données géographique</strong>: statistique et cartographie. Paris: Armand Colin, 2007. 192 ISBN 978-2-2002-6581-6.</p>
<p>BERTIN, J. <strong>Sémiologie graphique</strong>: les diagrammes, les réseaux, les cartes. Paris: Mouton, Gauthier-Villars, 1973.</p>
<p>BERTIN, J. <strong>La graphique et le traitement graphique de l’information</strong>. Paris: Flammarion, 1977.</p>
<p>BERTIN, J. <strong>A neográfica e o tratamento gráfico da informação</strong>. Curitiba: 1986. 273.</p>
<p>BONIN, S. <strong>Initiation a la Graphique</strong>. 1983. 1975.</p>
<p>CAUVIN, C.; ESCOBAR, F.; SERRADJ, A. <strong>Cartographie thématique 1</strong>: une nouvelle démarche. Paris: Lavoisier, 2007a. 284 ISBN 978-2-7462-1535-1.</p>
<p>______. <strong>Cartographie thématique 2</strong>: des transformations incontournables. Paris: Lavoisier, 2007b. 272 ISBN 978-2-7462-1535-1.</p>
<p>______. <strong>Cartographie thématique 3</strong>: méthodes quantitatives et transformations attributaires. Paris: Lavoisier, 2008a. 276 ISBN 978-2-7462-1535-1.</p>
<p>______. <strong>Cartographie thématique 4</strong>: des transformations renouvelées. Paris: Lavoisier, 2008b. 196 ISBN 978-2-7462-1535-1.</p>
<p>CAUVIN, C.; REYMOND, H.; SERRADJ, A. <strong>Discrétisation et représentation cartographique</strong>. Maison de la Geographie, Montpellier, 1987. 116 ISBN 2-86912-010-3.</p>
<p>LIBAULT, A. <strong>Geocartografia</strong>. São Paulo: 1975.</p>
<p>MARTINELLI, M. <strong>Gráficos e mapas</strong>: construa-os você mesmo. São Paulo: 1998.</p>
<p>______. <strong>Mapas da geografia e cartografia temática</strong>. São Paulo: 2003a.</p>
<p>______. <strong>Cartografia temática</strong>: caderno de mapas. São Paulo: 2003b.</p>
<p>MONMONIER, M. How to lie with maps. Chicago: The University of Chicago Press, 1996. 207 ISBN 0-226-53421-9.</p>
<p>POIDEVIN, D. <strong>La carte</strong>: moyen d’action. Paris: Ellipses, 1999. 200.</p>
<p>QUEIROZ FILHO, A. P.; MARTINELLI, M. . Cartografia de análise e de síntese na Geografia. <strong>Boletim Paulista de Geografia</strong>, v. 87, p. 7-43, 2007.</p>
<p>RAMOS, C. S. Visualização cartográfica e cartografia multimídia: conceitos e tecnologias. Rio Claro: 2005.</p>
<p>SALITCHEV, K. A. <strong>Cartografía</strong>. Ciudad de la Habana: Pueblo y Educatión, 1979. 214.</p>
<p>SLOCUM, T. A., McMASTER, R. B., KESSLER, F. C., HOWARD, H. H. <strong>Thematic Cartography and Geographic Visualization</strong>. New Jersey: 2005.</p>
<!--chapter:end:05-tipos-dados.Rmd-->
</div>
</div>
<div id="quali1" class="section level1 hasAnchor" number="6">
<h1 class="hasAnchor"><span class="header-section-number">6</span> Dados qualitativos: mapa corocromático nominal<a href="#quali1" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="instalando-e-carregando-pacotes-do-r" class="section level2 hasAnchor" number="6.1">
<h2 class="hasAnchor"><span class="header-section-number">6.1</span> Instalando e carregando pacotes do R<a href="#instalando-e-carregando-pacotes-do-r" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Inicie o <strong>RStudio</strong>, no Menu <em>File</em>, escolha <em>New File</em> e <em>R Script</em>.</p>
<p>Embora, na primeira vez de acesso não seja necessário limpar a memória, das outras vezes, ao iniciar o <strong>RStudio</strong>, é recomendável sempre limpá-la e definir o diretório de trabalho. Digite o seguinte comando:</p>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb182-1"><a href="#cb182-1" tabindex="-1"></a><span class="co">#para limpar a memória</span></span>
<span id="cb182-2"><a href="#cb182-2" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">ls</span>(<span class="at">all=</span><span class="cn">TRUE</span>))</span></code></pre></div>
<p>O que estiver depois do sinal # são anotações sobre o caminho percorrido que podem ajudar na memorização e não interferem no código. Você pode escrever o que quiser como anotação.</p>
<p>Para definir o diretório de trabalho, use a função <em>setwd</em> (de <em>set working diretory</em>, ou defina o diretório de trabalho, em português). Entre parênteses o caminho do diretório deve estar entre aspas e com a barra nesta direção /. Para verificar o diretório definido, use <code>getwd()</code>:</p>
<div class="sourceCode" id="cb183"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb183-1"><a href="#cb183-1" tabindex="-1"></a><span class="co">#para definir o diretório de trabalho</span></span>
<span id="cb183-2"><a href="#cb183-2" tabindex="-1"></a><span class="fu">getwd</span>()</span></code></pre></div>
<p>Além do <strong>R</strong> e <strong>RStudio</strong>, usaremos uma série de outros pacotes do <strong>R</strong> que podem ser instalados de uma vez, usando a função <strong>install.packages</strong> (instalar pacotes):</p>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb184-1"><a href="#cb184-1" tabindex="-1"></a><span class="co">#para instalar os pacotes</span></span>
<span id="cb184-2"><a href="#cb184-2" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="fu">c</span>(</span>
<span id="cb184-3"><a href="#cb184-3" tabindex="-1"></a>  <span class="st">&quot;devtools&quot;</span>, <span class="st">&quot;dplyr&quot;</span>, <span class="st">&quot;ggplot2&quot;</span>, <span class="st">&quot;ggtext&quot;</span>, <span class="st">&quot;ggthemes&quot;</span>, <span class="st">&quot;rgdal&quot;</span>,<span class="st">&quot;rnaturalearth&quot;</span>, <span class="st">&quot;rnaturalearthdata&quot;</span>, <span class="st">&quot;sf&quot;</span>, <span class="st">&quot;sp&quot;</span>,<span class="st">&quot;tidyr&quot;</span> </span>
<span id="cb184-4"><a href="#cb184-4" tabindex="-1"></a>))</span></code></pre></div>
<p>Os pacotes <strong>rnaturalearth</strong> e <strong>rnaturalearthdata</strong> facilitam a elaboração de mapas em <strong>R</strong> com dados de feições naturais da Terra que se encontram em <a href="http://www.naturalearthdata.com/" class="uri">http://www.naturalearthdata.com/</a>.</p>
<p>Vamos carregar alguns dos pacotes para a elaboração do mapa corocromático nominal, usando a função <strong>library</strong> para carregar as bibliotecas (pacotes instalados):</p>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb185-1"><a href="#cb185-1" tabindex="-1"></a><span class="co">#para carregar os pacotes</span></span>
<span id="cb185-2"><a href="#cb185-2" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb185-3"><a href="#cb185-3" tabindex="-1"></a><span class="fu">library</span>(devtools)</span>
<span id="cb185-4"><a href="#cb185-4" tabindex="-1"></a><span class="fu">library</span>(rgdal)</span>
<span id="cb185-5"><a href="#cb185-5" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb185-6"><a href="#cb185-6" tabindex="-1"></a><span class="fu">library</span>(sp)</span>
<span id="cb185-7"><a href="#cb185-7" tabindex="-1"></a><span class="fu">library</span>(rnaturalearth)</span>
<span id="cb185-8"><a href="#cb185-8" tabindex="-1"></a><span class="fu">library</span>(rnaturalearthdata)</span></code></pre></div>
</div>
<div id="o-pacote-geobr" class="section level2 hasAnchor" number="6.2">
<h2 class="hasAnchor"><span class="header-section-number">6.2</span> O pacote geobr<a href="#o-pacote-geobr" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>O pacote <strong>geobr</strong> foi desenvolvido por pesquisadores do Instituto de Pesquisa Econômica Aplicada (IPEA), que é uma fundação pública federal vinculada ao Ministério da Economia do Brasil, para importar os dados do IBGE (Pereira &amp; Gonçalves, 2021). Este pacote está depositado no <em>github</em> do IPEA. Para facilitar a instalação de pacotes que não estão no repositório CRAN, pode-se usar o pacote <strong>devtools</strong> com a função <strong>install_github()</strong>. Se você seguiu os passos anteriores, o <strong>devtools</strong> já está instalado e carregado no <strong>RStudio</strong>.</p>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb186-1"><a href="#cb186-1" tabindex="-1"></a><span class="co">#para instalar o pacote ‘geobr’</span></span>
<span id="cb186-2"><a href="#cb186-2" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">&quot;ipeaGIT/geobr&quot;</span>, <span class="at">subdir =</span> <span class="st">&quot;r-package&quot;</span>)</span></code></pre></div>
<p>Você deve estar curioso para saber o que significa <strong>::</strong> . O que vem antes de <strong>::</strong> é o nome do pacote a ser utilizado e o que vem depois, a função a ser usada. É muito útil, pois muitas vezes nos esquecemos de carregar um determinado pacote com a função <strong>library()</strong> e, mesmo assim, o <strong>R</strong> identifica o pacote e executa a função. Além disso, como as funções podem ter o mesmo nome em vários pacotes, o <strong>R</strong> utilizará a função cujo pacote foi carregado por último, não necessariamente a que você deseja. Usando <strong>::</strong> deixa claro o pacote cuja função você quer executar.</p>
<p>Vamos carregar o pacote que acabamos de instalar.</p>
<div class="sourceCode" id="cb187"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb187-1"><a href="#cb187-1" tabindex="-1"></a><span class="co">#para carregar o pacote</span></span>
<span id="cb187-2"><a href="#cb187-2" tabindex="-1"></a><span class="fu">library</span>(geobr)</span></code></pre></div>
<p>O pacote <strong>geobr</strong> contém 27 conjuntos de dados do IBGE para importação. Este pacote evita que você tenha que ir ao site do IBGE para fazer o <em>download</em> individualmente de cada base cartográfica que pretende usar. Uma vez carregado no <strong>RStudio</strong>, você consegue fazer <em>download</em> dos dados segundo diferentes divisões territoriais. Para ter uma ideia do conteúdo do <strong>geobr</strong>, use a função <strong>list_geobr()</strong>, como a seguir:</p>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb188-1"><a href="#cb188-1" tabindex="-1"></a><span class="co">#para listar o conteúdo do ‘geobr’</span></span>
<span id="cb188-2"><a href="#cb188-2" tabindex="-1"></a><span class="fu">list_geobr</span>()</span></code></pre></div>
<p>Como iremos fazer um mapa dos biomas do Brasil, vamos criar um objeto chamado <strong>biomas</strong>. Este conjunto de dados inclui polígonos de todos os biomas presentes no território brasileiro e zona costeira. O conjunto de dados de 2019 está disponível na escala 1:250.000. Para isso, vamos atribuir o nome ‘biomas’ antes dos sinais <strong>&lt;-</strong> e usar a função <strong>read_biomes</strong> do <strong>geobr</strong>, selecionando o ano dos dados de interesse - 2019. O argumento <em>simplified</em> é um argumento lógico (FALSO ou VERDADEIRO/<em>FALSE or TRUE</em>) que indica se a função deve retornar o conjunto de dados com a resolução original ou com os limites simplificados. A predefinição (<em>default</em>) é <strong>TRUE</strong>. Quando se deseja fazer análises espaciais com os dados, a versão com os limites simplificados é indicada. O argumento <em>showProgress</em> indica se deve apresentar a barra de progresso do <em>download</em> (<em>TRUE</em>) ou não (<em>FALSE</em>).</p>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb189-1"><a href="#cb189-1" tabindex="-1"></a><span class="co">#para criar um objeto chamado ‘biomas’ a partir do conjunto de dados do IBGE</span></span>
<span id="cb189-2"><a href="#cb189-2" tabindex="-1"></a>biomas <span class="ot">&lt;-</span> <span class="fu">read_biomes</span>(<span class="at">year =</span> <span class="dv">2019</span>, <span class="at">simplified =</span> <span class="cn">TRUE</span>, <span class="at">showProgress =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## Using year 2019</code></pre>
<p>Confira o tipo de objeto gerado:</p>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb191-1"><a href="#cb191-1" tabindex="-1"></a><span class="co">#para ver o tipo de objeto</span></span>
<span id="cb191-2"><a href="#cb191-2" tabindex="-1"></a><span class="fu">class</span>(biomas)</span></code></pre></div>
<pre><code>## [1] &quot;sf&quot;         &quot;data.frame&quot;</code></pre>
<p>Observe que a palavra ‘biomas’ aparece como um objeto no painel ‘Environment’ do <strong>RStudio</strong>. É um objeto do tipo ‘sf’ (espacial) e ‘data.frame’ porque tem uma tabela de dados alfa-numérica associada.</p>
<div class="sourceCode" id="cb193"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb193-1"><a href="#cb193-1" tabindex="-1"></a><span class="co">#para ver a tabela de dados de ‘biomas’</span></span>
<span id="cb193-2"><a href="#cb193-2" tabindex="-1"></a><span class="fu">View</span>(biomas)</span></code></pre></div>
<p>Pode ser que demore um pouco para abrir. Você verá uma tabela que contém as seguintes colunas: <strong>name_biome</strong>, <strong>code_biome</strong>, <strong>year</strong>, <strong>geom</strong>. A tabela de dados possui uma coluna para os nomes dos biomas, outra para os códigos atribuídos a cada bioma, outra com o ano dos dados e a última com a geometria (coordenadas de cada vértice para todos os polígonos). Se você quiser ver apenas os nomes das variáveis (colunas), digite a função <strong>names()</strong>.</p>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb194-1"><a href="#cb194-1" tabindex="-1"></a><span class="co">#para ver os nomes das colunas do objeto ‘biomas’</span></span>
<span id="cb194-2"><a href="#cb194-2" tabindex="-1"></a><span class="fu">names</span>(biomas)</span></code></pre></div>
<pre><code>## [1] &quot;name_biome&quot; &quot;code_biome&quot; &quot;year&quot;       &quot;geom&quot;</code></pre>
<p>Usando apenas o comando básico do <strong>R</strong>, conseguimos visualizar os dados espaciais. Vamos usar a função <strong>plot()</strong> para isso. O que temos é a Figura @ref(fig:plot-biom). Observamos que a partir da geometria (geom) foi elaborado um mapa para cada coluna da tabela de dados.</p>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb196-1"><a href="#cb196-1" tabindex="-1"></a><span class="co">#para visualizar o objeto ‘biomas’</span></span>
<span id="cb196-2"><a href="#cb196-2" tabindex="-1"></a><span class="fu">plot</span>(biomas)</span></code></pre></div>
<div class="figure">
<img src="bookdownproj_files/figure-html/plot-biom-1.png" alt="Mapa para cada coluna da tabela de dados" width="672" />
<p class="caption">
(#fig:plot-biom)Mapa para cada coluna da tabela de dados
</p>
</div>
</div>
<div id="projeção-cartográfica" class="section level2 hasAnchor" number="6.3">
<h2 class="hasAnchor"><span class="header-section-number">6.3</span> Projeção cartográfica<a href="#projeção-cartográfica" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Quando elaboramos um mapa, é sempre interessante colocarmos a área mapeada em um contexto mais amplo. Isso pode ser feito no próprio mapa ou inserindo um mapa de referência dentro da área de plotagem. Vamos fazer a primeira opção.</p>
<p>Quando adicionamos mais de uma camada em um mapa, precisamos ficar atentos às projeções cartográficas das duas camadas. Vamos conferir a projeção da camada <strong>biomas</strong>.</p>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb197-1"><a href="#cb197-1" tabindex="-1"></a><span class="fu">head</span>(biomas)</span></code></pre></div>
<pre><code>## Simple feature collection with 6 features and 3 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: -73.98304 ymin: -33.75115 xmax: -28.84785 ymax: 5.269581
## Geodetic CRS:  SIRGAS 2000
##       name_biome code_biome year                           geom
## 1       Amazônia          1 2019 MULTIPOLYGON (((-44.08515 -...
## 2       Caatinga          2 2019 MULTIPOLYGON (((-41.7408 -2...
## 3        Cerrado          3 2019 MULTIPOLYGON (((-43.39009 -...
## 4 Mata Atlântica          4 2019 MULTIPOLYGON (((-48.70814 -...
## 5          Pampa          5 2019 MULTIPOLYGON (((-52.82472 -...
## 6       Pantanal          6 2019 MULTIPOLYGON (((-57.75946 -...</code></pre>
<p>Observamos que o sistema de coordenadas de referência <strong>CRS (coordinate reference system)</strong> é SIRGAS 2000.</p>
<p>Vamos criar uma camada do tipo <strong>sf</strong> (<em>simple features</em>) chamada <strong>mundo</strong> a partir do pacote <strong>rnaturalearth</strong>. A função <strong>ne_countries</strong> permite selecionar polígonos, pontos ou <em>sf</em> dos países do mundo em uma escala determinada ou pontos dos países muito pequenos. Para entender melhor, digite <strong>ne_countries</strong> na busca da aba <em>Help</em> do <strong>RStudio</strong>.</p>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb199-1"><a href="#cb199-1" tabindex="-1"></a><span class="co">#para criar o objeto &#39;mundo&#39;</span></span>
<span id="cb199-2"><a href="#cb199-2" tabindex="-1"></a>mundo <span class="ot">&lt;-</span> <span class="fu">ne_countries</span>(<span class="at">scale =</span> <span class="st">&quot;medium&quot;</span>, <span class="at">returnclass =</span> <span class="st">&quot;sf&quot;</span>)</span>
<span id="cb199-3"><a href="#cb199-3" tabindex="-1"></a><span class="co">#para ver o tipo de objetos</span></span>
<span id="cb199-4"><a href="#cb199-4" tabindex="-1"></a><span class="fu">class</span>(mundo)</span></code></pre></div>
<pre><code>## [1] &quot;sf&quot;         &quot;data.frame&quot;</code></pre>
<p><strong>mundo</strong> tem duas classes de objetos: um do tipo <strong>sf</strong> (<em>simple feature</em>) e outro do tipo <strong>data.frame</strong> (tabela de dados).
Vamos ver também o <strong>CRS (coordinate reference system)</strong> de <strong>mundo</strong>.</p>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb201-1"><a href="#cb201-1" tabindex="-1"></a>sf<span class="sc">::</span><span class="fu">st_crs</span>(mundo)</span></code></pre></div>
<p>O sistema de coordenadas de <strong>mundo</strong> é <strong>+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0</strong>.</p>
<p>Vamos colocar <strong>biomas</strong> na mesma projeção.
O pacote <strong>sf</strong> (<em>simple features for R</em>) (Pebesma, 2018) permite a manipulação das bases de dados espaciais. Vamos usá-lo para alterar o CRS da camada <strong>biomas</strong>, usando a função <strong>st_transform</strong>.</p>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb202-1"><a href="#cb202-1" tabindex="-1"></a><span class="co">#para alterar o CRS de &#39;biomas&#39;</span></span>
<span id="cb202-2"><a href="#cb202-2" tabindex="-1"></a>biomaswgs84<span class="ot">&lt;-</span> <span class="fu">st_transform</span>(biomas, <span class="st">&quot;+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb203-1"><a href="#cb203-1" tabindex="-1"></a><span class="co">#para verificar o CRS de &#39;biomaswgs84&#39;</span></span>
<span id="cb203-2"><a href="#cb203-2" tabindex="-1"></a><span class="fu">st_crs</span>(biomaswgs84)</span></code></pre></div>
<p>O embasamento teórico sobre as projeções cartográficas e sistemas de coordenadas geográficas é primordial para lidar com dados espaciais.</p>
</div>
<div id="iniciando-com-o-ggplot2" class="section level2 hasAnchor" number="6.4">
<h2 class="hasAnchor"><span class="header-section-number">6.4</span> Iniciando com o ggplot2<a href="#iniciando-com-o-ggplot2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><strong>ggplot2</strong> é um pacote do <strong>R</strong> para produzir gráficos estatísticos ou dados (e mapas, claro!). Seu enorme potencial é descrito em diversos livros. Para aqueles que pretendem se aprofundar, uma ótima referência é Wickham et al. (2016). Todos os detalhes do pacote podem ser encontrados em <a href="https://ggplot2.tidyverse.org/reference/index.html" class="uri">https://ggplot2.tidyverse.org/reference/index.html</a>.</p>
<p>Ao contrário da maioria dos outros pacotes gráficos, o <strong>ggplot2</strong> possui uma gramática subjacente, com base na teoria da <em>gramática dos gráficos</em> (Wilkinson &amp; Wills, 2005; Wickham, 2010), que permite compor gráficos combinando componentes independentes.</p>
<p>Resumidamente, parte-se da ideia de que todo gráfico ou mapa é composto por um conjunto de dados (que fornecerá a informação a ser representada) e o arranjo (a descrição de como as variáveis dos dados são representadas por meio dos atributos estéticos). O arranjo tem cinco componentes:</p>
<p><strong>layer</strong> - uma camada de elementos geométricos (<strong>geom</strong>), que representa o que se vê, como pontos, linhas, polígonos, etc. e a estatística que resume os dados;</p>
<p><strong>scale</strong> - representa os valores do espaço dos dados no espaço estético. Este componente inclui o uso da cor, forma ou tamanho, além de desenhar a legenda e eixos;</p>
<p><strong>coord</strong> - sistema de coordenadas que descreve como as coordenadas dos dados são representadas no plano do gráfico. Também fornece os eixos e linhas de grade;</p>
<p><strong>facet</strong> - especifica como dividir e mostrar subconjuntos dos dados;</p>
<p><strong>theme</strong> - controla os detalhes do gráfico/mapa, tais como o tamanho da fonte ou cor do fundo. Existe um tema padrão definido no <strong>ggplot2</strong> que pode ser modificado.</p>
<p>O pacote <strong>ggplot2</strong> só permite a elaboração de gráficos ou mapas estáticos. Para mapas interativos, outros pacotes podem ser usados, tais como o <strong>leaflet</strong> ou <strong>tmap</strong>.</p>
<p>Usando <strong>ggplot2</strong> podemos especificar diferentes partes do gráfico e combiná-las usando o operador <strong>+</strong> (Wickham et al., 2016).</p>
</div>
<div id="biomas-do-brasil" class="section level2 hasAnchor" number="6.5">
<h2 class="hasAnchor"><span class="header-section-number">6.5</span> Biomas do Brasil<a href="#biomas-do-brasil" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Vamos usar o <strong>ggplot2</strong> para a elaboração do mapa de Biomas do Brasil. Agora que as camadas já estão com o mesmo CRS, vamos começar a adicioná-las por partes e configurar o mapa. No <strong>ggplot2</strong>, os mapas são construídos adicionando-se camada sobre camada, sendo a primeira delas dada pela função <strong>ggplot()</strong> (sem o número “2”).
Primeiro vamos carregar a camada <strong>mundo</strong>. Digitamos a função <strong>ggplot()</strong>, definimos o banco de dados, no caso, <strong>mundo</strong> e acrescentamos o sinal <strong>+</strong>. <strong>sf</strong> é o acrônimo de <em>simple features</em> e desenha objetos geométricos diferentes dependendo do tipo de feição que existe nos dados, podendo ser pontos, linhas ou polígonos. Como vimos anteriormente, <strong>mundo</strong> tem um objeto do tipo <strong>sf</strong> e, por isso, vamos usar <strong>geom_sf</strong> para sua representação gráfica. Veja que a primeira linha chama a função <strong>ggplot</strong> . No final da primeira linha tem um sinal <strong>+</strong> indicando que outros elementos serão adicionados. Todas as linhas que serão adicionadas nesta função ficarão com recuo de 2 caracteres em relação à primeira linha. (Figura @ref(fig:plot-mundo)).</p>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb204-1"><a href="#cb204-1" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> mundo) <span class="sc">+</span></span>
<span id="cb204-2"><a href="#cb204-2" tabindex="-1"></a>  <span class="fu">geom_sf</span>()</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="bookdownproj_files/figure-html/plot-mundo-1.png" alt="Mapa base" width="672" />
<p class="caption">
(#fig:plot-mundo)Mapa base
</p>
</div>
<p>Observe que não é necessário colocar <strong>data =</strong> quando for indicar que quer visualizar o objeto ‘mundo’. Esta indicação pode ser feita de forma direta <em>ggplot(mundo)</em>.</p>
<p>Podemos alterar as cores do contorno dos países e do seu preenchimento adicionando as novas cores com os atributos ‘color’(ou ‘colour’) para o contorno e ‘fill’ para o preenchimento. Vamos usar tonalidades diferentes de cinza para estes atributos (Figura @ref(fig:plot-mundo-grey)). Entenda melhor como funcionam as cores no <strong>R</strong> consultando <a href="https://r-charts.com/colors/" class="uri">https://r-charts.com/colors/</a>.</p>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb205-1"><a href="#cb205-1" tabindex="-1"></a><span class="fu">ggplot</span>(mundo) <span class="sc">+</span> </span>
<span id="cb205-2"><a href="#cb205-2" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">color =</span> <span class="st">&quot;grey80&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;grey90&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="bookdownproj_files/figure-html/plot-mundo-grey-1.png" alt="Mapa base em cinza claro" width="672" />
<p class="caption">
(#fig:plot-mundo-grey)Mapa base em cinza claro
</p>
</div>
<p>Agora vamos adicionar a segunda camada do mapa, a camada ‘biomaswgs84’. Para isso, precisamos indicar o nome da camada e qual o campo (variável) que definirá o preenchimento (neste caso, o campo <strong>name_biome</strong>), que contém os nomes de cada um dos biomas, um dado qualitativo nominal. O arranjo estético é dado por <strong>aes()</strong>, que descreve a propriedade visual da geometria (geom). Então na nova camada <strong>geom_sf</strong> precisamos indicar qual o banco de dados (<strong>biomaswgs84</strong>) e que queremos que o campo <strong>name_biome</strong> seja preenchido com cores (<em>fill</em>) (Figura @ref(fig:plot-mundo-biomas)).</p>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb206-1"><a href="#cb206-1" tabindex="-1"></a><span class="fu">ggplot</span>(mundo) <span class="sc">+</span> </span>
<span id="cb206-2"><a href="#cb206-2" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">color =</span> <span class="st">&quot;grey80&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;grey90&quot;</span>)<span class="sc">+</span></span>
<span id="cb206-3"><a href="#cb206-3" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> biomaswgs84, <span class="fu">aes</span>(<span class="at">fill =</span> name_biome))</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="bookdownproj_files/figure-html/plot-mundo-biomas-1.png" alt="Mapa base em cinza claro e camada de biomas" width="672" />
<p class="caption">
(#fig:plot-mundo-biomas)Mapa base em cinza claro e camada de biomas
</p>
</div>
<p>O resultado mostra que as duas camadas estão sobrepostas de forma correta e que as cores preenchidas correspondem a uma escala de cor <em>default</em> do <strong>ggplot2</strong>. Além disso, estamos vendo a representação do mundo todo. Como a nossa intenção é obter o mapa de biomas no território brasileiro, precisamos fazer um recorte indicando os limites geográficos que nos interessam. Assim, usando a função <strong>coord_sf</strong> (coordenadas de uma camada <em>simple feature</em> ) vamos indicar as coordenadas limites para o eixo <strong>x</strong> (longitude) e para o eixo <strong>y</strong> (latitude). Conferindo os limites da camada <strong>biomaswgs84</strong> (xmin: -73.98304 ymin: -33.75115 xmax: -28.84785 ymax: 5.269581), vamos aumentar um pouco esta área para termos espaço na área dentro da moldura do mapa. A informação dos limites de uma camada pode ser extraída de <strong>sf::st_crs(biomaswgs84)</strong> ou <strong>head(biomaswgs84)</strong> (Figura @ref(fig:plot-mundo-biomas-recorte)).</p>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb207-1"><a href="#cb207-1" tabindex="-1"></a><span class="fu">ggplot</span>(mundo) <span class="sc">+</span> </span>
<span id="cb207-2"><a href="#cb207-2" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">color =</span> <span class="st">&quot;grey80&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;grey90&quot;</span>)<span class="sc">+</span></span>
<span id="cb207-3"><a href="#cb207-3" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data=</span>biomaswgs84, <span class="fu">aes</span>(<span class="at">fill =</span> name_biome)) <span class="sc">+</span></span>
<span id="cb207-4"><a href="#cb207-4" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">77</span>, <span class="sc">-</span><span class="dv">19</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">36</span>, <span class="dv">10</span>), <span class="at">expand =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="bookdownproj_files/figure-html/plot-mundo-biomas-recorte-1.png" alt="Mapa base ajustada à camada de biomas" width="672" />
<p class="caption">
(#fig:plot-mundo-biomas-recorte)Mapa base ajustada à camada de biomas
</p>
</div>
<p>A escala de cores não é apropriada para os dados que estão sendo representados. Podemos observar uma ordem na sequência das cores e a utilização de cores inadequadas para algumas feições como para os biomas Amazônia e Sistema Costeiro. Em mapas corocromáticos nominais, as cores devem permitir a diferenciação entre as feições. No <strong>R</strong>, existem diferentes formas de se referir aos nomes das cores e muitas escalas de cores. Com base na tabela em <a href="https://r-charts.com/colors/" class="uri">https://r-charts.com/colors/</a>, você pode escolher os nomes das cores para cada bioma. Para tal, vamos usar a função <strong>scale_fill_manual</strong> e dizer qual cor a partir da ordem em que apareceram na legenda da figura anterior: Amazônia, Caatinga, Cerrado, Mata Atlântica, Pampa, Pantanal e Sistema Costeiro (Figura @ref(fig:plot-mundo-biomas-cores)).</p>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb208-1"><a href="#cb208-1" tabindex="-1"></a><span class="fu">ggplot</span>(mundo) <span class="sc">+</span> </span>
<span id="cb208-2"><a href="#cb208-2" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">color =</span> <span class="st">&quot;grey80&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;grey90&quot;</span>)<span class="sc">+</span></span>
<span id="cb208-3"><a href="#cb208-3" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data=</span>biomaswgs84, <span class="fu">aes</span>(<span class="at">fill =</span> name_biome)) <span class="sc">+</span></span>
<span id="cb208-4"><a href="#cb208-4" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">77</span>, <span class="sc">-</span><span class="dv">19</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">36</span>, <span class="dv">10</span>), <span class="at">expand =</span> <span class="cn">FALSE</span>)<span class="sc">+</span></span>
<span id="cb208-5"><a href="#cb208-5" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">&quot;forestgreen&quot;</span>, <span class="st">&quot;lightgoldenrodyellow&quot;</span>, <span class="st">&quot;orange1&quot;</span>,<span class="st">&quot;green3&quot;</span>,<span class="st">&quot;indianred&quot;</span>,<span class="st">&quot;mediumorchid3&quot;</span>,<span class="st">&quot;skyblue1&quot;</span>))</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="bookdownproj_files/figure-html/plot-mundo-biomas-cores-1.png" alt="Mapa base e biomas com cores adequadas" width="672" />
<p class="caption">
(#fig:plot-mundo-biomas-cores)Mapa base e biomas com cores adequadas
</p>
</div>
<p>Agora que as cores foram ajustadas, vamos mudar o título que fica acima da legenda. Para isso, vamos usar a função <strong>labs</strong> (rótulo) dizendo que quer preencher com a palavra “Biomas”(Figura @ref(fig:plot-mundo-biomas-leg)).</p>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb209-1"><a href="#cb209-1" tabindex="-1"></a><span class="fu">ggplot</span>(mundo) <span class="sc">+</span> </span>
<span id="cb209-2"><a href="#cb209-2" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">color =</span> <span class="st">&quot;grey80&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;grey90&quot;</span>)<span class="sc">+</span></span>
<span id="cb209-3"><a href="#cb209-3" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> biomaswgs84, <span class="fu">aes</span>(<span class="at">fill =</span> name_biome)) <span class="sc">+</span></span>
<span id="cb209-4"><a href="#cb209-4" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">77</span>, <span class="sc">-</span><span class="dv">19</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">36</span>, <span class="dv">10</span>), <span class="at">expand =</span> <span class="cn">FALSE</span>)<span class="sc">+</span></span>
<span id="cb209-5"><a href="#cb209-5" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">&quot;forestgreen&quot;</span>, <span class="st">&quot;lightgoldenrodyellow&quot;</span>, <span class="st">&quot;orange1&quot;</span>,<span class="st">&quot;green3&quot;</span>,<span class="st">&quot;indianred&quot;</span>,<span class="st">&quot;mediumorchid3&quot;</span>,<span class="st">&quot;skyblue1&quot;</span>))<span class="sc">+</span></span>
<span id="cb209-6"><a href="#cb209-6" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">&quot;Biomas&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="bookdownproj_files/figure-html/plot-mundo-biomas-leg-1.png" alt="Título da legenda" width="672" />
<p class="caption">
(#fig:plot-mundo-biomas-leg)Título da legenda
</p>
</div>
<p>Nem todo mapa precisa de um título no próprio mapa. Ele pode estar na legenda da figura. Este detalhe depende do propósito do mapa. Aqui, vamos colocá-lo na área de fora, acima da área da moldura do mapa. O título do mapa é dado pela função <strong>ggtitle</strong>. O título vai entre aspas (Figura @ref(fig:plot-mundo-biomas-title)).</p>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="#cb210-1" tabindex="-1"></a><span class="fu">ggplot</span>(mundo) <span class="sc">+</span> </span>
<span id="cb210-2"><a href="#cb210-2" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">color =</span> <span class="st">&quot;grey80&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;grey90&quot;</span>)<span class="sc">+</span></span>
<span id="cb210-3"><a href="#cb210-3" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data=</span>biomaswgs84, <span class="fu">aes</span>(<span class="at">fill =</span> name_biome)) <span class="sc">+</span></span>
<span id="cb210-4"><a href="#cb210-4" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">77</span>, <span class="sc">-</span><span class="dv">19</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">36</span>, <span class="dv">10</span>), <span class="at">expand =</span> <span class="cn">FALSE</span>)<span class="sc">+</span></span>
<span id="cb210-5"><a href="#cb210-5" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">&quot;forestgreen&quot;</span>, <span class="st">&quot;lightgoldenrodyellow&quot;</span>, <span class="st">&quot;orange1&quot;</span>,<span class="st">&quot;green3&quot;</span>,<span class="st">&quot;indianred&quot;</span>,<span class="st">&quot;mediumorchid3&quot;</span>,<span class="st">&quot;skyblue1&quot;</span>))<span class="sc">+</span></span>
<span id="cb210-6"><a href="#cb210-6" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">&quot;Biomas&quot;</span>)<span class="sc">+</span></span>
<span id="cb210-7"><a href="#cb210-7" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Mapa corocromático nominal: Biomas do Brasil&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="bookdownproj_files/figure-html/plot-mundo-biomas-title-1.png" alt="Título do mapa" width="672" />
<p class="caption">
(#fig:plot-mundo-biomas-title)Título do mapa
</p>
</div>
<p><strong>Uma observação importante</strong>: caso quando você acrescente o título usando acentuação como em “corocromático”, apareça um erro, você precisará ajustar a língua para português usando a função <strong>Sys.setlocale(category = “LC_ALL”, locale = “pt_BR.UTF-8”)</strong>.</p>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb211-1"><a href="#cb211-1" tabindex="-1"></a><span class="fu">Sys.setlocale</span>(<span class="at">category =</span> <span class="st">&quot;LC_ALL&quot;</span>, <span class="at">locale =</span> <span class="st">&quot;pt_BR.UTF-8&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;LC_COLLATE=pt_BR.UTF-8;LC_CTYPE=pt_BR.UTF-8;LC_MONETARY=pt_BR.UTF-8;LC_NUMERIC=C;LC_TIME=pt_BR.UTF-8&quot;</code></pre>
<p>Rodando o código novamente depois desta função deverá resolver o problema.</p>
<p>Agora vamos alterar a cor do fundo do mapa usando a função <strong>theme()</strong>, indicando que a cor do fundo deve ser “aliceblue” (Figura @ref(fig:plot-fundo)).</p>
<div class="sourceCode" id="cb213"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb213-1"><a href="#cb213-1" tabindex="-1"></a><span class="fu">ggplot</span>(mundo) <span class="sc">+</span> </span>
<span id="cb213-2"><a href="#cb213-2" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">color =</span> <span class="st">&quot;grey80&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;grey90&quot;</span>)<span class="sc">+</span></span>
<span id="cb213-3"><a href="#cb213-3" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data=</span>biomaswgs84, <span class="fu">aes</span>(<span class="at">fill =</span> name_biome)) <span class="sc">+</span></span>
<span id="cb213-4"><a href="#cb213-4" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">77</span>, <span class="sc">-</span><span class="dv">19</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">36</span>, <span class="dv">10</span>), <span class="at">expand =</span> <span class="cn">FALSE</span>)<span class="sc">+</span></span>
<span id="cb213-5"><a href="#cb213-5" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">&quot;forestgreen&quot;</span>, <span class="st">&quot;lightgoldenrodyellow&quot;</span>, <span class="st">&quot;orange1&quot;</span>,<span class="st">&quot;green3&quot;</span>,<span class="st">&quot;indianred&quot;</span>,<span class="st">&quot;mediumorchid3&quot;</span>,<span class="st">&quot;skyblue1&quot;</span>))<span class="sc">+</span></span>
<span id="cb213-6"><a href="#cb213-6" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">&quot;Biomas&quot;</span>)<span class="sc">+</span></span>
<span id="cb213-7"><a href="#cb213-7" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Mapa corocromático nominal: Biomas do Brasil&quot;</span>) <span class="sc">+</span></span>
<span id="cb213-8"><a href="#cb213-8" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;aliceblue&quot;</span>))</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="bookdownproj_files/figure-html/plot-fundo-1.png" alt="Mapa com fundo azul claro" width="672" />
<p class="caption">
(#fig:plot-fundo)Mapa com fundo azul claro
</p>
</div>
<p>Nós podemos optar por deixar a legenda fora da moldura do mapa, como já está. No entanto, é importante saber como posicioná-la na parte de dentro.
Para ajustar os elementos dentro da moldura, considere que o canto inferior esquerdo é a posição (0,0) e o canto superior direito, a posição (1,1). Por padrão, se não ajustarmos <em>justification</em>, a legenda ficará centralizada a partir da posição que definirmos na posição da legenda, o que cortará parte da mesma.
Teste cada uma das quatro posiçoes a partir dos cantos, com a respectiva <em>justification</em>, alternando entre (0,0), (0,1), (1,0) e (1,1). Vamos ficar com a posição c(1, 0.2).
A Figura @ref(fig:posicao-01) mostra como é a posição da legenda em (0,1).</p>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb214-1"><a href="#cb214-1" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> mundo) <span class="sc">+</span> </span>
<span id="cb214-2"><a href="#cb214-2" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">color =</span> <span class="st">&quot;grey80&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;grey90&quot;</span>)<span class="sc">+</span></span>
<span id="cb214-3"><a href="#cb214-3" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> biomaswgs84, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">fill =</span> name_biome)) <span class="sc">+</span></span>
<span id="cb214-4"><a href="#cb214-4" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">77</span>, <span class="sc">-</span><span class="dv">19</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">36</span>, <span class="dv">10</span>), <span class="at">expand =</span> <span class="cn">FALSE</span>)<span class="sc">+</span></span>
<span id="cb214-5"><a href="#cb214-5" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">&quot;forestgreen&quot;</span>, <span class="st">&quot;lightgoldenrodyellow&quot;</span>, <span class="st">&quot;orange1&quot;</span>,<span class="st">&quot;green3&quot;</span>,<span class="st">&quot;indianred&quot;</span>,<span class="st">&quot;mediumorchid3&quot;</span>,<span class="st">&quot;skyblue1&quot;</span>))<span class="sc">+</span></span>
<span id="cb214-6"><a href="#cb214-6" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">&quot;Biomas&quot;</span>)<span class="sc">+</span></span>
<span id="cb214-7"><a href="#cb214-7" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Mapa corocromático nominal: Biomas do Brasil&quot;</span>) <span class="sc">+</span></span>
<span id="cb214-8"><a href="#cb214-8" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;aliceblue&quot;</span>))<span class="sc">+</span></span>
<span id="cb214-9"><a href="#cb214-9" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), </span>
<span id="cb214-10"><a href="#cb214-10" tabindex="-1"></a>       <span class="at">legend.justification =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">0.2</span>), </span>
<span id="cb214-11"><a href="#cb214-11" tabindex="-1"></a>       <span class="at">legend.background =</span> <span class="fu">element_rect</span>(<span class="at">colour =</span> <span class="cn">NA</span>, <span class="at">fill =</span> <span class="st">&quot;white&quot;</span>))</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="bookdownproj_files/figure-html/posicao-01-1.png" alt="Legenda na posição (0,1)" width="672" />
<p class="caption">
(#fig:posicao-01)Legenda na posição (0,1)
</p>
</div>
<p>Vamos precisar diminuir um pouco o tamanho da legenda.
Uma legenda é composta por diversos elementos e todos podem ser ajustados: caixa da legenda, título, texto, espaçamento, cor do fundo, cor da moldura, entre outros. Para saber os ajustes que estão sendo usados use a função <strong>theme_get()</strong>. Segue a função para ajustes de alguns elementos.</p>
<div class="sourceCode" id="cb215"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb215-1"><a href="#cb215-1" tabindex="-1"></a><span class="fu">theme</span>(<span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="dv">1</span>, <span class="st">&#39;cm&#39;</span>), <span class="co">#muda o tamanho da caixa da legenda</span></span>
<span id="cb215-2"><a href="#cb215-2" tabindex="-1"></a>        <span class="at">legend.key.height =</span> <span class="fu">unit</span>(<span class="dv">1</span>, <span class="st">&#39;cm&#39;</span>), <span class="co">#muda a altura da caixa da legenda</span></span>
<span id="cb215-3"><a href="#cb215-3" tabindex="-1"></a>        <span class="at">legend.key.width =</span> <span class="fu">unit</span>(<span class="dv">1</span>, <span class="st">&#39;cm&#39;</span>), <span class="co">#muda a largura da caixa da legenda</span></span>
<span id="cb215-4"><a href="#cb215-4" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>), <span class="co">#muda o tamanho da fonte do título</span></span>
<span id="cb215-5"><a href="#cb215-5" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>)) <span class="co">#muda o tamanho da fonte do texto</span></span></code></pre></div>
<p>Vamos reduzir o tamanho da fonte do título da legenda e do texto (Figura @ref(fig:plot-text-size)). As possibilidades de edição são inúmeras usando <strong>ggplot2</strong>. Sugiro consultar o site <a href="https://ggplot2.tidyverse.org/index.html" class="uri">https://ggplot2.tidyverse.org/index.html</a> e o livro online “R Graphics Cookbook” (Chang, 2023), que cobrem todos os detalhes.</p>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb216-1"><a href="#cb216-1" tabindex="-1"></a><span class="fu">ggplot</span>(mundo) <span class="sc">+</span> </span>
<span id="cb216-2"><a href="#cb216-2" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">color =</span> <span class="st">&quot;grey80&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;grey90&quot;</span>)<span class="sc">+</span></span>
<span id="cb216-3"><a href="#cb216-3" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data=</span>biomaswgs84, <span class="fu">aes</span>(<span class="at">fill =</span> name_biome)) <span class="sc">+</span></span>
<span id="cb216-4"><a href="#cb216-4" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">77</span>, <span class="sc">-</span><span class="dv">19</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">36</span>, <span class="dv">10</span>), <span class="at">expand =</span> <span class="cn">FALSE</span>)<span class="sc">+</span></span>
<span id="cb216-5"><a href="#cb216-5" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">&quot;forestgreen&quot;</span>, <span class="st">&quot;lightgoldenrodyellow&quot;</span>, <span class="st">&quot;orange1&quot;</span>,<span class="st">&quot;green3&quot;</span>,<span class="st">&quot;indianred&quot;</span>,<span class="st">&quot;mediumorchid3&quot;</span>,<span class="st">&quot;skyblue1&quot;</span>))<span class="sc">+</span></span>
<span id="cb216-6"><a href="#cb216-6" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">&quot;Biomas&quot;</span>)<span class="sc">+</span></span>
<span id="cb216-7"><a href="#cb216-7" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Mapa corocromático nominal: Biomas do Brasil&quot;</span>) <span class="sc">+</span></span>
<span id="cb216-8"><a href="#cb216-8" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;aliceblue&quot;</span>))<span class="sc">+</span></span>
<span id="cb216-9"><a href="#cb216-9" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>), </span>
<span id="cb216-10"><a href="#cb216-10" tabindex="-1"></a>       <span class="at">legend.justification =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>), </span>
<span id="cb216-11"><a href="#cb216-11" tabindex="-1"></a>       <span class="at">legend.background =</span> <span class="fu">element_rect</span>(<span class="at">colour =</span> <span class="cn">NA</span>, <span class="at">fill =</span> <span class="st">&quot;white&quot;</span>),</span>
<span id="cb216-12"><a href="#cb216-12" tabindex="-1"></a>       <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">8</span>),</span>
<span id="cb216-13"><a href="#cb216-13" tabindex="-1"></a>       <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">7</span>))</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="bookdownproj_files/figure-html/plot-text-size-1.png" alt="Redução das fontes do título da legenda e texto" width="672" />
<p class="caption">
(#fig:plot-text-size)Redução das fontes do título da legenda e texto
</p>
</div>
<p>O título pode ser colocado dentro da área do mapa, do lado direito. Vamos acrescentar esta informação logo abaixo da definição do título no código, usando <strong>theme(plot.title = element_text(hjust = 1, vjust = -8))</strong> para que o alinhamento fique à direita (hjust = 1) e que fique dentro da área (vjust = -8) (Figura @ref(fig:plot-alin-title)).</p>
<div class="sourceCode" id="cb217"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb217-1"><a href="#cb217-1" tabindex="-1"></a><span class="fu">ggplot</span>(mundo) <span class="sc">+</span> </span>
<span id="cb217-2"><a href="#cb217-2" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">color =</span> <span class="st">&quot;grey80&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;grey90&quot;</span>)<span class="sc">+</span></span>
<span id="cb217-3"><a href="#cb217-3" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data=</span>biomaswgs84, <span class="fu">aes</span>(<span class="at">fill =</span> name_biome)) <span class="sc">+</span></span>
<span id="cb217-4"><a href="#cb217-4" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">77</span>, <span class="sc">-</span><span class="dv">19</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">36</span>, <span class="dv">10</span>), <span class="at">expand =</span> <span class="cn">FALSE</span>)<span class="sc">+</span></span>
<span id="cb217-5"><a href="#cb217-5" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">&quot;forestgreen&quot;</span>, <span class="st">&quot;lightgoldenrodyellow&quot;</span>, <span class="st">&quot;orange1&quot;</span>,<span class="st">&quot;green3&quot;</span>,<span class="st">&quot;indianred&quot;</span>,<span class="st">&quot;mediumorchid3&quot;</span>,<span class="st">&quot;skyblue1&quot;</span>))<span class="sc">+</span></span>
<span id="cb217-6"><a href="#cb217-6" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">&quot;Biomas&quot;</span>)<span class="sc">+</span></span>
<span id="cb217-7"><a href="#cb217-7" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Mapa corocromático nominal: Biomas do Brasil&quot;</span>) <span class="sc">+</span></span>
<span id="cb217-8"><a href="#cb217-8" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;aliceblue&quot;</span>))<span class="sc">+</span></span>
<span id="cb217-9"><a href="#cb217-9" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">8</span>))<span class="sc">+</span></span>
<span id="cb217-10"><a href="#cb217-10" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>), </span>
<span id="cb217-11"><a href="#cb217-11" tabindex="-1"></a>       <span class="at">legend.justification =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>), </span>
<span id="cb217-12"><a href="#cb217-12" tabindex="-1"></a>       <span class="at">legend.background =</span> <span class="fu">element_rect</span>(<span class="at">colour =</span> <span class="cn">NA</span>, <span class="at">fill =</span> <span class="st">&quot;white&quot;</span>),</span>
<span id="cb217-13"><a href="#cb217-13" tabindex="-1"></a>       <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">9</span>),</span>
<span id="cb217-14"><a href="#cb217-14" tabindex="-1"></a>       <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">8</span>))</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="bookdownproj_files/figure-html/plot-alin-title-1.png" alt="Alinhamento do título" width="672" />
<p class="caption">
(#fig:plot-alin-title)Alinhamento do título
</p>
</div>
<p>Precisamos adicionar um elemento muito importante: a escala gráfica!
A função <strong>ggspatial::annotation_scale(location = “br”, width_hint = 0.4, line_width = 0.5, height = unit(0.1,“cm”))</strong> indica que a localização da escala gráfica será “br”, ou seja, <em>bottom right</em> (inferior direito). <strong>width_hint</strong> é a largura total da barra da escala. A espessura da linha da barra da escala é dada por <strong>line_width</strong> e <strong>height</strong>, a altura.
Vamos aproveitar também para colocar uma linha de contorno na moldura do mapa. Essa linha é a <strong>panel.border</strong>.
As linhas do Equador e do Trópico de Capricórnio podem ser adicionadas com a função <strong>geo_hline()</strong> ajustando os valores para 0 (Equador) e -23.27 para o Trópico. O tipo da linha será pontilhado “dashed”.
Também podemos deixar sem linhas dos contornos dos biomas usando <strong>colour=NA</strong> na camada “biomaswgs84” (Figura @ref(fig:plot-escala)).</p>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb218-1"><a href="#cb218-1" tabindex="-1"></a><span class="fu">ggplot</span>(mundo) <span class="sc">+</span> </span>
<span id="cb218-2"><a href="#cb218-2" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">color =</span> <span class="st">&quot;grey80&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;grey90&quot;</span>)<span class="sc">+</span></span>
<span id="cb218-3"><a href="#cb218-3" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> biomaswgs84, <span class="fu">aes</span>(<span class="at">fill =</span> name_biome), <span class="at">colour=</span><span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb218-4"><a href="#cb218-4" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">77</span>, <span class="sc">-</span><span class="dv">19</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">36</span>, <span class="dv">10</span>), <span class="at">expand =</span> <span class="cn">FALSE</span>)<span class="sc">+</span></span>
<span id="cb218-5"><a href="#cb218-5" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>)<span class="sc">+</span></span>
<span id="cb218-6"><a href="#cb218-6" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span><span class="sc">-</span><span class="fl">23.27</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>)<span class="sc">+</span></span>
<span id="cb218-7"><a href="#cb218-7" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">&quot;forestgreen&quot;</span>, <span class="st">&quot;lightgoldenrodyellow&quot;</span>, <span class="st">&quot;orange1&quot;</span>,<span class="st">&quot;green3&quot;</span>,<span class="st">&quot;indianred&quot;</span>,<span class="st">&quot;mediumorchid3&quot;</span>,<span class="st">&quot;skyblue1&quot;</span>))<span class="sc">+</span></span>
<span id="cb218-8"><a href="#cb218-8" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">&quot;Biomas&quot;</span>)<span class="sc">+</span></span>
<span id="cb218-9"><a href="#cb218-9" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Mapa corocromático nominal: Biomas do Brasil&quot;</span>) <span class="sc">+</span></span>
<span id="cb218-10"><a href="#cb218-10" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;aliceblue&quot;</span>))<span class="sc">+</span></span>
<span id="cb218-11"><a href="#cb218-11" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">8</span>))<span class="sc">+</span></span>
<span id="cb218-12"><a href="#cb218-12" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">0.2</span>), </span>
<span id="cb218-13"><a href="#cb218-13" tabindex="-1"></a>       <span class="at">legend.justification =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">0.2</span>), </span>
<span id="cb218-14"><a href="#cb218-14" tabindex="-1"></a>       <span class="at">legend.background =</span> <span class="fu">element_rect</span>(<span class="at">colour =</span> <span class="cn">NA</span>, <span class="at">fill =</span> <span class="st">&quot;white&quot;</span>),</span>
<span id="cb218-15"><a href="#cb218-15" tabindex="-1"></a>       <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">9</span>),</span>
<span id="cb218-16"><a href="#cb218-16" tabindex="-1"></a>       <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">8</span>),</span>
<span id="cb218-17"><a href="#cb218-17" tabindex="-1"></a>       <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>,<span class="at">size =</span> .<span class="dv">1</span>,<span class="at">fill =</span> <span class="cn">NA</span>))<span class="sc">+</span></span>
<span id="cb218-18"><a href="#cb218-18" tabindex="-1"></a>  ggspatial<span class="sc">::</span><span class="fu">annotation_scale</span>(<span class="at">location =</span> <span class="st">&quot;br&quot;</span>, <span class="at">width_hint =</span> <span class="fl">0.3</span>, <span class="at">line_width =</span> <span class="fl">0.5</span>, <span class="at">height =</span> <span class="fu">unit</span>(<span class="fl">0.1</span>,<span class="st">&quot;cm&quot;</span>))</span></code></pre></div>
<pre><code>## Scale on map varies by more than 10%, scale bar may be inaccurate</code></pre>
<div class="figure" style="text-align: center">
<img src="bookdownproj_files/figure-html/plot-escala-1.png" alt="Escala gráfica, Equador e Trópico de Capricórnio" width="672" />
<p class="caption">
(#fig:plot-escala)Escala gráfica, Equador e Trópico de Capricórnio
</p>
</div>
<p>Observe que quando inserimos as linhas do Equador e do Trópico de Capricórnio, apareceu o título no eixo y como “yintercept”. Para remover esta informação, basta indicar que o título do eixo não deve ter preenchimento <strong>axis.title.y = element_blank())</strong>.
Embora o mapa de biomas pareça satisfatório, não temos referências internas da localização dos biomas. Seria interessante adicionar a camada dos estados (Unidades da Federação = UF) sem preenchimento e com o contorno em cinza médio (grey50). Para isso, primeiro vamos criar uma camada “sf” usando uma função do <strong>geobr</strong>, que é a “read_state”.</p>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb220-1"><a href="#cb220-1" tabindex="-1"></a>uf <span class="ot">&lt;-</span> <span class="fu">read_state</span>(<span class="at">code_state =</span> <span class="st">&quot;all&quot;</span>, <span class="at">year =</span> <span class="dv">2010</span>, <span class="at">simplified =</span> <span class="cn">TRUE</span>, <span class="at">showProgress =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## Using year 2010</code></pre>
<p>Em seguida, vamos transformar a projeção da camada “uf” para que fique em WGS84.</p>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb222-1"><a href="#cb222-1" tabindex="-1"></a>ufwgs84 <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(uf, <span class="st">&quot;+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0&quot;</span>)</span></code></pre></div>
<p>Agora adicionamos a camada <strong>ufwgs84</strong> logo abaixo da linha de código da camada <strong>biomaswgs84</strong>. O atributo <strong>alpha = 0</strong> indica que não deve haver preenchimento da camada, ou seja, ela deverá ficar transparente e o contorno deverá ser “grey50” (Figura @ref(fig:plot-uf)).</p>
<div class="sourceCode" id="cb223"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb223-1"><a href="#cb223-1" tabindex="-1"></a><span class="fu">ggplot</span>(mundo) <span class="sc">+</span> </span>
<span id="cb223-2"><a href="#cb223-2" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">color =</span> <span class="st">&quot;grey80&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;grey90&quot;</span>)<span class="sc">+</span></span>
<span id="cb223-3"><a href="#cb223-3" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> biomaswgs84, <span class="fu">aes</span>(<span class="at">fill =</span> name_biome), <span class="at">colour=</span><span class="cn">NA</span>)<span class="sc">+</span></span>
<span id="cb223-4"><a href="#cb223-4" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> ufwgs84, <span class="at">colour =</span> <span class="st">&quot;grey50&quot;</span>, <span class="at">alpha =</span> <span class="dv">0</span>)<span class="sc">+</span></span>
<span id="cb223-5"><a href="#cb223-5" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">77</span>, <span class="sc">-</span><span class="dv">19</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">36</span>, <span class="dv">10</span>), <span class="at">expand =</span> <span class="cn">FALSE</span>)<span class="sc">+</span></span>
<span id="cb223-6"><a href="#cb223-6" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>)<span class="sc">+</span></span>
<span id="cb223-7"><a href="#cb223-7" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span><span class="sc">-</span><span class="fl">23.27</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>)<span class="sc">+</span></span>
<span id="cb223-8"><a href="#cb223-8" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">&quot;forestgreen&quot;</span>, <span class="st">&quot;lightgoldenrodyellow&quot;</span>, <span class="st">&quot;orange1&quot;</span>,<span class="st">&quot;green3&quot;</span>,<span class="st">&quot;indianred&quot;</span>,<span class="st">&quot;mediumorchid3&quot;</span>,<span class="st">&quot;skyblue1&quot;</span>))<span class="sc">+</span></span>
<span id="cb223-9"><a href="#cb223-9" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">&quot;Biomas&quot;</span>)<span class="sc">+</span></span>
<span id="cb223-10"><a href="#cb223-10" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Mapa corocromático nominal: Biomas do Brasil&quot;</span>) <span class="sc">+</span></span>
<span id="cb223-11"><a href="#cb223-11" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;aliceblue&quot;</span>))<span class="sc">+</span></span>
<span id="cb223-12"><a href="#cb223-12" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">8</span>))<span class="sc">+</span></span>
<span id="cb223-13"><a href="#cb223-13" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">0.2</span>), </span>
<span id="cb223-14"><a href="#cb223-14" tabindex="-1"></a>       <span class="at">legend.justification =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">0.2</span>), </span>
<span id="cb223-15"><a href="#cb223-15" tabindex="-1"></a>       <span class="at">legend.background =</span> <span class="fu">element_rect</span>(<span class="at">colour =</span> <span class="cn">NA</span>, <span class="at">fill =</span> <span class="st">&quot;white&quot;</span>),</span>
<span id="cb223-16"><a href="#cb223-16" tabindex="-1"></a>       <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">9</span>),</span>
<span id="cb223-17"><a href="#cb223-17" tabindex="-1"></a>       <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">8</span>),</span>
<span id="cb223-18"><a href="#cb223-18" tabindex="-1"></a>       <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>,<span class="at">size =</span> .<span class="dv">1</span>,<span class="at">fill =</span> <span class="cn">NA</span>),</span>
<span id="cb223-19"><a href="#cb223-19" tabindex="-1"></a>       <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>())<span class="sc">+</span></span>
<span id="cb223-20"><a href="#cb223-20" tabindex="-1"></a>  ggspatial<span class="sc">::</span><span class="fu">annotation_scale</span>(<span class="at">location =</span> <span class="st">&quot;br&quot;</span>, <span class="at">width_hint =</span> <span class="fl">0.4</span>, <span class="at">line_width =</span> <span class="fl">0.5</span>, <span class="at">height =</span> <span class="fu">unit</span>(<span class="fl">0.1</span>,<span class="st">&quot;cm&quot;</span>))</span></code></pre></div>
<pre><code>## Scale on map varies by more than 10%, scale bar may be inaccurate</code></pre>
<div class="figure" style="text-align: center">
<img src="bookdownproj_files/figure-html/plot-uf-1.png" alt="Adicionando os limites das Unidades da Federação" width="672" />
<p class="caption">
(#fig:plot-uf)Adicionando os limites das Unidades da Federação
</p>
</div>
<p>Por último, vamos adicionar a fonte dos dados. Esta informação entra como “caption” na função <strong>labs</strong> e poderá entrar nos parênteses já existentes para <strong>labs</strong> (Figura @ref(fig:plot-caption)).</p>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb225-1"><a href="#cb225-1" tabindex="-1"></a><span class="fu">ggplot</span>(mundo) <span class="sc">+</span> </span>
<span id="cb225-2"><a href="#cb225-2" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">color =</span> <span class="st">&quot;grey80&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;grey90&quot;</span>)<span class="sc">+</span></span>
<span id="cb225-3"><a href="#cb225-3" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> biomaswgs84, <span class="fu">aes</span>(<span class="at">fill =</span> name_biome), <span class="at">colour=</span><span class="cn">NA</span>)<span class="sc">+</span></span>
<span id="cb225-4"><a href="#cb225-4" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> ufwgs84, <span class="at">colour =</span> <span class="st">&quot;grey50&quot;</span>, <span class="at">alpha =</span> <span class="dv">0</span>)<span class="sc">+</span></span>
<span id="cb225-5"><a href="#cb225-5" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">77</span>, <span class="sc">-</span><span class="dv">19</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">36</span>, <span class="dv">10</span>), <span class="at">expand =</span> <span class="cn">FALSE</span>)<span class="sc">+</span></span>
<span id="cb225-6"><a href="#cb225-6" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>)<span class="sc">+</span></span>
<span id="cb225-7"><a href="#cb225-7" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span><span class="sc">-</span><span class="fl">23.27</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>)<span class="sc">+</span></span>
<span id="cb225-8"><a href="#cb225-8" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">&quot;forestgreen&quot;</span>, <span class="st">&quot;lightgoldenrodyellow&quot;</span>, <span class="st">&quot;orange1&quot;</span>,<span class="st">&quot;green3&quot;</span>,<span class="st">&quot;indianred&quot;</span>,<span class="st">&quot;mediumorchid3&quot;</span>,<span class="st">&quot;skyblue1&quot;</span>))<span class="sc">+</span></span>
<span id="cb225-9"><a href="#cb225-9" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">&quot;Biomas&quot;</span>,</span>
<span id="cb225-10"><a href="#cb225-10" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">&quot;Fonte: IBGE (2019) </span><span class="sc">\n</span><span class="st"> Elaborado por: @Ligiaviz&quot;</span>) <span class="sc">+</span></span>
<span id="cb225-11"><a href="#cb225-11" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Mapa corocromático nominal: Biomas do Brasil&quot;</span>) <span class="sc">+</span></span>
<span id="cb225-12"><a href="#cb225-12" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;aliceblue&quot;</span>))<span class="sc">+</span></span>
<span id="cb225-13"><a href="#cb225-13" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">8</span>))<span class="sc">+</span></span>
<span id="cb225-14"><a href="#cb225-14" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">0.2</span>), </span>
<span id="cb225-15"><a href="#cb225-15" tabindex="-1"></a>       <span class="at">legend.justification =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">0.2</span>), </span>
<span id="cb225-16"><a href="#cb225-16" tabindex="-1"></a>       <span class="at">legend.background =</span> <span class="fu">element_rect</span>(<span class="at">colour =</span> <span class="cn">NA</span>, <span class="at">fill =</span> <span class="st">&quot;white&quot;</span>),</span>
<span id="cb225-17"><a href="#cb225-17" tabindex="-1"></a>       <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">8</span>),</span>
<span id="cb225-18"><a href="#cb225-18" tabindex="-1"></a>       <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">7</span>),</span>
<span id="cb225-19"><a href="#cb225-19" tabindex="-1"></a>       <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>),</span>
<span id="cb225-20"><a href="#cb225-20" tabindex="-1"></a>       <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>,<span class="at">size =</span> .<span class="dv">1</span>,<span class="at">fill =</span> <span class="cn">NA</span>),</span>
<span id="cb225-21"><a href="#cb225-21" tabindex="-1"></a>       <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>())<span class="sc">+</span></span>
<span id="cb225-22"><a href="#cb225-22" tabindex="-1"></a>  ggspatial<span class="sc">::</span><span class="fu">annotation_scale</span>(<span class="at">location =</span> <span class="st">&quot;br&quot;</span>, <span class="at">width_hint =</span> <span class="fl">0.4</span>, <span class="at">line_width =</span> <span class="fl">0.5</span>, <span class="at">height =</span> <span class="fu">unit</span>(<span class="fl">0.1</span>,<span class="st">&quot;cm&quot;</span>))</span></code></pre></div>
<pre><code>## Scale on map varies by more than 10%, scale bar may be inaccurate</code></pre>
<div class="figure" style="text-align: center">
<img src="bookdownproj_files/figure-html/plot-caption-1.png" alt="Mapa final com fonte de dados" width="672" />
<p class="caption">
(#fig:plot-caption)Mapa final com fonte de dados
</p>
</div>
<p>Pronto! Nosso primeiro mapa em <strong>R</strong> está finalizado! E nem doeu…
Você pode salvar o arquivo no formato <strong>png</strong>. Ele estará no seu diretório de trabalho.</p>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb227-1"><a href="#cb227-1" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">&quot;biomas.png&quot;</span>, <span class="at">width =</span> <span class="dv">8</span>, <span class="at">height =</span> <span class="dv">8</span>, <span class="at">dpi =</span> <span class="dv">300</span>)</span></code></pre></div>
</div>
<div id="referências-citadas-1" class="section level2 unnumbered hasAnchor">
<h2 class="unnumbered hasAnchor">Referências citadas<a href="#referências-citadas-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>CHANG, W. (2023) <strong>R Graphics Cookbook</strong>: Practical Recipes for Visualizing Data. 2nd Edition. <a href="https://r-graphics.org/index.html" class="uri">https://r-graphics.org/index.html</a></p>
<p>PEBESMA, E. (2018). Simple Features for R: Standardized Support for Spatial Vector Data. <strong>The R Journal</strong> 10:1, 439-446. <a href="https://journal.r-project.org/archive/2018/RJ-2018-009/index.html" class="uri">https://journal.r-project.org/archive/2018/RJ-2018-009/index.html</a></p>
<p>PEREIRA, R.H.M.; GONÇALVES, C.N. (2021) <strong>geobr</strong>: Loads Shapefiles of Official Spatial Data Sets of Brazil. GitHub repository - <a href="https://github.com/ipeaGIT/geobr" class="uri">https://github.com/ipeaGIT/geobr</a>.</p>
<p>WICKHAM, H. (2010) A Layered Grammar of Graphics. <strong>Journal of Computational and Graphical Statistics</strong>, 19(1).</p>
<p>WICKHAM, H. (2016). <strong>ggplot2</strong>: Elegant Graphics for Data Analysis. Springer-Verlag New York. ISBN 978-3-319-24277-4, <a href="https://ggplot2.tidyverse.org" class="uri">https://ggplot2.tidyverse.org</a>.</p>
<p>WILKINSON, L., WILLS, G. (2005) <strong>The Grammar of Graphics</strong>. 2nd Edition. New York: Springer. 690p.</p>
<!--chapter:end:06-coroc-nominal.Rmd-->
</div>
</div>
<div id="quali2" class="section level1 hasAnchor" number="7">
<h1 class="hasAnchor"><span class="header-section-number">7</span> Dados qualitativos: mapa corocromático ordinal<a href="#quali2" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Mapas corocromáticos ordinais são usados para representar dados <strong>qualitativos</strong> que se ordenam. Esses dados podem ser derivados de dados quantitativos para os quais se atribuem classes ordenadas do tipo “baixo-médio-alto”, “ruim-regular-bom” ou outras que sigam esta lógica.</p>
<p>O exemplo usado aqui é o do mapa de potencial de agressividade climática na Amazônia Legal do Brasil, elaborado pela Coordenação de Recursos Naturais e Estudos Ambientais - CREN, da Diretoria de Geociências do IBGE. São três classes: alta (fatores 1 e 2), média (fatores 1, 2 e 3) e baixa (fatores 1, 2 e 3).
Aqui, <strong>Fator</strong> é a causa predominante que explica o potencial de agressividade do clima: os fatores determinantes que explicam cada grau, expressos pelos dígitos 1, 2 e 3, que representam, respectivamente o Excesso de Umidade, a Deficiência de Umidade e a Ocorrência de Ambos Fatores (<a href="http://geoftp.ibge.gov.br/cartas_e_mapas/mapas_regionais/sociedade_e_economia/integrado_zee_amazonia_legal/Potencial_de_Agressividade_Climatica.pdf" class="uri">http://geoftp.ibge.gov.br/cartas_e_mapas/mapas_regionais/sociedade_e_economia/integrado_zee_amazonia_legal/Potencial_de_Agressividade_Climatica.pdf</a>).</p>
<p>A ideia é seguir as cores segundo classe (alta, média e baixa) com variações de tonalidade dentro de cada classe.</p>
<div id="banco-de-dados" class="section level2 hasAnchor" number="7.1">
<h2 class="hasAnchor"><span class="header-section-number">7.1</span> Banco de dados<a href="#banco-de-dados" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Iniciamos limpando a memória.</p>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb228-1"><a href="#cb228-1" tabindex="-1"></a><span class="co">#para limpar a memória</span></span>
<span id="cb228-2"><a href="#cb228-2" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">ls</span>())</span></code></pre></div>
<p>Definimos o diretório de trabalho.</p>
<div class="sourceCode" id="cb229"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb229-1"><a href="#cb229-1" tabindex="-1"></a><span class="co">#para verificar o diretório</span></span>
<span id="cb229-2"><a href="#cb229-2" tabindex="-1"></a><span class="fu">getwd</span>()</span></code></pre></div>
<p>Carregamos os pacotes que serão utilizados.</p>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb230-1"><a href="#cb230-1" tabindex="-1"></a><span class="co">#para carregar os pacotes que serao usados</span></span>
<span id="cb230-2"><a href="#cb230-2" tabindex="-1"></a><span class="fu">library</span>(geobr)</span>
<span id="cb230-3"><a href="#cb230-3" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb230-4"><a href="#cb230-4" tabindex="-1"></a><span class="fu">library</span>(rgdal)</span>
<span id="cb230-5"><a href="#cb230-5" tabindex="-1"></a><span class="fu">library</span>(ggplot2,<span class="at">warn.conflicts=</span><span class="cn">FALSE</span>)</span>
<span id="cb230-6"><a href="#cb230-6" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb230-7"><a href="#cb230-7" tabindex="-1"></a><span class="fu">library</span>(ggsn)</span>
<span id="cb230-8"><a href="#cb230-8" tabindex="-1"></a><span class="fu">library</span>(cowplot)</span>
<span id="cb230-9"><a href="#cb230-9" tabindex="-1"></a><span class="fu">library</span>(ggspatial)</span>
<span id="cb230-10"><a href="#cb230-10" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb230-11"><a href="#cb230-11" tabindex="-1"></a><span class="fu">library</span>(rnaturalearth)</span>
<span id="cb230-12"><a href="#cb230-12" tabindex="-1"></a><span class="fu">library</span>(rnaturalearthdata)</span></code></pre></div>
<p>Vamos criar o objeto <strong>mundo</strong> usando a função <code>ne_countries</code> do pacote <em>rnaturalearth</em>.</p>
<div class="sourceCode" id="cb231"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb231-1"><a href="#cb231-1" tabindex="-1"></a>mundo <span class="ot">&lt;-</span> <span class="fu">ne_countries</span>(<span class="at">scale =</span> <span class="st">&quot;medium&quot;</span>, <span class="at">returnclass =</span> <span class="st">&quot;sf&quot;</span>)</span></code></pre></div>
<p>Vamos examinar o objeto gerado.</p>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb232-1"><a href="#cb232-1" tabindex="-1"></a><span class="fu">head</span>(mundo)</span></code></pre></div>
<pre><code>## Simple feature collection with 6 features and 63 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: -70.06611 ymin: -18.01973 xmax: 74.89131 ymax: 60.40581
## Geodetic CRS:  +proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0
##   scalerank      featurecla labelrank     sovereignt sov_a3 adm0_dif
## 0         3 Admin-0 country         5    Netherlands    NL1        1
## 1         1 Admin-0 country         3    Afghanistan    AFG        0
## 2         1 Admin-0 country         3         Angola    AGO        0
## 3         1 Admin-0 country         6 United Kingdom    GB1        1
## 4         1 Admin-0 country         6        Albania    ALB        0
## 5         3 Admin-0 country         6        Finland    FI1        1
##   level              type       admin adm0_a3 geou_dif     geounit
## 0     2           Country       Aruba     ABW        0       Aruba
## 1     2 Sovereign country Afghanistan     AFG        0 Afghanistan
## 2     2 Sovereign country      Angola     AGO        0      Angola
## 3     2        Dependency    Anguilla     AIA        0    Anguilla
## 4     2 Sovereign country     Albania     ALB        0     Albania
## 5     2           Country       Aland     ALD        0       Aland
##   gu_a3 su_dif     subunit su_a3 brk_diff        name     name_long
## 0   ABW      0       Aruba   ABW        0       Aruba         Aruba
## 1   AFG      0 Afghanistan   AFG        0 Afghanistan   Afghanistan
## 2   AGO      0      Angola   AGO        0      Angola        Angola
## 3   AIA      0    Anguilla   AIA        0    Anguilla      Anguilla
## 4   ALB      0     Albania   ALB        0     Albania       Albania
## 5   ALD      0       Aland   ALD        0       Aland Aland Islands
##   brk_a3    brk_name brk_group abbrev postal
## 0    ABW       Aruba      &lt;NA&gt;  Aruba     AW
## 1    AFG Afghanistan      &lt;NA&gt;   Afg.     AF
## 2    AGO      Angola      &lt;NA&gt;   Ang.     AO
## 3    AIA    Anguilla      &lt;NA&gt;   Ang.     AI
## 4    ALB     Albania      &lt;NA&gt;   Alb.     AL
## 5    ALD       Aland      &lt;NA&gt;  Aland     AI
##                      formal_en formal_fr note_adm0 note_brk   name_sort
## 0                        Aruba      &lt;NA&gt;     Neth.     &lt;NA&gt;       Aruba
## 1 Islamic State of Afghanistan      &lt;NA&gt;      &lt;NA&gt;     &lt;NA&gt; Afghanistan
## 2  People&#39;s Republic of Angola      &lt;NA&gt;      &lt;NA&gt;     &lt;NA&gt;      Angola
## 3                         &lt;NA&gt;      &lt;NA&gt;      U.K.     &lt;NA&gt;    Anguilla
## 4          Republic of Albania      &lt;NA&gt;      &lt;NA&gt;     &lt;NA&gt;     Albania
## 5                Åland Islands      &lt;NA&gt;      Fin.     &lt;NA&gt;       Aland
##   name_alt mapcolor7 mapcolor8 mapcolor9 mapcolor13  pop_est gdp_md_est
## 0     &lt;NA&gt;         4         2         2          9   103065     2258.0
## 1     &lt;NA&gt;         5         6         8          7 28400000    22270.0
## 2     &lt;NA&gt;         3         2         6          1 12799293   110300.0
## 3     &lt;NA&gt;         6         6         6          3    14436      108.9
## 4     &lt;NA&gt;         1         4         1          6  3639453    21810.0
## 5     &lt;NA&gt;         4         1         4          6    27153     1563.0
##   pop_year lastcensus gdp_year                    economy
## 0       NA       2010       NA       6. Developing region
## 1       NA       1979       NA  7. Least developed region
## 2       NA       1970       NA  7. Least developed region
## 3       NA         NA       NA       6. Developing region
## 4       NA       2001       NA       6. Developing region
## 5       NA         NA       NA 2. Developed region: nonG7
##                income_grp wikipedia fips_10 iso_a2 iso_a3 iso_n3 un_a3
## 0 2. High income: nonOECD        NA    &lt;NA&gt;     AW    ABW    533   533
## 1           5. Low income        NA    &lt;NA&gt;     AF    AFG    004   004
## 2  3. Upper middle income        NA    &lt;NA&gt;     AO    AGO    024   024
## 3  3. Upper middle income        NA    &lt;NA&gt;     AI    AIA    660   660
## 4  4. Lower middle income        NA    &lt;NA&gt;     AL    ALB    008   008
## 5    1. High income: OECD        NA    &lt;NA&gt;     AX    ALA    248   248
##   wb_a2 wb_a3 woe_id adm0_a3_is adm0_a3_us adm0_a3_un adm0_a3_wb
## 0    AW   ABW     NA        ABW        ABW         NA         NA
## 1    AF   AFG     NA        AFG        AFG         NA         NA
## 2    AO   AGO     NA        AGO        AGO         NA         NA
## 3  &lt;NA&gt;  &lt;NA&gt;     NA        AIA        AIA         NA         NA
## 4    AL   ALB     NA        ALB        ALB         NA         NA
## 5  &lt;NA&gt;  &lt;NA&gt;     NA        ALA        ALD         NA         NA
##       continent region_un       subregion                 region_wb
## 0 North America  Americas       Caribbean Latin America &amp; Caribbean
## 1          Asia      Asia   Southern Asia                South Asia
## 2        Africa    Africa   Middle Africa        Sub-Saharan Africa
## 3 North America  Americas       Caribbean Latin America &amp; Caribbean
## 4        Europe    Europe Southern Europe     Europe &amp; Central Asia
## 5        Europe    Europe Northern Europe     Europe &amp; Central Asia
##   name_len long_len abbrev_len tiny homepart
## 0        5        5          5    4       NA
## 1       11       11          4   NA        1
## 2        6        6          4   NA        1
## 3        8        8          4   NA       NA
## 4        7        7          4   NA        1
## 5        5       13          5    5       NA
##                         geometry
## 0 MULTIPOLYGON (((-69.89912 1...
## 1 MULTIPOLYGON (((74.89131 37...
## 2 MULTIPOLYGON (((14.19082 -5...
## 3 MULTIPOLYGON (((-63.00122 1...
## 4 MULTIPOLYGON (((20.06396 42...
## 5 MULTIPOLYGON (((20.61133 60...</code></pre>
<p>Observe que o CRS de <strong>mundo</strong> é WGS84.
Na sequência, baixamos o arquivo “BR_UF_2020.zip” que contém o shapefile dos limites estaduais do Brasil, do site do IBGE.</p>
<div class="sourceCode" id="cb234"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb234-1"><a href="#cb234-1" tabindex="-1"></a><span class="co">#para identificar o url, faca o download do arquivo shapefile e clique em Ctrl+J</span></span>
<span id="cb234-2"><a href="#cb234-2" tabindex="-1"></a><span class="fu">download.file</span>(<span class="at">url =</span> <span class="st">&quot;https://geoftp.ibge.gov.br/organizacao_do_territorio/malhas_territoriais/malhas_municipais/municipio_2020/Brasil/BR/BR_UF_2020.zip&quot;</span>,        <span class="at">destfile =</span> <span class="st">&quot;BR_UF_2020.zip&quot;</span>)</span></code></pre></div>
<p>Precisamos descompactar o arquivo tipo zip.</p>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb235-1"><a href="#cb235-1" tabindex="-1"></a><span class="co">#para abrir o arquivo zip</span></span>
<span id="cb235-2"><a href="#cb235-2" tabindex="-1"></a><span class="fu">unzip</span>(<span class="at">zipfile =</span> <span class="st">&quot;BR_UF_2020.zip&quot;</span>)</span></code></pre></div>
<p>Fazemos a leitura do arquivo shapefile no <strong>R</strong>. O arquivo receberá o nome de UFBR.</p>
<div class="sourceCode" id="cb236"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb236-1"><a href="#cb236-1" tabindex="-1"></a><span class="co">#para abrir o arquivo shapefile dos estados</span></span>
<span id="cb236-2"><a href="#cb236-2" tabindex="-1"></a>UFBR <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">&quot;./BR_UF_2020.shp&quot;</span>)</span></code></pre></div>
<pre><code>## Reading layer `BR_UF_2020&#39; from data source 
##   `C:\Users\l_viz\Documents\RCartoTematica\BR_UF_2020.shp&#39; 
##   using driver `ESRI Shapefile&#39;
## Simple feature collection with 27 features and 4 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: -73.99045 ymin: -33.75118 xmax: -28.84764 ymax: 5.271841
## Geodetic CRS:  SIRGAS 2000</code></pre>
<p>A função <strong>head</strong> fornece uma série de informações, tais como os limites e o CRS.</p>
<div class="sourceCode" id="cb238"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb238-1"><a href="#cb238-1" tabindex="-1"></a><span class="co">#para ver informações do objeto</span></span>
<span id="cb238-2"><a href="#cb238-2" tabindex="-1"></a><span class="fu">head</span>(UFBR)</span></code></pre></div>
<pre><code>## Simple feature collection with 6 features and 4 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: -73.99045 ymin: -13.6937 xmax: -46.06142 ymax: 5.271841
## Geodetic CRS:  SIRGAS 2000
##   CD_UF    NM_UF SIGLA_UF NM_REGIAO                       geometry
## 1    11 Rondônia       RO     Norte MULTIPOLYGON (((-65.3815 -1...
## 2    12     Acre       AC     Norte MULTIPOLYGON (((-71.07772 -...
## 3    13 Amazonas       AM     Norte MULTIPOLYGON (((-69.83766 -...
## 4    14  Roraima       RR     Norte MULTIPOLYGON (((-63.96008 2...
## 5    15     Pará       PA     Norte MULTIPOLYGON (((-51.43248 -...
## 6    16    Amapá       AP     Norte MULTIPOLYGON (((-50.45011 2...</code></pre>
<p>Observe que o CRS é SIRGAS 2000.
Para ver a unidade de medida do arquivo UFBR.</p>
<div class="sourceCode" id="cb240"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb240-1"><a href="#cb240-1" tabindex="-1"></a><span class="fu">st_crs</span>(UFBR)<span class="sc">$</span>units_gdal</span></code></pre></div>
<pre><code>## [1] &quot;degree&quot;</code></pre>
<p>Vamos solicitar a visualização das colunas de UFBR.</p>
<div class="sourceCode" id="cb242"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb242-1"><a href="#cb242-1" tabindex="-1"></a><span class="co">#para visualizar os mapas de UFBR</span></span>
<span id="cb242-2"><a href="#cb242-2" tabindex="-1"></a><span class="fu">plot</span>(UFBR)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-108-1.png" width="672" /></p>
<p>Para saber o tipo de dados de UFBR, usamos a função <strong>class</strong>.</p>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb243-1"><a href="#cb243-1" tabindex="-1"></a><span class="fu">class</span>(UFBR)</span></code></pre></div>
<pre><code>## [1] &quot;sf&quot;         &quot;data.frame&quot;</code></pre>
<p>A segunda camada shapefile que precisamos é a de potencial de agressividade climática na Amazônia, que se encontra no site do IBGE.</p>
<div class="sourceCode" id="cb245"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb245-1"><a href="#cb245-1" tabindex="-1"></a><span class="co">#para fazer o download do arquivo da Amazônia</span></span>
<span id="cb245-2"><a href="#cb245-2" tabindex="-1"></a><span class="fu">download.file</span>(<span class="at">url =</span> <span class="st">&quot;https://geoftp.ibge.gov.br/informacoes_ambientais/climatologia/vetores/regionais/shapes_potencial_agressividade_climatica.zip&quot;</span>,</span>
<span id="cb245-3"><a href="#cb245-3" tabindex="-1"></a>              <span class="at">destfile =</span> <span class="st">&quot;shapes_potencial_agressividade_climatica.zip&quot;</span>)</span></code></pre></div>
<p>Usamos a função já conhecida para descompactar o arquivo.</p>
<div class="sourceCode" id="cb246"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb246-1"><a href="#cb246-1" tabindex="-1"></a><span class="co">#para abrir o arquivo zip</span></span>
<span id="cb246-2"><a href="#cb246-2" tabindex="-1"></a><span class="fu">unzip</span>(<span class="at">zipfile =</span> <span class="st">&quot;shapes_potencial_agressividade_climatica.zip&quot;</span>)</span></code></pre></div>
<p>E fazemos a leitura do shapefile no <strong>R</strong>, já atribuindo a projeção SIRGAS 2000 (CRS = 4674).</p>
<div class="sourceCode" id="cb247"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb247-1"><a href="#cb247-1" tabindex="-1"></a><span class="co">#para abrir o arquivo shapefile da Amazonia</span></span>
<span id="cb247-2"><a href="#cb247-2" tabindex="-1"></a>amazonia <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">&quot;./VetoresIntegrados.shp&quot;</span>, <span class="at">crs =</span> <span class="dv">4674</span>)</span></code></pre></div>
<pre><code>## Reading layer `VetoresIntegrados&#39; from data source 
##   `C:\Users\l_viz\Documents\RCartoTematica\VetoresIntegrados.shp&#39; 
##   using driver `ESRI Shapefile&#39;</code></pre>
<pre><code>## Warning: st_crs&lt;- : replacing crs does not reproject data; use
## st_transform for that</code></pre>
<pre><code>## Simple feature collection with 454 features and 2 fields
## Geometry type: POLYGON
## Dimension:     XY
## Bounding box:  xmin: -73.99853 ymin: -18.04267 xmax: -43.98264 ymax: 5.277829
## Geodetic CRS:  SIRGAS 2000</code></pre>
<p>Damos uma olhada nos limites, colunas e projeção do arquivo.</p>
<div class="sourceCode" id="cb251"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb251-1"><a href="#cb251-1" tabindex="-1"></a><span class="co">#para ver as 6 primeiras linhas do arquivo</span></span>
<span id="cb251-2"><a href="#cb251-2" tabindex="-1"></a><span class="fu">head</span>(amazonia)</span></code></pre></div>
<pre><code>## Simple feature collection with 6 features and 2 fields
## Geometry type: POLYGON
## Dimension:     XY
## Bounding box:  xmin: -65.35683 ymin: -18.04267 xmax: -50.22443 ymax: -9.736471
## Geodetic CRS:  SIRGAS 2000
##   Id Classe                       geometry
## 1  0     A2 POLYGON ((-51.72783 -15.548...
## 2  0     A2 POLYGON ((-58.00463 -15.393...
## 3  0     M2 POLYGON ((-59.98223 -11.944...
## 4  0     B2 POLYGON ((-61.47633 -10.528...
## 5  0     M2 POLYGON ((-50.22443 -9.8380...
## 6  0     B2 POLYGON ((-50.37933 -9.8277...</code></pre>
<p>Podemos visualizar o shapefile “amazonia” (Figura @ref(fig:plot-amazon)).</p>
<div class="sourceCode" id="cb253"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb253-1"><a href="#cb253-1" tabindex="-1"></a><span class="co">#para visualizar o arquivo amazonia</span></span>
<span id="cb253-2"><a href="#cb253-2" tabindex="-1"></a><span class="fu">plot</span>(amazonia)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="bookdownproj_files/figure-html/plot-amazon-1.png" alt="Mapa para cada coluna da tabela de dados" width="672" />
<p class="caption">
(#fig:plot-amazon)Mapa para cada coluna da tabela de dados
</p>
</div>
<p>Os objetos que iremos utilizar estão em projeções diferentes: <strong>mundo</strong> (CRS = WGS84), <strong>amazonia</strong> e <strong>UFBR</strong> (CRS = SIRGAS 2000). Como estas projeções são compatíveis, vamos mantê-las como estão.</p>
</div>
<div id="potencial-de-agressividade-climática-na-amazônia-legal-do-brasil" class="section level2 hasAnchor" number="7.2">
<h2 class="hasAnchor"><span class="header-section-number">7.2</span> Potencial de agressividade climática na Amazônia Legal do Brasil<a href="#potencial-de-agressividade-climática-na-amazônia-legal-do-brasil" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Vamos iniciar a elaboração do mapa usando o <strong>ggplot2</strong>.
A primeira camada a ser mapeada será <strong>mundo</strong>. Como um objeto de classe <em>sf</em>, usaremos a função <strong>geom_sf</strong>, indicando a cor do contorno (“white”, branco) e do preenchimento (“grey90”, cinza claro) (Figura @ref(fig:plot-mundo1)).</p>
<div class="sourceCode" id="cb254"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb254-1"><a href="#cb254-1" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb254-2"><a href="#cb254-2" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> mundo, <span class="at">colour =</span> <span class="st">&quot;white&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;grey90&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="bookdownproj_files/figure-html/plot-mundo1-1.png" alt="Mapa-mundi" width="672" />
<p class="caption">
(#fig:plot-mundo1)Mapa-mundi
</p>
</div>
<p>A segunda camada será a dos limites dos estados brasileiros (UFBR), com contorno em cinza médio (grey50) e preenchimento em cinza mais claro do que o contorno (grey85) e leve transparência (alpha = 0.2) (Figura @ref(fig:plot-mundoUF)).</p>
<div class="sourceCode" id="cb255"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb255-1"><a href="#cb255-1" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb255-2"><a href="#cb255-2" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> mundo, <span class="at">colour =</span> <span class="st">&quot;white&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;grey90&quot;</span>)<span class="sc">+</span></span>
<span id="cb255-3"><a href="#cb255-3" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> UFBR, <span class="at">colour =</span> <span class="st">&quot;grey50&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;grey85&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="bookdownproj_files/figure-html/plot-mundoUF-1.png" alt="Mapa-mundi com UFs do Brasil" width="672" />
<p class="caption">
(#fig:plot-mundoUF)Mapa-mundi com UFs do Brasil
</p>
</div>
<p>A terceira camada corresponde à “amazonia”, com o preenchimento da coluna “Classe”, sem contorno dos polígonos (colour = NA). As cores do potencial de agressividade (“Classe”) são preenchidas manualmente com o comando <strong>scale_fill_manual</strong> (Figura @ref(fig:plot-mundoUF-amazon)). Vamos seguir a ordem das cores como em <a href="http://geoftp.ibge.gov.br/cartas_e_mapas/mapas_regionais/sociedade_e_economia/integrado_zee_amazonia_legal/Potencial_de_Agressividade_Climatica.pdf" class="uri">http://geoftp.ibge.gov.br/cartas_e_mapas/mapas_regionais/sociedade_e_economia/integrado_zee_amazonia_legal/Potencial_de_Agressividade_Climatica.pdf</a>.</p>
<div class="sourceCode" id="cb256"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb256-1"><a href="#cb256-1" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb256-2"><a href="#cb256-2" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> mundo, <span class="at">colour =</span> <span class="st">&quot;white&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;grey90&quot;</span>)<span class="sc">+</span></span>
<span id="cb256-3"><a href="#cb256-3" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> UFBR, <span class="at">colour =</span> <span class="st">&quot;grey50&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;grey85&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>)<span class="sc">+</span></span>
<span id="cb256-4"><a href="#cb256-4" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> amazonia, <span class="fu">aes</span>(<span class="at">fill =</span> Classe), <span class="at">colour =</span> <span class="cn">NA</span>)<span class="sc">+</span></span>
<span id="cb256-5"><a href="#cb256-5" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values=</span> <span class="fu">c</span>(<span class="st">&quot;A1&quot;</span> <span class="ot">=</span> <span class="st">&quot;red3&quot;</span>,</span>
<span id="cb256-6"><a href="#cb256-6" tabindex="-1"></a>                              <span class="st">&quot;A2&quot;</span> <span class="ot">=</span> <span class="st">&quot;red1&quot;</span>,</span>
<span id="cb256-7"><a href="#cb256-7" tabindex="-1"></a>                              <span class="st">&quot;M1&quot;</span> <span class="ot">=</span> <span class="st">&quot;darkorange3&quot;</span>,</span>
<span id="cb256-8"><a href="#cb256-8" tabindex="-1"></a>                              <span class="st">&quot;M2&quot;</span> <span class="ot">=</span> <span class="st">&quot;darkorange&quot;</span>,</span>
<span id="cb256-9"><a href="#cb256-9" tabindex="-1"></a>                              <span class="st">&quot;M3&quot;</span> <span class="ot">=</span> <span class="st">&quot;goldenrod1&quot;</span>,</span>
<span id="cb256-10"><a href="#cb256-10" tabindex="-1"></a>                              <span class="st">&quot;B1&quot;</span> <span class="ot">=</span> <span class="st">&quot;chartreuse4&quot;</span>,</span>
<span id="cb256-11"><a href="#cb256-11" tabindex="-1"></a>                              <span class="st">&quot;B2&quot;</span> <span class="ot">=</span> <span class="st">&quot;chartreuse3&quot;</span>,</span>
<span id="cb256-12"><a href="#cb256-12" tabindex="-1"></a>                              <span class="st">&quot;B3&quot;</span> <span class="ot">=</span> <span class="st">&quot;chartreuse1&quot;</span>))</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="bookdownproj_files/figure-html/plot-mundoUF-amazon-1.png" alt="Mapa-mundi com UFs do Brasil e classes de agressividade climática da Amazônia" width="672" />
<p class="caption">
(#fig:plot-mundoUF-amazon)Mapa-mundi com UFs do Brasil e classes de agressividade climática da Amazônia
</p>
</div>
<p>Observamos que o mapa resultante apresenta ordem alfabética das categorias na legenda, apesar de ter sido indicada outra ordem no código. Isso acontece porque para entender que as categorias são ordenadas, o tipo de dado deve ser <strong>factor</strong> e deve ser <strong>ordenado</strong>. Vamos verificar a classe atual da coluna ‘Classe’.</p>
<div class="sourceCode" id="cb257"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb257-1"><a href="#cb257-1" tabindex="-1"></a><span class="fu">class</span>(amazonia<span class="sc">$</span>Classe)</span></code></pre></div>
<pre><code>## [1] &quot;character&quot;</code></pre>
<p>A classe ‘character’ precisa ser convertida para ‘ordened factor’. Vamos convertê-la.</p>
<div class="sourceCode" id="cb259"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb259-1"><a href="#cb259-1" tabindex="-1"></a><span class="co">#para converter em &#39;factor&#39; ordenado</span></span>
<span id="cb259-2"><a href="#cb259-2" tabindex="-1"></a>amazonia<span class="sc">$</span>Classe <span class="ot">&lt;-</span> <span class="fu">as.ordered</span>(amazonia<span class="sc">$</span>Classe)</span>
<span id="cb259-3"><a href="#cb259-3" tabindex="-1"></a></span>
<span id="cb259-4"><a href="#cb259-4" tabindex="-1"></a><span class="co">#para estabelecer a ordem entre os níveis</span></span>
<span id="cb259-5"><a href="#cb259-5" tabindex="-1"></a>amazonia<span class="sc">$</span>Classe <span class="ot">&lt;-</span> <span class="fu">ordered</span>(amazonia<span class="sc">$</span>Classe, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;B3&quot;</span>, <span class="st">&quot;B2&quot;</span>, <span class="st">&quot;B1&quot;</span>, <span class="st">&quot;M3&quot;</span>, <span class="st">&quot;M2&quot;</span>, <span class="st">&quot;M1&quot;</span>, <span class="st">&quot;A2&quot;</span>, <span class="st">&quot;A1&quot;</span>))</span></code></pre></div>
<p>Podemos adicionar o título do mapa, ajustar o tamanho da fonte do título, a cor do fundo, borda do mapa, título da legenda e informações adicionais como a fonte dos dados e os créditos da elaboração do mapa (Figura @ref(fig:plot-creditos)).</p>
<div class="sourceCode" id="cb260"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb260-1"><a href="#cb260-1" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb260-2"><a href="#cb260-2" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> mundo, <span class="at">colour =</span> <span class="st">&quot;white&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;grey90&quot;</span>)<span class="sc">+</span></span>
<span id="cb260-3"><a href="#cb260-3" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> UFBR, <span class="at">colour =</span> <span class="st">&quot;grey50&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;grey85&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>)<span class="sc">+</span></span>
<span id="cb260-4"><a href="#cb260-4" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> amazonia, <span class="fu">aes</span>(<span class="at">fill =</span> Classe), <span class="at">colour =</span> <span class="cn">NA</span>)<span class="sc">+</span></span>
<span id="cb260-5"><a href="#cb260-5" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values=</span> <span class="fu">c</span>(<span class="st">&quot;A1&quot;</span> <span class="ot">=</span> <span class="st">&quot;red3&quot;</span>,</span>
<span id="cb260-6"><a href="#cb260-6" tabindex="-1"></a>                              <span class="st">&quot;A2&quot;</span> <span class="ot">=</span> <span class="st">&quot;red1&quot;</span>,</span>
<span id="cb260-7"><a href="#cb260-7" tabindex="-1"></a>                              <span class="st">&quot;M1&quot;</span> <span class="ot">=</span> <span class="st">&quot;darkorange3&quot;</span>,</span>
<span id="cb260-8"><a href="#cb260-8" tabindex="-1"></a>                              <span class="st">&quot;M2&quot;</span> <span class="ot">=</span> <span class="st">&quot;darkorange&quot;</span>,</span>
<span id="cb260-9"><a href="#cb260-9" tabindex="-1"></a>                              <span class="st">&quot;M3&quot;</span> <span class="ot">=</span> <span class="st">&quot;goldenrod1&quot;</span>,</span>
<span id="cb260-10"><a href="#cb260-10" tabindex="-1"></a>                              <span class="st">&quot;B1&quot;</span> <span class="ot">=</span> <span class="st">&quot;chartreuse4&quot;</span>,</span>
<span id="cb260-11"><a href="#cb260-11" tabindex="-1"></a>                              <span class="st">&quot;B2&quot;</span> <span class="ot">=</span> <span class="st">&quot;chartreuse3&quot;</span>,</span>
<span id="cb260-12"><a href="#cb260-12" tabindex="-1"></a>                              <span class="st">&quot;B3&quot;</span> <span class="ot">=</span> <span class="st">&quot;chartreuse1&quot;</span>))<span class="sc">+</span></span>
<span id="cb260-13"><a href="#cb260-13" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Potencial de agressividade climática na Amazônia Legal&quot;</span>)<span class="sc">+</span></span>
<span id="cb260-14"><a href="#cb260-14" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;aliceblue&quot;</span>),</span>
<span id="cb260-15"><a href="#cb260-15" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">10</span>),</span>
<span id="cb260-16"><a href="#cb260-16" tabindex="-1"></a>        <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>,<span class="at">linewidth =</span> .<span class="dv">1</span>,<span class="at">fill =</span> <span class="cn">NA</span>))<span class="sc">+</span></span>
<span id="cb260-17"><a href="#cb260-17" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">&quot;Potencial&quot;</span>, <span class="at">caption =</span> <span class="st">&quot;Fonte: IBGE (2019) </span><span class="sc">\n</span></span>
<span id="cb260-18"><a href="#cb260-18" tabindex="-1"></a><span class="st">       Elaborado por: @Ligiaviz&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="bookdownproj_files/figure-html/plot-creditos-1.png" alt="Adicionando fonte dos dados e créditos" width="672" />
<p class="caption">
(#fig:plot-creditos)Adicionando fonte dos dados e créditos
</p>
</div>
<p>Observe que agora a legenda segue a ordem estabelecida e não mais a ordem alfabética.
Podemos também, alterar a forma como o nome da categoria aparece na legenda. No lugar de “B3” podemos nomeá-la “Baixa 3”.</p>
<div class="sourceCode" id="cb261"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb261-1"><a href="#cb261-1" tabindex="-1"></a><span class="co">#para recodificar as categorias</span></span>
<span id="cb261-2"><a href="#cb261-2" tabindex="-1"></a>amazonia <span class="ot">&lt;-</span> amazonia <span class="sc">%&gt;%</span> </span>
<span id="cb261-3"><a href="#cb261-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Classe =</span> <span class="fu">recode</span>(Classe,</span>
<span id="cb261-4"><a href="#cb261-4" tabindex="-1"></a>                          <span class="co"># como referência: categoria antiga  = categoria nova</span></span>
<span id="cb261-5"><a href="#cb261-5" tabindex="-1"></a>                          <span class="st">&quot;B3&quot;</span> <span class="ot">=</span> <span class="st">&quot;Baixa 3&quot;</span>,</span>
<span id="cb261-6"><a href="#cb261-6" tabindex="-1"></a>                          <span class="st">&quot;B2&quot;</span>  <span class="ot">=</span> <span class="st">&quot;Baixa 2&quot;</span>,</span>
<span id="cb261-7"><a href="#cb261-7" tabindex="-1"></a>                          <span class="st">&quot;B1&quot;</span> <span class="ot">=</span> <span class="st">&quot;Baixa 1&quot;</span>,</span>
<span id="cb261-8"><a href="#cb261-8" tabindex="-1"></a>                          <span class="st">&quot;M3&quot;</span> <span class="ot">=</span>    <span class="st">&quot;Média 3&quot;</span>,</span>
<span id="cb261-9"><a href="#cb261-9" tabindex="-1"></a>                          <span class="st">&quot;M2&quot;</span> <span class="ot">=</span>    <span class="st">&quot;Média 2&quot;</span>,</span>
<span id="cb261-10"><a href="#cb261-10" tabindex="-1"></a>                          <span class="st">&quot;M1&quot;</span> <span class="ot">=</span> <span class="st">&quot;Média 1&quot;</span>,</span>
<span id="cb261-11"><a href="#cb261-11" tabindex="-1"></a>                         <span class="st">&quot;A2&quot;</span> <span class="ot">=</span> <span class="st">&quot;Alta 2&quot;</span>,</span>
<span id="cb261-12"><a href="#cb261-12" tabindex="-1"></a>                         <span class="st">&quot;A1&quot;</span> <span class="ot">=</span> <span class="st">&quot;Alta 1&quot;</span></span>
<span id="cb261-13"><a href="#cb261-13" tabindex="-1"></a>))</span>
<span id="cb261-14"><a href="#cb261-14" tabindex="-1"></a><span class="fu">unique</span>(amazonia<span class="sc">$</span>Classe)</span></code></pre></div>
<pre><code>## [1] Alta 2  Média 2 Baixa 2 Baixa 3 Média 1 Baixa 1 &lt;NA&gt;    Média 3
## [9] Alta 1 
## 8 Levels: Baixa 3 &lt; Baixa 2 &lt; Baixa 1 &lt; Média 3 &lt; ... &lt; Alta 1</code></pre>
<p>Ainda precisamos de outra camada dos limites das Unidades da Federação para termos ideia da distribuição do potencial de agressividade climática na Amazônia. Aproveitamos também para configurar a legenda, acertando a posição dela no mapa e a cor do fundo, assim como já deixar sem o título do eixo <strong>y</strong>.</p>
<div class="sourceCode" id="cb263"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb263-1"><a href="#cb263-1" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb263-2"><a href="#cb263-2" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> mundo, <span class="at">colour =</span> <span class="st">&quot;white&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;grey90&quot;</span>)<span class="sc">+</span></span>
<span id="cb263-3"><a href="#cb263-3" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> UFBR, <span class="at">colour =</span> <span class="st">&quot;grey50&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;grey85&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>)<span class="sc">+</span></span>
<span id="cb263-4"><a href="#cb263-4" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> amazonia, <span class="fu">aes</span>(<span class="at">fill =</span> Classe), <span class="at">colour =</span> <span class="cn">NA</span>)<span class="sc">+</span></span>
<span id="cb263-5"><a href="#cb263-5" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values=</span> <span class="fu">c</span>(<span class="st">&quot;Alta 1&quot;</span> <span class="ot">=</span> <span class="st">&quot;red3&quot;</span>,</span>
<span id="cb263-6"><a href="#cb263-6" tabindex="-1"></a>                              <span class="st">&quot;Alta 2&quot;</span> <span class="ot">=</span> <span class="st">&quot;red1&quot;</span>,</span>
<span id="cb263-7"><a href="#cb263-7" tabindex="-1"></a>                              <span class="st">&quot;Média 1&quot;</span> <span class="ot">=</span> <span class="st">&quot;darkorange3&quot;</span>,</span>
<span id="cb263-8"><a href="#cb263-8" tabindex="-1"></a>                              <span class="st">&quot;Média 2&quot;</span> <span class="ot">=</span> <span class="st">&quot;darkorange&quot;</span>,</span>
<span id="cb263-9"><a href="#cb263-9" tabindex="-1"></a>                              <span class="st">&quot;Média 3&quot;</span> <span class="ot">=</span> <span class="st">&quot;goldenrod1&quot;</span>,</span>
<span id="cb263-10"><a href="#cb263-10" tabindex="-1"></a>                              <span class="st">&quot;Baixa 1&quot;</span> <span class="ot">=</span> <span class="st">&quot;chartreuse4&quot;</span>,</span>
<span id="cb263-11"><a href="#cb263-11" tabindex="-1"></a>                              <span class="st">&quot;Baixa 2&quot;</span> <span class="ot">=</span> <span class="st">&quot;chartreuse3&quot;</span>,</span>
<span id="cb263-12"><a href="#cb263-12" tabindex="-1"></a>                              <span class="st">&quot;Baixa 3&quot;</span> <span class="ot">=</span> <span class="st">&quot;chartreuse1&quot;</span>))<span class="sc">+</span></span>
<span id="cb263-13"><a href="#cb263-13" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Potencial de agressividade climática na Amazônia Legal&quot;</span>)<span class="sc">+</span></span>
<span id="cb263-14"><a href="#cb263-14" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;aliceblue&quot;</span>),</span>
<span id="cb263-15"><a href="#cb263-15" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">10</span>),</span>
<span id="cb263-16"><a href="#cb263-16" tabindex="-1"></a>        <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>,<span class="at">size =</span> .<span class="dv">1</span>,<span class="at">fill =</span> <span class="cn">NA</span>))<span class="sc">+</span></span>
<span id="cb263-17"><a href="#cb263-17" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">&quot;Potencial&quot;</span>, <span class="at">caption =</span> <span class="st">&quot;Fonte: IBGE (2019) </span><span class="sc">\n</span></span>
<span id="cb263-18"><a href="#cb263-18" tabindex="-1"></a><span class="st">       Elaborado por: @Ligiaviz&quot;</span>)<span class="sc">+</span></span>
<span id="cb263-19"><a href="#cb263-19" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> UFBR, <span class="at">colour =</span> <span class="st">&quot;grey50&quot;</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">alpha =</span> <span class="dv">0</span>)<span class="sc">+</span></span>
<span id="cb263-20"><a href="#cb263-20" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.9</span>, <span class="fl">0.2</span>), </span>
<span id="cb263-21"><a href="#cb263-21" tabindex="-1"></a>        <span class="at">legend.justification =</span> <span class="fu">c</span>(<span class="fl">0.9</span>, <span class="fl">0.2</span>),</span>
<span id="cb263-22"><a href="#cb263-22" tabindex="-1"></a>        <span class="at">legend.background =</span> <span class="fu">element_rect</span>(<span class="at">colour =</span> <span class="cn">NA</span>, <span class="at">fill =</span> <span class="st">&quot;aliceblue&quot;</span>),</span>
<span id="cb263-23"><a href="#cb263-23" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="bookdownproj_files/figure-html/plot-uf-legenda-1.png" alt="Mapa com correção da legenda e limites das UFs" width="672" />
<p class="caption">
(#fig:plot-uf-legenda)Mapa com correção da legenda e limites das UFs
</p>
</div>
<p>A delimitação da área do mapa e outros elementos como a linha do Equador também podem ser definidos agora. A última linha do código define a escala gráfica (Figura @ref(fig:plot-final)).</p>
<div class="sourceCode" id="cb264"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb264-1"><a href="#cb264-1" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb264-2"><a href="#cb264-2" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> mundo, <span class="at">colour =</span> <span class="st">&quot;white&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;grey90&quot;</span>)<span class="sc">+</span></span>
<span id="cb264-3"><a href="#cb264-3" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> UFBR, <span class="at">colour =</span> <span class="st">&quot;grey50&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;grey85&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>)<span class="sc">+</span></span>
<span id="cb264-4"><a href="#cb264-4" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> amazonia, <span class="fu">aes</span>(<span class="at">fill =</span> Classe), <span class="at">colour =</span> <span class="cn">NA</span>)<span class="sc">+</span></span>
<span id="cb264-5"><a href="#cb264-5" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values=</span> <span class="fu">c</span>(<span class="st">&quot;Alta 1&quot;</span> <span class="ot">=</span> <span class="st">&quot;red3&quot;</span>,</span>
<span id="cb264-6"><a href="#cb264-6" tabindex="-1"></a>                              <span class="st">&quot;Alta 2&quot;</span> <span class="ot">=</span> <span class="st">&quot;red1&quot;</span>,</span>
<span id="cb264-7"><a href="#cb264-7" tabindex="-1"></a>                              <span class="st">&quot;Média 1&quot;</span> <span class="ot">=</span> <span class="st">&quot;darkorange3&quot;</span>,</span>
<span id="cb264-8"><a href="#cb264-8" tabindex="-1"></a>                              <span class="st">&quot;Média 2&quot;</span> <span class="ot">=</span> <span class="st">&quot;darkorange&quot;</span>,</span>
<span id="cb264-9"><a href="#cb264-9" tabindex="-1"></a>                              <span class="st">&quot;Média 3&quot;</span> <span class="ot">=</span> <span class="st">&quot;goldenrod1&quot;</span>,</span>
<span id="cb264-10"><a href="#cb264-10" tabindex="-1"></a>                              <span class="st">&quot;Baixa 1&quot;</span> <span class="ot">=</span> <span class="st">&quot;chartreuse4&quot;</span>,</span>
<span id="cb264-11"><a href="#cb264-11" tabindex="-1"></a>                              <span class="st">&quot;Baixa 2&quot;</span> <span class="ot">=</span> <span class="st">&quot;chartreuse3&quot;</span>,</span>
<span id="cb264-12"><a href="#cb264-12" tabindex="-1"></a>                              <span class="st">&quot;Baixa 3&quot;</span> <span class="ot">=</span> <span class="st">&quot;chartreuse1&quot;</span>))<span class="sc">+</span></span>
<span id="cb264-13"><a href="#cb264-13" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Potencial de agressividade climática na Amazônia Legal&quot;</span>)<span class="sc">+</span></span>
<span id="cb264-14"><a href="#cb264-14" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;aliceblue&quot;</span>),</span>
<span id="cb264-15"><a href="#cb264-15" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">10</span>),</span>
<span id="cb264-16"><a href="#cb264-16" tabindex="-1"></a>        <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>,<span class="at">size =</span> .<span class="dv">1</span>,<span class="at">fill =</span> <span class="cn">NA</span>))<span class="sc">+</span></span>
<span id="cb264-17"><a href="#cb264-17" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">&quot;Potencial&quot;</span>, <span class="at">caption =</span> <span class="st">&quot;Fonte: IBGE (2019) </span><span class="sc">\n</span></span>
<span id="cb264-18"><a href="#cb264-18" tabindex="-1"></a><span class="st">       Elaborado por: @Ligiaviz&quot;</span>)<span class="sc">+</span></span>
<span id="cb264-19"><a href="#cb264-19" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> UFBR, <span class="at">colour =</span> <span class="st">&quot;grey50&quot;</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">alpha =</span> <span class="dv">0</span>)<span class="sc">+</span></span>
<span id="cb264-20"><a href="#cb264-20" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.9</span>, <span class="fl">0.2</span>), </span>
<span id="cb264-21"><a href="#cb264-21" tabindex="-1"></a>        <span class="at">legend.justification =</span> <span class="fu">c</span>(<span class="fl">0.9</span>, <span class="fl">0.2</span>),</span>
<span id="cb264-22"><a href="#cb264-22" tabindex="-1"></a>        <span class="at">legend.background =</span> <span class="fu">element_rect</span>(<span class="at">colour =</span> <span class="cn">NA</span>, <span class="at">fill =</span> <span class="st">&quot;aliceblue&quot;</span>),</span>
<span id="cb264-23"><a href="#cb264-23" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>())<span class="sc">+</span></span>
<span id="cb264-24"><a href="#cb264-24" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">77</span>, <span class="sc">-</span><span class="dv">24</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">20</span>, <span class="dv">7</span>), <span class="at">expand =</span> <span class="cn">FALSE</span>)<span class="sc">+</span></span>
<span id="cb264-25"><a href="#cb264-25" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>)<span class="sc">+</span></span>
<span id="cb264-26"><a href="#cb264-26" tabindex="-1"></a>  ggspatial<span class="sc">::</span><span class="fu">annotation_scale</span>(<span class="at">location =</span> <span class="st">&quot;bl&quot;</span>, <span class="at">width_hint =</span> <span class="fl">0.3</span>, <span class="at">line_width =</span> <span class="fl">0.5</span>, <span class="at">height =</span> <span class="fu">unit</span>(<span class="fl">0.1</span>,<span class="st">&quot;cm&quot;</span>))</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="bookdownproj_files/figure-html/plot-final-1.png" alt="Mapa completo: recorte da área de interesse, escala gráfica e linha do Equador" width="672" />
<p class="caption">
(#fig:plot-final)Mapa completo: recorte da área de interesse, escala gráfica e linha do Equador
</p>
</div>
<p>Para exportar como arquivo de extensão <strong>png</strong>, usa-se o comando a seguir.</p>
<div class="sourceCode" id="cb265"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb265-1"><a href="#cb265-1" tabindex="-1"></a><span class="co">#para salvar o arquivo com extensao .png</span></span>
<span id="cb265-2"><a href="#cb265-2" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">&quot;agressividade.png&quot;</span>, <span class="at">width =</span> <span class="dv">8</span>, <span class="at">height =</span> <span class="dv">8</span>, <span class="at">dpi =</span> <span class="dv">300</span>)</span></code></pre></div>
<!--chapter:end:07-coroc-ordinal.Rmd-->
</div>
</div>
<div id="quanti1" class="section level1 hasAnchor" number="8">
<h1 class="hasAnchor"><span class="header-section-number">8</span> Dados quantitativos absolutos: mapa das figuras geométricas proporcionais<a href="#quanti1" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Quando queremos transcrever graficamente dados quantitativos ou numéricos que expressam uma medida ou contagem, dois tipos de representação cartográfica são indicadas: o mapa de figuras geométricas proporcionais e o mapa dos pontos de contagem (também conhecido por densidade de pontos).
A escolha pela utilização de um ou outro depende do tipo de fenômeno a ser representado e da magnitude dos valores. As figuras geométricas proporcionais (em geral, o círculo é a figura mais utilizada) utilizam a variável visual “tamanho” e permitem perceber diferenças entre as proporções de forma imediata. Os pontos de contagem também utilizam a variável visual “tamanho” e possibilitam estabelecer relação entre a variável de interesse e a área do polígono, remetendo à ideia de densidade.</p>
<p>Neste tópico trataremos da representação por meio de círculos proporcionais da população do estado de São Paulo em 2022, segundo município. Como os dados de população correspondem a cada município como um todo (área urbana e rural), o círculo deverá estar localizado nas coordenadas dos centróides dos municípios.</p>
<div id="bases-de-dados" class="section level2 hasAnchor" number="8.1">
<h2 class="hasAnchor"><span class="header-section-number">8.1</span> Bases de dados<a href="#bases-de-dados" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Iniciamos limpando a memória.</p>
<div class="sourceCode" id="cb266"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb266-1"><a href="#cb266-1" tabindex="-1"></a><span class="co">#para limpar a memoria</span></span>
<span id="cb266-2"><a href="#cb266-2" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">ls</span>())</span></code></pre></div>
<p>Definimos com <code>setwd()</code>e verificamos o diretório de trabalho com <code>getwd()</code>.</p>
<div class="sourceCode" id="cb267"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb267-1"><a href="#cb267-1" tabindex="-1"></a><span class="co">#para verificar o diretório</span></span>
<span id="cb267-2"><a href="#cb267-2" tabindex="-1"></a><span class="fu">getwd</span>()</span></code></pre></div>
<p>Para evitar textos com erros devido à acentuação, vamos ajustar para a língua portuguesa.</p>
<div class="sourceCode" id="cb268"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb268-1"><a href="#cb268-1" tabindex="-1"></a><span class="co">#para ajustar a língua para português usando a função</span></span>
<span id="cb268-2"><a href="#cb268-2" tabindex="-1"></a><span class="fu">Sys.setlocale</span>(<span class="at">category =</span> <span class="st">&quot;LC_ALL&quot;</span>, <span class="at">locale =</span> <span class="st">&quot;pt_BR.UTF-8&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;LC_COLLATE=pt_BR.UTF-8;LC_CTYPE=pt_BR.UTF-8;LC_MONETARY=pt_BR.UTF-8;LC_NUMERIC=C;LC_TIME=pt_BR.UTF-8&quot;</code></pre>
<p>Outro ajuste importante será a desativação da notação científica dos números na legenda.</p>
<div class="sourceCode" id="cb270"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb270-1"><a href="#cb270-1" tabindex="-1"></a><span class="co">#para desativar a notação científica</span></span>
<span id="cb270-2"><a href="#cb270-2" tabindex="-1"></a><span class="fu">options</span>(<span class="at">scipen =</span> <span class="dv">999</span>)</span></code></pre></div>
<p>Carregamos os pacotes que serão utilizados.</p>
<div class="sourceCode" id="cb271"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb271-1"><a href="#cb271-1" tabindex="-1"></a><span class="co">#para carregar os pacotes que serão usados</span></span>
<span id="cb271-2"><a href="#cb271-2" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb271-3"><a href="#cb271-3" tabindex="-1"></a><span class="fu">library</span>(geobr)</span>
<span id="cb271-4"><a href="#cb271-4" tabindex="-1"></a><span class="fu">library</span>(ggplot2,<span class="at">warn.conflicts=</span><span class="cn">FALSE</span>)</span>
<span id="cb271-5"><a href="#cb271-5" tabindex="-1"></a><span class="fu">library</span>(scales)</span></code></pre></div>
<p>Usaremos a base de dados de população do Portal da Fundação SEADE. Para baixar o arquivo compactado, usamos a linha de código a seguir.</p>
<div class="sourceCode" id="cb272"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb272-1"><a href="#cb272-1" tabindex="-1"></a><span class="co">#para identificar o url, faca o download do arquivo shapefile e clique em Ctrl+J</span></span>
<span id="cb272-2"><a href="#cb272-2" tabindex="-1"></a><span class="fu">download.file</span>(<span class="at">url =</span> <span class="st">&quot;https://repositorio.seade.gov.br/dataset/9bb4f8ef-f1a4-4734-92a2-814cfc8d0974/resource/09ba3695-a6a1-44ab-9916-fd1a8aa1c980/download/populacao.zip&quot;</span>, <span class="at">destfile =</span> <span class="st">&quot;Populacao.zip&quot;</span>)</span></code></pre></div>
<p>Para descompactar o arquivo, usamos a função <strong>unzip</strong>.</p>
<div class="sourceCode" id="cb273"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb273-1"><a href="#cb273-1" tabindex="-1"></a><span class="co">#para abrir o arquivo zip</span></span>
<span id="cb273-2"><a href="#cb273-2" tabindex="-1"></a><span class="fu">unzip</span>(<span class="at">zipfile =</span> <span class="st">&quot;Populacao.zip&quot;</span>)</span></code></pre></div>
<p>Na sequência, criamos o objeto <strong>pop</strong> usando a função para leitura de arquivo do tipo shapefile.</p>
<div class="sourceCode" id="cb274"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb274-1"><a href="#cb274-1" tabindex="-1"></a><span class="co">#para abrir o arquivo shapefile do estado de São Paulo </span></span>
<span id="cb274-2"><a href="#cb274-2" tabindex="-1"></a>pop <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">&quot;./Populacao.shp&quot;</span>)</span></code></pre></div>
<pre><code>## Reading layer `Populacao&#39; from data source 
##   `C:\Users\l_viz\Documents\RCartoTematica\Populacao.shp&#39; 
##   using driver `ESRI Shapefile&#39;
## Simple feature collection with 645 features and 12 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: -53.10487 ymin: -25.30835 xmax: -44.1634 ymax: -19.78045
## Geodetic CRS:  SIRGAS 2000</code></pre>
<p>Podemos ver as colunas de <strong>pop</strong> com a função <strong>names(pop)</strong>.</p>
<div class="sourceCode" id="cb276"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb276-1"><a href="#cb276-1" tabindex="-1"></a><span class="co">#para ver as colunas de &#39;pop&#39;</span></span>
<span id="cb276-2"><a href="#cb276-2" tabindex="-1"></a><span class="fu">names</span>(pop)</span></code></pre></div>
<pre><code>##  [1] &quot;Cod_ibge&quot; &quot;Nome&quot;     &quot;Rotulo&quot;   &quot;Area_Km2&quot; &quot;Den_Demo&quot; &quot;Pop&quot;     
##  [7] &quot;RA&quot;       &quot;RG&quot;       &quot;RM&quot;       &quot;AU&quot;       &quot;RGI&quot;      &quot;RGINT&quot;   
## [13] &quot;geometry&quot;</code></pre>
<p>O objeto <strong>pop</strong> está na projeção cartográfica SIRGAS 2000. Vamos passá-lo para WGS84 pseudo Mercator (CRS = 3857).</p>
<div class="sourceCode" id="cb278"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb278-1"><a href="#cb278-1" tabindex="-1"></a><span class="co">#para transformar para a projeção em WGS84 pseudo Mercator (crs=3857)</span></span>
<span id="cb278-2"><a href="#cb278-2" tabindex="-1"></a>pop_wgs84 <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(pop, <span class="at">crs=</span> <span class="dv">3857</span>)</span></code></pre></div>
<p>Vamos precisar dos polígonos das Unidades da Federação, que podem ser obtidos no site do IBGE.</p>
<div class="sourceCode" id="cb279"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb279-1"><a href="#cb279-1" tabindex="-1"></a><span class="co">#para identificar o url, faca o download do arquivo shapefile e clique em Ctrl+J</span></span>
<span id="cb279-2"><a href="#cb279-2" tabindex="-1"></a><span class="fu">download.file</span>(<span class="at">url =</span> <span class="st">&quot;https://geoftp.ibge.gov.br/organizacao_do_territorio/malhas_territoriais/malhas_municipais/municipio_2020/Brasil/BR/BR_UF_2020.zip&quot;</span>, <span class="at">destfile =</span> <span class="st">&quot;BR_UF_2020.zip&quot;</span>)</span></code></pre></div>
<p>Usamos a função <strong>unzip</strong> para extrair o arquivo.</p>
<div class="sourceCode" id="cb280"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb280-1"><a href="#cb280-1" tabindex="-1"></a><span class="co">#para abrir o arquivo zip</span></span>
<span id="cb280-2"><a href="#cb280-2" tabindex="-1"></a><span class="fu">unzip</span>(<span class="at">zipfile =</span> <span class="st">&quot;BR_UF_2020.zip&quot;</span>)</span></code></pre></div>
<p>Para ler o arquivo no <strong>R</strong>, usamos <strong>st_read</strong>.</p>
<div class="sourceCode" id="cb281"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb281-1"><a href="#cb281-1" tabindex="-1"></a><span class="co">#para abrir o arquivo shapefile dos estados</span></span>
<span id="cb281-2"><a href="#cb281-2" tabindex="-1"></a>UFBR <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">&quot;./BR_UF_2020.shp&quot;</span>)</span></code></pre></div>
<pre><code>## Reading layer `BR_UF_2020&#39; from data source 
##   `C:\Users\l_viz\Documents\RCartoTematica\BR_UF_2020.shp&#39; 
##   using driver `ESRI Shapefile&#39;
## Simple feature collection with 27 features and 4 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: -73.99045 ymin: -33.75118 xmax: -28.84764 ymax: 5.271841
## Geodetic CRS:  SIRGAS 2000</code></pre>
<p>Para que fiquem na mesma projeção, transformamos UFBR para WGS84 pseudo Mercator.</p>
<div class="sourceCode" id="cb283"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb283-1"><a href="#cb283-1" tabindex="-1"></a><span class="co">#para transformar a projeção de &#39;UFBR&#39; para WGS84</span></span>
<span id="cb283-2"><a href="#cb283-2" tabindex="-1"></a>UFBRwgs84<span class="ot">&lt;-</span> <span class="fu">st_transform</span>(UFBR, <span class="at">crs=</span> <span class="dv">3857</span>)</span></code></pre></div>
<p>Podemos verificar o tipo de geometria do objeto <strong>pop_wgs84</strong> usando a função <strong>st_geometry_type</strong>.</p>
<div class="sourceCode" id="cb284"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb284-1"><a href="#cb284-1" tabindex="-1"></a><span class="co">#para ver o tipo de geometria de &#39;pop_wgs84&#39;</span></span>
<span id="cb284-2"><a href="#cb284-2" tabindex="-1"></a><span class="fu">st_geometry_type</span>(pop_wgs84, <span class="at">by_geometry=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## [1] MULTIPOLYGON
## 18 Levels: GEOMETRY POINT LINESTRING POLYGON ... TRIANGLE</code></pre>
</div>
<div id="centroides-dos-municípios" class="section level2 hasAnchor" number="8.2">
<h2 class="hasAnchor"><span class="header-section-number">8.2</span> Centroides dos municípios<a href="#centroides-dos-municípios" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Para utilizarmos os círculos proporcionais, precisaremos gerar as coordenadas dos centroides dos polígonos dos municípios, criando um objeto com geometria de ponto. Isto pode ser feito com a função <strong>st_centroid</strong>.</p>
<div class="sourceCode" id="cb286"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb286-1"><a href="#cb286-1" tabindex="-1"></a><span class="co">#para criar o objeto &#39;pop_centrd&#39; que contém os pontos dos centroides</span></span>
<span id="cb286-2"><a href="#cb286-2" tabindex="-1"></a>pop_centrd <span class="ot">=</span> <span class="fu">st_centroid</span>(pop_wgs84)</span></code></pre></div>
<p>Conferimos o tipo de geometria de <strong>pop_centrd</strong>.</p>
<div class="sourceCode" id="cb287"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb287-1"><a href="#cb287-1" tabindex="-1"></a><span class="co">#para ver o tipo de geometria de &#39;pop_centrd&#39;</span></span>
<span id="cb287-2"><a href="#cb287-2" tabindex="-1"></a><span class="fu">st_geometry_type</span>(pop_centrd, <span class="at">by_geometry =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## [1] POINT
## 18 Levels: GEOMETRY POINT LINESTRING POLYGON ... TRIANGLE</code></pre>
<p>Temos agora três camadas que serão usadas para a elaboração do mapa, que deverão ser adicionadas na seguinte ordem:</p>
<ol style="list-style-type: decimal">
<li><p>Unidades da Federação: UFBRwgs84;</p></li>
<li><p>Arquivo dos polígonos dos municípios do estado de São Paulo com os dados das populações de todos os municípios: pop_wgs84</p></li>
<li><p>Arquivo de pontos das coordenadas dos centroides dos municípios: pop_centrd.</p></li>
</ol>
</div>
<div id="mapa-da-população-do-estado-de-são-paulo" class="section level2 hasAnchor" number="8.3">
<h2 class="hasAnchor"><span class="header-section-number">8.3</span> Mapa da população do estado de São Paulo<a href="#mapa-da-população-do-estado-de-são-paulo" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Vamos usar o pacote <strong>ggplot2</strong> para fazer o mapa (Figura @ref(fig:plot-brasil-ufs)). Começamos adicionando a camada das UFs, preenchendo com cinza claro (fill = “gray95”) e contorno com cinza médio (colour = “grey50”). Alpha varia de 0 a 1, sendo 1 o valor para indicar nenhuma transparência.</p>
<div class="sourceCode" id="cb289"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb289-1"><a href="#cb289-1" tabindex="-1"></a><span class="co">#para plotar o mapa das UFs do Brasil</span></span>
<span id="cb289-2"><a href="#cb289-2" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb289-3"><a href="#cb289-3" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> UFBRwgs84, <span class="at">colour =</span> <span class="st">&quot;grey50&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;gray95&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="bookdownproj_files/figure-html/plot-brasil-ufs-1.png" alt="Mapa do Brasil com os limites das Unidades das Federações" width="672" />
<p class="caption">
(#fig:plot-brasil-ufs)Mapa do Brasil com os limites das Unidades das Federações
</p>
</div>
<p>Adicionamos a segunda camada, escolhendo a cor de preenchimento dos polígonos dos municípios (fill = “beige”), do contorno (color = “black”) e espessura da linha de contorno (size = 0.25) (Figura @ref(fig:plot-brasil-ufsp)).</p>
<div class="sourceCode" id="cb290"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb290-1"><a href="#cb290-1" tabindex="-1"></a><span class="co">#para plotar o mapa das UFs e dos municípios da UF São Paulo</span></span>
<span id="cb290-2"><a href="#cb290-2" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb290-3"><a href="#cb290-3" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> UFBRwgs84, <span class="at">colour =</span> <span class="st">&quot;grey50&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;gray95&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>)<span class="sc">+</span></span>
<span id="cb290-4"><a href="#cb290-4" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> pop_wgs84, <span class="at">fill =</span> <span class="st">&quot;beige&quot;</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">size =</span> <span class="fl">0.25</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="bookdownproj_files/figure-html/plot-brasil-ufsp-1.png" alt="Mapa do Brasil com os limites das Unidades das Federações e municípios da UF São Paulo" width="672" />
<p class="caption">
(#fig:plot-brasil-ufsp)Mapa do Brasil com os limites das Unidades das Federações e municípios da UF São Paulo
</p>
</div>
<p>A terceira camada, os pontos sobre os quais serão desenhados os círculos proporcionais, deverá indicar qual variável será mapeada como círculo (size = Pop). Lembre-se que o nome da coluna não vem entre aspas. A cor (color = “tomato”), a transparência (alpha = 0.8) e se a legenda deverá aparecer são definidos na mesma camada (Figura @ref(fig:plot-pop-ufsp)).</p>
<div class="sourceCode" id="cb291"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb291-1"><a href="#cb291-1" tabindex="-1"></a><span class="co">#para plotar o mapa das UFs, dos municípios da UF São Paulo e centroides com dados da população</span></span>
<span id="cb291-2"><a href="#cb291-2" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb291-3"><a href="#cb291-3" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> UFBRwgs84, <span class="at">colour =</span> <span class="st">&quot;grey50&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;gray95&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>)<span class="sc">+</span></span>
<span id="cb291-4"><a href="#cb291-4" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> pop_wgs84, <span class="at">fill =</span> <span class="st">&quot;beige&quot;</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">size =</span> <span class="fl">0.25</span>) <span class="sc">+</span></span>
<span id="cb291-5"><a href="#cb291-5" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> pop_centrd, <span class="fu">aes</span>(<span class="at">size =</span> Pop), <span class="at">color =</span> <span class="st">&quot;tomato&quot;</span>, <span class="at">alpha=</span><span class="fl">0.8</span>, <span class="at">show.legend =</span> <span class="st">&quot;point&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="bookdownproj_files/figure-html/plot-pop-ufsp-1.png" alt="Mapa do Brasil com os limites das Unidades das Federações e população dos municípios da UF São Paulo" width="672" />
<p class="caption">
(#fig:plot-pop-ufsp)Mapa do Brasil com os limites das Unidades das Federações e população dos municípios da UF São Paulo
</p>
</div>
<p>Após a definição das camadas, outras configurações podem ser feitas. Vamos definir as características relacionadas aos círculos. Para isso, usamos a função <strong>scale_size</strong>. Definimos o título que acompanha a legenda (name = “Habitantes”), a faixa dos tamanhos dos círculos (o menor como 0 e o maior como 10) (range = c(0, 10)) e os cortes dos tamanhos dos círculos (breaks = c(10000, 100000, 1000000, 10000000)) (Figura @ref(fig:plot-pop-config)).</p>
<div class="sourceCode" id="cb292"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb292-1"><a href="#cb292-1" tabindex="-1"></a><span class="co">#para plotar o mapa das UFs, dos municípios da UF São Paulo, centroides com dados da população e ajustar a legenda</span></span>
<span id="cb292-2"><a href="#cb292-2" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb292-3"><a href="#cb292-3" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> UFBRwgs84, <span class="at">colour =</span> <span class="st">&quot;grey50&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;gray95&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>)<span class="sc">+</span></span>
<span id="cb292-4"><a href="#cb292-4" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> pop_wgs84, <span class="at">fill =</span> <span class="st">&quot;beige&quot;</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">size =</span> <span class="fl">0.25</span>) <span class="sc">+</span></span>
<span id="cb292-5"><a href="#cb292-5" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> pop_centrd, <span class="fu">aes</span>(<span class="at">size =</span> Pop), <span class="at">color =</span> <span class="st">&quot;tomato&quot;</span>, <span class="at">alpha=</span><span class="fl">0.8</span>, <span class="at">show.legend =</span> <span class="st">&quot;point&quot;</span>)<span class="sc">+</span></span>
<span id="cb292-6"><a href="#cb292-6" tabindex="-1"></a>  <span class="fu">scale_size</span>(<span class="at">name=</span><span class="st">&quot;Habitantes&quot;</span>, <span class="at">range =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">10000</span>, <span class="dv">100000</span>, <span class="dv">1000000</span>, <span class="dv">10000000</span>))</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="bookdownproj_files/figure-html/plot-pop-config-1.png" alt="Configurações da legenda" width="672" />
<p class="caption">
(#fig:plot-pop-config)Configurações da legenda
</p>
</div>
<p>Acrescentamos o título do mapa (ggtitle(“População do estado de São Paulo em 2022”)) (Figura @ref(fig:plot-pop-title)).</p>
<div class="sourceCode" id="cb293"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb293-1"><a href="#cb293-1" tabindex="-1"></a><span class="co">#para plotar o mapa das UFs, dos municípios da UF São Paulo, centroides com dados da população, ajustar a legenda e adicionar o título</span></span>
<span id="cb293-2"><a href="#cb293-2" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb293-3"><a href="#cb293-3" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> UFBRwgs84, <span class="at">colour =</span> <span class="st">&quot;grey50&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;gray95&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>)<span class="sc">+</span></span>
<span id="cb293-4"><a href="#cb293-4" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> pop_wgs84, <span class="at">fill =</span> <span class="st">&quot;beige&quot;</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">size =</span> <span class="fl">0.25</span>) <span class="sc">+</span></span>
<span id="cb293-5"><a href="#cb293-5" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> pop_centrd, <span class="fu">aes</span>(<span class="at">size =</span> Pop), <span class="at">color =</span> <span class="st">&quot;tomato&quot;</span>, <span class="at">alpha=</span><span class="fl">0.8</span>, <span class="at">show.legend =</span> <span class="st">&quot;point&quot;</span>)<span class="sc">+</span></span>
<span id="cb293-6"><a href="#cb293-6" tabindex="-1"></a>  <span class="fu">scale_size</span>(<span class="at">name=</span><span class="st">&quot;Habitantes&quot;</span>, <span class="at">range =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">10000</span>, <span class="dv">100000</span>, <span class="dv">1000000</span>, <span class="dv">10000000</span>))<span class="sc">+</span></span>
<span id="cb293-7"><a href="#cb293-7" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;População do estado de São Paulo em 2022&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="bookdownproj_files/figure-html/plot-pop-title-1.png" alt="Título do mapa" width="672" />
<p class="caption">
(#fig:plot-pop-title)Título do mapa
</p>
</div>
<p>Em relação aos elementos da moldura do mapa, usamos a função <strong>theme</strong>. Vamos definir a cor de fundo em azul claro para remeter ao Oceano (panel.background = element_rect(fill = “aliceblue”)). Quanto ao título do mapa (plot.title), vamos ajustar o tamanho da fonte e a posição na área do mapa (element_text(size = 11, hjust = 0.9, vjust = -10)). Em relação à linha da moldura (panel.border), vamos indicar a cor preta, espessura da linha (0.1) e que não deverá haver preenchimento (NA) ( element_rect(color = “black”, linewidth = .1, fill = NA)) (Figura @ref(fig:plot-pop-title)).</p>
<div class="sourceCode" id="cb294"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb294-1"><a href="#cb294-1" tabindex="-1"></a><span class="co">#para plotar o mapa das UFs, dos municípios da UF São Paulo, centroides com dados da população, ajustar a legenda, adicionar o título e definir o tema</span></span>
<span id="cb294-2"><a href="#cb294-2" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb294-3"><a href="#cb294-3" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> UFBRwgs84, <span class="at">colour =</span> <span class="st">&quot;grey50&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;gray95&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>)<span class="sc">+</span></span>
<span id="cb294-4"><a href="#cb294-4" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> pop_wgs84, <span class="at">fill =</span> <span class="st">&quot;beige&quot;</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">size =</span> <span class="fl">0.25</span>) <span class="sc">+</span></span>
<span id="cb294-5"><a href="#cb294-5" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> pop_centrd, <span class="fu">aes</span>(<span class="at">size =</span> Pop), <span class="at">color =</span> <span class="st">&quot;tomato&quot;</span>, <span class="at">alpha=</span><span class="fl">0.8</span>, <span class="at">show.legend =</span> <span class="st">&quot;point&quot;</span>)<span class="sc">+</span></span>
<span id="cb294-6"><a href="#cb294-6" tabindex="-1"></a>  <span class="fu">scale_size</span>(<span class="at">name=</span><span class="st">&quot;Habitantes&quot;</span>, <span class="at">range =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">10000</span>, <span class="dv">100000</span>, <span class="dv">1000000</span>, <span class="dv">10000000</span>))<span class="sc">+</span></span>
<span id="cb294-7"><a href="#cb294-7" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;População do estado de São Paulo em 2022&quot;</span>)<span class="sc">+</span></span>
<span id="cb294-8"><a href="#cb294-8" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;aliceblue&quot;</span>),</span>
<span id="cb294-9"><a href="#cb294-9" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">hjust =</span> <span class="fl">0.9</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">10</span>),</span>
<span id="cb294-10"><a href="#cb294-10" tabindex="-1"></a>        <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>,<span class="at">linewidth =</span> .<span class="dv">1</span>,<span class="at">fill =</span> <span class="cn">NA</span>))</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="bookdownproj_files/figure-html/plot-pop-theme-1.png" alt="Configurações do tema do mapa" width="672" />
<p class="caption">
(#fig:plot-pop-theme)Configurações do tema do mapa
</p>
</div>
<p>Precisamos definir a área do mapa. Vamos restringir os limites para incluir uma área levemente maior do que o estado de São Paulo, usando a função <strong>coord_sf</strong>. Para saber os limites do estado de São Paulo, vamos olhar o objeto pop_wgs84.</p>
<div class="sourceCode" id="cb295"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb295-1"><a href="#cb295-1" tabindex="-1"></a><span class="co">#para ver os limites geográficos de &#39;pop_wgs84&#39;</span></span>
<span id="cb295-2"><a href="#cb295-2" tabindex="-1"></a>pop_wgs84</span></code></pre></div>
<p>Os limites de pop_wgs84 são:</p>
<p>Bounding box: xmin: -5911607 ymin: -2913666 xmax: -4916247 ymax: -2247040</p>
<p>Vamos ampliar um pouco esta área para:</p>
<p>xlim = c(-5950000, -4890000), ylim = c(-2950000, -2160000)</p>
<div class="sourceCode" id="cb296"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb296-1"><a href="#cb296-1" tabindex="-1"></a><span class="co">#para plotar o mapa das UFs, dos municípios da UF São Paulo, centroides com dados da população, ajustar a legenda, adicionar o título, definir o tema e os limites</span></span>
<span id="cb296-2"><a href="#cb296-2" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb296-3"><a href="#cb296-3" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> UFBRwgs84, <span class="at">colour =</span> <span class="st">&quot;grey50&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;gray95&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>)<span class="sc">+</span></span>
<span id="cb296-4"><a href="#cb296-4" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> pop_wgs84, <span class="at">fill =</span> <span class="st">&quot;beige&quot;</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">size =</span> <span class="fl">0.25</span>) <span class="sc">+</span></span>
<span id="cb296-5"><a href="#cb296-5" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> pop_centrd, <span class="fu">aes</span>(<span class="at">size =</span> Pop), <span class="at">color =</span> <span class="st">&quot;tomato&quot;</span>, <span class="at">alpha=</span><span class="fl">0.8</span>, <span class="at">show.legend =</span> <span class="st">&quot;point&quot;</span>)<span class="sc">+</span></span>
<span id="cb296-6"><a href="#cb296-6" tabindex="-1"></a>  <span class="fu">scale_size</span>(<span class="at">name=</span><span class="st">&quot;Habitantes&quot;</span>, <span class="at">range =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">10000</span>, <span class="dv">100000</span>, <span class="dv">1000000</span>, <span class="dv">10000000</span>))<span class="sc">+</span></span>
<span id="cb296-7"><a href="#cb296-7" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;População do estado de São Paulo em 2022&quot;</span>)<span class="sc">+</span></span>
<span id="cb296-8"><a href="#cb296-8" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;aliceblue&quot;</span>),</span>
<span id="cb296-9"><a href="#cb296-9" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">hjust =</span> <span class="fl">0.9</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">10</span>),</span>
<span id="cb296-10"><a href="#cb296-10" tabindex="-1"></a>        <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">linewidth =</span> .<span class="dv">1</span>,<span class="at">fill =</span> <span class="cn">NA</span>))<span class="sc">+</span></span>
<span id="cb296-11"><a href="#cb296-11" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">5950000</span>, <span class="sc">-</span><span class="dv">4890000</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">2950000</span>, <span class="sc">-</span><span class="dv">2160000</span>), <span class="at">expand =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="bookdownproj_files/figure-html/plot-pop-limites-1.png" alt="Limites do mapa" width="672" />
<p class="caption">
(#fig:plot-pop-limites)Limites do mapa
</p>
</div>
<p>Vamos posicionar a legenda na área interna da moldura e adicionar outras informações como a fonte dos dados e os créditos de elaboração do mapa.</p>
<div class="sourceCode" id="cb297"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb297-1"><a href="#cb297-1" tabindex="-1"></a><span class="co">#para plotar o mapa das UFs, dos municípios da UF São Paulo, centroides com dados da população, ajustar a legenda, adicionar o título, definir o tema, alterar posição da legenda e adicionar notas de rodapé </span></span>
<span id="cb297-2"><a href="#cb297-2" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb297-3"><a href="#cb297-3" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> UFBRwgs84, <span class="at">colour =</span> <span class="st">&quot;grey50&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;gray95&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>)<span class="sc">+</span></span>
<span id="cb297-4"><a href="#cb297-4" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> pop_wgs84, <span class="at">fill =</span> <span class="st">&quot;beige&quot;</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">size =</span> <span class="fl">0.25</span>) <span class="sc">+</span></span>
<span id="cb297-5"><a href="#cb297-5" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> pop_centrd, <span class="fu">aes</span>(<span class="at">size =</span> Pop), <span class="at">color =</span> <span class="st">&quot;tomato&quot;</span>, <span class="at">alpha=</span><span class="fl">0.8</span>, <span class="at">show.legend =</span> <span class="st">&quot;point&quot;</span>)<span class="sc">+</span></span>
<span id="cb297-6"><a href="#cb297-6" tabindex="-1"></a>  <span class="fu">scale_size</span>(<span class="at">name=</span><span class="st">&quot;Habitantes&quot;</span>, <span class="at">range =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">10000</span>, <span class="dv">100000</span>, <span class="dv">1000000</span>, <span class="dv">10000000</span>))<span class="sc">+</span></span>
<span id="cb297-7"><a href="#cb297-7" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;População do estado de São Paulo em 2022&quot;</span>)<span class="sc">+</span></span>
<span id="cb297-8"><a href="#cb297-8" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;aliceblue&quot;</span>),</span>
<span id="cb297-9"><a href="#cb297-9" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">hjust =</span> <span class="fl">0.9</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">10</span>),</span>
<span id="cb297-10"><a href="#cb297-10" tabindex="-1"></a>        <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>,<span class="at">linewidth =</span> .<span class="dv">1</span>,<span class="at">fill =</span> <span class="cn">NA</span>))<span class="sc">+</span></span>
<span id="cb297-11"><a href="#cb297-11" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">5950000</span>, <span class="sc">-</span><span class="dv">4890000</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">2950000</span>, <span class="sc">-</span><span class="dv">2160000</span>), <span class="at">expand =</span> <span class="cn">FALSE</span>)<span class="sc">+</span></span>
<span id="cb297-12"><a href="#cb297-12" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.2</span>))<span class="sc">+</span></span>
<span id="cb297-13"><a href="#cb297-13" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">caption =</span> <span class="st">&quot;Fonte: SEADE (2022) </span><span class="sc">\n</span></span>
<span id="cb297-14"><a href="#cb297-14" tabindex="-1"></a><span class="st">       Elaborado por: @Ligiaviz&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="bookdownproj_files/figure-html/plot-pop-detalhes-1.png" alt="Outros detalhes do mapa" width="672" />
<p class="caption">
(#fig:plot-pop-detalhes)Outros detalhes do mapa
</p>
</div>
<p>A escala gráfica será adicionada com a função <strong>annotation_scale</strong> do pacote <strong>ggspatial</strong>. Usamos <strong>::</strong> para indicar o pacote e a função. A localização da barra de escala deve ser indicada pela posição em cima ou embaixo combinada com a posição esquerda ou direita. Embaixo é indicado por “bottom” ou simplesmente “b”; em cima por “top” ou “t”; do lado direito (“rigth” ou “r”) ou do lado esquerdo (“left” ou “l”). Podemos ajustar a espessura do traço, a largura e altura da barra e quanto vale a unidade em centímetros.</p>
<div class="sourceCode" id="cb298"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb298-1"><a href="#cb298-1" tabindex="-1"></a><span class="co"># a última linha adiciona a barra de escala</span></span>
<span id="cb298-2"><a href="#cb298-2" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb298-3"><a href="#cb298-3" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> UFBRwgs84, <span class="at">colour =</span> <span class="st">&quot;grey50&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;gray95&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>)<span class="sc">+</span></span>
<span id="cb298-4"><a href="#cb298-4" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> pop_wgs84, <span class="at">fill =</span> <span class="st">&quot;beige&quot;</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">size =</span> <span class="fl">0.25</span>) <span class="sc">+</span></span>
<span id="cb298-5"><a href="#cb298-5" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> pop_centrd, <span class="fu">aes</span>(<span class="at">size =</span> Pop), <span class="at">color =</span> <span class="st">&quot;tomato&quot;</span>, <span class="at">alpha=</span><span class="fl">0.8</span>, <span class="at">show.legend =</span> <span class="st">&quot;point&quot;</span>)<span class="sc">+</span></span>
<span id="cb298-6"><a href="#cb298-6" tabindex="-1"></a>  <span class="fu">scale_size</span>(<span class="at">name=</span><span class="st">&quot;Habitantes&quot;</span>, <span class="at">range =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">10000</span>, <span class="dv">100000</span>, <span class="dv">1000000</span>, <span class="dv">10000000</span>))<span class="sc">+</span></span>
<span id="cb298-7"><a href="#cb298-7" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;População do estado de São Paulo em 2022&quot;</span>)<span class="sc">+</span></span>
<span id="cb298-8"><a href="#cb298-8" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;aliceblue&quot;</span>),</span>
<span id="cb298-9"><a href="#cb298-9" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">hjust =</span> <span class="fl">0.9</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">10</span>),</span>
<span id="cb298-10"><a href="#cb298-10" tabindex="-1"></a>        <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>,<span class="at">linewidth =</span> .<span class="dv">1</span>,<span class="at">fill =</span> <span class="cn">NA</span>))<span class="sc">+</span></span>
<span id="cb298-11"><a href="#cb298-11" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">5950000</span>, <span class="sc">-</span><span class="dv">4890000</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">2950000</span>, <span class="sc">-</span><span class="dv">2160000</span>), <span class="at">expand =</span> <span class="cn">FALSE</span>)<span class="sc">+</span></span>
<span id="cb298-12"><a href="#cb298-12" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.2</span>))<span class="sc">+</span></span>
<span id="cb298-13"><a href="#cb298-13" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">caption =</span> <span class="st">&quot;Fonte: SEADE (2022) </span><span class="sc">\n</span></span>
<span id="cb298-14"><a href="#cb298-14" tabindex="-1"></a><span class="st">       Elaborado por: @Ligiaviz&quot;</span>)<span class="sc">+</span></span>
<span id="cb298-15"><a href="#cb298-15" tabindex="-1"></a>  ggspatial<span class="sc">::</span><span class="fu">annotation_scale</span>(<span class="at">location =</span> <span class="st">&quot;br&quot;</span>, <span class="at">width_hint =</span> <span class="fl">0.4</span>, <span class="at">line_width =</span> <span class="fl">0.5</span>, <span class="at">height =</span> <span class="fu">unit</span>(<span class="fl">0.1</span>,<span class="st">&quot;cm&quot;</span>))</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="bookdownproj_files/figure-html/plot-pop-escala-1.png" alt="Com a escala gráfica" width="672" />
<p class="caption">
(#fig:plot-pop-escala)Com a escala gráfica
</p>
</div>
<p>Por fim, vamos acrescentar a seta do norte geográfico. Usaremos <strong>ggspatial::annotation_north_arrow</strong>. Indicaremos a posição no mapa (location = “tr”), o tipo de norte (which_north = “true”), o tamanho e a unidade (pad_x = unit(0.4, “in”), pad_y = unit(0.4, “in”)), o estilo da seta, as cores de preenchimento e da linha e o estilo do texto para a letra N.</p>
<div class="sourceCode" id="cb299"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb299-1"><a href="#cb299-1" tabindex="-1"></a><span class="co">#o último bloco adiciona e configura a seta do Norte Geográfico</span></span>
<span id="cb299-2"><a href="#cb299-2" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb299-3"><a href="#cb299-3" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> UFBRwgs84, <span class="at">colour =</span> <span class="st">&quot;grey50&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;gray95&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>)<span class="sc">+</span></span>
<span id="cb299-4"><a href="#cb299-4" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> pop_wgs84, <span class="at">fill =</span> <span class="st">&quot;beige&quot;</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">size =</span> <span class="fl">0.25</span>) <span class="sc">+</span></span>
<span id="cb299-5"><a href="#cb299-5" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> pop_centrd, <span class="fu">aes</span>(<span class="at">size =</span> Pop), <span class="at">color =</span> <span class="st">&quot;tomato&quot;</span>, <span class="at">alpha=</span><span class="fl">0.8</span>, <span class="at">show.legend =</span> <span class="st">&quot;point&quot;</span>)<span class="sc">+</span></span>
<span id="cb299-6"><a href="#cb299-6" tabindex="-1"></a>  <span class="fu">scale_size</span>(<span class="at">name=</span><span class="st">&quot;Habitantes&quot;</span>, <span class="at">range =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">10000</span>, <span class="dv">100000</span>, <span class="dv">1000000</span>, <span class="dv">10000000</span>))<span class="sc">+</span></span>
<span id="cb299-7"><a href="#cb299-7" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;População do estado de São Paulo em 2022&quot;</span>)<span class="sc">+</span></span>
<span id="cb299-8"><a href="#cb299-8" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;aliceblue&quot;</span>),</span>
<span id="cb299-9"><a href="#cb299-9" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">hjust =</span> <span class="fl">0.9</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">10</span>),</span>
<span id="cb299-10"><a href="#cb299-10" tabindex="-1"></a>        <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>,<span class="at">linewidth =</span> .<span class="dv">1</span>,<span class="at">fill =</span> <span class="cn">NA</span>))<span class="sc">+</span></span>
<span id="cb299-11"><a href="#cb299-11" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">5950000</span>, <span class="sc">-</span><span class="dv">4890000</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">2950000</span>, <span class="sc">-</span><span class="dv">2160000</span>), <span class="at">expand =</span> <span class="cn">FALSE</span>)<span class="sc">+</span></span>
<span id="cb299-12"><a href="#cb299-12" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.2</span>))<span class="sc">+</span></span>
<span id="cb299-13"><a href="#cb299-13" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">caption =</span> <span class="st">&quot;Fonte: SEADE (2022) </span><span class="sc">\n</span></span>
<span id="cb299-14"><a href="#cb299-14" tabindex="-1"></a><span class="st">       Elaborado por: @Ligiaviz&quot;</span>)<span class="sc">+</span></span>
<span id="cb299-15"><a href="#cb299-15" tabindex="-1"></a>  ggspatial<span class="sc">::</span><span class="fu">annotation_scale</span>(<span class="at">location =</span> <span class="st">&quot;br&quot;</span>, <span class="at">width_hint =</span> <span class="fl">0.4</span>, <span class="at">line_width =</span> <span class="fl">0.5</span>, <span class="at">height =</span> <span class="fu">unit</span>(<span class="fl">0.1</span>,<span class="st">&quot;cm&quot;</span>), <span class="at">bar_cols =</span> <span class="fu">c</span>(<span class="st">&quot;white&quot;</span>, <span class="st">&quot;white&quot;</span>))<span class="sc">+</span></span>
<span id="cb299-16"><a href="#cb299-16" tabindex="-1"></a>  ggspatial<span class="sc">::</span><span class="fu">annotation_north_arrow</span>(</span>
<span id="cb299-17"><a href="#cb299-17" tabindex="-1"></a>    <span class="at">location =</span> <span class="st">&quot;tr&quot;</span>, <span class="at">which_north =</span> <span class="st">&quot;true&quot;</span>,</span>
<span id="cb299-18"><a href="#cb299-18" tabindex="-1"></a>    <span class="at">pad_x =</span> <span class="fu">unit</span>(<span class="fl">0.4</span>, <span class="st">&quot;in&quot;</span>), <span class="at">pad_y =</span> <span class="fu">unit</span>(<span class="fl">0.4</span>, <span class="st">&quot;in&quot;</span>),</span>
<span id="cb299-19"><a href="#cb299-19" tabindex="-1"></a>    <span class="at">style =</span> ggspatial<span class="sc">::</span><span class="fu">north_arrow_nautical</span>(</span>
<span id="cb299-20"><a href="#cb299-20" tabindex="-1"></a>      <span class="at">fill =</span> <span class="fu">c</span>(<span class="st">&quot;grey40&quot;</span>, <span class="st">&quot;white&quot;</span>),</span>
<span id="cb299-21"><a href="#cb299-21" tabindex="-1"></a>      <span class="at">line_col =</span> <span class="st">&quot;grey20&quot;</span>,</span>
<span id="cb299-22"><a href="#cb299-22" tabindex="-1"></a>      <span class="at">text_family =</span> <span class="st">&quot;ArcherPro Book&quot;</span></span>
<span id="cb299-23"><a href="#cb299-23" tabindex="-1"></a>    )) </span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="bookdownproj_files/figure-html/plot-pop-seta-1.png" alt="Com a seta do Norte" width="672" />
<p class="caption">
(#fig:plot-pop-seta)Com a seta do Norte
</p>
</div>
<p>Para exportar o mapa pronto com extensão <strong>png</strong>, usaremos <strong>ggsave</strong>.</p>
<div class="sourceCode" id="cb300"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb300-1"><a href="#cb300-1" tabindex="-1"></a><span class="co">#para salvar o arquivo com extensao .png</span></span>
<span id="cb300-2"><a href="#cb300-2" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">&quot;populacaoSP.png&quot;</span>, <span class="at">width =</span> <span class="dv">8</span>, <span class="at">height =</span> <span class="dv">8</span>, <span class="at">dpi =</span> <span class="dv">300</span>)</span></code></pre></div>
</div>
<div id="referências-sugeridas-1" class="section level2 hasAnchor" number="8.4">
<h2 class="hasAnchor"><span class="header-section-number">8.4</span> Referências sugeridas<a href="#referências-sugeridas-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><strong>Using ggplot to plot pie charts on a geographical map</strong> - <a href="http://www.spectdata.com/index.php/2018/10/25/how-to-use-ggplot-to-plot-pie-charts-on-a-map/" class="uri">http://www.spectdata.com/index.php/2018/10/25/how-to-use-ggplot-to-plot-pie-charts-on-a-map/</a></p>
<p><strong>NEW VERSION OF CARTOGRAPHY</strong> (outro pacote do R dedicado à Cartografia Temática)
<a href="https://rgeomatic.hypotheses.org/category/cartography" class="uri">https://rgeomatic.hypotheses.org/category/cartography</a></p>
<!--chapter:end:08-fig-geom.Rmd-->
</div>
</div>
<div id="quanti2" class="section level1 hasAnchor" number="9">
<h1 class="hasAnchor"><span class="header-section-number">9</span> Dados quantitativos absolutos: mapa dos pontos de contagem (ou densidade de pontos)<a href="#quanti2" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Diferente do mapa de figuras proporcionais, onde o tamanho das figuras remete à ideia de proporção, os pontos de contagem permitem estabelecer a ideia de densidade ao representar determinada quantidade espalhada aleatoriamente dentro dos polígonos de unidades administrativas.</p>
<p>Utilizaremos como exemplo os dados de etnia da população na escala intraurbana do município de São Paulo. Cada ponto terá um valor de número de residentes por Distrito Administrativo. Aos pontos atribuiremos cores para proporcionar a visualização da distribuição espacial das etnias por área. Este mapa tem como inspiração o mapa de grupos étnicos de Chicago, desenvovido por <a href="http://www.radicalcartography.net/index.html?chicagodots">Bill Rankin (2009)</a>. Foi replicado em Londres para os votos segundo partidos políticos <a href="https://gist.github.com/PaulC91/9cc8551d5475620cb5c5d87ee1609257">Tom Campbell</a>. Este script foi utilizado e adaptado para a elaboração do mapa da população segundo etnia em São Paulo, que será desenvolvido a seguir.</p>
<div id="bases-de-dados-1" class="section level2 hasAnchor" number="9.1">
<h2 class="hasAnchor"><span class="header-section-number">9.1</span> Bases de dados<a href="#bases-de-dados-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Para a elaboração deste mapa precisaremos de dados da população segundo cor ou raça. O IBGE define cinco grupos de cor ou raça autodeclarados durante a pesquisa do Censo Demográfico: raça ou cor branca, preta, amarela, parda e indígena. Usaremos os dados disponíveis mais recentes que são os de 2010. A base cartográfica será a malha dos Distritos, também disponíveis no site do IBGE.</p>
<p>Para darmos início, vamos limpar a memória e verificar o diretório.</p>
<div class="sourceCode" id="cb301"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb301-1"><a href="#cb301-1" tabindex="-1"></a><span class="co">#para limpar a memoria</span></span>
<span id="cb301-2"><a href="#cb301-2" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span> <span class="fu">ls</span>())</span>
<span id="cb301-3"><a href="#cb301-3" tabindex="-1"></a><span class="co">#para verificar o diretório de trabalho</span></span>
<span id="cb301-4"><a href="#cb301-4" tabindex="-1"></a><span class="fu">getwd</span>()</span></code></pre></div>
<pre><code>## [1] &quot;C:/Users/l_viz/Documents/RCartoTematica&quot;</code></pre>
<p>É sempre bom deixarmos alinhado com a língua que usaremos para evitar problemas com acentuação nos títulos. Também vamos desativar a notação científica para que os códigos do IBGE apareçam por completo.</p>
<div class="sourceCode" id="cb303"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb303-1"><a href="#cb303-1" tabindex="-1"></a><span class="co">#para ajustar a lingua para portugues usando a funcao</span></span>
<span id="cb303-2"><a href="#cb303-2" tabindex="-1"></a><span class="fu">Sys.setlocale</span>(<span class="at">category =</span> <span class="st">&quot;LC_ALL&quot;</span>, <span class="at">locale =</span> <span class="st">&quot;pt_BR.UTF-8&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;LC_COLLATE=pt_BR.UTF-8;LC_CTYPE=pt_BR.UTF-8;LC_MONETARY=pt_BR.UTF-8;LC_NUMERIC=C;LC_TIME=pt_BR.UTF-8&quot;</code></pre>
<div class="sourceCode" id="cb305"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb305-1"><a href="#cb305-1" tabindex="-1"></a><span class="co">#para desativar a notação científica</span></span>
<span id="cb305-2"><a href="#cb305-2" tabindex="-1"></a><span class="fu">options</span>(<span class="at">scipen =</span> <span class="dv">999</span>)</span></code></pre></div>
<div class="sourceCode" id="cb306"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb306-1"><a href="#cb306-1" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;R.utils&quot;</span>)</span></code></pre></div>
<p>Carregamos os pacotes que serão utilizados.</p>
<div class="sourceCode" id="cb307"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb307-1"><a href="#cb307-1" tabindex="-1"></a><span class="fu">library</span>(R.utils)</span>
<span id="cb307-2"><a href="#cb307-2" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb307-3"><a href="#cb307-3" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb307-4"><a href="#cb307-4" tabindex="-1"></a><span class="fu">library</span>(ggplot2,<span class="at">warn.conflicts=</span><span class="cn">FALSE</span>)</span>
<span id="cb307-5"><a href="#cb307-5" tabindex="-1"></a><span class="fu">library</span>(ggspatial)</span>
<span id="cb307-6"><a href="#cb307-6" tabindex="-1"></a><span class="fu">library</span>(stringr)</span></code></pre></div>
<p>O arquivo shapefile dos Distritos estão disponíveis no FTP do IBGE por Unidade da Federação. Desta forma, faremos o download do arquivo zip após a identificação da url (<em>Uniform Resource Locator</em>, ou Localizador Uniforme de Recursos - significa endereço web, ou seja, o texto que você digita na barra do navegador para acessar uma determinada página ou serviço). Para isso, usaremos a função <code>download.file</code> do pacote <strong>R.utils</strong>. A documentação completa dos pacotes e funções estão disponíveis em <a href="https://www.rdocumentation.org/">R documentation</a>.</p>
<div class="sourceCode" id="cb308"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb308-1"><a href="#cb308-1" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">&quot;https://geosampa.prefeitura.sp.gov.br/PaginasPublicas/downloadArquivo.aspx?orig=DownloadCamadas&amp;arq=01_Limites%20Administrativos%5C%5CDistrito%5C%5CShapefile%5C%5CSIRGAS_SHP_distrito&amp;arqTipo=Shapefile&quot;</span></span>
<span id="cb308-2"><a href="#cb308-2" tabindex="-1"></a></span>
<span id="cb308-3"><a href="#cb308-3" tabindex="-1"></a>destfile <span class="ot">&lt;-</span> <span class="st">&quot;C:/Users/l_viz/Documents/RCartoTematica/shapefile.zip&quot;</span></span>
<span id="cb308-4"><a href="#cb308-4" tabindex="-1"></a></span>
<span id="cb308-5"><a href="#cb308-5" tabindex="-1"></a><span class="fu">download.file</span>(url, destfile, <span class="at">mode=</span><span class="st">&#39;wb&#39;</span>)</span></code></pre></div>
<p>Descompacte o arquivo zip diretamente na pasta de trabalho. Vamos abrir o shapefile com a função <code>st_read</code> do pacote <strong>R.utils</strong>.</p>
<div class="sourceCode" id="cb309"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb309-1"><a href="#cb309-1" tabindex="-1"></a><span class="co">#para abrir o arquivo shapefile dos distritos da UF São Paulo </span></span>
<span id="cb309-2"><a href="#cb309-2" tabindex="-1"></a>sp_distr <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">&quot;C:/Users/l_viz/Documents/RCartoTematica/SIRGAS_SHP_distrito/SIRGAS_SHP_distrito.shp&quot;</span>)</span></code></pre></div>
<pre><code>## Reading layer `SIRGAS_SHP_distrito&#39; from data source 
##   `C:\Users\l_viz\Documents\RCartoTematica\SIRGAS_SHP_distrito\SIRGAS_SHP_distrito.shp&#39; 
##   using driver `ESRI Shapefile&#39;
## Simple feature collection with 96 features and 7 fields
## Geometry type: POLYGON
## Dimension:     XY
## Bounding box:  xmin: 313389.7 ymin: 7343743 xmax: 360618.2 ymax: 7416156
## Projected CRS: SIRGAS 2000 / UTM zone 23S</code></pre>
<p>Para verificar o tipo de objeto, usamos <code>class</code> do pacote <strong>R.utils</strong>. Para olharmos as 6 primeiras linhas do objeto, usamos a função <code>head</code> do mesmo pacote.</p>
<div class="sourceCode" id="cb311"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb311-1"><a href="#cb311-1" tabindex="-1"></a><span class="co">#para verificar o tipo de objeto</span></span>
<span id="cb311-2"><a href="#cb311-2" tabindex="-1"></a><span class="fu">class</span>(sp_distr)</span></code></pre></div>
<pre><code>## [1] &quot;sf&quot;         &quot;data.frame&quot;</code></pre>
<div class="sourceCode" id="cb313"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb313-1"><a href="#cb313-1" tabindex="-1"></a><span class="co">#para vermos as 6 primeiras linhas</span></span>
<span id="cb313-2"><a href="#cb313-2" tabindex="-1"></a><span class="fu">head</span>(sp_distr)</span></code></pre></div>
<pre><code>## Simple feature collection with 6 features and 7 fields
## Geometry type: POLYGON
## Dimension:     XY
## Bounding box:  xmin: 315542 ymin: 7343743 xmax: 360618.2 ymax: 7408231
## Projected CRS: SIRGAS 2000 / UTM zone 23S
##   ds_codigo        ds_nome ds_sigla ds_cd_sub       ds_subpref
## 1        51       MANDAQUI      MAN        05 SANTANA-TUCURUVI
## 2        52       MARSILAC      MAR        20      PARELHEIROS
## 3        32          MOEMA      MOE        12     VILA MARIANA
## 4        31     GUAIANASES      GUA        28       GUAIANASES
## 5        33       IGUATEMI      IGU        30       SAO MATEUS
## 6        36 ITAIM PAULISTA      IPA        24   ITAIM PAULISTA
##   ds_areamt ds_areakmt                       geometry
## 1  13247864      13.25 POLYGON ((330950.4 7407837,...
## 2 208195746     208.20 POLYGON ((336124.1 7355302,...
## 3   9079516       9.08 POLYGON ((331242.2 7392162,...
## 4   8938527       8.94 POLYGON ((355108.2 7393291,...
## 5  19583557      19.58 POLYGON ((350859.9 7389600,...
## 6  12143789      12.14 POLYGON ((359239.6 7402470,...</code></pre>
<p>Vamos visualizar os Distritos usando <code>ggplot</code> do pacote <strong>ggplot2</strong>, definindo a geometria a partir de <code>geom_sf</code> com o contorno na cor preta e o preenchimento em cinza claro.</p>
<div class="sourceCode" id="cb315"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb315-1"><a href="#cb315-1" tabindex="-1"></a><span class="co">#para plotar a camada dos distritos do estado de SP</span></span>
<span id="cb315-2"><a href="#cb315-2" tabindex="-1"></a><span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb315-3"><a href="#cb315-3" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> sp_distr, <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;grey90&quot;</span>) <span class="co">#para plotar</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="bookdownproj_files/figure-html/plot-distr-ufsp-1.png" alt="Malha de Distritos do Estado de São Paulo" width="672" />
<p class="caption">
(#fig:plot-distr-ufsp)Malha de Distritos do Estado de São Paulo
</p>
</div>
<div class="sourceCode" id="cb316"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb316-1"><a href="#cb316-1" tabindex="-1"></a><span class="co">#para ver as colunas de sp_distr</span></span>
<span id="cb316-2"><a href="#cb316-2" tabindex="-1"></a><span class="fu">names</span>(sp_distr)</span></code></pre></div>
<pre><code>## [1] &quot;ds_codigo&quot;  &quot;ds_nome&quot;    &quot;ds_sigla&quot;   &quot;ds_cd_sub&quot;  &quot;ds_subpref&quot;
## [6] &quot;ds_areamt&quot;  &quot;ds_areakmt&quot; &quot;geometry&quot;</code></pre>
<div class="sourceCode" id="cb318"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb318-1"><a href="#cb318-1" tabindex="-1"></a><span class="fu">head</span>(sp_distr)</span></code></pre></div>
<pre><code>## Simple feature collection with 6 features and 7 fields
## Geometry type: POLYGON
## Dimension:     XY
## Bounding box:  xmin: 315542 ymin: 7343743 xmax: 360618.2 ymax: 7408231
## Projected CRS: SIRGAS 2000 / UTM zone 23S
##   ds_codigo        ds_nome ds_sigla ds_cd_sub       ds_subpref
## 1        51       MANDAQUI      MAN        05 SANTANA-TUCURUVI
## 2        52       MARSILAC      MAR        20      PARELHEIROS
## 3        32          MOEMA      MOE        12     VILA MARIANA
## 4        31     GUAIANASES      GUA        28       GUAIANASES
## 5        33       IGUATEMI      IGU        30       SAO MATEUS
## 6        36 ITAIM PAULISTA      IPA        24   ITAIM PAULISTA
##   ds_areamt ds_areakmt                       geometry
## 1  13247864      13.25 POLYGON ((330950.4 7407837,...
## 2 208195746     208.20 POLYGON ((336124.1 7355302,...
## 3   9079516       9.08 POLYGON ((331242.2 7392162,...
## 4   8938527       8.94 POLYGON ((355108.2 7393291,...
## 5  19583557      19.58 POLYGON ((350859.9 7389600,...
## 6  12143789      12.14 POLYGON ((359239.6 7402470,...</code></pre>
<p>A segunda etapa será a obtenção dos dados de raça ou cor a partir dos dados do Censo de 2010. Precisaremos fazer isso manualmente. Baixe os arquivos correspondentes ao município de São Paulo a partir do ftp do IBGE na sua pasta de trabalho <a href="https://ftp.ibge.gov.br/Censos/Censo_Demografico_2010/Resultados_do_Universo/Agregados_por_Setores_Censitarios/SP_Capital_20190823.zip" class="uri">https://ftp.ibge.gov.br/Censos/Censo_Demografico_2010/Resultados_do_Universo/Agregados_por_Setores_Censitarios/SP_Capital_20190823.zip</a>.
Descompacte o arquivo manualmente na pasta do diretório onde se encontra para podermos selecionar e ler o arquivo que queremos. Depois de descompactado, execute a linha a seguir. <code>read.table</code> lerá o arquivo Pessoa03_SP1 de extensão csv com separador entre colunas “;” e primeira linha contendo os nomes das variáveis “(header = TRUE)”, criando o objeto de nome “pessoa”. Aproveitaremos para já selecionar as colunas que nos interessam usando <code>%&gt;%</code> (<em>pipe</em>, que pode ser lido como “então”) e a função <code>select</code> selecionando a coluna de código do setor e as variáveis “V001” a “V006”. Com a função <code>head</code> verificamos as 6 primeiras linhas do objeto “pessoa”.
A documentação do Censo com todas as planilhas e variáveis encontra-se no arquivo <a href="https://ftp.ibge.gov.br/Censos/Censo_Demografico_2010/Resultados_do_Universo/Agregados_por_Setores_Censitarios/Documentacao_Agregado_dos_Setores_20180416.zip">BASE DE INFORMAÇÕES POR SETOR CENSITÁRIO Censo 2010 - Universo.pdf</a>.</p>
<div class="sourceCode" id="cb320"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb320-1"><a href="#cb320-1" tabindex="-1"></a><span class="co">#para ler o arquivo Pessoa03_SP1.csv</span></span>
<span id="cb320-2"><a href="#cb320-2" tabindex="-1"></a>pessoa <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;C:/Users/l_viz/Documents/RCartoTematica/Base informaçoes setores2010 universo SP_Capital/CSV/Pessoa03_SP1.csv&quot;</span>, <span class="at">sep=</span><span class="st">&quot;;&quot;</span>, <span class="at">header=</span>T) <span class="sc">%&gt;%</span></span>
<span id="cb320-3"><a href="#cb320-3" tabindex="-1"></a>  <span class="fu">select</span>(Cod_setor, V001, V002, V003, V004, V005, V006)</span>
<span id="cb320-4"><a href="#cb320-4" tabindex="-1"></a><span class="fu">head</span>(pessoa)</span></code></pre></div>
<pre><code>##         Cod_setor V001 V002 V003 V004 V005 V006
## 1 355030801000001  806  661   23    3  119    0
## 2 355030801000002  913  730   16    4  163    0
## 3 355030801000003  625  521   25    8   71    0
## 4 355030801000004  572  430   26    8  108    0
## 5 355030801000005  754  580   28   23  123    0
## 6 355030801000006  643  552   11    0   80    0</code></pre>
<p>O resultado da função <code>head</code> nos mostra que as variáveis de “V002” a “V006” são do tipo caractere (chr). Teremos que alterar para “integer” para que possam ser executados cálculos com estes valores. Vamos usar <code>mutate</code> que permite a transformação de todas estas variáveis de uma única vez. Ou seja, se a variável for caractere, será transformada em “integer”.</p>
<div class="sourceCode" id="cb322"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb322-1"><a href="#cb322-1" tabindex="-1"></a><span class="co">#para transformar todas as variáveis do tipo chr em int</span></span>
<span id="cb322-2"><a href="#cb322-2" tabindex="-1"></a>pessoa <span class="ot">&lt;-</span> pessoa <span class="sc">%&gt;%</span> </span>
<span id="cb322-3"><a href="#cb322-3" tabindex="-1"></a> <span class="fu">mutate_if</span>(is.character, as.integer)</span></code></pre></div>
<p>O aviso resultante do comando diz que foram introduzidos valores do tipo “NA” (not available, ou seja, valores faltantes) onde havia valores não numéricos do tipo “x”. O IBGE restringe a informação para proteção de dados dos informantes. Segundo a documentação,</p>
<blockquote>
<p>“No arquivo agregado por setores, o IBGE optou pela restrição de dados como forma de proteção dos dados dos informantes do Censo Demográfico 2010. Assim, em todos os setores com menos de cinco domicílios particulares permanentes foram omitidos os valores da maioria das variáveis de dados. Foram mantidas apenas as variáveis estruturais tais como: a identificação das subdivisões geográficas, o número de domicílios e a população por sexo. Para indicar a omissão dos dados, os valores das variáveis foram preenchidos com “x”. (IBGE, 2011, p.35)&gt;</p>
</blockquote>
<p>Como vimos, a coluna “Cod_setor” aparece como numérica “dbl”(double) e precisa ser convertida para caractere. Usamos a função a seguir.</p>
<div class="sourceCode" id="cb323"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb323-1"><a href="#cb323-1" tabindex="-1"></a><span class="co">#para converter &quot;dbl&quot; para &quot;chr&quot;</span></span>
<span id="cb323-2"><a href="#cb323-2" tabindex="-1"></a>pessoa <span class="ot">&lt;-</span> pessoa <span class="sc">%&gt;%</span></span>
<span id="cb323-3"><a href="#cb323-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Cod_setor =</span> <span class="fu">as.character</span>(Cod_setor))</span>
<span id="cb323-4"><a href="#cb323-4" tabindex="-1"></a><span class="co">#para ver as 6 primeiras linhas</span></span>
<span id="cb323-5"><a href="#cb323-5" tabindex="-1"></a><span class="fu">head</span>(pessoa)</span></code></pre></div>
<pre><code>##         Cod_setor V001 V002 V003 V004 V005 V006
## 1 355030801000001  806  661   23    3  119    0
## 2 355030801000002  913  730   16    4  163    0
## 3 355030801000003  625  521   25    8   71    0
## 4 355030801000004  572  430   26    8  108    0
## 5 355030801000005  754  580   28   23  123    0
## 6 355030801000006  643  552   11    0   80    0</code></pre>
<p>Como vamos precisar unir a tabela de dados com o shapefile, as colunas de identificadores devem ser exatamente iguais. No shapefile temos 96 Distritos Administrativos, cuja coluna de identificação é CD_GEOCODD, com 9 dígitos. Na tabela “pessoa”, o identificador é “Cod_setor”, com 15 dígitos. Desta forma, precisaremos compatibilizar os identificadores deixando “Cod_setor” com 9 dígitos também.</p>
<div class="sourceCode" id="cb325"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb325-1"><a href="#cb325-1" tabindex="-1"></a><span class="co">#para deixar o codigo do setor com o mesmo numero de caracteres do codigo do distrito</span></span>
<span id="cb325-2"><a href="#cb325-2" tabindex="-1"></a>pessoa<span class="sc">$</span>Cod_setor <span class="ot">&lt;-</span> <span class="fu">substring</span>(pessoa<span class="sc">$</span>Cod_setor, <span class="dv">8</span>, <span class="dv">9</span>)</span>
<span id="cb325-3"><a href="#cb325-3" tabindex="-1"></a><span class="co">#para ver as 6 primeiras linhas</span></span>
<span id="cb325-4"><a href="#cb325-4" tabindex="-1"></a><span class="fu">head</span>(pessoa)</span></code></pre></div>
<pre><code>##   Cod_setor V001 V002 V003 V004 V005 V006
## 1        01  806  661   23    3  119    0
## 2        01  913  730   16    4  163    0
## 3        01  625  521   25    8   71    0
## 4        01  572  430   26    8  108    0
## 5        01  754  580   28   23  123    0
## 6        01  643  552   11    0   80    0</code></pre>
<div class="sourceCode" id="cb327"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb327-1"><a href="#cb327-1" tabindex="-1"></a><span class="co">#para ver o tipo de objeto</span></span>
<span id="cb327-2"><a href="#cb327-2" tabindex="-1"></a><span class="fu">class</span>(pessoa)</span></code></pre></div>
<pre><code>## [1] &quot;data.frame&quot;</code></pre>
<div class="sourceCode" id="cb329"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb329-1"><a href="#cb329-1" tabindex="-1"></a><span class="co">#para visualizar a tabela</span></span>
<span id="cb329-2"><a href="#cb329-2" tabindex="-1"></a><span class="fu">View</span>(pessoa)</span></code></pre></div>
<p>Ao abrirmos a tabela com a função <code>View</code>, percebemos que temos os códigos com 9 dígitos, mas continuamos com 18.363 linhas referentes aos setores censitários e não as 96 dos Distritos! Como cada Distrito tem vários setores (em média, 18.363/96=191 setores), precisamos somá-los dentro de cada Distrito para termos os valores corretos de cada variável, com um total de 96 linhas. Ou seja, precisamos agregar os valores dos setores por meio de soma.</p>
<div class="sourceCode" id="cb330"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb330-1"><a href="#cb330-1" tabindex="-1"></a><span class="co"># Para agregar as variáveis das colunas 2 a 7, usando Cod_setor como quebra, função de soma e ignorando os valores NA</span></span>
<span id="cb330-2"><a href="#cb330-2" tabindex="-1"></a>pessoa_distr <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(pessoa[,<span class="dv">2</span><span class="sc">:</span><span class="dv">7</span>],<span class="at">by=</span><span class="fu">list</span>(pessoa<span class="sc">$</span>Cod_setor),<span class="at">FUN=</span>sum, <span class="at">na.rm=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<div class="sourceCode" id="cb331"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb331-1"><a href="#cb331-1" tabindex="-1"></a><span class="co">#para ver o arquivo</span></span>
<span id="cb331-2"><a href="#cb331-2" tabindex="-1"></a><span class="fu">View</span>(pessoa_distr)</span></code></pre></div>
<p>Agora sim, temos uma tabela com os 96 Distritos administrativos de São Paulo e os valores somados de cada variável. Vamos, então, corrigir os nomes das colunas.</p>
<div class="sourceCode" id="cb332"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb332-1"><a href="#cb332-1" tabindex="-1"></a><span class="co">#para alterar os nomes das colunas de pessoa_distr</span></span>
<span id="cb332-2"><a href="#cb332-2" tabindex="-1"></a><span class="fu">names</span>(pessoa_distr) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;ds_codigo&#39;</span>, <span class="st">&#39;Total&#39;</span>, <span class="st">&#39;Branca&#39;</span>, <span class="st">&#39;Preta&#39;</span>, <span class="st">&#39;Amarela&#39;</span>, <span class="st">&#39;Parda&#39;</span>, <span class="st">&#39;Indigena&#39;</span>)</span>
<span id="cb332-3"><a href="#cb332-3" tabindex="-1"></a><span class="co">#para verificar que a alteração foi feita</span></span>
<span id="cb332-4"><a href="#cb332-4" tabindex="-1"></a><span class="fu">names</span>(pessoa_distr)</span></code></pre></div>
<pre><code>## [1] &quot;ds_codigo&quot; &quot;Total&quot;     &quot;Branca&quot;    &quot;Preta&quot;     &quot;Amarela&quot;  
## [6] &quot;Parda&quot;     &quot;Indigena&quot;</code></pre>
<div class="sourceCode" id="cb334"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb334-1"><a href="#cb334-1" tabindex="-1"></a><span class="fu">class</span>(pessoa_distr)</span></code></pre></div>
<pre><code>## [1] &quot;data.frame&quot;</code></pre>
<div class="sourceCode" id="cb336"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb336-1"><a href="#cb336-1" tabindex="-1"></a><span class="fu">View</span>(pessoa_distr)</span></code></pre></div>
<p>Observe que ‘ds_codigo’ em sp_distr tem apenas 1 dígito para os códigos menores do que 10 enquanto que ‘ds_codigo’ de pessoa_distr tem 2 dígitos para os códigos menores do que 10. Precisamos tornar estes campos iguais para que a união seja correta. Vamos usar o pacote <code>stringr</code> para isso.</p>
<div class="sourceCode" id="cb337"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb337-1"><a href="#cb337-1" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb337-2"><a href="#cb337-2" tabindex="-1"></a></span>
<span id="cb337-3"><a href="#cb337-3" tabindex="-1"></a>sp_distr <span class="ot">&lt;-</span> sp_distr <span class="sc">%&gt;%</span> </span>
<span id="cb337-4"><a href="#cb337-4" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ds_codigo =</span> <span class="fu">str_pad</span>(ds_codigo, <span class="at">width=</span><span class="dv">2</span>,</span>
<span id="cb337-5"><a href="#cb337-5" tabindex="-1"></a>                             <span class="at">pad=</span><span class="st">&quot;0&quot;</span>))</span></code></pre></div>
<p>Com a tabela compatível com o shapefile, podemos uni-los. Vamos chamar o novo objeto de “sp_pessoa_distr” e usar a função <code>left_join</code>, indicando o campo de união (ds_codigo). Uniremos o data.frame “pessoa_distr” ao objeto “sf” (simple feature) “sp_distr”. Então, tranformamos o novo objeto em classe “sf” com a função <code>st_as_sf</code>.</p>
<div class="sourceCode" id="cb338"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb338-1"><a href="#cb338-1" tabindex="-1"></a><span class="co">#para unir o arquivo shapefile com o dataframe</span></span>
<span id="cb338-2"><a href="#cb338-2" tabindex="-1"></a>sp_pessoa_distr <span class="ot">&lt;-</span> sp_distr <span class="sc">%&gt;%</span></span>
<span id="cb338-3"><a href="#cb338-3" tabindex="-1"></a>  <span class="fu">left_join</span>(pessoa_distr, <span class="at">by =</span> <span class="st">&quot;ds_codigo&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb338-4"><a href="#cb338-4" tabindex="-1"></a>  <span class="fu">st_as_sf</span>()</span>
<span id="cb338-5"><a href="#cb338-5" tabindex="-1"></a><span class="co">#para conferir os nomes das colunas</span></span>
<span id="cb338-6"><a href="#cb338-6" tabindex="-1"></a><span class="fu">names</span>(sp_pessoa_distr)</span></code></pre></div>
<pre><code>##  [1] &quot;ds_codigo&quot;  &quot;ds_nome&quot;    &quot;ds_sigla&quot;   &quot;ds_cd_sub&quot;  &quot;ds_subpref&quot;
##  [6] &quot;ds_areamt&quot;  &quot;ds_areakmt&quot; &quot;Total&quot;      &quot;Branca&quot;     &quot;Preta&quot;     
## [11] &quot;Amarela&quot;    &quot;Parda&quot;      &quot;Indigena&quot;   &quot;geometry&quot;</code></pre>
<div class="sourceCode" id="cb340"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb340-1"><a href="#cb340-1" tabindex="-1"></a><span class="co">#conferindo o tipo de objeto obtido</span></span>
<span id="cb340-2"><a href="#cb340-2" tabindex="-1"></a><span class="fu">head</span>(sp_pessoa_distr)</span></code></pre></div>
<pre><code>## Simple feature collection with 6 features and 13 fields
## Geometry type: POLYGON
## Dimension:     XY
## Bounding box:  xmin: 315542 ymin: 7343743 xmax: 360618.2 ymax: 7408231
## Projected CRS: SIRGAS 2000 / UTM zone 23S
##   ds_codigo        ds_nome ds_sigla ds_cd_sub       ds_subpref
## 1        51       MANDAQUI      MAN        05 SANTANA-TUCURUVI
## 2        52       MARSILAC      MAR        20      PARELHEIROS
## 3        32          MOEMA      MOE        12     VILA MARIANA
## 4        31     GUAIANASES      GUA        28       GUAIANASES
## 5        33       IGUATEMI      IGU        30       SAO MATEUS
## 6        36 ITAIM PAULISTA      IPA        24   ITAIM PAULISTA
##   ds_areamt ds_areakmt  Total Branca Preta Amarela  Parda Indigena
## 1  13247864      13.25 107580  79320  6209    2012  19985       54
## 2 208195746     208.20   8258   4045   463      92   3533       42
## 3   9079516       9.08  83368  75550   797    2915   4057       49
## 4   8938527       8.94 103996  49907  9995     478  43557       59
## 5  19583557      19.58 127662  61822  8559     785  56373      123
## 6  12143789      12.14 224074  99761 19493    1333 103245      236
##                         geometry
## 1 POLYGON ((330950.4 7407837,...
## 2 POLYGON ((336124.1 7355302,...
## 3 POLYGON ((331242.2 7392162,...
## 4 POLYGON ((355108.2 7393291,...
## 5 POLYGON ((350859.9 7389600,...
## 6 POLYGON ((359239.6 7402470,...</code></pre>
</div>
<div id="definição-dos-pontos-aleatórios" class="section level2 hasAnchor" number="9.2">
<h2 class="hasAnchor"><span class="header-section-number">9.2</span> Definição dos pontos aleatórios<a href="#definição-dos-pontos-aleatórios" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>A terceira etapa para a elaboração do mapa de densidade de pontos é a geração de um objeto de pontos definindo o valor de cada ponto. Se temos mais de 11 milhões de pessoas em São Paulo, um mapa com 11 milhões de pontos não ajudaria muito, pois eles cobririam todos os polígonos. Se cada ponto tiver o valor de 200 pessoas, teremos 55 mil pontos. Precisamos ficar atentos com os valores baixos da tabela. A população indígena varia de 16 a 1002 pessoas nos Distritos com menor e maior número, respectivamente. Ou seja, na divisão por 200, distritos com menos de 200 pessoas autodeclaradas indígenas vão ter 1 ponto devido a àproximação que será feita (superestimando valores baixos para evitar polígono com zero ponto desta etnia).</p>
<div class="sourceCode" id="cb342"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb342-1"><a href="#cb342-1" tabindex="-1"></a><span class="co"># para gerar objeto do número de pontos para serem plotados para cada etnia (1 para cada 200 pessoas)</span></span>
<span id="cb342-2"><a href="#cb342-2" tabindex="-1"></a>num.pontos200 <span class="ot">&lt;-</span> <span class="fu">ceiling</span>(<span class="fu">select</span>(<span class="fu">as.data.frame</span>(sp_pessoa_distr), Branca<span class="sc">:</span>Indigena) <span class="sc">/</span> <span class="dv">200</span>)</span>
<span id="cb342-3"><a href="#cb342-3" tabindex="-1"></a><span class="co">#para ver a classe do objeto criado</span></span>
<span id="cb342-4"><a href="#cb342-4" tabindex="-1"></a><span class="fu">class</span>(num.pontos200)</span></code></pre></div>
<pre><code>## [1] &quot;data.frame&quot;</code></pre>
<p>Vamos olhar o objeto gerado.</p>
<div class="sourceCode" id="cb344"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb344-1"><a href="#cb344-1" tabindex="-1"></a><span class="co">#para ver os nomes das colunas</span></span>
<span id="cb344-2"><a href="#cb344-2" tabindex="-1"></a><span class="fu">names</span>(num.pontos200)</span></code></pre></div>
<pre><code>## [1] &quot;Branca&quot;   &quot;Preta&quot;    &quot;Amarela&quot;  &quot;Parda&quot;    &quot;Indigena&quot;</code></pre>
<div class="sourceCode" id="cb346"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb346-1"><a href="#cb346-1" tabindex="-1"></a><span class="co">#para visualizar a tabela</span></span>
<span id="cb346-2"><a href="#cb346-2" tabindex="-1"></a><span class="fu">View</span>(num.pontos200)</span></code></pre></div>
<p>A função <code>sapply</code> aplica o comando para todas as colunas. No caso, usamos <code>sapply</code> para ver a classe de todas as colunas.</p>
<div class="sourceCode" id="cb347"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb347-1"><a href="#cb347-1" tabindex="-1"></a><span class="co">#para converter valores numéricos em inteiros (&quot;integer&quot;)</span></span>
<span id="cb347-2"><a href="#cb347-2" tabindex="-1"></a>num.pontos200 <span class="ot">&lt;-</span> num.pontos200 <span class="sc">%&gt;%</span> </span>
<span id="cb347-3"><a href="#cb347-3" tabindex="-1"></a> <span class="fu">mutate_if</span>(is.numeric, as.integer)</span>
<span id="cb347-4"><a href="#cb347-4" tabindex="-1"></a><span class="co">#para verificar as colunas e tipos de dados</span></span>
<span id="cb347-5"><a href="#cb347-5" tabindex="-1"></a><span class="fu">sapply</span>(num.pontos200, class)</span></code></pre></div>
<pre><code>##    Branca     Preta   Amarela     Parda  Indigena 
## &quot;integer&quot; &quot;integer&quot; &quot;integer&quot; &quot;integer&quot; &quot;integer&quot;</code></pre>
<p>Agora vamos distribuir, de forma aleatória (random) os números de pontos gerados por polígono.</p>
<div class="sourceCode" id="cb349"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb349-1"><a href="#cb349-1" tabindex="-1"></a><span class="co">#para gerar os pontos aleatórios em cada polígono: st_sample gera os pontos em cada polígono</span></span>
<span id="cb349-2"><a href="#cb349-2" tabindex="-1"></a><span class="co">#st_cast lança o conjunto como &quot;POINT&quot;</span></span>
<span id="cb349-3"><a href="#cb349-3" tabindex="-1"></a><span class="co">#st_coordinates extrai as coordenadas para uma matriz</span></span>
<span id="cb349-4"><a href="#cb349-4" tabindex="-1"></a><span class="co">#converte como tibble</span></span>
<span id="cb349-5"><a href="#cb349-5" tabindex="-1"></a><span class="co">#setNames define os nomes das colunas</span></span>
<span id="cb349-6"><a href="#cb349-6" tabindex="-1"></a><span class="co">#cria a variável &quot;Etnia&quot;</span></span>
<span id="cb349-7"><a href="#cb349-7" tabindex="-1"></a><span class="co">#map_df une cada tibble da Etnia em um</span></span>
<span id="cb349-8"><a href="#cb349-8" tabindex="-1"></a>pts <span class="ot">&lt;-</span> <span class="fu">map_df</span>(<span class="fu">names</span>(num.pontos200),</span>
<span id="cb349-9"><a href="#cb349-9" tabindex="-1"></a>              <span class="sc">~</span> <span class="fu">st_sample</span>(sp_pessoa_distr, <span class="at">size =</span> num.pontos200[,.x], <span class="at">type =</span> <span class="st">&quot;random&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb349-10"><a href="#cb349-10" tabindex="-1"></a>                    <span class="fu">st_cast</span>(<span class="st">&quot;POINT&quot;</span>) <span class="sc">%&gt;%</span>                                         </span>
<span id="cb349-11"><a href="#cb349-11" tabindex="-1"></a>                    <span class="fu">st_coordinates</span>() <span class="sc">%&gt;%</span>                                         </span>
<span id="cb349-12"><a href="#cb349-12" tabindex="-1"></a>                    <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb349-13"><a href="#cb349-13" tabindex="-1"></a>                    <span class="fu">setNames</span>(<span class="fu">c</span>(<span class="st">&quot;lon&quot;</span>,<span class="st">&quot;lat&quot;</span>)) <span class="sc">%&gt;%</span>                                  </span>
<span id="cb349-14"><a href="#cb349-14" tabindex="-1"></a>                    <span class="fu">mutate</span>(<span class="at">Etnia =</span> <span class="fu">factor</span>(.x, <span class="at">levels =</span> <span class="fu">names</span>((num.pontos200))))        </span>
<span id="cb349-15"><a href="#cb349-15" tabindex="-1"></a>) </span></code></pre></div>
<p>Vamos definir as cores para cada etnia criando uma paleta de cores com o nome “pal”. Tanto o nome das colunas quanto as cores devem estar entre aspas. Por ser um dado qualitativo, as cores devem ser bem diferentes, evitando ordenamento entre elas.</p>
<div class="sourceCode" id="cb350"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb350-1"><a href="#cb350-1" tabindex="-1"></a><span class="co">#para definir as cores para cada etnia</span></span>
<span id="cb350-2"><a href="#cb350-2" tabindex="-1"></a>pal <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Branca&quot;</span> <span class="ot">=</span> <span class="st">&quot;#0087DC&quot;</span>, <span class="st">&quot;Preta&quot;</span> <span class="ot">=</span> <span class="st">&quot;#DC241F&quot;</span>, <span class="st">&quot;Amarela&quot;</span> <span class="ot">=</span> <span class="st">&quot;#FCBB30&quot;</span>, <span class="st">&quot;Parda&quot;</span> <span class="ot">=</span> <span class="st">&quot;#70147A&quot;</span>, <span class="st">&quot;Indigena&quot;</span> <span class="ot">=</span> <span class="st">&quot;#78B943&quot;</span>)</span></code></pre></div>
</div>
<div id="mapa-de-raça-ou-cor-dos-residentes-do-município-de-são-paulo" class="section level2 hasAnchor" number="9.3">
<h2 class="hasAnchor"><span class="header-section-number">9.3</span> Mapa de raça ou cor dos residentes do município de São Paulo<a href="#mapa-de-raça-ou-cor-dos-residentes-do-município-de-são-paulo" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Finalmente vamos elaborar o mapa adicionando as duas camadas: polígono com os Distritos Administrativos e camada de pontos segundo etnia. O mapa terá o fundo em preto, com os limites dos Distritos e textos em branco. A primeira camada (sp_pessoa_distr) será transparente com contorno branco. A segunda camada conterá a informação do objeto “pts” com os pontos aleatórios por polígono (cada ponto valendo 200 pessoas). As cores dos pontos se referem a cada etnia e são definidas pela paleta “pal”. Definimos o CRS = 4989 (SIRGAS 2000). O tema será “theme_void” onde o tamanho da fonte será 30 pontos. <code>labs</code> define os textos para o título, subtítulo e nota de rodapé. <code>guides</code> define as cores da legenda e o tamanho. Por fim, <code>theme</code> define as cores do painel, posição da legenda, margens, cor dos textos e o tamanho da fonte da nota de rodapé.</p>
<div class="sourceCode" id="cb351"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb351-1"><a href="#cb351-1" tabindex="-1"></a><span class="fu">head</span>(sp_pessoa_distr)</span></code></pre></div>
<pre><code>## Simple feature collection with 6 features and 13 fields
## Geometry type: POLYGON
## Dimension:     XY
## Bounding box:  xmin: 315542 ymin: 7343743 xmax: 360618.2 ymax: 7408231
## Projected CRS: SIRGAS 2000 / UTM zone 23S
##   ds_codigo        ds_nome ds_sigla ds_cd_sub       ds_subpref
## 1        51       MANDAQUI      MAN        05 SANTANA-TUCURUVI
## 2        52       MARSILAC      MAR        20      PARELHEIROS
## 3        32          MOEMA      MOE        12     VILA MARIANA
## 4        31     GUAIANASES      GUA        28       GUAIANASES
## 5        33       IGUATEMI      IGU        30       SAO MATEUS
## 6        36 ITAIM PAULISTA      IPA        24   ITAIM PAULISTA
##   ds_areamt ds_areakmt  Total Branca Preta Amarela  Parda Indigena
## 1  13247864      13.25 107580  79320  6209    2012  19985       54
## 2 208195746     208.20   8258   4045   463      92   3533       42
## 3   9079516       9.08  83368  75550   797    2915   4057       49
## 4   8938527       8.94 103996  49907  9995     478  43557       59
## 5  19583557      19.58 127662  61822  8559     785  56373      123
## 6  12143789      12.14 224074  99761 19493    1333 103245      236
##                         geometry
## 1 POLYGON ((330950.4 7407837,...
## 2 POLYGON ((336124.1 7355302,...
## 3 POLYGON ((331242.2 7392162,...
## 4 POLYGON ((355108.2 7393291,...
## 5 POLYGON ((350859.9 7389600,...
## 6 POLYGON ((359239.6 7402470,...</code></pre>
<div class="sourceCode" id="cb353"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb353-1"><a href="#cb353-1" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb353-2"><a href="#cb353-2" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> sp_pessoa_distr, <span class="at">fill =</span> <span class="st">&quot;transparent&quot;</span>, <span class="at">colour =</span> <span class="st">&quot;white&quot;</span>)<span class="sc">+</span></span>
<span id="cb353-3"><a href="#cb353-3" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> pts, <span class="fu">aes</span>(lon, lat, <span class="at">colour =</span> Etnia))<span class="sc">+</span></span>
<span id="cb353-4"><a href="#cb353-4" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> pal)<span class="sc">+</span></span>
<span id="cb353-5"><a href="#cb353-5" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">crs =</span> <span class="dv">31983</span>)<span class="sc">+</span></span>
<span id="cb353-6"><a href="#cb353-6" tabindex="-1"></a>  <span class="fu">theme_void</span>(<span class="at">base_family =</span> <span class="st">&quot;&quot;</span>, <span class="at">base_size =</span> <span class="dv">45</span>)<span class="sc">+</span></span>
<span id="cb353-7"><a href="#cb353-7" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>,</span>
<span id="cb353-8"><a href="#cb353-8" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;Raça ou cor no município de São Paulo, Brasil&quot;</span>,</span>
<span id="cb353-9"><a href="#cb353-9" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;1 ponto = 200 pessoas&quot;</span>,</span>
<span id="cb353-10"><a href="#cb353-10" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">&quot;Fontes de dados: IBGE, Censo Demográfico 2010 | </span><span class="sc">\n</span><span class="st"> </span></span>
<span id="cb353-11"><a href="#cb353-11" tabindex="-1"></a><span class="st">       Elaborado por: @Ligiaviz&quot;</span>)<span class="sc">+</span></span>
<span id="cb353-12"><a href="#cb353-12" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">colour =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">5</span>)))<span class="sc">+</span></span>
<span id="cb353-13"><a href="#cb353-13" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">1.01</span>), <span class="at">legend.direction =</span> <span class="st">&quot;horizontal&quot;</span>,</span>
<span id="cb353-14"><a href="#cb353-14" tabindex="-1"></a>        <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;#212121&quot;</span>, <span class="at">color =</span> <span class="cn">NA</span>), </span>
<span id="cb353-15"><a href="#cb353-15" tabindex="-1"></a>        <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;#212121&quot;</span>, <span class="at">color =</span> <span class="cn">NA</span>),</span>
<span id="cb353-16"><a href="#cb353-16" tabindex="-1"></a>        <span class="at">legend.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;#212121&quot;</span>, <span class="at">color =</span> <span class="cn">NA</span>),</span>
<span id="cb353-17"><a href="#cb353-17" tabindex="-1"></a>        <span class="at">legend.key =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;#212121&quot;</span>, <span class="at">colour =</span> <span class="cn">NA</span>),</span>
<span id="cb353-18"><a href="#cb353-18" tabindex="-1"></a>        <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="st">&quot;cm&quot;</span>),</span>
<span id="cb353-19"><a href="#cb353-19" tabindex="-1"></a>        <span class="at">text =</span>  <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">&quot;white&quot;</span>),</span>
<span id="cb353-20"><a href="#cb353-20" tabindex="-1"></a>        <span class="at">title =</span>  <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">&quot;white&quot;</span>),</span>
<span id="cb353-21"><a href="#cb353-21" tabindex="-1"></a>        <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">35</span>, <span class="at">hjust =</span> <span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb353-22"><a href="#cb353-22" tabindex="-1"></a>  ggspatial<span class="sc">::</span><span class="fu">annotation_scale</span>(<span class="at">location =</span> <span class="st">&quot;br&quot;</span>,</span>
<span id="cb353-23"><a href="#cb353-23" tabindex="-1"></a>                              <span class="at">text_cex=</span> <span class="dv">2</span>,</span>
<span id="cb353-24"><a href="#cb353-24" tabindex="-1"></a>                              <span class="at">text_col =</span> <span class="st">&quot;white&quot;</span>,</span>
<span id="cb353-25"><a href="#cb353-25" tabindex="-1"></a>                              <span class="at">bar_cols =</span> <span class="fu">c</span>(<span class="st">&quot;white&quot;</span>, <span class="st">&quot;white&quot;</span>),</span>
<span id="cb353-26"><a href="#cb353-26" tabindex="-1"></a>                              <span class="at">width_hint =</span> <span class="fl">0.4</span>,</span>
<span id="cb353-27"><a href="#cb353-27" tabindex="-1"></a>                              <span class="at">line_width =</span> <span class="fl">0.5</span>,</span>
<span id="cb353-28"><a href="#cb353-28" tabindex="-1"></a>                              <span class="at">height =</span> <span class="fu">unit</span>(<span class="fl">0.3</span>,<span class="st">&quot;cm&quot;</span>))</span></code></pre></div>
<p>Vamos exportar no formato png com boa resolução.</p>
<div class="sourceCode" id="cb354"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb354-1"><a href="#cb354-1" tabindex="-1"></a><span class="co">#para exportar o mapa como figura</span></span>
<span id="cb354-2"><a href="#cb354-2" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">&quot;etnia.png&quot;</span>, <span class="at">plot =</span> p, <span class="at">dpi =</span> <span class="dv">320</span>, <span class="at">width =</span> <span class="dv">85</span>, <span class="at">height =</span> <span class="dv">70</span>, <span class="at">units =</span> <span class="st">&quot;cm&quot;</span>)</span></code></pre></div>
<p>A figura exportada deverá ter a aparência a seguir.
<img src="etnia.png" width="5354" /></p>
</div>
<div id="referências-sugeridas-2" class="section level2 hasAnchor" number="9.4">
<h2 class="hasAnchor"><span class="header-section-number">9.4</span> Referências sugeridas<a href="#referências-sugeridas-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><strong>Grupos étnicos de Chicago</strong>, desenvovido por <a href="http://www.radicalcartography.net/index.html?chicagodots">Bill Rankin (2009)</a></p>
<p><strong>Votos em Londres, segundo partidos políticos</strong>, <a href="https://gist.github.com/PaulC91/9cc8551d5475620cb5c5d87ee1609257">Tom Campbell</a></p>
<!--chapter:end:09-dens-pontos1.Rmd-->
</div>
</div>
<div id="quanti3" class="section level1 hasAnchor" number="10">
<h1 class="hasAnchor"><span class="header-section-number">10</span> Dados quantitativos relativos: mapa coroplético<a href="#quanti3" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Vimos na Figura @ref(fig:tipos-dados) que podemos classificar os dados em qualitativos e quantitativos. Sendo um dado quantitativo, devemos classificá-se como absoluto ou relativo. As representações por figuras geométricas proporcionais e por densidade de pontos, vistas nos itens anteriores, tratavam de valores absolutos ou contagens. Quando os dados se referem a índices, taxas, porcentagens, densidades, ou seja, qualquer resultado de uma divisão, são classificados como <strong>relativos</strong>. O conceito envolvido neste tipo de dado não é o de <strong>proporcionalidade</strong> (como nos dados absolutos), mas o de <strong>ordem</strong>. A transcrição gráfica da ordem se faz pelas variáveis visuais <em>valor</em>, <em>cor ordenada</em> ou <em>granulação ordenada</em>. Esta representação é a <strong>coroplética</strong>, a mais frequentemente utilizada em Cartografia Temática.
Utilizaremos como exemplos três indicadores na escala intraurbana da Região Metropolitana de São Paulo (RMSP), calculados para as Unidades de Desenvolvimento Humano (UDHs). Com base em dados provenientes de diversas fontes, tais como, Ministério da Saúde (DATASUS/SIM, SINASC, SIH/SUS), Ministério da Educação (Censos Escolares), MapBiomas, Ministério da Cidadania (CadÚnico, Bolsa Família e BPC), Ministério da Economia (RAIS), Tribunal Superior Eleitoral, Ministério do Desenvolvimento Regional (SNIS) e IBGE (Contas Nacionais), o PNUD, a Fundação João Pinheiro e o Instituto de Pesquisa Econômica Aplicada (IPEA) desenvolveram o <a href="http://www.atlasbrasil.org.br/">Atlas do Desenvolvimento Humano no Brasil</a>, publicado em 2013. Foram criadas malhas de UDHs para as Regiões Metropolitanas (RMs) a partir do agrupamento de unidades com a maior homogeneidade interna possível.</p>
<p>Para a elaboração destes mapas precisaremos dos valores dos indicadores para cada UDH da RMSP. A base cartográfica será a malha de UDHs da RMSP disponível no site do Atlas Brasil.</p>
<p>Para darmos início, vamos limpar a memória, verificar e definir o diretório de trabalho.</p>
<div class="sourceCode" id="cb355"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb355-1"><a href="#cb355-1" tabindex="-1"></a><span class="co">#para limpar a memoria</span></span>
<span id="cb355-2"><a href="#cb355-2" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span> <span class="fu">ls</span>())</span>
<span id="cb355-3"><a href="#cb355-3" tabindex="-1"></a><span class="co">#para verificar o diretório de trabalho</span></span>
<span id="cb355-4"><a href="#cb355-4" tabindex="-1"></a><span class="fu">getwd</span>()</span></code></pre></div>
<pre><code>## [1] &quot;C:/Users/l_viz/Documents/RCartoTematica&quot;</code></pre>
<div class="sourceCode" id="cb357"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb357-1"><a href="#cb357-1" tabindex="-1"></a><span class="co">#para ajustar a lingua para portugues usando a funcao</span></span>
<span id="cb357-2"><a href="#cb357-2" tabindex="-1"></a><span class="fu">Sys.setlocale</span>(<span class="at">category =</span> <span class="st">&quot;LC_ALL&quot;</span>, <span class="at">locale =</span> <span class="st">&quot;pt_BR.UTF-8&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;LC_COLLATE=pt_BR.UTF-8;LC_CTYPE=pt_BR.UTF-8;LC_MONETARY=pt_BR.UTF-8;LC_NUMERIC=C;LC_TIME=pt_BR.UTF-8&quot;</code></pre>
<div class="sourceCode" id="cb359"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb359-1"><a href="#cb359-1" tabindex="-1"></a><span class="co">#para desativar a notação científica</span></span>
<span id="cb359-2"><a href="#cb359-2" tabindex="-1"></a><span class="fu">options</span>(<span class="at">scipen =</span> <span class="dv">999</span>)</span></code></pre></div>
<p>Vamos carregar os pacotes que serão utilizados.</p>
<div class="sourceCode" id="cb360"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb360-1"><a href="#cb360-1" tabindex="-1"></a><span class="fu">library</span>(R.utils)</span>
<span id="cb360-2"><a href="#cb360-2" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb360-3"><a href="#cb360-3" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb360-4"><a href="#cb360-4" tabindex="-1"></a><span class="fu">library</span>(ggplot2,<span class="at">warn.conflicts=</span><span class="cn">FALSE</span>)</span>
<span id="cb360-5"><a href="#cb360-5" tabindex="-1"></a><span class="fu">library</span>(ggspatial)</span>
<span id="cb360-6"><a href="#cb360-6" tabindex="-1"></a><span class="fu">library</span>(archive)</span>
<span id="cb360-7"><a href="#cb360-7" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb360-8"><a href="#cb360-8" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span>
<span id="cb360-9"><a href="#cb360-9" tabindex="-1"></a><span class="fu">library</span>(classInt)</span>
<span id="cb360-10"><a href="#cb360-10" tabindex="-1"></a><span class="fu">library</span>(tmap)</span>
<span id="cb360-11"><a href="#cb360-11" tabindex="-1"></a><span class="fu">library</span>(RColorBrewer)</span></code></pre></div>
<div id="bancos-de-dados" class="section level2 hasAnchor" number="10.1">
<h2 class="hasAnchor"><span class="header-section-number">10.1</span> Bancos de dados<a href="#bancos-de-dados" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>O arquivo shapefile das UDHs está disponível de forma compactada junto com os indicadores por RM no sítio do Atlas Brasil. Como em capítulos anteriores, faremos o download do arquivo zip após a identificação da url dos dados. Para baixar os dados, usaremos a função <code>download.file</code> do pacote <strong>R.utils</strong>.</p>
<div class="sourceCode" id="cb361"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb361-1"><a href="#cb361-1" tabindex="-1"></a><span class="co">#se quiser identificar a url de um determinado conjunto de dados, faça o download do arquivo desejado manualmente e clique em Ctrl+J. O navegador mostrará o caminho completo, que poderá ser copiado. Para o download do arquivo com as UDHs da RMSP, use o comando a seguir. Use o nome do arquivo como arquivo de destino (destfile) </span></span>
<span id="cb361-2"><a href="#cb361-2" tabindex="-1"></a><span class="fu">download.file</span>(<span class="at">url =</span> <span class="st">&quot;https://dv69vw.dm.files.1drv.com/y4mGCIOeG89QN-sOTMEQ4X1lyzmraQiwh4LzSTYvcxb9rrvkkmW_Am300R8_-WB_hZ-qtfPffeEoJ0rRVFpUV95lvP-nOvxI1Q-5iQzqHAwPeWMy8uDZ1pBM918KVAmFUFWpfWRIcINlOg1T9ooCQcVE_Qg42gmf-zjrX6IfvtU2e3Ca6ADD8ZDXNpSSrnjroE8490cc8CK9AHk_OY3rQ8-Ow&quot;</span>, <span class="at">destfile =</span> <span class="st">&quot;dados_sp.zip&quot;</span>, <span class="at">mode=</span><span class="st">&quot;wb&quot;</span>)</span></code></pre></div>
<p>O arquivo “RM 63500 São Paulo - Base UDH 2000_2010.xlsx” contém os indicadores que usaremos para a elaboração dos mapas.
Vamos ler o arquivo xlsx e criar um objeto em R com o nome de “dadosUDH”.</p>
<div class="sourceCode" id="cb362"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb362-1"><a href="#cb362-1" tabindex="-1"></a><span class="co">#para ler o arquivo xlsx</span></span>
<span id="cb362-2"><a href="#cb362-2" tabindex="-1"></a>dadosUDH <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">&quot;RM 63500 São Paulo - Base UDH 2000_2010.xlsx&quot;</span>)</span>
<span id="cb362-3"><a href="#cb362-3" tabindex="-1"></a><span class="co">#para ver as 6 primeiras linhas de dadosUDH</span></span>
<span id="cb362-4"><a href="#cb362-4" tabindex="-1"></a><span class="fu">head</span>(dadosUDH)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 237
##          Cod_ID  UDH_Atlas NOME_UDH CODMUN6 NOME_MUN CODUF NOME_UF CODRM
##           &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;      &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt;
## 1 1350390100001    1.35e12 Fazenda…  350390 Arujá (…    35 SP      63500
## 2 1350390100002    1.35e12 Arujá :…  350390 Arujá (…    35 SP      63500
## 3 1350390100003    1.35e12 Arujá :…  350390 Arujá (…    35 SP      63500
## 4 1350390100004    1.35e12 Arujá :…  350390 Arujá (…    35 SP      63500
## 5 1350390100005    1.35e12 São Ben…  350390 Arujá (…    35 SP      63500
## 6 1350390100006    1.35e12 Arujá :…  350390 Arujá (…    35 SP      63500
## # ℹ 229 more variables: NOME_RM &lt;chr&gt;, ANO &lt;dbl&gt;, ESPVIDA &lt;dbl&gt;,
## #   FECTOT &lt;dbl&gt;, MORT1 &lt;dbl&gt;, MORT5 &lt;dbl&gt;, SOBRE40 &lt;dbl&gt;,
## #   SOBRE60 &lt;dbl&gt;, RAZDEP &lt;dbl&gt;, T_ENV &lt;dbl&gt;, E_ANOSESTUDO &lt;dbl&gt;,
## #   T_ANALF11A14 &lt;dbl&gt;, T_ANALF15A17 &lt;dbl&gt;, T_ANALF15M &lt;dbl&gt;,
## #   T_ANALF18A24 &lt;dbl&gt;, T_ANALF18M &lt;dbl&gt;, T_ANALF25A29 &lt;dbl&gt;,
## #   T_ANALF25M &lt;dbl&gt;, T_ATRASO_2_BASICO &lt;dbl&gt;, T_ATRASO_2_FUND &lt;dbl&gt;,
## #   T_FBBAS &lt;dbl&gt;, T_FBFUND &lt;dbl&gt;, T_FBMED &lt;dbl&gt;, T_FBSUPER &lt;dbl&gt;, …</code></pre>
<p>O arquivo xlsx que foi aberto tem 237 colunas, das quais 227 são indicadores criados para o Atlas Brasil.</p>
<div class="sourceCode" id="cb364"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb364-1"><a href="#cb364-1" tabindex="-1"></a><span class="co"># Para ler o arquivo shapefile</span></span>
<span id="cb364-2"><a href="#cb364-2" tabindex="-1"></a>UDH <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">&quot;RM_SaoPaulo_UDH_region.shp&quot;</span>)</span></code></pre></div>
<pre><code>## Reading layer `RM_SaoPaulo_UDH_region&#39; from data source 
##   `C:\Users\l_viz\Documents\RCartoTematica\RM_SaoPaulo_UDH_region.shp&#39; 
##   using driver `ESRI Shapefile&#39;
## Simple feature collection with 2858 features and 4 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: -47.20852 ymin: -24.06425 xmax: -45.69481 ymax: -23.18342
## Geodetic CRS:  WGS 84</code></pre>
<p>Para verificar o tipo de objeto, usamos <code>class</code> do pacote <strong>R.utils</strong>. Para olharmos as 6 primeiras linhas do objeto, usamos a função <code>head</code> do mesmo pacote.</p>
<div class="sourceCode" id="cb366"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb366-1"><a href="#cb366-1" tabindex="-1"></a><span class="co">#para verificar o tipo de objeto</span></span>
<span id="cb366-2"><a href="#cb366-2" tabindex="-1"></a><span class="fu">class</span>(UDH)</span></code></pre></div>
<pre><code>## [1] &quot;sf&quot;         &quot;data.frame&quot;</code></pre>
<div class="sourceCode" id="cb368"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb368-1"><a href="#cb368-1" tabindex="-1"></a><span class="co">#para vermos as 6 primeiras linhas</span></span>
<span id="cb368-2"><a href="#cb368-2" tabindex="-1"></a><span class="fu">head</span>(UDH)</span></code></pre></div>
<pre><code>## Simple feature collection with 6 features and 4 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: -46.37286 ymin: -23.43001 xmax: -46.24768 ymax: -23.32145
## Geodetic CRS:  WGS 84
##       UDH_ATLAS CD_GEOCODM NM_MUNICIP  RM
## 1 1350390100001    3503901   ARUJ\xc1 635
## 2 1350390100002    3503901   ARUJ\xc1 635
## 3 1350390100003    3503901   ARUJ\xc1 635
## 4 1350390100004    3503901   ARUJ\xc1 635
## 5 1350390100005    3503901   ARUJ\xc1 635
## 6 1350390100006    3503901   ARUJ\xc1 635
##                         geometry
## 1 MULTIPOLYGON (((-46.37286 -...
## 2 MULTIPOLYGON (((-46.31341 -...
## 3 MULTIPOLYGON (((-46.28883 -...
## 4 MULTIPOLYGON (((-46.27519 -...
## 5 MULTIPOLYGON (((-46.24768 -...
## 6 MULTIPOLYGON (((-46.31747 -...</code></pre>
<p>Vamos visualizar as UDHs usando <code>ggplot</code> do pacote <strong>ggplot2</strong>, definindo a geometria a partir de <code>geom_sf</code> com o contorno na cor preta e o preenchimento em laranja.</p>
<div class="sourceCode" id="cb370"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb370-1"><a href="#cb370-1" tabindex="-1"></a><span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb370-2"><a href="#cb370-2" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> UDH, <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;orange&quot;</span>) <span class="co">#para plotar UDH</span></span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-174-1.png" width="672" /></p>
<div class="sourceCode" id="cb371"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb371-1"><a href="#cb371-1" tabindex="-1"></a><span class="co">#para ver as colunas de UDH</span></span>
<span id="cb371-2"><a href="#cb371-2" tabindex="-1"></a><span class="fu">names</span>(UDH)</span></code></pre></div>
<pre><code>## [1] &quot;UDH_ATLAS&quot;  &quot;CD_GEOCODM&quot; &quot;NM_MUNICIP&quot; &quot;RM&quot;         &quot;geometry&quot;</code></pre>
<p>Como nosso objetivo é fazer alguns mapas da RMSP, no arquivo <strong>dadosUDH</strong> vamos selecionar algumas colunas das variáveis que nos interessam: UDH_Atlas, NOME_MUN, P_SUPER, T_LUZ e IDHM. Temos sempre que manter a coluna de identificador que permitirá a união entre o shapefile e o banco de dados.</p>
<div class="sourceCode" id="cb373"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb373-1"><a href="#cb373-1" tabindex="-1"></a>dados_RMSP <span class="ot">&lt;-</span> dadosUDH <span class="sc">%&gt;%</span></span>
<span id="cb373-2"><a href="#cb373-2" tabindex="-1"></a>  <span class="fu">select</span>(UDH_Atlas, NOME_MUN, P_SUPER, T_LUZ, IDHM)</span>
<span id="cb373-3"><a href="#cb373-3" tabindex="-1"></a><span class="fu">head</span>(dados_RMSP)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 5
##       UDH_Atlas NOME_MUN   P_SUPER T_LUZ  IDHM
##           &lt;dbl&gt; &lt;chr&gt;        &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 1350390100001 Arujá (SP)    0.62  99.7 0.584
## 2 1350390100002 Arujá (SP)    0.93 100   0.584
## 3 1350390100003 Arujá (SP)    7.68  98.8 0.688
## 4 1350390100004 Arujá (SP)    0.93 100   0.584
## 5 1350390100005 Arujá (SP)   25.3   99.8 0.793
## 6 1350390100006 Arujá (SP)    7.68  98.8 0.688</code></pre>
<p>Como vimos, a coluna “UDH_Atlas” aparece como numérica “dbl”(double) e precisa ser convertida para caractere. Usamos a função a seguir.</p>
<div class="sourceCode" id="cb375"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb375-1"><a href="#cb375-1" tabindex="-1"></a><span class="co">#para converter &quot;dbl&quot; para &quot;chr&quot;</span></span>
<span id="cb375-2"><a href="#cb375-2" tabindex="-1"></a>dados_RMSP <span class="ot">&lt;-</span> dados_RMSP <span class="sc">%&gt;%</span></span>
<span id="cb375-3"><a href="#cb375-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">UDH_Atlas =</span> <span class="fu">as.character</span>(UDH_Atlas))</span>
<span id="cb375-4"><a href="#cb375-4" tabindex="-1"></a><span class="fu">head</span>(dados_RMSP)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 5
##   UDH_Atlas     NOME_MUN   P_SUPER T_LUZ  IDHM
##   &lt;chr&gt;         &lt;chr&gt;        &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 1350390100001 Arujá (SP)    0.62  99.7 0.584
## 2 1350390100002 Arujá (SP)    0.93 100   0.584
## 3 1350390100003 Arujá (SP)    7.68  98.8 0.688
## 4 1350390100004 Arujá (SP)    0.93 100   0.584
## 5 1350390100005 Arujá (SP)   25.3   99.8 0.793
## 6 1350390100006 Arujá (SP)    7.68  98.8 0.688</code></pre>
<p>Outro elemento importante é a grafia do nome da coluna que identifica cada UDH. Em <strong>dados_RMSP</strong>, a grafia da coluna é <strong>UDH_Atlas</strong>, enquanto no objeto <strong>UDH</strong>, a grafia é <strong>UDH_ATLAS</strong>. Embora o conteúdo seja o mesmo, a mistura entre caixa alta e caixa baixa nas letras, não permite a união entre a tabela e a geometria. Vamos, então, corrigir a grafia no objeto <strong>dados_RMSP</strong>.</p>
<div class="sourceCode" id="cb377"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb377-1"><a href="#cb377-1" tabindex="-1"></a><span class="co">#para alterar o nome da coluna UDH_Atlas</span></span>
<span id="cb377-2"><a href="#cb377-2" tabindex="-1"></a><span class="fu">names</span>(dados_RMSP) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;UDH_ATLAS&#39;</span>, <span class="st">&#39;NOME_MUN&#39;</span>, <span class="st">&#39;P_SUPER&#39;</span>, <span class="st">&#39;T_LUZ&#39;</span>, <span class="st">&#39;IDHM&#39;</span>)</span>
<span id="cb377-3"><a href="#cb377-3" tabindex="-1"></a><span class="co">#para verificar que a alteração foi feita</span></span>
<span id="cb377-4"><a href="#cb377-4" tabindex="-1"></a><span class="fu">names</span>(dados_RMSP)</span></code></pre></div>
<pre><code>## [1] &quot;UDH_ATLAS&quot; &quot;NOME_MUN&quot;  &quot;P_SUPER&quot;   &quot;T_LUZ&quot;     &quot;IDHM&quot;</code></pre>
<p>Com a tabela compatível com o shapefile, podemos uni-los. Vamos chamar o novo objeto de “udh_dados_rmsp” e usar a função <code>left_join</code>, indicando o campo de união (UDH_Atlas). Uniremos o data.frame “dados_RMSP” ao objeto “sf” (simple feature) “UDH”. Então, tranformamos o novo objeto em classe “sf” com a função <code>st_as_sf</code>.</p>
<div class="sourceCode" id="cb379"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb379-1"><a href="#cb379-1" tabindex="-1"></a><span class="co">#para unir o arquivo shapefile com o dataframe</span></span>
<span id="cb379-2"><a href="#cb379-2" tabindex="-1"></a>udh_dados_rmsp <span class="ot">&lt;-</span> UDH <span class="sc">%&gt;%</span></span>
<span id="cb379-3"><a href="#cb379-3" tabindex="-1"></a>  <span class="fu">left_join</span>(dados_RMSP, <span class="at">by =</span> <span class="st">&quot;UDH_ATLAS&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb379-4"><a href="#cb379-4" tabindex="-1"></a>  <span class="fu">st_as_sf</span>()</span>
<span id="cb379-5"><a href="#cb379-5" tabindex="-1"></a><span class="co">#para conferir os nomes das colunas</span></span>
<span id="cb379-6"><a href="#cb379-6" tabindex="-1"></a><span class="fu">names</span>(udh_dados_rmsp)</span></code></pre></div>
<pre><code>## [1] &quot;UDH_ATLAS&quot;  &quot;CD_GEOCODM&quot; &quot;NM_MUNICIP&quot; &quot;RM&quot;         &quot;NOME_MUN&quot;  
## [6] &quot;P_SUPER&quot;    &quot;T_LUZ&quot;      &quot;IDHM&quot;       &quot;geometry&quot;</code></pre>
<div class="sourceCode" id="cb381"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb381-1"><a href="#cb381-1" tabindex="-1"></a><span class="co">#conferindo o tipo de objeto obtido</span></span>
<span id="cb381-2"><a href="#cb381-2" tabindex="-1"></a><span class="fu">head</span>(udh_dados_rmsp)</span></code></pre></div>
<pre><code>## Simple feature collection with 6 features and 8 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: -46.37286 ymin: -23.39725 xmax: -46.28883 ymax: -23.32145
## Geodetic CRS:  WGS 84
##       UDH_ATLAS CD_GEOCODM NM_MUNICIP  RM   NOME_MUN P_SUPER  T_LUZ
## 1 1350390100001    3503901   ARUJ\xc1 635 Arujá (SP)    0.62  99.72
## 2 1350390100001    3503901   ARUJ\xc1 635 Arujá (SP)    6.87  99.70
## 3 1350390100002    3503901   ARUJ\xc1 635 Arujá (SP)    0.93 100.00
## 4 1350390100002    3503901   ARUJ\xc1 635 Arujá (SP)    3.12 100.00
## 5 1350390100003    3503901   ARUJ\xc1 635 Arujá (SP)    7.68  98.75
## 6 1350390100003    3503901   ARUJ\xc1 635 Arujá (SP)   20.41 100.00
##    IDHM                       geometry
## 1 0.584 MULTIPOLYGON (((-46.37286 -...
## 2 0.733 MULTIPOLYGON (((-46.37286 -...
## 3 0.584 MULTIPOLYGON (((-46.31341 -...
## 4 0.695 MULTIPOLYGON (((-46.31341 -...
## 5 0.688 MULTIPOLYGON (((-46.28883 -...
## 6 0.812 MULTIPOLYGON (((-46.28883 -...</code></pre>
</div>
<div id="mapas-coropléticos" class="section level2 hasAnchor" number="10.2">
<h2 class="hasAnchor"><span class="header-section-number">10.2</span> Mapas coropléticos<a href="#mapas-coropléticos" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Existem decisões importantes quando vamos fazer um mapa coroplético:</p>
<ul>
<li><p>o número de classes;</p></li>
<li><p>como fazer a discretização (dividir os intervalos das classes);</p></li>
<li><p>qual paleta de cores utilizar.</p></li>
</ul>
<p>Todos esses aspectos influirão na percepção visual do padrão espacial resultante.
Vamos olhar o resumo das variáveis em nosso banco de dados.</p>
<div class="sourceCode" id="cb383"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb383-1"><a href="#cb383-1" tabindex="-1"></a><span class="co">#para resumir os dados quantitativos</span></span>
<span id="cb383-2"><a href="#cb383-2" tabindex="-1"></a><span class="fu">summary</span>(udh_dados_rmsp)</span></code></pre></div>
<pre><code>##   UDH_ATLAS          CD_GEOCODM         NM_MUNICIP       
##  Length:5716        Length:5716        Length:5716       
##  Class :character   Class :character   Class :character  
##  Mode  :character   Mode  :character   Mode  :character  
##                                                          
##                                                          
##                                                          
##                                                          
##       RM              NOME_MUN            P_SUPER          T_LUZ       
##  Length:5716        Length:5716        Min.   : 0.00   Min.   : 95.07  
##  Class :character   Class :character   1st Qu.: 2.18   1st Qu.: 99.90  
##  Mode  :character   Mode  :character   Median : 5.85   Median :100.00  
##                                        Mean   :12.42   Mean   : 99.88  
##                                        3rd Qu.:16.98   3rd Qu.:100.00  
##                                        Max.   :77.07   Max.   :100.00  
##                                        NA&#39;s   :131     NA&#39;s   :131     
##       IDHM                 geometry   
##  Min.   :0.4790   MULTIPOLYGON :5716  
##  1st Qu.:0.6450   epsg:4326    :   0  
##  Median :0.7150   +proj=long...:   0  
##  Mean   :0.7188                       
##  3rd Qu.:0.7930                       
##  Max.   :0.9650                       
##  NA&#39;s   :131</code></pre>
<p>Existem três variáveis que nos interessam para elaborar mapas coropléticos. O arquivo “A - DICIONÁRIO dos indicadores do Atlas.xlsx” apresenta a explicação de todas as variáveis do banco de dados.
A variável <strong>P_SUPER</strong> é o percentual das pessoas ocupadas com nível de escolaridade superior completo (Razão entre o número de pessoas de 18 anos ou mais de idade ocupadas e que já concluíram a graduação do ensino superior e o número total de pessoas ocupadas nessa faixa etária, multiplicada por 100). É importantíssimo que saibamos exatamente a definição das variáveis utilizadas para que possamos interpretar adequadamente os resultados obtidos.
A variável <strong>T_LUZ</strong> é o percentual da população que vive em domicílios com energia elétrica (Razão entre a população que vive em domicílios particulares permanentes com iluminação elétrica e a população total residente em domicílios particulares permanentes, multiplicada por 100. Considera-se iluminação proveniente ou não de uma rede geral, com ou sem medidor).
A variável <strong>IDHM</strong> é o Índice de Desenvolvimento Humano Municipal (Média geométrica dos índices das dimensões Renda, Educação e Longevidade, com pesos iguais). A dimensão Educação é obtida através da média geométrica do subíndice de frequência escolar, com peso de 2/3, e do subíndice de escolaridade, com peso de 1/3. A dimensão Longevidade é obtida a partir do indicador Esperança de vida ao nascer, através da fórmula: [(valor observado do indicador) - (valor mínimo)] / [(valor máximo) - (valor mínimo)], onde os valores mínimo e máximo são 25 e 85 anos, respectivamente. A dimensão Renda é obtida a partir do indicador Renda per capita, através da fórmula: [ln (valor observado do indicador) - ln (valor mínimo)] / [ln (valor máximo) - ln (valor mínimo)], onde os valores mínimo e máximo são R$ 8,00 e R$ 4.033,00 (a preços de agosto de 2010).</p>
<p>Conhecendo as variáveis que vamos mapear, vamos para as definições necessárias para elaborar os mapas. Vamos começar pela definição do número de classes. Este aspecto afeta diretamente a capacidade de identificar as classes em um mapa. Um mapa pode ser do tipo “sem classes” ou do tipo “com classes”. Os mapas sem classes atribuem uma tonalidade a cada valor do conjunto de dados. É muito interessante para termos ideia do padrão geral do mapa. No entanto, o leitor dificilmente conseguirá identificar o valor de cada tonalidade porque a legenda será apresentada em coluna única. Assim, os mapas divididos em classes são mais utilizados. Ao definir o número de classes, se utilizarmos poucas classes (menos de 4), podemos perder as situações intermediárias do fenômeno representado, resultando em grande simplificação. Se usarmos mais de 9 classes, por outro lado, o leitor terá dificuldade de identificar as tonalidades em uma escala monocromática. O intervalo entre 4 e 7 classes tem sido apontado como o mais indicado. Podemos utilizar a fórmula de Sturges para orientação sobre o número de classes (<em>k</em>). Na fórmula a seguir, <em>n</em> significa o número de unidades geográficas (no nosso caso, o número de UDHs).</p>
<p><span class="math display">\[
k = 1 + 3,3*log (n)
\]</span>
Como vimos com a função <code>summary</code>, o shapefile de udh_dados_rmsp tem 5716 UDHs. Aplicando a fórmula de Sturges, teríamos 13,4 classes. De acordo com a fórmula, com 70 unidades geográficas já atingiríamos o limite de 7 classes. Assim, como regra geral, acima de 70 unidades, podemos usar 7 classes, para uma paleta monocromática. Se a paleta tiver duas cores opostas (e.g., azul e vermelho), poderíamos ter 7 classes em tons de azul e sete em tons de vermelho. Em paletas com cores ordenadas, um número levemente mais alto de classes seria aceitável. Neste caso, a experiência de quem faz o mapa ajudaria na decisão.</p>
<p>A segunda decisão necessária diz respeito a como dividir os intervalos das classes. Para isso, precisaremos recorrer a conceitos muito básicos de estatística descritiva. Na prática, precisamos avaliar a distribuição dos dados da variável de interesse. A melhor forma de fazer isso é examinarmos o histograma da variável. Um histograma mostra a frequência dos intervalos dos dados e permite avaliar se a distribuição se assemelha a uma distribuição normal ou Gaussiana. A distribuição normal é uma curva simétrica em torno do seu ponto médio, apresentando um formato de sino. Quando os dados apresentam simetria, a forma de discretização afetará pouco o padrão espacial do mapa. No entanto, quando há grande assimetria nos dados é necessário um cuidado maior para que a representação cartográfica comunique o padrão espacial do fenômeno de forma mais adequada.
Vamos, então, examinar os histogramas das variáveis IDHM, P_SUPER e T_LUZ.
Com o pacote <strong>ggplot2</strong> vamos criar um objeto <strong>histo_idhm</strong>. Inicialmente, usamos a função <code>ggplot</code>, indicando o nome do objeto <em>sf</em> e da variável de interesse (IDHM). Adicionamos a função <code>geom_histogram</code>, definindo o número de classes para o histograma, que não precisa ser o número de classes do mapa (neste caso usamos bins=12). Definimos o eixo y como “density” porque é requerido para desenharmos a curva normal. Escolhemos a cor de contorno das colunas como “blue” e a cor de preenchimento como “lightblue”. Como vimos com a função <code>summary</code>, existem 131 UDHs com valores faltantes (NAs). Precisamos desconsiderar estas unidades usando <code>na.rm = T</code>. A função <code>geom_vline</code> desenha uma linha vertical sobre o histograma. Vamos usá-la para posicionar o valor da média do conjunto de dados (<em>mean</em>). Definimos a espessura da linha (size=1), sua cor (<em>orange</em>, laranja) e o tipo de traçado (<em>dashed</em>, pontilhado). Para o desenho da curva normal sobre o histograma, precisamos da função <code>stat_function</code>. Definimos o tipo de função (fun = dnorm), a cor da linha (colour= “red”), sua espessura (size = 1) e os argumentos, indicando a média, sem os valores faltantes (mean e na.rm = T) e o desvio padrão (<em>standard deviation</em> = sd), indicando (sd e na.rm = T). O mesmo código será usado para as variáveis P_SUPER e T_LUZ, apenas mudando os nomes das variáveis.</p>
<div class="sourceCode" id="cb385"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb385-1"><a href="#cb385-1" tabindex="-1"></a>histo_idhm <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(udh_dados_rmsp, <span class="fu">aes</span>(<span class="at">x=</span>IDHM))<span class="sc">+</span> <span class="co"># Draw histogram with density</span></span>
<span id="cb385-2"><a href="#cb385-2" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins=</span><span class="dv">12</span>, <span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">after_stat</span>(density)), </span>
<span id="cb385-3"><a href="#cb385-3" tabindex="-1"></a>                              <span class="at">colour =</span> <span class="st">&quot;blue&quot;</span>, </span>
<span id="cb385-4"><a href="#cb385-4" tabindex="-1"></a>                              <span class="at">fill=</span><span class="st">&quot;lightblue&quot;</span>, </span>
<span id="cb385-5"><a href="#cb385-5" tabindex="-1"></a>                              <span class="at">na.rm =</span> T)<span class="sc">+</span></span>
<span id="cb385-6"><a href="#cb385-6" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">mean</span>(udh_dados_rmsp<span class="sc">$</span>IDHM, <span class="at">na.rm =</span> T), </span>
<span id="cb385-7"><a href="#cb385-7" tabindex="-1"></a>             <span class="at">linewidth =</span> <span class="dv">1</span>, </span>
<span id="cb385-8"><a href="#cb385-8" tabindex="-1"></a>             <span class="at">colour =</span> <span class="st">&quot;orange&quot;</span>, </span>
<span id="cb385-9"><a href="#cb385-9" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>)<span class="sc">+</span></span>
<span id="cb385-10"><a href="#cb385-10" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="at">fun =</span> dnorm, </span>
<span id="cb385-11"><a href="#cb385-11" tabindex="-1"></a>                <span class="at">colour =</span> <span class="st">&quot;red&quot;</span>, </span>
<span id="cb385-12"><a href="#cb385-12" tabindex="-1"></a>                <span class="at">size =</span> <span class="dv">1</span>,</span>
<span id="cb385-13"><a href="#cb385-13" tabindex="-1"></a>                <span class="at">args =</span> <span class="fu">list</span>(<span class="at">mean =</span> <span class="fu">mean</span>(udh_dados_rmsp<span class="sc">$</span>IDHM, <span class="at">na.rm =</span> T),</span>
<span id="cb385-14"><a href="#cb385-14" tabindex="-1"></a>                            <span class="at">sd =</span> <span class="fu">sd</span>(udh_dados_rmsp<span class="sc">$</span>IDHM, <span class="at">na.rm =</span> T))</span>
<span id="cb385-15"><a href="#cb385-15" tabindex="-1"></a>  )</span></code></pre></div>
<div class="sourceCode" id="cb386"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb386-1"><a href="#cb386-1" tabindex="-1"></a>histo_luz <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(udh_dados_rmsp, <span class="fu">aes</span>(<span class="at">x=</span>T_LUZ)) <span class="sc">+</span> <span class="co"># Draw histogram with density</span></span>
<span id="cb386-2"><a href="#cb386-2" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins=</span><span class="dv">30</span>, <span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">after_stat</span>(density)), </span>
<span id="cb386-3"><a href="#cb386-3" tabindex="-1"></a>                              <span class="at">colour =</span> <span class="st">&quot;blue&quot;</span>,</span>
<span id="cb386-4"><a href="#cb386-4" tabindex="-1"></a>                              <span class="at">fill=</span><span class="st">&quot;lightblue&quot;</span>, </span>
<span id="cb386-5"><a href="#cb386-5" tabindex="-1"></a>                              <span class="at">na.rm =</span> T)<span class="sc">+</span></span>
<span id="cb386-6"><a href="#cb386-6" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">mean</span>(udh_dados_rmsp<span class="sc">$</span>T_LUZ, <span class="at">na.rm =</span> T), </span>
<span id="cb386-7"><a href="#cb386-7" tabindex="-1"></a>             <span class="at">linewidth =</span> <span class="dv">1</span>, </span>
<span id="cb386-8"><a href="#cb386-8" tabindex="-1"></a>             <span class="at">colour =</span> <span class="st">&quot;orange&quot;</span>, </span>
<span id="cb386-9"><a href="#cb386-9" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>)<span class="sc">+</span></span>
<span id="cb386-10"><a href="#cb386-10" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="at">fun =</span> dnorm, <span class="at">colour =</span> <span class="st">&quot;red&quot;</span>, </span>
<span id="cb386-11"><a href="#cb386-11" tabindex="-1"></a>                <span class="at">size =</span> <span class="dv">1</span>,</span>
<span id="cb386-12"><a href="#cb386-12" tabindex="-1"></a>                <span class="at">args =</span> <span class="fu">list</span>(<span class="at">mean =</span> <span class="fu">mean</span>(udh_dados_rmsp<span class="sc">$</span>T_LUZ, <span class="at">na.rm =</span> T),</span>
<span id="cb386-13"><a href="#cb386-13" tabindex="-1"></a>                            <span class="at">sd =</span> <span class="fu">sd</span>(udh_dados_rmsp<span class="sc">$</span>T_LUZ, <span class="at">na.rm =</span> T))</span>
<span id="cb386-14"><a href="#cb386-14" tabindex="-1"></a>  )</span></code></pre></div>
<div class="sourceCode" id="cb387"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb387-1"><a href="#cb387-1" tabindex="-1"></a>histo_sup <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(udh_dados_rmsp, <span class="fu">aes</span>(<span class="at">x=</span>P_SUPER)) <span class="sc">+</span>     <span class="co"># Draw histogram with density</span></span>
<span id="cb387-2"><a href="#cb387-2" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins=</span><span class="dv">30</span>, <span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">after_stat</span>(density)), </span>
<span id="cb387-3"><a href="#cb387-3" tabindex="-1"></a>                              <span class="at">colour =</span> <span class="st">&quot;blue&quot;</span>,</span>
<span id="cb387-4"><a href="#cb387-4" tabindex="-1"></a>                              <span class="at">fill=</span><span class="st">&quot;lightblue&quot;</span>, </span>
<span id="cb387-5"><a href="#cb387-5" tabindex="-1"></a>                              <span class="at">na.rm =</span> T)<span class="sc">+</span></span>
<span id="cb387-6"><a href="#cb387-6" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">mean</span>(udh_dados_rmsp<span class="sc">$</span>P_SUPER, <span class="at">na.rm =</span> T),</span>
<span id="cb387-7"><a href="#cb387-7" tabindex="-1"></a>             <span class="at">linewidth =</span> <span class="dv">1</span>, </span>
<span id="cb387-8"><a href="#cb387-8" tabindex="-1"></a>             <span class="at">colour =</span> <span class="st">&quot;orange&quot;</span>, </span>
<span id="cb387-9"><a href="#cb387-9" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>)<span class="sc">+</span></span>
<span id="cb387-10"><a href="#cb387-10" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="at">fun =</span> dnorm, <span class="at">colour =</span> <span class="st">&quot;red&quot;</span>, </span>
<span id="cb387-11"><a href="#cb387-11" tabindex="-1"></a>                <span class="at">size =</span> <span class="dv">1</span>,</span>
<span id="cb387-12"><a href="#cb387-12" tabindex="-1"></a>                <span class="at">args =</span> <span class="fu">list</span>(<span class="at">mean =</span> <span class="fu">mean</span>(udh_dados_rmsp<span class="sc">$</span>P_SUPER, <span class="at">na.rm =</span> T),</span>
<span id="cb387-13"><a href="#cb387-13" tabindex="-1"></a>                            <span class="at">sd =</span> <span class="fu">sd</span>(udh_dados_rmsp<span class="sc">$</span>P_SUPER, <span class="at">na.rm =</span> T))</span>
<span id="cb387-14"><a href="#cb387-14" tabindex="-1"></a>                )</span></code></pre></div>
<p>Para plotar os três histogramas, vamos usar o pacote <strong>gridExtra</strong> e a função <code>grid.arrange</code>. Para esta função, listamos os três objetos, indicamos que sejam organizados em 3 colunas (ncol=3) e definimos a altura dos gráficos para 5 cm.</p>
<div class="sourceCode" id="cb388"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb388-1"><a href="#cb388-1" tabindex="-1"></a><span class="co">#para plotar os 3 histogramas em uma única coluna</span></span>
<span id="cb388-2"><a href="#cb388-2" tabindex="-1"></a><span class="fu">grid.arrange</span>(histo_idhm, </span>
<span id="cb388-3"><a href="#cb388-3" tabindex="-1"></a>             histo_luz, </span>
<span id="cb388-4"><a href="#cb388-4" tabindex="-1"></a>             histo_sup, </span>
<span id="cb388-5"><a href="#cb388-5" tabindex="-1"></a>             <span class="at">ncol=</span><span class="dv">3</span>, </span>
<span id="cb388-6"><a href="#cb388-6" tabindex="-1"></a>             <span class="at">heights =</span> <span class="fu">unit</span>(<span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">1</span>), <span class="fu">c</span>(<span class="st">&#39;cm&#39;</span>, <span class="st">&#39;null&#39;</span>))</span>
<span id="cb388-7"><a href="#cb388-7" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-185-1.png" width="960" /></p>
<p>Os histogramas permitem verificar que IDHM tem uma distribuição muito próxima à distribuição normal, com simetria nítida. P_SUPER e T_LUZ apresentam fortes assimetrias. A maior parte dos valores de T_LUZ se encontram entre 99 e 100%. P_SUPER tem a maior parte das UDHs com valores abaixo da linha tracejada laranja que representa a média do conjunto de dados.</p>
<div id="o-número-de-classes" class="section level3 hasAnchor" number="10.2.1">
<h3 class="hasAnchor"><span class="header-section-number">10.2.1</span> O número de classes<a href="#o-número-de-classes" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Conhecendo as variáveis que vamos mapear, precisamos definir o número de classes. Este aspecto afeta diretamente a capacidade de identificar as classes em um mapa. Um mapa pode ser do tipo “sem classes” ou do tipo “com classes”. Os mapas sem classes atribuem uma tonalidade a cada valor do conjunto de dados. É muito interessante para termos ideia do padrão geral do mapa. No entanto, o leitor dificilmente conseguirá identificar o valor de cada tonalidade porque a legenda será apresentada em coluna única. Assim, os mapas divididos em classes são mais utilizados.</p>
<p>Ao definir o número de classes, se utilizarmos poucas classes (menos de 4), podemos perder as situações intermediárias do fenômeno representado, resultando em grande simplificação. Se usarmos mais de 9 classes, por outro lado, o leitor terá dificuldade de identificar as tonalidades em uma escala monocromática. O intervalo entre 4 e 7 classes tem sido apontado como o mais indicado. Podemos utilizar a fórmula de Sturges para orientação sobre o número de classes (<em>k</em>) (CAUVIN et al., 2008). Na fórmula a seguir, <em>n</em> significa o número de unidades geográficas (no nosso caso, o número de UDHs).</p>
<p><span class="math display">\[
k = 1 + 3,3*log (n)
\]</span>
Como vimos com a função <code>summary</code>, o shapefile de udh_dados_rmsp tem 5716 UDHs. Aplicando a fórmula de Sturges, teríamos 13,4 classes. De acordo com a fórmula, com 70 unidades geográficas já atingiríamos o limite de 7 classes. Assim, como regra geral, acima de 70 unidades, podemos usar 7 classes, para uma paleta monocromática. Se a paleta tiver duas cores opostas (e.g., azul e vermelho), poderíamos ter 7 classes em tons de azul e sete em tons de vermelho. Em paletas com cores ordenadas, de 4 a 7 classes é o recomendável. Neste caso, a experiência de quem faz o mapa ajudaria na decisão.</p>
<p>Vamos elaborar os mapas sem classes das três variáveis. Para corrigir a geometria do shapefile, vamos usar o comando a seguir, tornando-a válida.</p>
<div class="sourceCode" id="cb389"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb389-1"><a href="#cb389-1" tabindex="-1"></a><span class="co">#para tornar válida a geometria de udh_dados_rmsp</span></span>
<span id="cb389-2"><a href="#cb389-2" tabindex="-1"></a>udh_dados_rmsp <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_make_valid</span>(udh_dados_rmsp)</span></code></pre></div>
<p>Para os mapas coropléticos, vamos usar o pacote <strong>tmap</strong>, cuja documentação completa pode ser encontrada <a href="https://cran.r-project.org/web/packages/tmap/tmap.pdf">aqui</a>. Este pacote oferece uma abordagem flexível e fácil para criar mapas temáticos. Usa a gramática dos gráficos em camadas com sintaxe parecida com <strong>ggplot2</strong>.</p>
<p>Vamos usar a função <strong>tm_shape</strong> para indicar o nome do arquivo shapefile que contém os dados. Com o sinal + adicionamos <strong>tm_fill</strong> para indicar o nome da variável, o título que aparecerá na legenda e a forma de dividir os intervalos das classes. Nesta primeira visualização vamos fazer os três mapas do tipo “sem classes”, com legenda contínua. Em seguida, usamos <strong>tmap_arrange</strong> para plotarmos os três mapas em uma única linha, definindo a altura dos mapas.</p>
<div class="sourceCode" id="cb390"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb390-1"><a href="#cb390-1" tabindex="-1"></a><span class="co">#para definir o modo estático</span></span>
<span id="cb390-2"><a href="#cb390-2" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="at">mode =</span> <span class="st">&quot;plot&quot;</span>)</span></code></pre></div>
<pre><code>## tmap mode set to plotting</code></pre>
<div class="sourceCode" id="cb392"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb392-1"><a href="#cb392-1" tabindex="-1"></a>map_idhm <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(udh_dados_rmsp) <span class="sc">+</span> <span class="co">#indica o nome do arquivo shapefile que será mapeado</span></span>
<span id="cb392-2"><a href="#cb392-2" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">&quot;IDHM&quot;</span>,<span class="at">title =</span> <span class="st">&quot;IDHM&quot;</span>,<span class="at">style =</span> <span class="st">&quot;cont&quot;</span>) <span class="sc">+</span> <span class="co">#indica a variável e escala contínua</span></span>
<span id="cb392-3"><a href="#cb392-3" tabindex="-1"></a>  <span class="fu">tm_scale_bar</span>()                                        <span class="co">#adiciona a barra de escala</span></span>
<span id="cb392-4"><a href="#cb392-4" tabindex="-1"></a></span>
<span id="cb392-5"><a href="#cb392-5" tabindex="-1"></a>map_psuper <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(udh_dados_rmsp) <span class="sc">+</span> <span class="co">#indica o nome do arquivo shapefile que será mapeado</span></span>
<span id="cb392-6"><a href="#cb392-6" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">&quot;P_SUPER&quot;</span>,<span class="at">title =</span> <span class="st">&quot;% nível superior&quot;</span>,<span class="at">style =</span> <span class="st">&quot;cont&quot;</span>) <span class="sc">+</span> <span class="co">#indica a variável e escala contínua</span></span>
<span id="cb392-7"><a href="#cb392-7" tabindex="-1"></a>  <span class="fu">tm_scale_bar</span>()          <span class="co">#adiciona a barra de escala</span></span>
<span id="cb392-8"><a href="#cb392-8" tabindex="-1"></a></span>
<span id="cb392-9"><a href="#cb392-9" tabindex="-1"></a>map_tluz <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(udh_dados_rmsp) <span class="sc">+</span> <span class="co">#indica o nome do arquivo shapefile que será mapeado</span></span>
<span id="cb392-10"><a href="#cb392-10" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">&quot;T_LUZ&quot;</span>,<span class="at">title =</span> <span class="st">&quot;% energia&quot;</span>,<span class="at">style =</span> <span class="st">&quot;cont&quot;</span>) <span class="sc">+</span> <span class="co">#indica a variável e escala contínua</span></span>
<span id="cb392-11"><a href="#cb392-11" tabindex="-1"></a>  <span class="fu">tm_scale_bar</span>()       <span class="co">#adiciona a barra de escala</span></span>
<span id="cb392-12"><a href="#cb392-12" tabindex="-1"></a></span>
<span id="cb392-13"><a href="#cb392-13" tabindex="-1"></a><span class="co">#para organizar os 3 mapas em uma linha</span></span>
<span id="cb392-14"><a href="#cb392-14" tabindex="-1"></a><span class="fu">tmap_arrange</span>(map_idhm,map_psuper,map_tluz,<span class="at">nrow=</span><span class="dv">1</span>, <span class="at">heights =</span> <span class="fu">unit</span>(<span class="fu">c</span>(<span class="dv">8</span>, <span class="dv">1</span>), <span class="fu">c</span>(<span class="st">&#39;cm&#39;</span>, <span class="st">&#39;null&#39;</span>))) </span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-187-1.png" width="960" />
Os mapas sem classes serão úteis para avaliar os mapas com classes que faremos.</p>
</div>
<div id="os-intervalos-de-classes" class="section level3 hasAnchor" number="10.2.2">
<h3 class="hasAnchor"><span class="header-section-number">10.2.2</span> Os intervalos de classes<a href="#os-intervalos-de-classes" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Existem diversas medidas estatísticas que podem ser usadas para definir os intervalos das classes de um mapa. Em <strong>tmap</strong>, o usuário pode definir os intervalos especificando o algoritmo desejado. Se não for especificado o algoritmo, será definido automaticamente <code>style = "pretty"</code> (estilo que arredonda os limites dos intervalos em números inteiros e os distribui de forma uniforme). Para escalas discretas, as opções de divisão de classes são:</p>
<p><code>style = "cat"</code>: para dados categóricos, atribui uma cor para cada categoria;</p>
<p><code>style = "fixed"</code>: atribui intervalos fixos definidos pelo usuário;</p>
<p><code>style = "sd"</code>: define intervalos a partir do valor do desvio-padrão. A escala de cores mais indicada é a escala divergente (cores opostas nas extremidades). O valor da média fica no meio da escala e as classes abaixo ou acima da média são definidas com base no desvio-padrão dos dados. Pode apresentar um número de classes diferente de <em>n</em>, já que depende do valor do desvio-padrão;</p>
<p><code>style = "equal"</code>: define intervalos iguais dividindo a diferença entre o maior e o menor valor pelo número de classes escolhido;</p>
<p><code>style = "quantile"</code>: Divide a variável em quantis de forma que em cada intervalo haja o mesmo número de observações;</p>
<p>As outras opções utilizam algoritmos específicos que podem ser consultadas com o símbolo <code>?</code> antes de seu nome (e.g., <code>?dpih</code>) e incluem “kmeans”, “hclust”, “bclust”, “fisher”, “jenks”, “dpih”, “headtails” e “log10_pretty”.
Os gradientes contínuos (para mapas sem classes) são: “cont”, “order” e “log10”.
Vamos comparar os mapas usando as seguintes escalas: “equal”, “quantile”, “jenks” e “sd”, por serem as mais utilizadas.</p>
<div class="sourceCode" id="cb393"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb393-1"><a href="#cb393-1" tabindex="-1"></a>idhm_cont <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(udh_dados_rmsp) <span class="sc">+</span> <span class="co">#indica o nome do arquivo shapefile que será mapeado</span></span>
<span id="cb393-2"><a href="#cb393-2" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">&quot;IDHM&quot;</span>,<span class="at">title =</span> <span class="st">&quot;IDHM&quot;</span>,<span class="at">style =</span> <span class="st">&quot;cont&quot;</span>) <span class="sc">+</span> <span class="co">#indica a variável e escala contínua</span></span>
<span id="cb393-3"><a href="#cb393-3" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">title =</span> <span class="st">&quot;Cont&quot;</span>, <span class="at">title.size =</span> <span class="fl">0.6</span>, <span class="at">legend.title.size =</span> <span class="fl">0.5</span>, <span class="at">legend.text.size =</span> <span class="fl">0.5</span>, <span class="at">legend.outside =</span> <span class="cn">TRUE</span>)<span class="sc">+</span> <span class="co">#define o layout</span></span>
<span id="cb393-4"><a href="#cb393-4" tabindex="-1"></a>  <span class="fu">tm_scale_bar</span>()                              <span class="co">#adiciona a barra de escala</span></span>
<span id="cb393-5"><a href="#cb393-5" tabindex="-1"></a></span>
<span id="cb393-6"><a href="#cb393-6" tabindex="-1"></a>idhm_eq <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(udh_dados_rmsp) <span class="sc">+</span> <span class="co">#indica o nome do arquivo shapefile que será mapeado</span></span>
<span id="cb393-7"><a href="#cb393-7" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">&quot;IDHM&quot;</span>,<span class="at">title =</span> <span class="st">&quot;IDHM&quot;</span>,<span class="at">n =</span> <span class="dv">7</span>, <span class="at">style =</span> <span class="st">&quot;equal&quot;</span>, <span class="at">legend.hist =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb393-8"><a href="#cb393-8" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">title =</span> <span class="st">&quot;Equal&quot;</span>, <span class="at">title.size =</span> <span class="fl">0.6</span>, <span class="at">legend.title.size =</span> <span class="fl">0.5</span>, <span class="at">legend.text.size =</span> <span class="fl">0.5</span>, <span class="at">legend.outside =</span> <span class="cn">TRUE</span>)<span class="sc">+</span></span>
<span id="cb393-9"><a href="#cb393-9" tabindex="-1"></a>  <span class="fu">tm_scale_bar</span>()</span>
<span id="cb393-10"><a href="#cb393-10" tabindex="-1"></a></span>
<span id="cb393-11"><a href="#cb393-11" tabindex="-1"></a>idhm_qt <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(udh_dados_rmsp) <span class="sc">+</span> </span>
<span id="cb393-12"><a href="#cb393-12" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">&quot;IDHM&quot;</span>,<span class="at">title =</span> <span class="st">&quot;IDHM&quot;</span>,<span class="at">n =</span> <span class="dv">7</span>, <span class="at">style =</span> <span class="st">&quot;quantile&quot;</span>, <span class="at">legend.hist =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb393-13"><a href="#cb393-13" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">title =</span> <span class="st">&quot;Quantile&quot;</span>, <span class="at">title.size =</span> <span class="fl">0.6</span>, <span class="at">legend.title.size =</span> <span class="fl">0.5</span>, <span class="at">legend.text.size =</span> <span class="fl">0.5</span>, <span class="at">legend.outside =</span> <span class="cn">TRUE</span>)<span class="sc">+</span></span>
<span id="cb393-14"><a href="#cb393-14" tabindex="-1"></a>  <span class="fu">tm_scale_bar</span>()</span>
<span id="cb393-15"><a href="#cb393-15" tabindex="-1"></a></span>
<span id="cb393-16"><a href="#cb393-16" tabindex="-1"></a>idhm_jk <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(udh_dados_rmsp) <span class="sc">+</span> </span>
<span id="cb393-17"><a href="#cb393-17" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">&quot;IDHM&quot;</span>,<span class="at">title =</span> <span class="st">&quot;IDHM&quot;</span>,<span class="at">n =</span> <span class="dv">7</span>, <span class="at">style =</span> <span class="st">&quot;jenks&quot;</span>, <span class="at">legend.hist =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb393-18"><a href="#cb393-18" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">title =</span> <span class="st">&quot;Jenks&quot;</span>, <span class="at">title.size =</span> <span class="fl">0.6</span>, <span class="at">legend.title.size =</span> <span class="fl">0.5</span>, <span class="at">legend.text.size =</span> <span class="fl">0.5</span>, <span class="at">legend.outside =</span> <span class="cn">TRUE</span>)<span class="sc">+</span></span>
<span id="cb393-19"><a href="#cb393-19" tabindex="-1"></a>  <span class="fu">tm_scale_bar</span>()</span>
<span id="cb393-20"><a href="#cb393-20" tabindex="-1"></a></span>
<span id="cb393-21"><a href="#cb393-21" tabindex="-1"></a>idhm_sd <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(udh_dados_rmsp) <span class="sc">+</span> </span>
<span id="cb393-22"><a href="#cb393-22" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">&quot;IDHM&quot;</span>,<span class="at">title =</span> <span class="st">&quot;IDHM&quot;</span>,<span class="at">n =</span> <span class="dv">7</span>, <span class="at">style =</span> <span class="st">&quot;sd&quot;</span>, <span class="at">palette =</span> <span class="st">&quot;RdYlGn&quot;</span>, <span class="at">legend.hist =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb393-23"><a href="#cb393-23" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">title =</span> <span class="st">&quot;Standard </span><span class="sc">\n</span><span class="st">deviation&quot;</span>, <span class="at">title.size =</span> <span class="fl">0.6</span>, <span class="at">legend.title.size =</span> <span class="fl">0.5</span>, <span class="at">legend.text.size =</span> <span class="fl">0.5</span>, <span class="at">legend.outside =</span> <span class="cn">TRUE</span>)<span class="sc">+</span></span>
<span id="cb393-24"><a href="#cb393-24" tabindex="-1"></a>  <span class="fu">tm_scale_bar</span>()</span>
<span id="cb393-25"><a href="#cb393-25" tabindex="-1"></a></span>
<span id="cb393-26"><a href="#cb393-26" tabindex="-1"></a><span class="fu">tmap_arrange</span>(idhm_cont, idhm_eq,idhm_qt,idhm_jk,idhm_sd, <span class="at">nrow=</span><span class="dv">3</span>, <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">heights =</span> <span class="fu">unit</span>(<span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">5</span>), <span class="fu">c</span>(<span class="st">&#39;cm&#39;</span>, <span class="st">&#39;cm&#39;</span>))) <span class="co">#organiza a apresentação dos mapas</span></span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-188-1.png" width="672" /></p>
<p>Os diferentes intervalos adotados para os mapas do IDHM nos mostram que quando o histograma da variável apresenta distribuição próxima da normal, a divisão por jenks ou a divisão por desvio-padrão fornecem padrões bem semelhantes ao do mapa sem classes.</p>
<p>Siga o código anterior e olhe os mapas para P_SUPER e T_LUZ.</p>
<p>Os mapas de P_SUPER mostram que as divisões segundo classes iguais (“equal”) e segundo desvio-padrão (“standard deviation”) são as que mais se aproximam do mapa com a escala contínua. A divisão por quintis (“quantile”), por outro lado, leva a uma compreensão muito diferente do fenômeno mapeado, enfatizando a classe mais escura. O intervalo desta classe inclui valores que vão de 27,52 a 77,07%, levando a um padrão geográfico que comunica que o percentual de pessoas ocupadas com nível superior é alto em quase toda RM, o que não é verdade. Este resultado se deve exclusivamente ao tipo de divisão entre as classes. É por isso que a distribuição dos dados precisa ser analisada e um mapa sem classes pode auxiliar na escolha do corte mais apropriado para o conjunto de dados.</p>
<p>E como é o acesso à energia elétrica na maior Região Metropolitana do Brasil? Vimos nos histogramas que estes dados também são muito assimétricos. Elabore os mapas para T_LUZ para avaliar a divisão mais adequada.</p>
<p>As divisões pelo algoritmo de Jenks e segundo desvio-padrão são as que mais se aproximam do mapa sem classes. Os mapas mostram que o valor mais baixo é 95,1%. O mapa com intervalos do algoritmo de Jenks é o que separa melhor os valores mais altos (99,9 a 100%), permitindo a identificação de diferenças sutis.</p>
<p>O pacote <strong>classInt</strong> apresenta a função <code>jenks.test</code> que avalia a acurácia dos intervalos criados segundo os diferentes algoritmos. Antes de criarmos objetos do tipo <em>classIntervals</em>, vamos filtrar os NAs das variáveis de interesse.</p>
<div class="sourceCode" id="cb394"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb394-1"><a href="#cb394-1" tabindex="-1"></a><span class="co">#para selecionar apenas dados que não são NAs</span></span>
<span id="cb394-2"><a href="#cb394-2" tabindex="-1"></a>idhm.final <span class="ot">&lt;-</span> udh_dados_rmsp <span class="sc">%&gt;%</span></span>
<span id="cb394-3"><a href="#cb394-3" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(<span class="fu">is.na</span>(IDHM)))</span>
<span id="cb394-4"><a href="#cb394-4" tabindex="-1"></a><span class="co">#para ver as dimensões do objeto filtrado</span></span>
<span id="cb394-5"><a href="#cb394-5" tabindex="-1"></a><span class="fu">dim</span>(idhm.final)</span></code></pre></div>
<pre><code>## [1] 5585    9</code></pre>
<div class="sourceCode" id="cb396"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb396-1"><a href="#cb396-1" tabindex="-1"></a><span class="co">#para ver a classe do objeto</span></span>
<span id="cb396-2"><a href="#cb396-2" tabindex="-1"></a><span class="fu">class</span>(idhm.final)</span></code></pre></div>
<pre><code>## [1] &quot;sf&quot;         &quot;data.frame&quot;</code></pre>
<div class="sourceCode" id="cb398"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb398-1"><a href="#cb398-1" tabindex="-1"></a><span class="fu">str</span>(idhm.final)</span></code></pre></div>
<pre><code>## Classes &#39;sf&#39; and &#39;data.frame&#39;:   5585 obs. of  9 variables:
##  $ UDH_ATLAS : chr  &quot;1350390100001&quot; &quot;1350390100001&quot; &quot;1350390100002&quot; &quot;1350390100002&quot; ...
##  $ CD_GEOCODM: chr  &quot;3503901&quot; &quot;3503901&quot; &quot;3503901&quot; &quot;3503901&quot; ...
##  $ NM_MUNICIP: chr  &quot;ARUJ\xc1&quot; &quot;ARUJ\xc1&quot; &quot;ARUJ\xc1&quot; &quot;ARUJ\xc1&quot; ...
##  $ RM        : chr  &quot;635&quot; &quot;635&quot; &quot;635&quot; &quot;635&quot; ...
##  $ NOME_MUN  : chr  &quot;Arujá (SP)&quot; &quot;Arujá (SP)&quot; &quot;Arujá (SP)&quot; &quot;Arujá (SP)&quot; ...
##  $ P_SUPER   : num  0.62 6.87 0.93 3.12 7.68 ...
##  $ T_LUZ     : num  99.7 99.7 100 100 98.8 ...
##  $ IDHM      : num  0.584 0.733 0.584 0.695 0.688 0.812 0.584 0.733 0.793 0.88 ...
##  $ geometry  :sfc_MULTIPOLYGON of length 5585; first list element: List of 1
##   ..$ :List of 1
##   .. ..$ : num [1:1013, 1:2] -46.4 -46.4 -46.4 -46.4 -46.4 ...
##   ..- attr(*, &quot;class&quot;)= chr [1:3] &quot;XY&quot; &quot;MULTIPOLYGON&quot; &quot;sfg&quot;
##  - attr(*, &quot;sf_column&quot;)= chr &quot;geometry&quot;
##  - attr(*, &quot;agr&quot;)= Factor w/ 3 levels &quot;constant&quot;,&quot;aggregate&quot;,..: NA NA NA NA NA NA NA NA
##   ..- attr(*, &quot;names&quot;)= chr [1:8] &quot;UDH_ATLAS&quot; &quot;CD_GEOCODM&quot; &quot;NM_MUNICIP&quot; &quot;RM&quot; ...</code></pre>
<p>Vamos calcular objetos do tipo classInt para avaliar a acurácia dos intervalos para cada tipo de discretização. Existem 2 índices: índice de Jenks e o Tabular Accuracy Index (TAI). Antes, vamos criar paletas de cores: <strong>pal1</strong> e <strong>opar</strong>.</p>
<div class="sourceCode" id="cb400"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb400-1"><a href="#cb400-1" tabindex="-1"></a>pal1 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;wheat1&quot;</span>, <span class="st">&quot;red3&quot;</span>)</span>
<span id="cb400-2"><a href="#cb400-2" tabindex="-1"></a>opar <span class="ot">&lt;-</span> <span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>))</span></code></pre></div>
<p>Vamos criar objetos do tipo classIntervals para IDHM para cada estilo disponível.</p>
<div class="sourceCode" id="cb401"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb401-1"><a href="#cb401-1" tabindex="-1"></a>idhm_fixed <span class="ot">&lt;-</span> <span class="fu">classIntervals</span>(idhm.final<span class="sc">$</span>IDHM, <span class="at">n=</span><span class="dv">7</span>, <span class="at">style=</span><span class="st">&quot;fixed&quot;</span>,</span>
<span id="cb401-2"><a href="#cb401-2" tabindex="-1"></a> <span class="at">fixedBreaks=</span><span class="fu">c</span>(<span class="fl">0.4</span>, <span class="fl">0.5</span>, <span class="fl">0.55</span>, <span class="fl">0.6</span>, <span class="fl">0.7</span>, <span class="fl">0.8</span>, <span class="fl">0.9</span>, <span class="fl">0.965</span>))</span>
<span id="cb401-3"><a href="#cb401-3" tabindex="-1"></a>idhm_sd <span class="ot">&lt;-</span> <span class="fu">classIntervals</span>(idhm.final<span class="sc">$</span>IDHM, <span class="at">n=</span><span class="dv">7</span>, <span class="at">style=</span><span class="st">&quot;sd&quot;</span>)</span>
<span id="cb401-4"><a href="#cb401-4" tabindex="-1"></a>idhm_equal <span class="ot">&lt;-</span> <span class="fu">classIntervals</span>(idhm.final<span class="sc">$</span>IDHM, <span class="at">n=</span><span class="dv">7</span>, <span class="at">style=</span><span class="st">&quot;equal&quot;</span>)</span>
<span id="cb401-5"><a href="#cb401-5" tabindex="-1"></a>idhm_quant <span class="ot">&lt;-</span> <span class="fu">classIntervals</span>(idhm.final<span class="sc">$</span>IDHM, <span class="at">n=</span><span class="dv">7</span>, <span class="at">style=</span><span class="st">&quot;quantile&quot;</span>)</span>
<span id="cb401-6"><a href="#cb401-6" tabindex="-1"></a>idhm_kmeans <span class="ot">&lt;-</span> <span class="fu">classIntervals</span>(idhm.final<span class="sc">$</span>IDHM, <span class="at">n=</span><span class="dv">7</span>, <span class="at">style=</span><span class="st">&quot;kmeans&quot;</span>)</span>
<span id="cb401-7"><a href="#cb401-7" tabindex="-1"></a>idhm_pretty <span class="ot">&lt;-</span> <span class="fu">classIntervals</span>(idhm.final<span class="sc">$</span>IDHM, <span class="at">n=</span><span class="dv">7</span>, <span class="at">style=</span><span class="st">&quot;pretty&quot;</span>)</span>
<span id="cb401-8"><a href="#cb401-8" tabindex="-1"></a>idhm_hclust <span class="ot">&lt;-</span> <span class="fu">classIntervals</span>(idhm.final<span class="sc">$</span>IDHM, <span class="at">n=</span><span class="dv">7</span>, <span class="at">style=</span><span class="st">&quot;hclust&quot;</span>)</span>
<span id="cb401-9"><a href="#cb401-9" tabindex="-1"></a>idhm_bclust <span class="ot">&lt;-</span> <span class="fu">classIntervals</span>(idhm.final<span class="sc">$</span>IDHM, <span class="at">n=</span><span class="dv">7</span>, <span class="at">style=</span><span class="st">&quot;bclust&quot;</span>)</span></code></pre></div>
<pre><code>## Committee Member: 1(1) 2(1) 3(1) 4(1) 5(1) 6(1) 7(1) 8(1) 9(1) 10(1)
## Computing Hierarchical Clustering</code></pre>
<div class="sourceCode" id="cb403"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb403-1"><a href="#cb403-1" tabindex="-1"></a>idhm_fisher <span class="ot">&lt;-</span> <span class="fu">classIntervals</span>(idhm.final<span class="sc">$</span>IDHM, <span class="at">n=</span><span class="dv">7</span>, <span class="at">style=</span><span class="st">&quot;fisher&quot;</span>)</span>
<span id="cb403-2"><a href="#cb403-2" tabindex="-1"></a>idhm_jenks <span class="ot">&lt;-</span> <span class="fu">classIntervals</span>(idhm.final<span class="sc">$</span>IDHM, <span class="at">n=</span><span class="dv">7</span>, <span class="at">style=</span><span class="st">&quot;jenks&quot;</span>)</span>
<span id="cb403-3"><a href="#cb403-3" tabindex="-1"></a>idhm_dpih <span class="ot">&lt;-</span> <span class="fu">classIntervals</span>(idhm.final<span class="sc">$</span>IDHM, <span class="at">n=</span><span class="dv">7</span>, <span class="at">style=</span><span class="st">&quot;dpih&quot;</span>)</span>
<span id="cb403-4"><a href="#cb403-4" tabindex="-1"></a>idhm_headtails <span class="ot">&lt;-</span> <span class="fu">classIntervals</span>(idhm.final<span class="sc">$</span>IDHM, <span class="at">n=</span><span class="dv">7</span>, <span class="at">style=</span><span class="st">&quot;headtails&quot;</span>)</span>
<span id="cb403-5"><a href="#cb403-5" tabindex="-1"></a>idhm_maximum <span class="ot">&lt;-</span> <span class="fu">classIntervals</span>(idhm.final<span class="sc">$</span>IDHM, <span class="at">n=</span><span class="dv">7</span>, <span class="at">style=</span><span class="st">&quot;maximum&quot;</span>)</span></code></pre></div>
<p>Vamos, então, comparar os índices dos diferentes estilos de discretização. Quanto mais próximos de 1 para <em>Goodness of Fit</em> e para <em>Tabular accuracy</em>, maior a acurácia do estilo.</p>
<div class="sourceCode" id="cb404"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb404-1"><a href="#cb404-1" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">jenks.tests</span>(idhm_fixed))</span></code></pre></div>
<pre><code>##        # classes  Goodness of fit Tabular accuracy 
##        7.0000000        0.9379771        0.7503345</code></pre>
<div class="sourceCode" id="cb406"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb406-1"><a href="#cb406-1" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">jenks.tests</span>(idhm_sd))</span></code></pre></div>
<pre><code>##        # classes  Goodness of fit Tabular accuracy 
##       10.0000000        0.9799030        0.8535586</code></pre>
<div class="sourceCode" id="cb408"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb408-1"><a href="#cb408-1" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">jenks.tests</span>(idhm_equal))</span></code></pre></div>
<pre><code>##        # classes  Goodness of fit Tabular accuracy 
##        7.0000000        0.9639592        0.8028448</code></pre>
<div class="sourceCode" id="cb410"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb410-1"><a href="#cb410-1" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">jenks.tests</span>(idhm_quant))</span></code></pre></div>
<pre><code>##        # classes  Goodness of fit Tabular accuracy 
##        7.0000000        0.9673643        0.8258333</code></pre>
<div class="sourceCode" id="cb412"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb412-1"><a href="#cb412-1" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">jenks.tests</span>(idhm_kmeans))</span></code></pre></div>
<pre><code>##        # classes  Goodness of fit Tabular accuracy 
##        7.0000000        0.9722329        0.8341840</code></pre>
<div class="sourceCode" id="cb414"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb414-1"><a href="#cb414-1" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">jenks.tests</span>(idhm_pretty))</span></code></pre></div>
<pre><code>##        # classes  Goodness of fit Tabular accuracy 
##       11.0000000        0.9813751        0.8584816</code></pre>
<div class="sourceCode" id="cb416"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb416-1"><a href="#cb416-1" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">jenks.tests</span>(idhm_hclust))</span></code></pre></div>
<pre><code>##        # classes  Goodness of fit Tabular accuracy 
##        7.0000000        0.9641622        0.8049719</code></pre>
<div class="sourceCode" id="cb418"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb418-1"><a href="#cb418-1" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">jenks.tests</span>(idhm_bclust))</span></code></pre></div>
<pre><code>##        # classes  Goodness of fit Tabular accuracy 
##        7.0000000        0.9615317        0.8061690</code></pre>
<div class="sourceCode" id="cb420"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb420-1"><a href="#cb420-1" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">jenks.tests</span>(idhm_fisher))</span></code></pre></div>
<pre><code>##        # classes  Goodness of fit Tabular accuracy 
##        7.0000000        0.9724775        0.8332861</code></pre>
<div class="sourceCode" id="cb422"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb422-1"><a href="#cb422-1" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">jenks.tests</span>(idhm_jenks))</span></code></pre></div>
<pre><code>##        # classes  Goodness of fit Tabular accuracy 
##        7.0000000        0.9724775        0.8332861</code></pre>
<div class="sourceCode" id="cb424"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb424-1"><a href="#cb424-1" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">jenks.tests</span>(idhm_dpih))</span></code></pre></div>
<pre><code>##        # classes  Goodness of fit Tabular accuracy 
##       29.0000000        0.9980050        0.9542532</code></pre>
<div class="sourceCode" id="cb426"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb426-1"><a href="#cb426-1" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">jenks.tests</span>(idhm_headtails))</span></code></pre></div>
<pre><code>##        # classes  Goodness of fit Tabular accuracy 
##        2.0000000        0.6904488        0.4332091</code></pre>
<div class="sourceCode" id="cb428"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb428-1"><a href="#cb428-1" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">jenks.tests</span>(idhm_maximum))</span></code></pre></div>
<pre><code>##        # classes  Goodness of fit Tabular accuracy 
##       8.00000000       0.08076560       0.04560482</code></pre>
<p>Os resultados mostram que o estilo <em>dpih</em> apresenta a melhor acurácia (GOF de 0.998 e TAI de 0.954), com 29 classes. Se quisermos ficar com apenas 7 classes, os estilos com valores mais altos foram <em>jenks</em> e <em>fisher</em>.</p>
<p>Crie classIntervals com os diferentes estilos para P_SUPER e T_LUZ. Em seguida, rode o <code>jenks.test</code> para cada variável.</p>
<p>Novamente, o estilo <em>dpih</em> apresenta os melhores valores para P_SUPER, porém, neste caso, propondo 149 classes. Se quisermos ficar com 7 classes, o estilo <em>kmeans</em> apresenta os melhores resultados (GOF de 0.9760 e TAI de 0,852).</p>
<p>Os resultados para T_LUZ mostram que os estilos <em>jenks</em> e <em>fisher</em> apresentam GOF mais elevado (0,9649) e TAI de 0,824. O algoritmo de Jenks tinha se mostrado bem semelhante ao mapa sem classes, como visto anteriormente.</p>
</div>
<div id="escalacores" class="section level3 hasAnchor" number="10.2.3">
<h3 class="hasAnchor"><span class="header-section-number">10.2.3</span> A escala de cores<a href="#escalacores" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Tendo decidido o número de classes e a forma de discretização para cada mapa que desejamos elaborar, resta decidir a paleta de cores.
O pacote <strong>tmap</strong> oferece diversas paletas para até 20 classes. As paletas são agrupadas em: <strong>categóricas</strong> (para dados qualitativos), <strong>sequenciais</strong> (para dados quantitativos) e <strong>divergentes</strong> (para dados quantitativos com escala com duas cores opostas). Além destes tipos de paletas desenvolvidas por Cynthia Brewer (pacote <strong>RColorBrewer</strong>), ainda há o pacote <strong>viridis</strong> com cinco paletas sequenciais. Observe que as paletas deste pacote começam com a tonalidade mais escura e terminam com a mais clara. Para atender a um público com anomalia na visão das cores, está disponível um simulador para Deuteranopia, Protanopia e Tritanopia. O site <a href="https://colorbrewer2.org/" class="uri">https://colorbrewer2.org/</a> apresenta as paletas do pacote.</p>
</div>
</div>
<div id="layout-do-mapa-coroplético-de-idhm-da-rmsp" class="section level2 hasAnchor" number="10.3">
<h2 class="hasAnchor"><span class="header-section-number">10.3</span> Layout do mapa coroplético de IDHM da RMSP<a href="#layout-do-mapa-coroplético-de-idhm-da-rmsp" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Vamos elaborar o mapa do IDHM da RMSP usando a melhor discretização indicada pelos intervalos definidos usando (<code>style = "fisher"</code>). A paleta de cores deve ser do tipo sequencial. Vamos escolher a paleta de laranjas (get_brewer_pal(“Oranges”).</p>
<p>Usaremos o banco de dados de população do Portal da Fundação SEADE que contém os polígonos de todos os municípios do estado. Para baixar o arquivo compactado, usamos a linha de código a seguir. O arquivo shapefile encontra-se em: <a href="https://repositorio.seade.gov.br/dataset/9bb4f8ef-f1a4-4734-92a2-814cfc8d0974/resource/09ba3695-a6a1-44ab-9916-fd1a8aa1c980/download/populacao.zip" class="uri">https://repositorio.seade.gov.br/dataset/9bb4f8ef-f1a4-4734-92a2-814cfc8d0974/resource/09ba3695-a6a1-44ab-9916-fd1a8aa1c980/download/populacao.zip</a>. Se você já fez o mapa das figuras geométricas da população do estado de São Paulo, já tem este arquivo em seu diretório.</p>
<p>Vamos criar o objeto <strong>pop</strong> usando a função para leitura de arquivo do tipo shapefile.</p>
<div class="sourceCode" id="cb430"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb430-1"><a href="#cb430-1" tabindex="-1"></a><span class="co">#para abrir o arquivo shapefile do estado de São Paulo </span></span>
<span id="cb430-2"><a href="#cb430-2" tabindex="-1"></a>pop <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">&quot;./Populacao.shp&quot;</span>)</span></code></pre></div>
<pre><code>## Reading layer `Populacao&#39; from data source 
##   `C:\Users\l_viz\Documents\RCartoTematica\Populacao.shp&#39; 
##   using driver `ESRI Shapefile&#39;
## Simple feature collection with 645 features and 12 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: -53.10487 ymin: -25.30835 xmax: -44.1634 ymax: -19.78045
## Geodetic CRS:  SIRGAS 2000</code></pre>
<p>Podemos ver as colunas de <strong>pop</strong> com a função <strong>names(pop)</strong>.</p>
<div class="sourceCode" id="cb432"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb432-1"><a href="#cb432-1" tabindex="-1"></a><span class="fu">names</span>(pop)</span></code></pre></div>
<pre><code>##  [1] &quot;Cod_ibge&quot; &quot;Nome&quot;     &quot;Rotulo&quot;   &quot;Area_Km2&quot; &quot;Den_Demo&quot; &quot;Pop&quot;     
##  [7] &quot;RA&quot;       &quot;RG&quot;       &quot;RM&quot;       &quot;AU&quot;       &quot;RGI&quot;      &quot;RGINT&quot;   
## [13] &quot;geometry&quot;</code></pre>
<p>O objeto <strong>pop</strong> está na projeção cartográfica SIRGAS 2000. Vamos passá-lo para WGS84 pseudo Mercator (CRS = 3857) para ficar compatível com idhm.final.</p>
<div class="sourceCode" id="cb434"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb434-1"><a href="#cb434-1" tabindex="-1"></a><span class="co">#para transformar para a projeção WGS84 pseudo Mercator (crs=3857)</span></span>
<span id="cb434-2"><a href="#cb434-2" tabindex="-1"></a>pop_wgs84 <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(pop, <span class="at">crs=</span> <span class="dv">3857</span>)</span></code></pre></div>
<p>Vamos criar um objeto “idhm.final.fisher” que será o mapa do IDHM na RMSP. Primeiro vamos adicionar a camada dos polígonos dos municípios do estado de São Paulo (pop_wgs84), indicando que a extensão deverá corresponder à camada “idhm.final”. Para que ela fique com os polígonos em cinza, usaremos tm_fill(). A segunda camada a ser adicionada é a que contém os dados de IDHM (idhm.final). A camada será preenchida com o valor do IDHM (tm_fill(col = “IDHM”)). A discretização será feita usando o estilo “fisher”, paleta de cores laranja e adicionaremos o histograma da legenda. O layout conterá o título do mapa e o fundo do mapa será azul bem claro (aliceblue). A terceira camada será novamente a camada dos polígonos dos municípios, desta vez, sem preenchimento. As bordas dos municípios será em branco (white), com largura igual a 1. Adicionaremos a fonte dos dados e os créditos de elaboração do mapa. A barra de escala será adicionada com um tamanho relativo de 20% do tamanho do mapa (width = 0.2). A posição da barra de escala é definida considerando-se que o canto inferior esquerdo corresponde à posição (0,0) e o canto superior direito é (1,1). Assim, o começo da escala estará na posição 0.71 no sentido horizontal e a 0.13, no vertical. Por último, pedimos para visualizar o mapa “idhm.final.fisher” e o salvamos com a extensão png. Para isso usamos a função <code>tmap_save</code>. O arquivo será salvo com resolução de 300 dpi.</p>
<div class="sourceCode" id="cb435"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb435-1"><a href="#cb435-1" tabindex="-1"></a>idhm.final.fisher <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(pop_wgs84, <span class="at">bbox =</span> idhm.final)<span class="sc">+</span></span>
<span id="cb435-2"><a href="#cb435-2" tabindex="-1"></a>  <span class="fu">tm_fill</span>()<span class="sc">+</span></span>
<span id="cb435-3"><a href="#cb435-3" tabindex="-1"></a>  <span class="fu">tm_shape</span>(idhm.final) <span class="sc">+</span> <span class="co">#indica o nome do arquivo shapefile que será mapeado</span></span>
<span id="cb435-4"><a href="#cb435-4" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">&quot;IDHM&quot;</span>,<span class="at">title =</span> <span class="st">&quot;IDHM&quot;</span>, <span class="at">style =</span> <span class="st">&quot;fisher&quot;</span>, <span class="at">palette =</span> <span class="st">&quot;Oranges&quot;</span>, <span class="at">legend.hist =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb435-5"><a href="#cb435-5" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">title =</span> <span class="st">&quot;IDHM na RMSP&quot;</span>, <span class="at">title.size =</span> <span class="fl">0.8</span>, <span class="at">legend.title.size =</span> <span class="fl">0.5</span>, <span class="at">legend.text.size =</span> <span class="fl">0.5</span>, <span class="at">legend.outside =</span> <span class="cn">TRUE</span>, <span class="at">bg.color =</span> <span class="st">&quot;aliceblue&quot;</span>)<span class="sc">+</span></span>
<span id="cb435-6"><a href="#cb435-6" tabindex="-1"></a>  <span class="fu">tm_shape</span>(pop_wgs84)<span class="sc">+</span></span>
<span id="cb435-7"><a href="#cb435-7" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">&quot;white&quot;</span>, <span class="at">lwd =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb435-8"><a href="#cb435-8" tabindex="-1"></a>  <span class="fu">tm_credits</span>(<span class="st">&quot;Fonte: http://www.atlasbrasil.org.br</span><span class="sc">\n</span><span class="st"> 2022 Ligiaviz&quot;</span>, <span class="at">position =</span> <span class="fu">c</span>(<span class="st">&quot;RIGHT&quot;</span>, <span class="st">&quot;BOTTOM&quot;</span>))<span class="sc">+</span></span>
<span id="cb435-9"><a href="#cb435-9" tabindex="-1"></a>  <span class="fu">tm_scale_bar</span>(<span class="at">width =</span> <span class="fl">0.2</span>, <span class="at">position =</span> <span class="fu">c</span>(<span class="st">&quot;0.71&quot;</span>, <span class="st">&quot;0.13&quot;</span>))</span>
<span id="cb435-10"><a href="#cb435-10" tabindex="-1"></a><span class="co">#para visualizar o mapa</span></span>
<span id="cb435-11"><a href="#cb435-11" tabindex="-1"></a>idhm.final.fisher</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-196-1.png" width="960" /></p>
<div class="sourceCode" id="cb436"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb436-1"><a href="#cb436-1" tabindex="-1"></a><span class="co">#para salvar o mapa como arquivo png</span></span>
<span id="cb436-2"><a href="#cb436-2" tabindex="-1"></a><span class="fu">tmap_save</span>(idhm.final.fisher, <span class="st">&quot;idhm.png&quot;</span>)</span></code></pre></div>
<pre><code>## Map saved to C:\Users\l_viz\Documents\RCartoTematica\idhm.png</code></pre>
<pre><code>## Resolution: 2635.027 by 1673.607 pixels</code></pre>
<pre><code>## Size: 8.783423 by 5.57869 inches (300 dpi)</code></pre>
<p>Embora os mapas coropléticos sejam os mais amplamente utilizados, eles presumem que haja homogeneidade interna das unidades geográficas, quando isso raramente acontece. Desta forma, o refinamento da representação coroplética pode ser obtido por meio de mapas dasimétricos (PETROV, 2008; BARROZO et al., 2015).</p>
</div>
</div>
<div id="quanti4" class="section level1 hasAnchor" number="11">
<h1 class="hasAnchor"><span class="header-section-number">11</span> Mapa coroplético interativo<a href="#quanti4" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>A visualização interativa de mapas por meio da Internet desloca o leitor de uma posição passiva para a capacidade de decidir o que quer ver e em qual escala.</p>
<p>O pacote <strong>tmap</strong> possui duas opções de visualização do mapa: no modo <strong>plot</strong>, a visualização é estática; no modo <strong>view</strong> a visualização é interativa. No mapa de IDHM na Região Metropolitana de São Paulo, usamos o modo <strong>plot</strong>.</p>
<p>Vamos visualizar o mesmo mapa com o modo <strong>view</strong>.
Algumas diferenças em relação ao modo <strong>plot</strong> precisam ser destacadas:</p>
<ul>
<li><p>o mapa é sempre projetado na Projeção de Mercator para Web, que é padrão para os mapas interativos na Web. Portanto, não há equivalência de áreas;</p></li>
<li><p>Não é possível plotar diversos mapas pequenos de forma múltipla;</p></li>
<li><p>A estética da legenda não pode ser ajustada em relação a tamanho (tamanho do símbolo e espessura da linha);</p></li>
<li><p>Os rótulos com texto ainda não são suportados;</p></li>
<li><p>As opções de layout ajustadas com <strong>tm_layout</strong> em relação ao formato do mapa não são usadas. Entretanto, as opções de estilo ainda se aplicam.</p></li>
</ul>
<div class="sourceCode" id="cb440"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb440-1"><a href="#cb440-1" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="at">mode =</span> <span class="st">&quot;view&quot;</span>)</span></code></pre></div>
<pre><code>## tmap mode set to interactive viewing</code></pre>
<p>O mapa interativo pode ser visualizado com o código a seguir:</p>
<div class="sourceCode" id="cb442"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb442-1"><a href="#cb442-1" tabindex="-1"></a>idhm.final.fisher <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(pop_wgs84, <span class="at">bbox =</span> idhm.final)<span class="sc">+</span></span>
<span id="cb442-2"><a href="#cb442-2" tabindex="-1"></a>  <span class="fu">tm_fill</span>()<span class="sc">+</span></span>
<span id="cb442-3"><a href="#cb442-3" tabindex="-1"></a>  <span class="fu">tm_shape</span>(idhm.final) <span class="sc">+</span> <span class="co">#indica o nome do arquivo shapefile que será mapeado</span></span>
<span id="cb442-4"><a href="#cb442-4" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">&quot;IDHM&quot;</span>,<span class="at">title =</span> <span class="st">&quot;IDHM&quot;</span>, <span class="at">style =</span> <span class="st">&quot;fisher&quot;</span>, <span class="at">palette =</span> <span class="st">&quot;Oranges&quot;</span>, <span class="at">legend.hist =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb442-5"><a href="#cb442-5" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">title =</span> <span class="st">&quot;IDHM na RMSP&quot;</span>, <span class="at">title.size =</span> <span class="fl">0.8</span>, <span class="at">legend.title.size =</span> <span class="fl">0.5</span>, <span class="at">legend.text.size =</span> <span class="fl">0.5</span>, <span class="at">legend.outside =</span> <span class="cn">TRUE</span>, <span class="at">bg.color =</span> <span class="st">&quot;aliceblue&quot;</span>)<span class="sc">+</span></span>
<span id="cb442-6"><a href="#cb442-6" tabindex="-1"></a>  <span class="fu">tm_shape</span>(pop_wgs84)<span class="sc">+</span></span>
<span id="cb442-7"><a href="#cb442-7" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">&quot;white&quot;</span>, <span class="at">lwd =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb442-8"><a href="#cb442-8" tabindex="-1"></a>  <span class="fu">tm_credits</span>(<span class="st">&quot;Fonte: http://www.atlasbrasil.org.br</span><span class="sc">\n</span><span class="st"> 2022 @Ligiaviz&quot;</span>, <span class="at">position =</span> <span class="fu">c</span>(<span class="st">&quot;RIGHT&quot;</span>, <span class="st">&quot;BOTTOM&quot;</span>))<span class="sc">+</span></span>
<span id="cb442-9"><a href="#cb442-9" tabindex="-1"></a>  <span class="fu">tm_scale_bar</span>(<span class="at">width =</span> <span class="fl">0.2</span>, <span class="at">position =</span> <span class="fu">c</span>(<span class="st">&quot;0.71&quot;</span>, <span class="st">&quot;0.13&quot;</span>))</span>
<span id="cb442-10"><a href="#cb442-10" tabindex="-1"></a><span class="co">#para visualizar o mapa</span></span>
<span id="cb442-11"><a href="#cb442-11" tabindex="-1"></a>idhm.final.fisher</span></code></pre></div>
<div id="indo-além-proposta-de-exercício" class="section level2 hasAnchor" number="11.1">
<h2 class="hasAnchor"><span class="header-section-number">11.1</span> Indo além: Proposta de exercício<a href="#indo-além-proposta-de-exercício" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>No objeto “dadosUDH”, existe a variável “ESPVIDA”, que significa “Esperança de vida ao nascer”. Faça o mapa coroplético deste indicador seguindo os passos propostos neste capítulo.
Para saber mais sobre o <strong>tmap</strong>, consulte a <a href="https://cran.r-project.org/web/packages/tmap/tmap.pdf">documentação</a> e <a href="https://geocompr.robinlovelace.net/">Lovelace et al.(em andamento)</a>.</p>
</div>
<div id="referências-sugeridas-3" class="section level2 hasAnchor" number="11.2">
<h2 class="hasAnchor"><span class="header-section-number">11.2</span> Referências sugeridas<a href="#referências-sugeridas-3" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>ARMSTRONG, M. P., XIAO, N., BENNETT, D. A., 2003. Using genetic algorithms to create multicriteria class intervals for choropleth maps. <strong>Annals, Association of American Geographers</strong>, 93 (3), 595-623</p>
<p>BARROZO, L.V., PÉREZ-MACHADO, R.P., SMALL, C. CABRAL-MIRANDA, W. , 2015. Changing spatial perception: dasymetric mapping to improve analysis of health outcomes in a megacity. <strong>Journal of Maps</strong>, DOI:
10.1080/17445647.2015.1101403.</p>
<p>CAUVIN, C., ESCOBAR, F., SERRADJ, A., 2008. <strong>Cartographie thématique 3</strong>: méthodes quantitatives et transformations attributaires. Paris: Lavoisier, 147p.</p>
<p>JENKS, G. F., CASPALL, F. C., 1971. Error on choroplethic maps: definition, measurement, reduction. <strong>Annals, Association of American Geographers</strong>, 61 (2), 217–244.</p>
<p>LOVELACE, R., NOWOSAD, J., &amp; MUENCHOW, J. (in progress). <strong>Geocomputation with R</strong>. Available online via <a href="https://geocompr.robinlovelace.net/" class="uri">https://geocompr.robinlovelace.net/</a></p>
<p>MARTINELLI, M. <strong>Representações gráficas da geografia</strong>: os mapas temáticos. 1999. São Paulo: FFLCH/USP, Tese (Livre-Docência).</p>
<p>PETROV, A. 2008. Setting the Record Straight: On the Russian Origins of Dasymetric Mapping. <strong>Cartographica: The International Journal for Geographic Information and Geovisualization</strong>, 43(2):133-136.</p>
<p>POIDEVIN, D. 1999. <strong>La carte</strong>: moyen d’action. Guide pratique pour la conception &amp; la réalisation de cartes. Paris: Ellipses. 200p.</p>
<p>TENNEKES, M. 2018. tmap: Thematic Maps in R, <strong>Journal of Statistical Software</strong>, 84(6), 1-39, doi: 10.18637/jss.v084.i06</p>
<p><strong>Elegant and informative maps with tmap</strong>
<a href="https://r-tmap.github.io/tmap-book/index.html" class="uri">https://r-tmap.github.io/tmap-book/index.html</a></p>
<p><strong>Hands-On Spatial Data Science with R</strong>
<a href="https://spatialanalysis.github.io/handsonspatialdata/rate-mapping.html" class="uri">https://spatialanalysis.github.io/handsonspatialdata/rate-mapping.html</a></p>
<p><strong>Let’s Make a Map in R</strong> (mapas coropléticos com ggplot2)
<a href="https://medium.com/@traffordDataLab/lets-make-a-map-in-r-7bd1d9366098" class="uri">https://medium.com/@traffordDataLab/lets-make-a-map-in-r-7bd1d9366098</a></p>
<p><strong>R jenks.tests</strong>
<a href="http://www.endmemo.com/r/jenks.tests.php" class="uri">http://www.endmemo.com/r/jenks.tests.php</a></p>
<!--chapter:end:10-coropletico.Rmd-->
</div>
</div>
<div id="quanti4" class="section level1 hasAnchor" number="12">
<h1 class="hasAnchor"><span class="header-section-number">12</span> Dados quantitativos a partir de amostras: mapa isarítmico<a href="#quanti4" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Algumas informações com referência espacial são obtidas a partir de amostras distribuídas no espaço. Tais amostras podem ser pontuais e até mesmo lineares, tais como curvas de nível com valores de altitude ou batimetria. As amostras de pontos são mais comuns e incluem medidas de variáveis atmosféricas, de poluição do ar, amostras de solo, entre outras. Muitas vezes temos interesse em visualizar os valores em área não amostrada, sendo possível recorrermos a modelos matemáticos para gerar interpolações dos valores entre os pontos amostrados, resultando em uma superfície contínua. O mapa resultante é do tipo isarítmico.</p>
<p><strong>Capítulo em elaboração</strong></p>
<div id="referências-sugeridas-4" class="section level2 hasAnchor" number="12.1">
<h2 class="hasAnchor"><span class="header-section-number">12.1</span> Referências sugeridas<a href="#referências-sugeridas-4" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<!--chapter:end:11-isaritmico.Rmd-->
</div>
</div>
<div id="quanti5" class="section level1 hasAnchor" number="13">
<h1 class="hasAnchor"><span class="header-section-number">13</span> Mapa de fluxos: movimentos no espaço<a href="#quanti5" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p><strong>Capítulo em elaboração</strong></p>
<!--chapter:end:12-fluxos.Rmd-->
</div>
<div id="osm" class="section level1 hasAnchor" number="14">
<h1 class="hasAnchor"><span class="header-section-number">14</span> Usando dados do Open Street Map<a href="#osm" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p><strong>Capítulo em elaboração</strong></p>
<!--chapter:end:13-osm-basemap.Rmd-->
</div>
<div id="anamorf" class="section level1 hasAnchor" number="15">
<h1 class="hasAnchor"><span class="header-section-number">15</span> Anamorfose<a href="#anamorf" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p><strong>Capítulo em elaboração</strong></p>
<!--chapter:end:14-anamorfose.Rmd-->
</div>
<div id="sintese" class="section level1 hasAnchor" number="16">
<h1 class="hasAnchor"><span class="header-section-number">16</span> Mapas de síntese<a href="#sintese" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p><strong>Capítulo em elaboração</strong></p>
<!--chapter:end:15-sintese.Rmd-->
</div>
<!--bookdown:body:end-->
            </section>

          </div>
        </div>
      </div>
<!--bookdown:link_prev-->
<!--bookdown:link_next-->
    </div>
  </div>
<!--bookdown:config-->

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
